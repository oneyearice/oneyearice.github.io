# ç¬¬8èŠ‚. ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®



## linuxå®ç°sw

**ç½‘æ¡¥**

![image-20220325085922473](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325085922473.png)



vmnet8å’Œvmnet0æŒ‰ç†è¯´æ˜¯VMwareWorkstationçš„ä¸¤ä¸ªç½‘æ®µæ˜¯ä¸é€šçš„ï¼Œä½†æ˜¯é€šè¿‡VMè™šæœºçš„ç½‘æ¡¥å®ç°äºŒå±‚äº’é€šã€‚

![image-20220325091117522](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325091117522.png)

å®éªŒç¯å¢ƒå¦‚ä¸Šï¼Œä¸‹é¢å¼€å§‹é…ç½®

é…ç½®å¥½ä¸¤å¤´çš„IPåœ°å€å°±è¡Œï¼Œè¯·ä¸è¦é…ç½®ç½‘å…³ æˆ‘ä»¬åœ¨åšäºŒå±‚å®éªŒ



### é…ç½®ä¸­é—´çš„æœºå™¨ä¸ºç½‘æ¡¥

#### æ–¹æ³•1ï¼šä¼ ç»Ÿå‘½ä»¤é…ç½®ï¼Œé‡‡ç”¨å·¥å…·é›†ï¼Œç¼ºç‚¹ä¸èƒ½å­˜ç›˜

<img src="8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325091823398.png" alt="image-20220325091823398" style="zoom:80%;" /> 

ç¡®è®¤å·²ç»å®‰è£…äº†bridge-utilså·¥å…·é›†ï¼Œæœ€å°åŒ–å®‰è£…æ—¶æ²¡æœ‰çš„

å…¶ä¸­æœ‰ä¸€ä¸ª/usr/sbin/brctlå·¥å…·

å°†åŸæœ‰çš„IPåœ°å€ç­‰ä¸‰å±‚ä¿¡æ¯å¹²æ‰ï¼Œä»¥å†…è¦å®ç°çš„æ˜¯äºŒå±‚SWçš„äºŒå±‚å£

![image-20220325092141833](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325092141833.png)



**btctl showæŸ¥çœ‹å½“å‰ä¿¡æ¯ä¸ºç©º**

![image-20220325092257427](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325092257427.png)



**brctl addr br0åˆ›å»ºæ¡¥æ¥è®¾å¤‡br0è¿™ä¸ªsw**

![image-20220325092539760](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325092539760.png)



**brctl addif br0 eth0 eth1å°†æ¥å£åŠ å…¥ç½‘æ¡¥è®¾å¤‡**

![image-20220325092709215](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325092709215.png)



æ­¤æ—¶å°±å…¶å®å®éªŒå°±æå®šäº†ï¼Œ

**è¿˜å¯ä»¥å¯ç”¨STP**

![image-20220325092816942](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325092816942.png)



**æŸ¥çœ‹swä¸Šçš„macåœ°å€**

![image-20220325092936829](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325092936829.png)

![image-20220325093014379](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325093014379.png)

è¿˜æ²¡æœ‰å­¦åˆ°ä¸¤å¤´çš„MACåœ°å€ï¼Œè‡ªç„¶è¿˜ä¸é€šï¼Œæ‰¾ä¸‹æ•…éšœåŸå› ï¼Œå…¶å®æ•…éšœåŸå› ä¸Šå›¾ğŸ‘†å¯ä»¥çœ‹åˆ°ä¸€ä¸ªbr0æ˜¯<font color=red>DOWN</font>çš„ï¼Œè‚¯å®šä¸è¡Œäº†å•Šã€‚æ‰€ä»¥åªéœ€è¦ip link set br0 upå°±è¡Œäº†ï¼Œå“ˆå“ˆå¤§ä½¬ç«Ÿç„¶æ²¡çœ‹å‡ºæ¥~

ä¸¤å¤´éƒ½pingè¿™ï¼Œç„¶åä¸­é—´çš„swä¸ŠtcpdumæŠ“åŒ…ç»“æœæ²¡æœ‰ï¼Œçœ‹æ¥é—®é¢˜ä¸æ˜¯åœ¨ä¸­é—´è®¾å¤‡ï¼Œè¿™è¯è¯´çš„ï¼Œä¸­é—´è®¾å¤‡çš„br0æ²¡èµ·æ¥ï¼Œå°±å¥½æ¯”a----sw-----bçš„swä¸¤ä¸ªç½‘å£æ˜¯downçš„ï¼Œä½ è¯´æ˜¯ä¸æ˜¯ä¸­é—´è®¾å¤‡é—®é¢˜ï¼Œé—®é¢˜å°±æ˜¯br0æ²¡æœ‰UPï¼Œip link set br0 upå³å¯ã€‚é‡è¦çš„äº‹è¯´ä¸¤é~

![image-20220325094435154](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325094435154.png)

![image-20220325094553205](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325094553205.png)



![image-20220325095807064](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325095807064.png) 









#### æ–¹æ³•2ï¼šcentos7çš„ä¸“é—¨å·¥å…·nmcliï¼Œå¯ä»¥å­˜ç›˜

ä¸Šæ¬¡æ–¹æ³•1 çš„é…ç½®

![image-20220325100213583](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325100213583.png)

ç„¶åå¼€å§‹ä½¿ç”¨nmcliæ–¹æ³•è¿›è¡Œé…ç½®



**åˆ›å»ºbr0æ¥å£**

```
nmcli connection add con-name mybr0 type bridge ifname br0
```

![image-20220325100655286](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325100655286.png)



![image-20220325100823319](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325100823319.png)



**åŠ å…¥æˆå‘˜å£**

```shell
nmcli connection add con-name mybr0-eth0 ifname eth0 type bridge-slave master br0
nmcli connection add con-name mybr0-eth1 ifname eth1 type bridge-slave master br0
```



![image-20220325101003363](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325101003363.png)



å…¶å®å°±æ˜¯æ–°å»ºäº†é…ç½®æ–‡ä»¶

![image-20220325120134652](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325120134652.png)





**åŠ å…¥ä¸¤å¼ ç½‘å¡å¹¶å¯ç”¨ç½‘æ¡¥br0**

```
nmcli connection up mybr0-eth0
nmcli connection up mybr0-eth1
ip link br0 set up
```

![image-20220325101237754](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325101237754.png)

ä½ çœ‹ä¸Šå›¾çš„mybr0æ˜¯é»„è‰²å¯¹å§ï¼Œå…¶å®åœ¨ç»ˆç«¯é‡Œæ˜¯çº¢è‰²ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯downçš„ï¼Œæ˜¯æœ‰é—®é¢˜ã€‚ä¸ç®¡æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Œéƒ½è¦upèµ·æ¥çš„ã€‚



æ­¤æ—¶br0æ‹¿åˆ°äº†ä¸ªåœ°å€ï¼Œå°±æ˜¯DHCPçš„äº†ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯ç®¡ç†IPå’¯ï¼Œç±»æ¯”äºäºŒå±‚äº¤æ¢æœºçš„SVIå£ï¼Œç±»æ¯”äºé€æ˜å¢™çš„L3åœ°å€ã€‚

![image-20220325102416626](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325102416626.png)

å…¶å®æˆ‘åœ¨åšå®éªŒçš„ï¼Œå‘ç°ä¸€æ ·éœ€è¦ip link set br0 up çš„ï¼Œå³ä½¿ç”¨nmcli æ¥åšbr0ï¼Œä¸€æ ·é»˜è®¤ä¹Ÿæ˜¯DOWNçš„ã€‚



ä»¥ä¸Šå°±å¯ä»¥äº†ï¼Œå‡æµ‹è¯•OK





## Ubuntuç½‘ç»œé…ç½®

### ç½‘å¡åçš„ä¿®æ”¹å’Œcentos 7ä¸€æ ·ï¼š

<img src="8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325122032252.png" alt="image-20220325122032252" style="zoom:80%;" /> 





### ç½‘å¡é…ç½®

![image-20220325122132847](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325122132847.png)

**åˆ‡åˆ°root**

![image-20220325122215604](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325122215604.png) 



æŸ¥çœ‹IPåœ°å€

![image-20220325122716246](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325122716246.png)

nmcli è¿˜çœ‹ä¸åˆ°ï¼Œip aæ˜¯æœ‰æ¥å£çš„ ç›®å‰å¤„äºdownçŠ¶æ€

å°è¯•å¯ç”¨æ¥å£ï¼Œå¹¶æœªæ‹¿åˆ°åœ°å€ï¼Œ

![image-20220325122829777](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325122829777.png) 

æŸ¥çœ‹ç½‘å¡é…ç½®æ–‡ä»¶

```
cat /etc/netplan/01-netcfg.yaml
```

yamlæ–‡ä»¶å’Œpythonä¸€æ ·ï¼Œç¼©è¿›å¿…é¡»ä¸¥æ ¼ç»Ÿä¸€ï¼Œå¦åˆ™æŠ¥é”™ã€‚

æŸ¥çœ‹ç½‘å¡é…ç½®æ–‡ä»¶ï¼Œå‘ç°å†™çš„æ˜¯ens33è€Œä¸æ˜¯eth0ï¼Œä¹‹å‰æ”¹è¿‡åå­—äº†ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶é‡Œçš„åå­—ä¹Ÿè¦æ”¹

![image-20220325123058550](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325123058550.png)



æ”¹æˆeth0ï¼Œæ³¨æ„ç¼©è¿›ä¸¤ä¸ªç©ºæ ¼

![image-20220325132241202](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325132241202.png)

é‡å¯æœåŠ¡ï¼Œnetplan applyç±»ä¼¼äºsystemctl restart netowrkã€‚

![image-20220325132319154](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325132319154.png) 

æ­¤æ—¶å°±èƒ½DHCPåŠ¨æ€è·å–åœ°å€äº†

![image-20220325132400887](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325132400887.png)



https://ubuntu.com/server/docs/network-configuration

![image-20220325133018246](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325133018246.png)

![image-20220325133318595](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325133318595.png)



æŒ‰å›¾é…ç½®å¥½åï¼Œé‡å¯æœåŠ¡netplan applyï¼Œåcat /etc/resolv.confé‡Œæ˜¯æ²¡æœ‰DNSä¿¡æ¯çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯åœ¨çš„

![image-20220325134133535](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325134133535.png)

ä½¿ç”¨systemd-resolve --statusè¿›è¡ŒæŸ¥çœ‹å…·ä½“é…ç½®çš„DNSä¿¡æ¯

![image-20220325133936287](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325133936287.png) 





![image-20220325134303512](8-ç½‘æ¡¥å®ç°å’Œubuntuç½‘ç»œé…ç½®.assets/image-20220325134303512.png)







