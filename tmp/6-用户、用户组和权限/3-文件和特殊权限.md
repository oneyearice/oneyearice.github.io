# ç¬¬3èŠ‚. æ–‡ä»¶å’Œç‰¹æ®Šæƒé™



## æ¥ä¸Šæ–‡ï¼Œæ¨¡å¼æ³•

```
chmod who opt per file
who:	u,g,o,a
opt:	+,-,=
per:	r,w,x
```

## æ•°å­—æ³•

```
rwxrw-r--	f1
111110100   ğŸ‘‰ 111 110 100 = 7 6 4
r 4
w 2
x 1
```

## æ–‡ä»¶å¤¹çš„æƒé™

```
wï¼šé’ˆå¯¹æ–‡ä»¶å¤¹ï¼Œå°±æ˜¯åˆ›å»ºã€åˆ é™¤å…¶ä¸­çš„æ–‡ä»¶ã€‚è€Œä¿®æ”¹æ–‡ä»¶æ¶‰åŠçš„æ˜¯æ–‡ä»¶æœ¬èº«çš„å†™æƒé™ã€‚
----------ğŸ‘‡---------------------------------
[user1@centos7 dir]$ ll ./ -d
drwxr-xr-x. 2 root root 16 Feb  8 09:23 ./		 # æ–‡ä»¶å¤¹dirçš„æƒé™
[root@centos7 dir]# su user1
[user1@centos7 dir]$ ll
total 0
-rw-r--rw-. 1 root root 0 Feb  8 09:23 f1
[user1@centos7 dir]$ touch 11
touch: cannot touch â€˜11â€™: Permission denied
[user1@centos7 dir]$ vi f1
[user1@centos7 dir]$ cat f1
111
[user1@centos7 dir]$ rm f1
rm: cannot remove â€˜f1â€™: Permission denied
[user1@centos7 dir]$ echo xxx > f1
[user1@centos7 dir]$ cat f1
xxx
[user1@centos7 dir]$

```

```
r: è¯»æƒé™é’ˆå¯¹æ–‡ä»¶å¤¹å°±æ˜¯çœ‹ä¸åˆ°æ–‡ä»¶å¤¹ä¸‹é¢çš„å†…å®¹ï¼Œä½†æ˜¯å¦‚æœä½ çŸ¥é“æŸä¸ªæ–‡ä»¶çš„åç§°ï¼Œæ˜¯å¯ä»¥ç›´æ¥çœ‹è¯¥æ–‡ä»¶å†…å®¹çš„ã€‚
[root@centos7 data]# chmod o-r dir/
[root@centos7 data]# ll
total 0
drwxr-x--x. 2 root root 16 Feb  8 09:46 dir
[root@centos7 data]# su user1
[user1@centos7 data]$ cat dir/f1
xx
[user1@centos7 data]$ cd dir
[user1@centos7 dir]$ ls
ls: cannot open directory .: Permission denied
[user1@centos7 dir]$ cat f1
xx
[user1@centos7 dir]$ ll -d f1
-rw-r--r--. 1 root root 3 Feb  8 09:48 f1
[user1@centos7 dir]$ ll
ls: cannot open directory .: Permission denied
[user1@centos7 dir]$

```

```
xï¼šæ‰§è¡Œæƒé™é’ˆå¯¹æ–‡ä»¶å¤¹å°±æ˜¯è¿›å…¥å’¯ï¼Œè¿™ä¸ªæ‰§è¡Œä¸€æ—¦å–æ¶ˆï¼Œå…³ç³»å°±å¤§äº†ï¼Œä½ è¿æ–‡ä»¶å¤¹éƒ½è¿›ä¸å»ï¼Œé‚£ä¹ˆæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å°±çœ‹ä¸åˆ°<<åªæ˜¯çœ‹ä¸åˆ°å…ƒæ•°æ®ï¼Œæ–‡ä»¶åç§°å€’æ˜¯å¯ä»¥çœ‹åˆ°è¿™ä¸ªqu'jue'yuï¼Œ
ğŸ‘‡-----è¿™æ˜¯dirçš„rwxéƒ½æ²¡çš„æƒ…å†µ----
[root@centos7 data]# chmod o-x dir
[root@centos7 data]# ll
total 0
drwxr-x---. 2 root root 16 Feb  8 09:46 dir
[root@centos7 data]# ll dir/
total 4
-rw-r--r--. 1 root root 3 Feb  8 09:48 f1
[root@centos7 data]# cd dir/
[root@centos7 dir]# ll
total 4
-rw-r--r--. 1 root root 3 Feb  8 09:48 f1
[root@centos7 dir]# chmod o+w f1
[root@centos7 dir]# cd ..
[root@centos7 data]# ll
total 0
drwxr-x---. 2 root root 16 Feb  8 09:46 dir
[root@centos7 data]# ll dir/
total 4
-rw-r--rw-. 1 root root 3 Feb  8 09:48 f1
[root@centos7 data]# su user1
[user1@centos7 data]$ cd dir
bash: cd: dir: Permission denied
[user1@centos7 data]$ cat dir/f1
cat: dir/f1: Permission denied
[user1@centos7 data]$ echo 333 dir/f1
333 dir/f1
[user1@centos7 data]$ echo 333 > dir/f1
bash: dir/f1: Permission denied
[user1@centos7 data]$ ll dir/
ls: cannot open directory dir/: Permission denied
[user1@centos7 data]$
ğŸ‘‡-----ç»™ä¸Šé¢çš„dirè¡¥ä¸€ä¸ªrè¯»æƒé™----
[root@centos7 data]# chmod o=r dir
[root@centos7 data]# ll
total 0
drwxr-xr--. 2 root root 16 Feb  8 09:46 dir
[root@centos7 data]# ll dir/f1
-rw-r--rw-. 1 root root 3 Feb  8 09:48 dir/f1
[root@centos7 data]#
[root@centos7 data]# su user1
[user1@centos7 data]$ ll dir
ls: cannot access dir/f1: Permission denied
total 0
-????????? ? ? ? ?            ? f1				# ğŸ‘ˆå…ƒæ•°æ®çœ‹ä¸åˆ°ï¼Œæ–‡ä»¶åå­—å€’æ˜¯å¯ä»¥çš„
[user1@centos7 data]$ cd dir
bash: cd: dir: Permission denied
[user1@centos7 data]$ ll dir/f1
ls: cannot access dir/f1: Permission denied
[user1@centos7 data]$

```

æ–‡ä»¶å¤¹æ¥è®²ï¼š

ç›®å½•å­˜æ”¾çš„æ•°æ®å—é‡Œçš„å†…å®¹æ˜¯å„ä¸ªæ–‡ä»¶åå’Œå…¶å¯¹åº”çš„èŠ‚ç‚¹ä¿¡æ¯

æ–‡ä»¶å­˜æ”¾çš„æ•°æ®å—é‡Œçš„å†…å®¹æ˜¯æ–‡ä»¶çš„å†…å®¹

**è¯»**ï¼šå¯ä»¥åˆ—å‡ºè¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åï¼Œæ‹¿æ‰åï¼Œå¦‚æœçŸ¥é“æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶åï¼Œä¹Ÿèƒ½é€šè¿‡/dir/fileå»ç›´æ¥catï¼ˆè¿™å–å†³äºæ–‡ä»¶æœ¬èº«çš„ræƒé™ï¼‰ã€‚

**æ‰§è¡Œ**ï¼šå¯ä»¥è¿›å…¥ç›®å½•ï¼Œå¯ä»¥è®¿é—®ç›®å½•é‡Œçš„æ–‡ä»¶å†…å®¹(ä¾èµ–äºæ–‡ä»¶æœ¬èº«çš„ræƒé™)ã€‚

**å†™**ï¼šå†³å®šæ˜¯å¦å¯ä»¥åœ¨ç›®å½•é‡Œé¢åˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶ã€‚æ–‡ä»¶æœ¬èº«çš„æƒé™è¿˜å¾—çœ‹æ–‡ä»¶è‡ªå·±çš„ã€‚

æ³¨æ„ï¼Œwéœ€è¦xåŠ æŒ~å¦‚æœæ–‡ä»¶å¤¹çš„æ‰§è¡Œæƒé™å–æ¶ˆï¼ŒåŠæ—¶æœ‰å†™æƒé™ï¼Œç”±äºè¿›ä¸åˆ°è¯¥ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æ³•å»å†™æ–‡ä»¶çš„ã€‚

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119112747536.png" alt="image-20220119112747536" style="zoom:67%;" /> 

## è¯´ä¸‹å¤§Xï¼Œåé¢å†å°†st

```
[root@centos7 data]# ll
total 0
drwxr-xr--. 2 root root 16 Feb  8 09:46 dir
-rw-r--r--. 1 root root  0 Feb  8 11:31 f1
-rw-r--r--. 1 root root  0 Feb  8 11:31 f2
[root@centos7 data]# chmod -R a+x /data
[root@centos7 data]# ll /data
total 0
drwxr-xr-x. 2 root root 16 Feb  8 09:46 dir
-rwxr-xr-x. 1 root root  0 Feb  8 11:31 f1
-rwxr-xr-x. 1 root root  0 Feb  8 11:31 f2
[root@centos7 data]# ll /data -d
drwxr-xr-x. 3 root root 37 Feb  8 11:31 /data

------ğŸ‘†é€šè¿‡-Rå¯ä»¥ä½¿æ–‡ä»¶å¤¹å’Œå…¶ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æƒé™éƒ½é€’å½’æ”¹æ‰-----
ä½†æ˜¯å¦‚æœé‡åˆ°æ–‡ä»¶ä½ ç»™å®ƒä¸€ä¸ªxæ‰§è¡Œæƒé™ï¼Œå¾€å¾€å­˜åœ¨å®‰å…¨é£é™©---æ‰€ä»¥-R é…åˆå¤§Xå°±å¯ä»¥è¿‡æ»¤æ–‡ä»¶çš„æƒé™ä¿®æ”¹
ğŸ‘‡
[root@centos7 data]# chmod -R a-x /data/
[root@centos7 data]# ll /data/
total 0
drw-r--r--. 2 root root 16 Feb  8 09:46 dir
-rw-r--r--. 1 root root  0 Feb  8 11:31 f1
-rw-r--r--. 1 root root  0 Feb  8 11:31 f2
[root@centos7 data]# chmod -R a+X /data/
[root@centos7 data]# ll /data/
total 0
drwxr-xr-x. 2 root root 16 Feb  8 09:46 dir
-rw-r--r--. 1 root root  0 Feb  8 11:31 f1
-rw-r--r--. 1 root root  0 Feb  8 11:31 f2
[root@centos7 data]#

```

**ç»ƒä¹ **ï¼š

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119115054290.png" alt="image-20220119115054290" style="zoom:67%;" /> 

```
è¯¯åˆ äº†ç”¨æˆ·mingçš„å®¶ç›®å½•ï¼Œè¿›è¡Œæ¢å¤
ä¸‰æ¡å‘½ä»¤
cp -r /etc/skel /home/ming
chown -R ming.ming /home/ming
chmod 700 /home/ming   # é‡Œé¢çš„å‡ ä¸ªéšè—æ–‡ä»¶éƒ½æ˜¯ä»/etc/skelä¸‹å¤åˆ¶è¿‡æ¥çš„ï¼Œå±æ€§ä¸å˜å°±å¥½ã€‚

---è¯¯åˆ é™¤äº†ç”¨æˆ·mingå®¶ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä½†æ˜¯ç›®å½•è¿˜åœ¨ï¼Œè¿›è¡Œæ¢å¤ğŸ‘‡
[root@centos7 ~]# rm -rf /home/ming/.*
rm: refusing to remove â€˜.â€™ or â€˜..â€™ directory: skipping â€˜/home/ming/.â€™
rm: refusing to remove â€˜.â€™ or â€˜..â€™ directory: skipping â€˜/home/ming/..â€™
[root@centos7 ~]# ll -a /home/ming
total 0
drwx------.  2 ming ming   6 Feb  8 13:43 .
drwxr-xr-x. 16 root root 192 Feb  8 12:01 ..
--ğŸ‘‡æ³¨æ„ï¼Œæ­¤æ—¶é€šè¿‡.*å¤åˆ¶/etc/skel/ä¸‹çš„æ‰€æœ‰æ–‡ä»¶--åŒ…å«éšè—å’Œééšè—ï¼Œä¼šæœ‰å¤§é—®é¢˜ğŸ•--
[root@centos7 home]# cp -r /etc/skel/.* /home/ming
cp: will not create hard link â€˜/home/ming/skelâ€™ to directory â€˜/home/ming/.â€™
cp: overwrite â€˜/home/ming/.bash_logoutâ€™? ^C
[root@centos7 home]# ll /home/ming
total 1036
-rw-r--r--.  1 root root     16 Feb  8 13:44 adjtime
-rw-r--r--.  1 root root   1529 Feb  8 13:44 aliases
-rw-r--r--.  1 root root  12288 Feb  8 13:44 aliases.db
drwxr-xr-x.  2 root root    236 Feb  8 13:44 alternatives
-rw-------.  1 root root    541 Feb  8 13:44 anacrontab
-rw-r--r--.  1 root root     55 Feb  8 13:44 asound.conf
drwxr-x---.  3 root root     43 Feb  8 13:44 audisp
drwxr-x---.  3 root root     83 Feb  8 13:44 audit
drwxr-xr-x.  2 root root     22 Feb  8 13:44 bash_completion.d
-rw-r--r--.  1 root root   2853 Feb  8 13:44 bashrc
drwxr-xr-x.  2 root root      6 Feb  8 13:44 binfmt.d
-rw-r--r--.  1 root root     37 Feb  8 13:44 centos-release
-rw-r--r--.  1 root root     51 Feb  8 13:44 centos-release-upstream
drwxr-xr-x.  2 root root      6 Feb  8 13:44 chkconfig.d
drwxr-xr-x.  2 root root     21 Feb  8 13:44 cron.d
drwxr-xr-x.  2 root root     42 Feb  8 13:44 cron.daily
-rw-------.  1 root root      0 Feb  8 13:44 cron.deny
drwxr-xr-x.  2 root root     22 Feb  8 13:44 cron.hourly
drwxr-xr-x.  2 root root      6 Feb  8 13:44 cron.monthly
-rw-r--r--.  1 root root    451 Feb  8 13:44 crontab
drwxr-xr-x.  2 root root      6 Feb  8 13:44 cron.weekly
-rw-------.  1 root root      0 Feb  8 13:44 crypttab
-rw-r--r--.  1 root root   1620 Feb  8 13:44 csh.cshrc
-rw-r--r--.  1 root root   1103 Feb  8 13:44 csh.login
ğŸ‘†å‘ç°å¤åˆ¶å¾ˆNå¤šæ–‡ä»¶è¿‡æ¥äº†ï¼ŒåŸå› æ˜¯å› ä¸º.*é€šé…ç¬¦å®ƒä»£è¡¨.xxxè¿˜æœ‰..xxxæ‰€ä»¥å¤åˆ¶.*æ„å‘³ç€ä½ ä¸ä»…ä»…å¤åˆ¶äº†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¹Ÿå¤åˆ¶äº†ä¸Šçº§ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚
æ¨èğŸ‘‡ğŸ‘‰ä½¿ç”¨cp -r /etc/skel/. /home/mingè¿™ç§æ–¹å¼å¤åˆ¶æ‰€æœ‰æ–‡ä»¶å«éšè—æ–‡ä»¶
drwx------. 2 root root 6 Feb  8 13:52 ming
[root@centos7 home]# cp -r /etc/skel/. /home/ming
[root@centos7 home]# ll -a ming
total 12
drwx------.  2 root root  72 Feb  8 13:53 .
drwxr-xr-x. 16 root root 192 Feb  8 13:52 ..
-rw-r--r--.  1 root root  18 Feb  8 13:53 .bash_logout
-rw-r--r--.  1 root root 193 Feb  8 13:53 .bash_profile
-rw-r--r--.  1 root root 231 Feb  8 13:53 .bashrc
-rw-r--r--.  1 root root   0 Feb  8 13:53 f1
[root@centos7 home]#
------ğŸ‘‡è¿™æ ·ä¹Ÿè¡Œï¼Œå°±æ˜¯é€šè¿‡.[^.]*æ¥è¡¨ç¤ºæ‰€æœ‰éšè—æ–‡ä»¶ï¼Œå’Œ*æ¥è¡¨ç¤ºæ‰€æœ‰ééšè—æ–‡ä»¶----
[root@centos7 home]# cp -r /etc/skel/.[^.]* /home/ming
[root@centos7 home]# ll /home/ming -a
total 12
drwx------.  2 root root  62 Feb  8 13:55 .
drwxr-xr-x. 16 root root 192 Feb  8 13:52 ..
-rw-r--r--.  1 root root  18 Feb  8 13:55 .bash_logout
-rw-r--r--.  1 root root 193 Feb  8 13:55 .bash_profile
-rw-r--r--.  1 root root 231 Feb  8 13:55 .bashrc
[root@centos7 home]# cp -r /etc/skel/* /home/ming
[root@centos7 home]# ll /home/ming -a
total 12
drwx------.  2 root root  72 Feb  8 13:55 .
drwxr-xr-x. 16 root root 192 Feb  8 13:52 ..
-rw-r--r--.  1 root root  18 Feb  8 13:55 .bash_logout
-rw-r--r--.  1 root root 193 Feb  8 13:55 .bash_profile
-rw-r--r--.  1 root root 231 Feb  8 13:55 .bashrc
-rw-r--r--.  1 root root   0 Feb  8 13:55 f1
[root@centos7 home]#

```

mkdiråˆ›å»ºæ–‡ä»¶å¤¹çš„æ—¶å€™å¯ä»¥è®¾ç½®æƒé™

```
[root@centos7 home]# mkdir --help
Usage: mkdir [OPTION]... DIRECTORY...
Create the DIRECTORY(ies), if they do not already exist.

Mandatory arguments to long options are mandatory for short options too.
  -m, --mode=MODE   set file mode (as in chmod), not a=rwx - umask
  -p, --parents     no error if existing, make parent directories as needed
  -v, --verbose     print a message for each created directory
  -Z                   set SELinux security context of each created directory
                         to the default type
      --context[=CTX]  like -Z, or if CTX is specified then set the SELinux
                         or SMACK security context to CTX
      --help     display this help and exit
      --version  output version information and exit

GNU coreutils online help: <http://www.gnu.org/software/coreutils/>
For complete documentation, run: info coreutils 'mkdir invocation'
[root@centos7 home]#

[root@centos7 ~]# mkdir -m 000  /home/sb001
[root@centos7 ~]# ll /home/sb001 -d
d---------. 2 root root 6 Feb  8 14:00 /home/sb001
[root@centos7 ~]#

```

## æ–‡ä»¶çš„ç‰¹æ®Šæƒé™



/etc/shaowè¿™ä¸ªæ–‡ä»¶æ™®é€šç”¨æˆ·æ²¡æœ‰æƒé™å¯¹å…¶ä¿®æ”¹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡passwdå‘½ä»¤å¯¹å…¶è¿›è¡Œä¿®æ”¹çš„ï¼Œå› ä¸ºæ”¹è‡ªèº«å¯†ç æœ¬è´¨ä¸Šå°±æ˜¯ä¿®æ”¹äº†shadowæ–‡ä»¶ã€‚

```
[root@centos7 ~]# ll /etc/shadow
----------. 1 root root 1366 Feb  8 14:06 /etc/shadow
[root@centos7 ~]# su user1
[user1@centos7 root]$ cat /etc/shadow
cat: /etc/shadow: Permission denied
[user1@centos7 root]$ echo xx /etc/shadow
xx /etc/shadow
[user1@centos7 root]$ echo xx >> /etc/shadow
bash: /etc/shadow: Permission denied
[user1@centos7 root]$ passwd
Changing password for user user1.
Changing password for user1.
(current) UNIX password:
passwd: Authentication token manipulation error
[user1@centos7 root]$ passwd
Changing password for user user1.
Changing password for user1.
(current) UNIX password:
New password:
Retype new password:
passwd: all authentication tokens updated successfully.
[user1@centos7 root]
```

è¿™æ˜¯å› ä¸ºpasswdå‘½ä»¤-ä¹Ÿå°±æ˜¯è¿™/bin/passwdè¿™ä¸ªæ‰§è¡Œæ–‡ä»¶ç”¨æˆ·å±æ€§ä½ä¸Šæœ‰sä½ã€‚

[user1@centos7 root]$ ll /bin/passwd
<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119141502513.png" alt="image-20220119141502513" style="zoom:67%;" /> 

**suid**å½“ç”¨æˆ·ä½¿ç”¨è¯¥ç¨‹åº/å‘½ä»¤è®¿é—®æŸä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼ŒåŸåˆ™ä¸Šæ˜¯ä½¿ç”¨è¿™ä¸ªç”¨æˆ·çš„æƒé™å»è®¿é—®æ–‡ä»¶ã€‚

ä¸€æ—¦æœ‰äº†suidï¼Œä¸ç®¡è°è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œé€šè¿‡è¿™ä¸ªç¨‹åºè®¿é—®æ–‡ä»¶ï¼Œå°±æ˜¯è·å¾—è¿™ä¸ªç¨‹åºæ‰€æœ‰è€…çš„æƒé™ã€‚ä¸Šå›¾åªè¦ä½ è¿è¡Œpasswdï¼Œä½ çš„èº«ä»½å°±è½¬æ¢ä¸ºrootäº†ã€‚suidå…¨ç§°å°±æ˜¯set owner user id up to executionåœ¨æ‰§è¡Œæ—¶è®¾ç½®æ‰€æœ‰è€…ç”¨æˆ·IDã€‚



ç¬¬äºŒç‚¹ï¼Œsuidä¸€å®šæ˜¯ä½œç”¨åœ¨<font color=red>äºŒè¿›åˆ¶</font>çš„å¯æ‰§è¡Œçš„æ–‡ä»¶ä¸Š(å¯¹shellè„šæœ¬æ— æ•ˆ)ï¼Œå¦åˆ™æ²¡æœ‰æ„ä¹‰äº†å°±ã€‚æ‰€ä»¥å¤§Sæ²¡æœ‰æ„ä¹‰-å»æ‰xåå°±æ˜¯å¤§S

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119142750167.png" alt="image-20220119142750167" style="zoom:67%;" /> 



```
[root@centos7 ~]# ll /usr/bin/vi
-rwsr-xr-x. 1 root root 928056 Oct 14  2020 /usr/bin/vi
[root@centos7 ~]# su user
su: user user does not exist
[root@centos7 ~]# su user1
[user1@centos7 root]$ vi /etc/shadow    # æ­¤æ—¶å°±å¯ä»¥viè¿›å»ä¿®æ”¹å¹¶ä¿æŒäº†
[user1@centos7 root]$ echo xxx >> /etc/shadow   # echoä¸è¡Œè‚¯å®šçš„å•Šä½ suidçš„æ˜¯vimå•Š
bash: /etc/shadow: Permission denied
----------è¿™ä¸ªï¼Œï¼Œï¼Œå°è¯•å°†echoå˜æˆsuidæƒé™ï¼Œå‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œå¯èƒ½è¦è¯¥é‡å®šå‘æ–‡ä»¶å’¯å‘µå‘µ----
[root@centos7 ~]# which echo
/usr/bin/echo
[root@centos7 ~]# ll /usr/bin/echo
-rwxr-xr-x. 1 root root 33088 Aug 20  2019 /usr/bin/echo
[root@centos7 ~]# chmod u+s /usr/bin/echo
[root@centos7 ~]# ll /usr/bin/echo
-rwsr-xr-x. 1 root root 33088 Aug 20  2019 /usr/bin/echo
[root@centos7 ~]# su user1
[user1@centos7 root]$ echo xx >> /etc/shadow
bash: /etc/shadow: Permission denied
[user1@centos7 root]$ exit
exit
[root@centos7 ~]# which >>
-bash: syntax error near unexpected token `newline'
[root@centos7 ~]#

```

## æ•°å­—æ³•ä¿®æ”¹suidï¼š

4æ˜¯å•ç‹¬ç®—çš„

```
[root@centos7 ~]# ll /usr/bin/echo
-rwsr-xr-x. 1 root root 33088 Aug 20  2019 /usr/bin/echo
[root@centos7 ~]# chmod 755 /usr/bin/echo
[root@centos7 ~]# ll /usr/bin/echo
-rwxr-xr-x. 1 root root 33088 Aug 20  2019 /usr/bin/echo
[root@centos7 ~]# chmod 4755 /usr/bin/echo
[root@centos7 ~]# ll /usr/bin/echo
-rwsr-xr-x. 1 root root 33088 Aug 20  2019 /usr/bin/echo
[root@centos7 ~]#

```



## sgid

1ã€å¦‚æœæŸä¸ªç”¨æˆ·è¿è¡Œcatç¨‹åºä¹Ÿå³æ˜¯ä½¿ç”¨catå»è®¿é—®æ–‡ä»¶ï¼Œå°±ä¼šç»§æ‰¿æ‰€å±ç»„çš„æƒé™ã€‚æˆ–è€…è¯´å°±ä¼šå°†ç”¨æˆ·åŸæœ¬çš„æ‰€å±ç»„æå‡è‡³è¯¥ç¨‹åºçš„æ‰€å±ç»„ã€‚

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119143918872.png" alt="image-20220119143918872" style="zoom:67%;" /> 

åŒæ ·æ•°å­—æ³•

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119144535142.png" alt="image-20220119144535142" style="zoom:67%;" /> 

755å‰é¢è¡¥ä¸€ä¸ª2ï¼Œsgid

755å‰é¢è¡¥ä¸€ä¸ª4ï¼Œsguid

755å‰é¢è¡¥ä¸€ä¸ª6ï¼Œsuid+sgid

## ç²˜æ»ä½

é’ˆå¯¹æ–‡ä»¶å¤¹çš„å±æ€§

éç”¨æˆ·æœ¬äººï¼Œæ— æ³•åˆ é™¤æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119150030146.png" alt="image-20220119150030146" style="zoom: 67%;" /> 

<img src="3-æ–‡ä»¶å’Œç‰¹æ®Šæƒé™.assets/image-20220119162058929.png" alt="image-20220119162058929" style="zoom:67%;" /> 

ç²˜æ»ä½å¯¹æ–‡ä»¶ä¸ç”Ÿæ•ˆ

```
[root@centos7 dir]# su user1
[user1@centos7 dir]$ ll
total 0
-rw-r--r--. 1 root  root  0 Feb  8 16:19 f1
-rw-rw-r-T. 1 user1 user1 0 Feb  8 16:22 f2
[user1@centos7 dir]$ rm -rf f2
[user1@centos7 dir]$ ll
total 0
-rw-r--r--. 1 root root 0 Feb  8 16:19 f1
[user1@centos7 dir]$

```

## æ€»ç»“

suidï¼š

â€‹	ä½œç”¨äºå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶çš„ç¨‹åºï¼Œæƒé™4ï¼ŒåŠŸèƒ½ï¼šç”¨æˆ·æ‰§è¡Œæ­¤ç¨‹åºæ—¶ï¼Œå°†ç»§æ‰¿æ­¤ç¨‹åºæ‰€æœ‰è€…çš„æƒé™ã€‚

sguidï¼š

â€‹	ä½œç”¨äºå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶çš„ç¨‹åºï¼Œæƒé™2ï¼ŒåŠŸèƒ½ï¼šç”¨æˆ·æ‰§è¡Œæ­¤ç¨‹åºæ—¶ï¼Œå°†é›†æˆæ­¤ç¨‹åºæ‰€å±ç»„çš„æƒé™ã€‚

â€‹	ä½œç”¨äºç›®å½•ï¼Œæƒé™2ï¼ŒåŠŸèƒ½ï¼Œæ–°å»ºçš„æ–‡ä»¶ï¼Œå°†è‡ªåŠ¨é›†æˆè¯¥ç›®å½•çš„æ‰€å±ç»„ã€‚

stickyï¼š

â€‹	ä½œç”¨äºç›®å½•ï¼Œæƒé™1ï¼ŒåŠŸèƒ½ï¼šåªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ä»¶ï¼Œrootä¸å—é™ã€‚



## åˆ›å»ºä¸€ä¸ªç›®å½•å¯ä»¥è®©æœ‰é™çš„å‡ ä¸ªç”¨æˆ·ä½¿ç”¨

```
[16:49:55 root@localhost data]#mkdir -m 770 testdir
[16:50:10 root@localhost data]#ll
total 1
drwxrwx---. 2 root  root   6 Jan 19 16:50 testdir
[16:52:38 root@localhost data]#chown .grp001 testdir
[16:52:50 root@localhost data]#ll
total 1
drwxrwx---. 2 root  grp001  6 Jan 19 16:50 testdir
[16:53:01 root@localhost data]#usermod -G grp001 user1
[16:54:31 root@localhost data]#usermod -G grp001 user2
[16:55:01 root@localhost data]#groupmems -l -g grp001
user1  user2
[16:55:14 root@localhost data]#su user1
[16:55:19 user1@localhost data]$cd testdir/
[16:55:28 user1@localhost testdir]$touch f1
[16:55:30 user1@localhost testdir]$echo 11 >> f1

[16:55:34 user1@localhost testdir]$exit
exit
[16:55:36 root@localhost data]#su user2
[16:55:43 user2@localhost data]$cd testdir/
[16:55:54 user2@localhost testdir]$echo xx >> f2
[16:56:06 user2@localhost testdir]$cat f2
xx
è²Œä¼¼centos7.9å’Œ7.6è¿™é‡Œæœ‰ä¸ªä¸ä¸€æ ·çš„ç‚¹ğŸ‘‡
å°±æ˜¯user1å¯ä»¥ä¿®æ”¹user2åˆ›å»ºçš„æ–‡ä»¶ï¼Œå¦‚æœæ—¶ä¹‹å‰çš„è§‚ç‚¹ï¼Œå°±ä¼šå†è®¾ç½®æ–‡ä»¶å¤¹çš„sguidæ¥ä½¿ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ›å»ºçš„æ—¶å€™è‡ªåŠ¨é›†æˆçˆ¶ç›®å½•çš„æ‰€å±ç»„ã€‚
å½“ç„¶æœ€å¥½è¿˜æ˜¯è®¾ç½®ä¸€ä¸‹æ–‡ä»¶å¤¹çš„sgid
[root@centos7 data]# chmod g+s renyue/
[root@centos7 data]# ll
total 0
drwxrws---. 2 root renyue-group 26 Feb  8 17:12 renyue
[root@centos7 data]#
[root@centos7 data]# su client1
[client1@centos7 data]$ ll
total 0
drwxrws---. 2 root renyue-group 26 Feb  8 17:12 renyue
[client1@centos7 data]$ cd renyue/
[client1@centos7 renyue]$ touch f3
[client1@centos7 renyue]$ ll
total 4
-rw-rw-r--. 1 client1 client1      2 Feb  8 17:12 f1
-rw-rw-r--. 1 client2 client2      0 Feb  8 17:12 f2
-rw-rw-r--. 1 client1 renyue-group 0 Feb  8 17:35 f3
[client1@centos7 renyue]$



```

## cp /etc/fstab /data/dir/ æ™®é€šéœ€è¦ä»€ä¹ˆæƒé™ï¼Ÿ

cp å‘½ä»¤çš„æ‰§è¡Œæƒé™

/etcæ–‡ä»¶å¤¹çš„æ‰§è¡Œ

fstabæ–‡ä»¶çš„è¯»

/dataæ–‡ä»¶å¤¹çš„æ‰§è¡Œ

/diræ–‡ä»¶å¤¹å¾—æ‰§è¡Œå’Œå†™

