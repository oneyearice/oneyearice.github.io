# ç¬¬4èŠ‚ Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•



# dockeræŸ¥çœ‹æ—¥å¿—



## **æ¦‚è¿°**

docker logs æœ¬è´¨æ˜¯æŸ¥çœ‹å®¹å™¨åœ¨ç»ˆç«¯æ‰“å°å‡ºæ¥çš„ä¿¡æ¯ï¼Œåªè¦ä½ çš„å®¹å™¨æœ‰STDOUTå°±ä¼šè¢«docker logsåœ¨å¤–é¢æŠ“åˆ°ï¼Œä¸è¿‡ä¸€èˆ¬æ¥è®²éƒ½æ˜¯å®¹å™¨é‡Œçš„æ—¥å¿—æ‰ä¼šåœ¨å±å¹•æ‰“å°ï¼Œæ‰€ä»¥docker logsä¹Ÿå°±èµ·äº†ä¸ªåå­—å«logså¦åˆ™æ­£å®—ç‚¹åº”è¯¥å«docker stdoutï¼Œå“ˆå“ˆã€‚



runä¸€ä¸ªnginxçœ‹çœ‹ä¸Šé¢è¯´çš„ï¼Œé€šè¿‡docker top å¯è§nginxæ˜¯daemon offä¹Ÿå°±æ˜¯å®¹å™¨é‡Œæ˜¯å‰å°è¿è¡Œçš„ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å®¹å™¨runèµ·æ¥ä¸ä¼šåœæ­¢ï¼Œç„¶åå†docker run -d å°† docker run xxx æ”¾å…¥åå°æ‰§è¡Œ--å¦åˆ™å®¹å™¨upåä¼šå ç”¨å®¿ä¸»çš„å‰å°ã€‚

![image-20240424095400290](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424095400290.png)



![image-20240424094708414](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424094708414.png)

<img src="4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424100502765.png" alt="image-20240424100502765" style="zoom:40%;" />



ç®€å•è®²ä¸€å¥è¯ï¼šå®¹å™¨çš„runèµ·æ¥å°±æ˜¯è¦ï¼šé‡Œé¢æ˜¯å‰å°ï¼Œå¤–é¢æ˜¯åå°

è§£é‡Šï¼šé‡Œé¢æ˜¯å‰å°æ‰èƒ½runèµ·æ¥ä¸stopè¿™æ˜¯å®¹å™¨çš„å›ºæœ‰è¦æ±‚ï¼›å¤–é¢æ˜¯åå°ï¼Œå®¹å™¨upåæ‰ä¸ä¼šå ç”¨å®¿ä¸»çš„å‰å°ã€‚





## **docker logså…¶å®æ˜¯çœ‹çš„å®¹å™¨é‡Œçš„å±å¹•æ‰“å°(stdoutå’Œstderr)**

æµ‹è¯•å¦‚ä¸‹ğŸ‘‡

æ­¤æ—¶å°±å¯ä»¥é€šè¿‡docker logsçœ‹åˆ°å®¹å™¨é‡Œçš„STDOUT

![image-20240424102128388](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424102128388.png)

è¯æ˜å°±æ˜¯STDOUTè€Œä¸ä»…ä»…æ˜¯LOGSğŸ‘‡

![image-20240424102759227](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424102759227.png)

æˆ‘æœ¬ä»¥ä¸ºæ­£å› ä¸ºnginxå°†ä¸¤ä¸ªæ—¥å¿—è½¯è¿æ¥åˆ°äº†stdoutå’Œstderrä¹Ÿå°±æ˜¯å±å¹•æ‰“å°ï¼Œæ‰ä¼šè¢«å¤–é¢å®¿ä¸»çš„docker logsæŠ“åˆ°ï¼Œç»“æœå½“æˆ‘ç›´æ¥äº§ç”Ÿå±å¹•è¾“å‡ºçš„æ—¶å€™docker logs å¹¶æ²¡æœ‰æŠ“åˆ°ã€‚

è€Œä¸”catä¹Ÿå°±å¡ä½äº†--åœ¨å®¹å™¨é‡ŒğŸ‘‡ï¼Œ<font color=red>æˆ‘çŸ¥é“äº†ï¼Œå› ä¸ºä½ exec -itè¿›å»ä¸æ˜¯ä¹‹å‰runçš„æ—¶å€™çš„é‚£ä¸ªttyäº†ï¼Œæ‰€ä»¥exec è¿›å»çš„stdoutåœ¨docker logs web01çš„é‚£ä¸ªttyæ˜¯çœ‹ä¸åˆ°çš„ï¼Œechoä¸è¿›å»å’Œcatä¸å‡ºæ¥åˆ™æ˜¯å› ä¸ºâ‘ çœ‹ä¼¼echo >> access.logå’Œcat access.logå®åˆ™echo >> /dev/stdoutå’Œcat /dev/stdout è‡ªç„¶æ˜¯ï¼šå‰ç½®ä¸æ˜¯ä¸€ä¸ªttyå¤–é¢docker logsè‡ªç„¶çœ‹ä¸åˆ°ï¼Œåç¼€cat /dev/stdoutå¡ä½å…¶å®å°±æ˜¯å®¿ä¸»ä¸Šå•ç‹¬catä¸€ä¸ªé“ç†ï¼Œä»€ä¹ˆé“ç†ï¼Œå“Ÿè¿˜ä¼šæŠ¬æ å•Šï¼Œå°±æ˜¯cat=cat /dev/stdoutæ˜¯ç­‰å¾…STDINå°†STDINçš„å†…å®¹è¾“å…¥åˆ°STDTOUä¸Š</font>

![image-20240424103528994](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424103528994.png)

![image-20240424110125297](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424110125297.png)

![image-20240424110158053](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424110158053.png)



![image-20240424110250537](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424110250537.png)



æ”¹ä¸ºrun -itæ–¹å¼è¿›å»ï¼Œç„¶åç”¨attachä¹Ÿå°±æ˜¯ä¸€ä¸ªttyå»æµ‹è¯•ï¼Œç†å½“å®ç° ï¼š å®¹å™¨é‡Œçš„å±å¹•çš„ä¸œè¥¿éƒ½èƒ½åœ¨docker logs çœ‹åˆ°äº†ã€‚

![image-20240424105250344](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424105250344.png)

æ­¤æ—¶logså°±èƒ½æ‹¿åˆ°stdoutäº†ï¼Œè¿™å°±ä¸Šæ–‡çº¢è‰²å­—ä½“æ‰€è¯´çš„ä¸€ä¸ªttyæ‰è¡Œã€‚

![image-20240424105314754](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424105314754.png)





æ¢ä¸€ç§è¯æ˜æ–¹å¼ğŸ‘‡

![image-20240424104524790](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424104524790.png)

æ­£å› ä¸ºtailf -f æ˜¯å±å¹•æ‰“å°çš„å†…å®¹ï¼Œæ‰€ä»¥docker logs å°±æŠŠè¿™ä¸ªå±å¹•æ‰“å°çš„å†…å®¹æŠ“å‡ºæ¥äº†ï¼Œ

/etc/hosts----tail--->STDOUT----docer logs---->å®¿ä¸»çœ‹åˆ°äº†

è€Œä¸æ˜¯è¯´/etc/hostså˜æˆäº†logï¼Œå“¦ï¼Œä¸è¦çç†è§£ã€‚



â€‹		**å‰ä¸€ä¸ªä¾‹å­ï¼ŒSTDOUTç”±äºæ˜¯ä¸åŒçš„tty**ï¼Œæ‰€ä»¥æ²¡æ³•åŒæ­¥ä¿¡æ¯--ä¸€è¾¹å±å¹•çš„STDOUT---ä¸€édocker logsçœ‹åˆ°ï¼Œå› ä¸ºä¸æ˜¯ä¸€ä¸ªttyã€‚

â€‹		**ç°åœ¨ä¸€ä¸ªä¾‹å­tail -f /etc/hosts**ï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾ä½ exec -itè¿›å»å¾€/etc/hostsé‡Œechoç‚¹ä¸œè¥¿ï¼Œè¿™æ ·å³ä¾¿ä¸æ˜¯åŒä¸€ä¸ªttyï¼šä¸€è¾¹exec è¿›å»å¾€è¿™ä¸ªæ–‡ä»¶é‡Œå†™ä¸œè¥¿ï¼Œä¸€è¾¹å¦ä¸€ä¸ªrunningçš„å®¹å™¨é‡Œç”±äºå‰å°tail -f /etc/hostsäº†ï¼Œåªè¦åˆ«çš„ttyå¾€è¯¥æ–‡ä»¶å†™ä¸œè¥¿ï¼Œé‚£ä¹ˆå®¹å™¨çš„tail -fæ˜¯ä¼šçœ‹åˆ°çš„ï¼Œäºæ˜¯å®¹å™¨æœ¬èº«çš„å±å¹•ä¹Ÿä¼šæœ‰åŒæ­¥çš„æ‰“å°ã€‚  # è½æ–‡ä»¶äº†æ‰€ä»¥ä¸åŒttyéƒ½æ˜¯åŒæ­¥çš„è¯¥æ–‡ä»¶è€Œå·²ã€‚

â€‹		è€Œå‰ä¸€ä¸ªä¾‹å­ä¸åŒttyä¸­é—´å¯èƒ½æœ‰æ–‡ä»¶ä½œä¸ºä¸­è½¬æ¡¥æ¢ï¼Œä»–ä»¬æ˜¯å„è‡ªçš„ttyåœ¨å„è‡ªçš„STDOUTæˆ–è€…STDERRã€‚



```shell
docker run  --name test01 busybox /bin/sh -c 'i=1;while true;do echo $i;let i++;sleep 1;done'
```

![image-20240424150411056](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424150411056.png)

logsä¸€æ ·å¯è§ï¼Œ

![image-20240424150610068](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424150610068.png)

è¿˜æ˜¯é‚£å¥è¯logsçœ‹çš„å®¹å™¨çš„ttyæ­£å¼å½“å‰ä½ runçš„é‚£ä¸ªå®¹å™¨çš„tty

ä½ è‹¥æ­¤æ—¶exec -it è¿›å»è¯¥å®¹å™¨ï¼Œå°±æ˜¯å¦ä¸€ä¸ªttyäº†ï¼Œæ­¤æ—¶STDOUTç”±äºæ˜¯ä¸åŒçš„ttyä¸ä¼šåœ¨docker logsé‡Œçœ‹åˆ°ï¼Œå› ä¸ºdocker logsçœ‹çš„æ˜¯å°±æ˜¯é‚£ä¸ªå®¹å™¨é‡Œçš„ttyç»ˆç«¯ã€‚



ç„¶åsh -c è¦ç”¨å•å¼•å·ğŸ‘‡ä»¥ä¸‹æ˜¯åŒºåˆ«ï¼Œå…¶å®å°±æ˜¯ä½ è¦å°†é‡Œé¢æ‰€æœ‰çš„éƒ½åŸå°ä¸åŠ¨çš„ä¼ é€’åˆ°docker run é‡Œçš„sh -cé‡Œå»ï¼Œæ‰€ä»¥è‡ªç„¶ä¸èƒ½è§£æçš„ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å•å¼•å·ï¼Œç»Ÿç»Ÿæ˜¯å­—ç¬¦ä¸²æ‰”è¿›å»ã€‚

![image-20240424151633576](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424151633576.png)

è¡¥å……ï¼šä¸ºä»€ä¹ˆä¸€ç›´æ˜¯100ï¼Ÿå› ä¸ºi=100ï¼ŒåŒå¼•å·å±•å¼€åä¸º"i=1;while true;do echo 100;let i++;sleep1;done"  ä¹Ÿå°±æ˜¯è¯´å®¹å™¨é‡Œå®é™…æ‰§è¡Œçš„æ˜¯echo 100ï¼Œå“ˆå“ˆå“ˆï¼Œä½ è¯´ä¸ºå•¥ä¸€ç›´100å‘¢ã€‚



**docker ps dockerçœ‹åˆ°çš„å®¹å™¨çš„æ—¥å¿—ï¼Œåœ¨å®¿ä¸»æœºä¸Šä¹Ÿæœ‰æ–‡ä»¶è½åœ°çš„**

æŸ¥çœ‹å®¹å™¨æ—¥å¿—è½åœ¨å®¿ä¸»ä¸Šçš„æ–‡ä»¶ä½ç½®ï¼š

```
/var/lib/docker/containers/0axxxx...xxxb471ca/0axxx...xxx471ca-json.log
```

![image-20240424164325068](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424164325068.png)

ç„¶ålogsè¶Šæ¥è¶Šå¤šï¼Œä¼šå¯¼è‡´ç£ç›˜ç©ºé—´å ç”¨è¶Šæ¥è¶Šå¤šï¼Œå¸¸ç”¨æ–¹æ³•

![image-20240424165444650](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424165444650.png)





# **å…³äºæ›¿æ¢æ‰å®¹å™¨é‡Œçš„åŸæœ¬cli**

â€‹		æ¯”å¦‚åŸæ¥å®¹å™¨çš„cliæ˜¯ä¸€ä¸ªè„šæœ¬æ¥å¯åŠ¨å®¹å™¨çš„ï¼Œç°åœ¨è¯¥è„šæœ¬è¢«ä½ æ›¿æ¢ä¸ºtail -f xxxäº†ï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šå¯åŠ¨nginxæœåŠ¡äº†ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µå°±è¦å°å¿ƒäº†ã€‚

![image-20240424170721370](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424170721370.png)



![image-20240424171550061](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424171550061.png)

è™½ç„¶å¤–é¢çœ‹

![image-20240424171813170](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424171813170.png)

ä½†æ˜¯é‡Œé¢ä½ æŠŠè„šæœ¬æ›¿äº†ï¼Œé‡Œé¢ç«¯å£éƒ½æ²¡å¼€ğŸ‘‡

![image-20240424180541705](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424180541705.png)



æ›¿ä»£cliçš„ä½¿ç”¨åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯ç”¨æ¥æµ‹è¯•æŸ¥çœ‹çš„ã€‚





# å®¹å™¨é‡Œçš„DNSä»¥åŠhostsæ–‡ä»¶



ç±»æ¯”å®¿ä¸»çš„hostsæœ¬åœ°è§£ææƒ…å†µ

![image-20240424181546719](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424181546719.png)

å®¹å™¨é‡Œå¤šäº†ä¸€ä¸ªå®¹å™¨IPï¼Œä¸”è§£æåˆ°å®¹å™¨IDã€‚å½“ç„¶127.0.0.1è¿˜æ˜¯è€æ ·å­

![image-20240424181529142](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424181529142.png)

è¿˜æœ‰ä¸ªä»…ä»…æ˜¯éªŒè¯hostsæ–‡ä»¶ï¼Œå¯ä»¥docker run --rm æ¥åšï¼Œæ¼”ç¤ºå®Œé€€å‡ºå®¹å™¨åç›´æ¥åˆ é™¤å®¹å™¨

![image-20240424182341015](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424182341015.png)



![image-20240424182420774](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240424182420774.png)



**docker runçš„æ—¶å€™å°±æ–°å¢hostè§£æ**

hostæ–‡ä»¶æ·»åŠ è¿›å»å°±å¥½äº†ï¼Œä¸è¿‡å¤–é¢ä¹Ÿå¯ä»¥

![image-20240425094243819](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425094243819.png)



![image-20240425095019651](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425095019651.png)

å†æ¬¡ç†è§£ä¸‹-it -d å’ŒcliğŸ‘‡

![image-20240425095406770](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425095406770.png)



### dockerå®¹å™¨é‡Œçš„dns

è¿™ç‚¹æˆ‘å‰æ–‡å°±æ€»ç»“è¿‡äº†ï¼Œç»“åˆå·¥ä½œä¸­çš„æ•…éšœæ¡ˆä¾‹è¿›è¡Œå’Œå½’çº³æ€»ç»“

![image-20240425100652839](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425100652839.png)



è¿™é‡Œè¡¥å……å…¶ä»–çš„ç‚¹ï¼šæ¯”å¦‚ubuntuçš„æƒ…å†µã€æ¯”å¦‚é™¤äº†daemon.json è¿˜æœ‰docker run --dns=æ¥æŒ‡å®šã€‚

**ubuntuçš„å®¹å™¨çš„dns**

å’Œrock-linuxä¸€æ ·ä¹Ÿæ˜¯ä»dockerå¼•æ“çš„daemon.jsonä¼˜å…ˆç„¶åå†ç»“åˆ/etc/resolv.confé‡Œæ¥çš„ï¼Œä½†æ˜¯ubuntuçš„å®¿ä¸»æœºçš„/etc/resolv.confæ–‡ä»¶é‡Œçœ‹åˆ°çš„å…¶å®ä¸æ˜¯çœŸå®çš„å®¿ä¸»ä½¿ç”¨çš„dnsï¼Œè€Œæ˜¯è¦é€šè¿‡

![image-20240425100350967](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425100350967.png)

ä¸Šå›¾çš„/etc/resovle.confæ˜¯å®¹å™¨é‡Œçš„dnsçš„ä½¿ç”¨æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è‡ªç„¶ä¹Ÿæ˜¯ä»å®¿ä¸»æœºçš„dockerå¼•æ“çš„daemon.json ç»“åˆ å®¿ä¸»çš„dns æ¥ç”Ÿäº§çš„ã€‚

â€‹		è€Œå®¿ä¸»æœºçš„dnsğŸ‘‡ä¸‹å›¾æ˜¾ç¤ºäº†ubuntuçš„ç‰¹æ®Šçš„æŸ¥çœ‹æ–¹æ³•ï¼ˆubuntuçš„/etc/resolv.confé‡Œçœ‹ä¸åˆ°çœŸå®çš„dnsé…ç½®çš„ï¼‰

![image-20240425101048549](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425101048549.png)



![image-20240425101111322](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425101111322.png)

åŒæ—¶è¿˜æœ‰å…¶ä»–çš„cliæŸ¥çœ‹ğŸ‘‡

![image-20240425101439443](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425101439443.png)



**dnså’Œoptionsçš„ä¼˜å…ˆçº§ï¼Œä»ä¸Šåˆ°ä¸‹ï¼š**

â‘ docker runæŒ‡å®šçš„å‚æ•°ä¼˜å…ˆ

â‘¡daemon.jsonæŒ‡å®šçš„å‚æ•°å…¶æ¬¡

â‘¢å®¿ä¸»æœºçš„/etc/resolv.confæŒ‡å®šçš„å‚æ•°æœ€å

â‘£æŒ‡å®šçš„å‚æ•°ä¼˜å…ˆçš„æ„æ€å°±æ˜¯ï¼Œå°±ä¸¤ä¸ªå‚æ•°å…¶å®ï¼Œä¸€ä¸ªdns ä¸€ä¸ªoptionsï¼Œæ¯”å¦‚ï¼šrun å’Œ jsoné‡Œéƒ½æ²¡æœ‰æŒ‡å®šoptionsï¼Œè€Œå®¿ä¸»æœºçš„resolv.cnfé‡Œåˆ¶å®šäº†ï¼Œé‚£ä¹ˆå°±æ˜¯å®¿ä¸»çš„é…ç½®ä¼˜å…ˆäº†ã€‚

![image-20240425103309407](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425103309407.png)

æ³¨æ„ä¸Šå›¾çš„ä¸€ä¸ªç‚¹ï¼šå°±æ˜¯10.1.1.1æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œå› ä¸º/etc/resolv.confæ–‡ä»¶é‡Œçš„namserveråªè®¤å‰ä¸‰ä¸ªã€‚æµ‹è¯•è¿‡äº†çš„åœ¨å‰é¢çš„ç« èŠ‚é‡Œ--å°±æ˜¯æœ¬æ®µæ–‡å­—çš„æ ‡é¢˜ä¸‹é¢çš„ç¬¬ä¸€å¼ å›¾é‚£è¾¹åšäº†æµ‹è¯•æˆªå›¾çš„ã€‚

```shell
docker run --rm --name web01 --dns=1.1.1.1 --dns=2.2.2.2 --dns=3.3.3.3 --dns-option=timeout:23 --dns-option=attempt:3 --dns-option=rotate --dns-option="single-request-reopen" busybox cat /etc/resolv.conf
```

![image-20240425105000486](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425105000486.png)

è¿™æ ·å·®ä¸å¤šäº†å§ï¼Œå•ä¸ªå®¹å™¨ç”Ÿæ•ˆï¼Œä¹Ÿä¸å½±å“å…¶ä»–å®¹å™¨ï¼Œä¹Ÿä¸ç”¨dameon.jsonï¼Œä¹Ÿä¸ç”¨å®¿ä¸»çš„/etc/resolv.confï¼Œå°±æŒºä¸“ä¸šï¼Œå“ˆå“ˆã€‚



**searchè¦åˆ æ‰**

è¿˜æœ‰ä¸€ä¸ªsearch xx.xxxä¸€èˆ¬ä¸æ€ä¹ˆç”¨ï¼Œé”™äº†ï¼Œä¸æ˜¯ä¸æ€ä¹ˆç”¨ï¼Œè€Œæ˜¯ä¸€å®šè¦åˆ æ‰ï¼Œé˜²æ­¢ä¹±ç»™ä½ è‡ªåŠ¨æ·»åŠ æ£ä¹±ã€‚

![image-20240425105831171](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425105831171.png)

æ²¡å•¥ç”¨ï¼Œè°æŒ‡æœ›searchæ¥è¡¥é½å•Šï¼›è€Œä¸”å¯èƒ½å¸¦æ¥æ„æ–™ä¹‹å¤–çš„æ•…éšœã€‚

![image-20240425110037203](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425110037203.png)

searchæ€ä¹ˆåˆ ï¼Œä¸æ˜¯å»/etc/resolv.confé‡Œåˆ ï¼Œè¿™åªæ˜¯ä¸ªåŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶ï¼Œæºå¤´åœ¨ç½‘å¡é…ç½®æ–‡ä»¶ã€æˆ–è€…nmcliå»é…ç½®ä¿®æ”¹ã€‚



ubuntué‡Œ

<img src="4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425110639921.png" alt="image-20240425110639921" style="zoom:33%;" />



centosä¸€æ ·ç±»ä¼¼çš„ç½‘å¡ï¼Œæˆ–è€…ç”¨çš„æ˜¯NetworkManagerçš„ç›´æ¥ç”¨nmcliå»ä¿®æ”¹å°±è¡Œäº†



![image-20240425111541638](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425111541638.png)

å›¾ä¸­ipv4.dnså’ŒIP4.DNSçš„åŒºåˆ«ï¼Œä¸€ä¸ªæ˜¯å‰é¢é…ç½®çš„ï¼Œä¸€ä¸ªæ—¶å€™åé¢æœ€ç»ˆç”Ÿæˆçš„ï¼Œä½ å¯ä»¥ç†è§£æˆé…ç½®æ–‡ä»¶å’Œæœ€ç»ˆçŠ¶æ€ï¼Œå”‰ï¼Œè¿™äº›å¤ªç»†äº†ï¼Œä¸ç®¡äº†ï¼Œæ€»ä¹‹å®é™…æ“ä½œçš„æ—¶å€™å¸¦ç‚¹è„‘å­å°±è¡Œäº†ã€‚ä¸ç†ä¼šè¿™å¥è¯ä¹Ÿè¡Œã€‚





# å®¹å™¨å’Œå®¿ä¸»æœºæ–‡ä»¶æ€ä¹ˆäº¤æ¢



## **docker cp**

-a å¥½æ¯”cp -aï¼Œä¿ç•™å±æ€§

![image-20240425113332684](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425113332684.png)



æ“ä½œä¸‹ï¼Œè·‘ä¸€ä¸ªå®¹å™¨upç€

![image-20240425113012356](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425113012356.png)



ç„¶åå°†å®¿ä¸»æœºçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¤åˆ¶è¿›å®¹å™¨é‡Œ

```shell
docke cp -a /etc/issue test01:/tmp/
```

æ‹·è¿›å»ï¼š

![image-20240425114653716](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425114653716.png)

æ‹·å‡ºæ¥

![image-20240425115147560](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425115147560.png)





# å®¹å™¨çš„ç¯å¢ƒå˜é‡

è¿™ä¸œè¥¿æ‡‚çš„éƒ½çŸ¥é“å¾ˆå…³é”®çš„ï¼š

1ã€cmdé‡Œçš„setï¼Œçœ‹çš„æ˜¯ç¯å¢ƒå˜é‡ï¼Œå¯èƒ½çœ‹çš„éƒ½ä¸å…¨å¯¹å§ï¼Œæ¯•ç«Ÿä»…ä»…æ˜¯å½“å‰ç”¨æˆ·çš„å§ï¼›å­˜åœ¨è½¯ä»¶é€€å‡ºäº†ï¼Œç½‘ç»œè®¾ç½®é‡Œçš„ä»£ç†é‡Œä¹Ÿæ¸…ç©ºäº†ï¼Œä½†æ˜¯seté‡Œå‘ç°PROXYå˜é‡çš„å­˜åœ¨ï¼Œè¿™ç§æƒ…å†µä¹Ÿå¯èƒ½å¯¼è‡´ç½‘ç»œé—®é¢˜ï¼Œæ•…éšœå®šä½å°±å¾ˆéš¾ï¼Œå‡ºç°è¿‡ä¸€æ¬¡ï¼Œå…·ä½“ç»†èŠ‚æˆ‘å¿˜äº†ï¼Œç»“è®ºå°±æ˜¯seté‡Œä¹Ÿè¦è§‚å¯Ÿæ˜¯å¦é…ç½®äº†ä»£ç†ï¼Œå®¹æ˜“å¿½ç•¥è¿™ä¸ªç‚¹ã€‚

2ã€envä¹Ÿå°±æ˜¯linuxçœ‹ç¯å¢ƒå˜é‡çš„cliã€‚

3ã€ç¯å¢ƒå˜é‡é‡Œçš„PATHå˜é‡ï¼Œcrontableé‡Œçš„å†™æ¸…æ¥šPATHå˜é‡.

![image-20240425135622842](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425135622842.png)

crontableæ­£å„¿å…«ç»è¿˜è¦å†™

![image-20240425135652603](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425135652603.png)

è¿™äº›éƒ½æ˜¯ç¯å¢ƒå˜é‡



æ¯ä¸ªå®¹å™¨è‡ªå·±éƒ½æœ‰ç¯å¢ƒå˜é‡ï¼Œç¯å¢ƒå˜é‡çš„ç”¨é€”å’Œé•œåƒå¯†åˆ‡ç›¸å…³ï¼Œæœ‰äº›æ˜¯ä¸ä¼—ä¸åŒçš„çš„ç¯å¢ƒå˜é‡ã€‚

![image-20240425140531905](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425140531905.png)

å†çœ‹çœ‹mysqlçš„å˜é‡

![image-20240425141132594](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425141132594.png)

mariadbçš„å˜é‡

![image-20240425142502347](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425142502347.png)



è¿˜å¯ä»¥ä¼ é€’å˜é‡ç”¨-e

![image-20240425150011901](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425150011901.png)

æ³¨æ„ä¸Šå›¾mysqlå¦‚æœPASSWORDå˜é‡æ²¡ç»™è¿›å»ï¼Œæ˜¯èµ·ä¸æ¥çš„ï¼Œ

å¦‚æœç”¨äº†--restart=alwaysï¼Œå°±ä¼šçœ‹åˆ°å®¹å™¨çŠ¶æ€æ˜¯ä¸€ç›´é‡å¯ä¸­

![image-20240425155452186](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425155452186.png)



![image-20240425150649895](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425150649895.png)

è¿˜å¯ä»¥å†™åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œç»Ÿä¸€å®‰ç½®

![image-20240425151235519](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425151235519.png)



ä¸è¿‡è¿™äº›ä¾‹å­çš„ç¯å¢ƒå˜é‡æ²¡æœ‰å…·ä½“æ„ä¹‰ï¼Œmysqlçš„ç¯å¢ƒå˜é‡ä¸€èˆ¬è¿™ä¹ˆè®¾ç½®

```shell
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=wordpress -e MYSQL_USER=wordpress -e MYSQL_PASSWORD=123456 --name mysql -d --restart=always mariadb:11.3.2
```

![image-20240425161002137](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425161002137.png)

å»æ‰envè§‚å¯Ÿ

![image-20240425161017715](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425161017715.png)

å¯å¾—ğŸ‘†æ˜¯passwordæ²¡ç»™ã€‚å…¶å®æ˜¯you need to specify one of the following as an environment variableï¼Œæ˜¯ä¸‰ä¸ªå˜é‡ç»™ä¸€ä¸ªå°±è¡Œäº†ã€‚

ç„¶åevnå–ä»£äº†docker-entrypoint.shçš„è„šæœ¬ï¼Œä¹ŸæŠ¥é”™ï¼Œå¯è§passwordå˜é‡æ˜¯åœ¨cmdä¹‹å‰å°±éœ€è¦çš„ã€‚

â€‹		ç„¶åè®¾ç½®ä¸ºéšæœºå¯†ç æˆ–è€…ç©ºå¯†ç ï¼šå…·ä½“-eçš„ä¼ é€’å‚æ•°çš„æ ¼å¼ï¼Œè¿™æ˜¯å½“åˆåˆ›å»ºé•œåƒçš„ä½œè€…æŒ‡å®šçš„ï¼Œè¦å»hub.docker.comå»æŸ¥çœ‹mysqlé•œåƒçš„ä¼ é€’å‚æ•°æ ¼å¼ï¼Œè€Œä¸æ˜¯å»mysqlå®˜æ–¹ç½‘ç«™å»æŸ¥çœ‹ã€‚

![image-20240425162212782](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425162212782.png)



![image-20240425162337327](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425162337327.png)

ç„¶åé—®é¢˜æ¥äº†éšæœºå¯†ç MYSQL_RANDOM_ROOT_PASSWORDåˆ°åº•æ˜¯å¤šå°‘å‘¢ï¼Œçœ‹logså°±è¡Œå•¦~ğŸ‘‡

![image-20240425163428625](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425163428625.png)

å°è¯•ç™»å…¥mysqlï¼Œç”±äºæ²¡æœ‰åšç«¯å£æš´éœ²ï¼Œæ‰€ä»¥æˆ‘ç”¨å®¹å™¨çš„ipå»è¿ğŸ‘‡

![image-20240425165204462](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425165204462.png)

å¥½ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¦‚ä½•å®‰å…¨çš„è®¾ç½®mysqlçš„å¯†ç ï¼Œ

1ã€ä½ ç”¨éšæœºå¯†ç ï¼Œlogsé‡Œå¯è§ï¼Œä¸å®‰å…¨ï¼›æ‰€ä»¥éœ€è¦æ‰‹åŠ¨è¿›å»ä¿®æ”¹ï¼Œåˆ™ç®—æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼›

2ã€**âˆš** ä½ ç”¨æ‰‹åŠ¨æŒ‡å®š-e MYSQL_ROOT_PASSWORD=123456 æ¥æŒ‡å®šï¼Œç»“æœhistoryé‡Œå¯è§ï¼Œä¸å®‰å…¨ï¼›æ‰€ä»¥æˆ‘ä»¬è¦vim mysql.envè¿›å»å®šä¹‰å˜é‡ï¼Œchown 600 mysql.evnï¼Œç„¶åsource mysql.envï¼Œç„¶åå†-e MYSQL_ROOT_PASSWORD=$VARå°±è¡Œäº†ã€‚

![image-20240425170239180](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425170239180.png)

è¿™æ ·å°±å®‰å…¨äº†ï¼Œ

![image-20240425170606377](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425170606377.png)



ç„¶åå†è¯•è¯•ç”¨æ–‡ä»¶ä¼ å‚çš„æ–¹å¼--env-fileğŸ‘‡

![image-20240425171756062](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425171756062.png)

ä¸Šå›¾æç¤ºNo space left on deviceï¼Œç£ç›˜åˆå¤Ÿäº†ï¼Œåˆ å§

![image-20240425172522113](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425172522113.png)

åé¢ä¼šè®²æ€ä¹ˆåˆ¶ä½œé•œåƒï¼Œè®©ç”¨æˆ·ä½¿ç”¨é•œåƒçš„äººå¯ä»¥ä¼ é€’å˜é‡ï¼Œä¹Ÿå°±æ˜¯åˆ¶ä½œé•œåƒçš„æ—¶å€™è¦è€ƒè™‘çš„äº‹æƒ…äº†ã€‚

è¿˜æœ‰åˆ«å¿˜äº†

![image-20240425173205188](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425173205188.png)





# æ¸…ç†å®¹å™¨



æ¸…ç†å‰å…ˆçœ‹çœ‹ï¼šå¯ä»¥iç”¨ docker system



**docker system df**

![image-20240425173906580](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425173906580.png)

åœæ‰å‡ ä¸ªupçš„å®¹å™¨åï¼Œç°åœ¨RECLAIMABLEé‡Œçœ‹åˆ°å¯ä»¥å›æ”¶çš„ç©ºé—´äº†

![image-20240425174200836](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425174200836.png)

è§£é‡Šå¦‚ä¸‹<img src="4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425174355078.png" alt="image-20240425174355078" style="zoom:47%;" />



**docker system events**

![image-20240425175012671](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425175012671.png)



**docker system info = docker info**

![image-20240425175538514](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425175538514.png)



**docker system prune**

![image-20240425175918253](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425175918253.png)

å››ä¸ª-allåˆ†åˆ«æ˜¯

æ‰€æœ‰åœæ­¢çš„å®¹å™¨

æ‰€æœ‰æ²¡æœ‰ä½¿ç”¨çš„ç½‘ç»œï¼Œç½‘ç»œåé¢è®²

æ‰€æœ‰æ²¡æœ‰æ ‡ç­¾çš„é•œåƒ

æ‰€æœ‰danglingçš„build cache



danglingå°±æ˜¯æ²¡æœ‰æ ‡ç­¾çš„é•œåƒï¼Œäº§ç”Ÿçš„åŸå› å¦‚ä¸‹ğŸ‘‡ï¼Œå°±æ˜¯å®¹å™¨æ­£åœ¨ç”¨ç€ä¸€ä¸ªimageï¼Œä½ åˆ imageçš„æ—¶å€™è¿˜å¾—æ˜¯ç”¨çš„TAGï¼Œåˆ™åˆ é™¤äº†TAGï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰TAGï¼Œä¹Ÿå«danglingã€‚æ³¨æ„å“¦ï¼Œå®¹å™¨ç”¨åœ¨æ˜¯åˆ ä¸æ‰imageçš„å“¦ï¼Œè¿™ä¸€ç‚¹é€šè¿‡IDå»åˆ å°±æ˜æ˜¾çœ‹åˆ°äº†ï¼Œé€šè¿‡TAGå»åˆ ä¹Ÿåªæ˜¯å»æ‰äº†TAGè€Œå·²ã€‚

![image-20240425180425126](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425180425126.png)



å®¹å™¨æ²¡æœ‰UPçš„ï¼ŒExitedçš„ï¼Œimageæ˜¯å¯ä»¥åˆ æ‰çš„

![image-20240425180724998](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425180724998.png)

ç„¶åå®¹å™¨runèµ·æ¥æ˜¯å¤åˆ¶äº†imageä¸€ä»½ï¼Œå¦åˆ™å®¹å™¨åœæ­¢åå°†imageåˆ é™¤ï¼Œä¸ºä»€ä¹ˆå®¹å™¨è¿˜èƒ½ç»§ç»­UPå‘¢ï¼Œæ‰€ä»¥æ­£æ˜¯å› ä¸ºå®¹å™¨runè¿™ä¸ªåŠ¨ä½œå°±æ˜¯å¤åˆ¶ä¸€ä»½imageçš„ã€‚

![image-20240425181140332](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425181140332.png)



### è¿˜ä¸€ä¸ªè¡¥å……ä¸€ä¸‹ï¼šdockerçš„PS1

éœ€æ±‚ï¼Œæˆ‘æƒ³ä¿®æ”¹dockeré‡Œçš„æç¤ºç¬¦

![image-20240425184906817](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425184906817.png)

è¯ºï¼Œæ˜¯ä¸æ˜¯so easyï¼Œå†æ‰¾æ‰¾busyboxçš„PS1å˜é‡è½åœ¨é‚£ä¸ªæ–‡ä»¶é‡Œå°±è¡Œäº†

å¦‚æœå®åœ¨æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œå°±ç”¨-eçš„æ–¹å¼ä¼ è¿›å»ä¹Ÿè¡Œå•Šã€‚

![image-20240425185250322](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240425185250322.png)

æå®š~

ä½†å…¶å®ï¼Œä¸æ¨èä¿®æ”¹ï¼Œå› ä¸ºè¿™æ ·ä½  ä¸æ³¨æ„ä»¥ä¸ºè¿˜åœ¨å®¿ä¸»æœºä¸Šï¼Œä¸çŸ¥é“å·²ç»è¿›å®¹å™¨äº†ï¼Œå°±å°´å°¬äº†ã€‚



![image-20240426100731730](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240426100731730.png)





# æ¡ˆä¾‹ï¼Œä½¿ç”¨dockerè‡ªåŠ¨éƒ¨ç½²ä¸€ä¸ªå¼€æºè¿ç»´è½¯ä»¶

https://github.com/openspug/spug

https://www.spug.cc/

```shell
docker run -d --restart=always --name=spug -p 80:80 registry.aliyuncs.com/openspug/spug
# é€šè¿‡é•œåƒåæŒ‡å®šçš„ä»é˜¿é‡Œäº‘ä¸‹è½½ï¼Œèµ°çš„æ˜¯httpsé»˜è®¤ã€‚
```

![image-20240426111117446](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240426111117446.png)



æ­¤æ—¶é¡µé¢å¯ä»¥æ‰“å¼€äº†

![image-20240426114447620](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240426114447620.png)



è¿˜éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªç™»å…¥å¯†ç 

```shell
docker exec spug init_spug admin 123456  # åˆå§‹åŒ–å¹¶åˆ›å»ºç™»å…¥è´¦å·å¯†ç 
```

init_spugæ˜¯äººå®¶å®¹å™¨é‡Œè‡ªå¸¦çš„è„šæœ¬ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯å½“ä½œcliè¿˜æ‰§è¡Œçš„

![image-20240426114733073](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240426114733073.png)

![image-20240426115738819](4.Dockerå®¹å™¨ç®¡ç†å¸¸è§ç”¨æ³•.assets/image-20240426115738819.png)

