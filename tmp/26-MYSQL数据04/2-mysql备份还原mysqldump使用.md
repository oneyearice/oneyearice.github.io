# ç¬¬2èŠ‚. mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨



# mysqldump

mysqldumpæ˜¯mariadb-clientå®‰è£…çš„æ—¶å€™å°±è‡ªå¸¦çš„

![image-20230719150441673](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719150441673.png)

æŸ¥çœ‹mysqldumpçš„å¸®åŠ©ä¿¡æ¯ï¼š

![image-20230719150957100](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719150957100.png)

![image-20230719151016824](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719151016824.png)

![image-20230719151121884](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719151121884.png)

-A ä¹Ÿä¸æ˜¯çœŸçš„å¦‚ä¸Šå›¾æ‰€è¯´æ˜¯all-databasesï¼Œä¸ä¼šå¤‡ä»½information_schemaï¼Œä¹Ÿä¸ä¼šå¤‡ä»½performance_schemaï¼Œ

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719151440765.png" alt="image-20230719151440765" style="zoom:50%;" />



æ¯”å¦‚å¯ä»¥è¿™ä¹ˆå†™

mysqldump hellodb   		# å¿…é¡»æŒ‡å®šä¸€ä¸ªæ•°æ®åº“

mysqldump hellodb students

mysqldump hellodb



mysqldump -uroot -pxxx mysql å¯¹ mysqlè¿™ä¸ªç³»ç»Ÿåº“è¿›è¡Œå¤‡ä»½ğŸ‘‡

![image-20230719155506000](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719155506000.png)

1ã€mysqldump db_name æ˜¯æŠŠæ•°æ®åº“é‡Œçš„ä¸œè¥¿åšäº†ä¸ªä¸€ä¸ªæ˜¾ç¤ºï¼Œå¯ä»¥çœ‹åˆ°userçš„è§†å›¾ï¼Œslowlogçš„insertç­‰ç­‰

![image-20230719170313496](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719170313496.png)

![image-20230719170345245](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719170345245.png)



![image-20230719171635867](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719171635867.png)

çœ‹æç¤ºï¼Œå…³é—­binlog

![image-20230719172734478](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719172734478.png)



è¿™æ ·å°±å¯ä»¥äº†

![image-20230719172758457](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719172758457.png)

ç„¶åå»ç”¨mysqldump çœ‹çœ‹æ˜¯å¦èƒ½çœ‹åˆ°è¿™ä¸ªå‡½æ•°

![image-20230719172920154](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719172920154.png)



## å…ˆçœ‹ä¸‹ä¸€ç§é”™è¯¯çš„mysqldump

å…¨å¤‡å¯ä»¥ä½¿ç”¨é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œ

mysqldump -uroot -pxxxx hellodb > /data/hellodb.sql

![image-20230719174253475](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719174253475.png)

æ‰€è°“mysqldump dbå…¶å®å°±æ˜¯ä¿å­˜äº†ä¹‹å‰é…ç½®çš„å„ç§å‘½ä»¤

![image-20230719174701959](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719174701959.png)

ä¸‹é¢å¼€å§‹åˆ©ç”¨è¿™ä¸ªdumpå‡ºæ¥çš„æ–‡ä»¶è¿›è¡Œè¿˜åŸæµ‹è¯•ï¼Œ

drop æ‰å…ˆ

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719174830630.png" alt="image-20230719174830630" style="zoom:50%;" /> 



ç”±äºmysqldumpå‡ºæ¥çš„å¤‡ä»½æ–‡ä»¶ï¼Œä½ ä»¬æ²¡æœ‰åˆ›å»ºåº“çš„å‘½ä»¤ï¼Œæ‰€ä»¥è¿˜åŸä¹‹å‰è¦æ‰‹åŠ¨åˆ›å»ºåº“ã€‚

![image-20230719175136730](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719175136730.png)



åŒæ ·ç”±äºmysql dumpå‡ºæ¥çš„å†…å®¹é‡Œæ²¡æœ‰åˆ›å»ºæ•°æ®åº“ï¼Œæ‰€ä»¥ä½ æ‰‹åŠ¨åˆ›å»ºçš„æ—¶å€™å…¶å®å¯ä»¥æ”¹ä¸ªåå­—çš„ï¼Œ

![image-20230719181131116](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719181131116.png)

è¿›å»çœ‹ä¸€ä¸‹

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719180254467.png" alt="image-20230719180254467" style="zoom:50%;" />

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719180340044.png" alt="image-20230719180340044" style="zoom:67%;" /> 



1ã€è¿™ç§æ–¹æ³•å¤‡ä»½æ•°æ®å°±ä¸å¤ªå¥½äº†ã€‚ä¸‡ä¸€åŸæ¥çš„dbåç§°ä½ å¿˜äº†å‘¢ã€‚éšä¾¿å†™ä¸€ä¸ªï¼Œç”¨æˆ·é‚£è¾¹å‰ç«¯åº•å±‚sqlé‡Œé¢äººå®¶è¿˜æ˜¯è€çš„åº“åï¼Œä¸šåŠ¡è‚¯å®šæ¢å¤ä¸äº†çš„ã€‚

2ã€è¿˜ä¸€ä¸ªï¼Œç”±äºè¿™ç§mysqldumpå‡ºæ¥çš„sqlå†…å®¹é‡Œæ²¡æœ‰æ¶‰åŠåº“ï¼Œä¹Ÿå°±æ˜¯ä¸çŸ¥é“äººå®¶å½“åˆåˆ›å»ºåº“çš„æ—¶å€™æ˜¯å¦æ¶‰åŠäº†ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚å­—ç¬¦é›†ï¼Œæ¯”å¦‚å¼•æ“ï¼Œç­‰ã€‚è¿™äº›éƒ½æ˜¯é—®é¢˜ã€‚





## mysqldump --databases | -B

åŸæ¥æ˜¯è¿™æ ·ğŸ‘‡

![image-20230719181627156](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719181627156.png)

ç°åœ¨æ”¹æˆè¿™æ ·ğŸ‘‡

![image-20230719181737703](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719181737703.png)

å†æ¥çœ‹å¤‡ä»½çš„æ–‡ä»¶ï¼Œæ­¤æ—¶-Bå°±ä¼šæœ‰åˆ›å»ºæ•°æ®åº“çš„å‘½ä»¤äº†

![image-20230719181834909](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719181834909.png)

åˆ åº“

![image-20230719182028795](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182028795.png)

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182054440.png" alt="image-20230719182054440" style="zoom:50%;" />



ç„¶åæ¢å¤ä¸€ä¸‹ï¼Œæ­¤æ—¶å°±ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå¯èƒ½éƒ½ä¸çŸ¥é“çš„å…·ä½“å‚æ•°çš„æ•°æ®åº“äº†

![image-20230719182250859](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182250859.png)

![image-20230719182333475](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182333475.png)

![image-20230719182351105](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182351105.png)

åŒæ ·ä¹Ÿå¯ä»¥ä¸ç”¨cliäº¤äº’æ¨¡å¼ï¼Œä¸è¿‡-eçš„æ–¹å¼ï¼Œæ— éœ€è€ƒè™‘ç»“å°¾çš„åˆ†å·äº†;å°±

![image-20230719182635419](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182635419.png)



### å¦‚æœä¸æ˜¯dropåˆ åº“ï¼Œè€Œæ˜¯åº“é‡Œçš„è¡¨æ ¼ä¸¢äº†ï¼Œä¹Ÿä¸€æ ·å¯ä»¥ç”¨è¿™ç§æ–¹å¼ï¼Œ

å› ä¸ºmysqldump -rtoot -pXXX -B hellodbé‡Œçš„createè¯­å¥é‡Œæ˜¯ç”±IF NOT EXISTSæ¡ä»¶åˆ¤æ–­çš„ã€‚

![image-20230719182852320](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719182852320.png)



### å¤‡ä»½å¤šä¸ªä¸€æ ·æ˜¯-B

![image-20230719183037926](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719183037926.png)

æ³¨æ„ä¸Šå›¾ä¸€æ ·hello mysqlå…¶å®ä¸åŠ -Bå°±åˆ¤å®šæœªhelloåº“é‡Œçš„mysqlè¡¨äº†ã€‚

![image-20230719183337051](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719183337051.png)

![image-20230719183432639](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719183432639.png)



### å†çœ‹çœ‹-Aå…¨å¤‡ï¼Œå°±æ˜¯ä¸å¤‡ä»½information_schemaå’Œperformance_schema

![image-20230719184026104](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719184026104.png)

æœç„¶å°‘äº†é‚£ä¸¤ä¸ªï¼šä¸€ä¸ªå…ƒæ•°æ®ï¼Œä¸€ä¸ªæ€§èƒ½

![image-20230719184742018](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230719184742018.png)

è¿›ä¸€æ­¥æ€è€ƒ-Aä¸ä¼šå¤‡ä»½information_schemaå’Œperformance_schemaï¼Œé‚£ä¹ˆä¼šä¸ä¼šä¸¢å¤±æ•°æ®å‘¢ï¼Ÿ

å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨æ˜¯æ”¾åœ¨mysqlè¿™ä¸ªç³»ç»Ÿåº“é‡Œçš„ï¼Œæ‰€ä»¥ä¸ä¼šä¸¢çš„ã€‚



![image-20230720094222942](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720094222942.png)

ä¸Šå›¾å°±æ˜¯è¯´æ˜ä¸€ä¸‹å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨è¿™äº›å¯èƒ½éƒ½æ˜¯è·Ÿè¿™ä¸ªæŸä¸€ä¸ªæ•°æ®åº“èµ°çš„ï¼Œdrop database hello;åï¼Œé‡Œé¢çš„å‡½æ•°ä¹Ÿå°±æ²¡äº†ã€‚

![image-20230720094751435](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720094751435.png)

-Aå°±åŒ…å«äº†-E å’Œ-Rå› ä¸ºè¿™äº›ä¸œè¥¿åŸºæœ¬éƒ½åœ¨mysqlåº“é‡Œï¼ŒåŒ…æ‹¬--triggersè§¦å‘å™¨ä¹Ÿæ˜¯åœ¨-Aé‡Œå°±åŒ…å«äº†ï¼Œéƒ½æ˜¯åœ¨mysqlç³»ç»Ÿåº“é‡Œã€‚



## mysqldumpå’Œbinlog

![image-20230720100257409](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720100257409.png)

1ã€å¤œé‡Œ2ç‚¹mysqldumpåšäº†å…¨å¤‡ï¼Œç¬¬äºŒå¤©18ç‚¹æ•°æ®åº“å´©äº†ï¼›

2ã€äºŒè¿›åˆ¶æ˜¯ç‹¬ç«‹çš„æ—¥å¿—è®°å½•ï¼Œæ˜¯ç‹¬ç«‹äºå…¨å¤‡çš„å¦å¤–ä¸€æ¡çº¿ç´¢

3ã€æ­¤æ—¶ç”¨mysqldumpçš„å…¨å¤‡æ–‡ä»¶ï¼Œåªèƒ½æ¢å¤åˆ°å¤œé‡Œ2ç‚¹çš„æ•°æ®ï¼Œè¿˜éœ€è¦ç»“åˆbinglogæ‰èƒ½è¡¥å…¨æ¢å¤æ•°æ®ã€‚

4ã€æ­¤æ—¶å°±éœ€è¦çŸ¥é“2ç‚¹å…¨å¤‡çš„æ—¶é—´èŠ‚ç‚¹(ä¹Ÿä¸ä¸€å®šæ˜¯ç”¨æ—¶é—´æ¥æ¯”å¯¹ï¼Œå¯èƒ½å°±æ˜¯è®°å½•ä¸‹å…¨å¤‡å¯¹åº”çš„binlogä½ç½®å°±è¡Œäº†)å¯¹åº”çš„binlogæ—¥å¿—é‡Œçš„ä½ç½®

5ã€ä¸ºäº†è®°å½•ä¸‹æ¥å½“æ—¶åšå…¨å¤‡çš„äºŒè¿›åˆ¶å“ªä¸ªä½ç½®ç‚¹ï¼Œå°±éœ€è¦mysqldump --master-dataè¿™ä¸ªé€‰é¡¹ã€‚

![image-20230720101827383](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720101827383.png)

--master-data=1å’Œ=2çš„æœ‰æ„ä¹‰ï¼Œæ²¡æœ‰æ¶‰åŠä¸»ä»å¤åˆ¶çš„æ—¶å€™=2å°±è¡Œäº†ã€‚=1å°±æ˜¯åŠ äº†ä¸ªchange masterçš„å‘½ä»¤ï¼›=2å°±æ˜¯åªæ˜¯ä¸€ä¸ªcomment symbolæ³¨é‡Šè€Œå·²ï¼Œä¸ä¼šåƒ=1ä¸€æ ·ç”Ÿæˆä¸€ä¸ªchange master toè¿™ä¸ªå‘½ä»¤ã€‚=2æ˜¯åŠ æ³¨é‡Šï¼Œæ³¨é‡Šé‡Œé¢è®°å½•å…¨å¤‡åŠ¨ä½œå¯¹åº”çš„binlogçš„ä½ç½®ã€‚

![image-20230720102344946](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720102344946.png)

è¿™æ ·å°±èƒ½åœ¨æ³¨é‡Šé‡Œçœ‹åˆ°binllogçš„ä½ç½®positionäº†

![image-20230720102444092](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720102444092.png)

-- ä¸¤ä¸ªæ¨ªçº¿ï¼Œè¢«æ³¨é‡Šæ‰äº†ï¼›è¿™å°±æ˜¯--master-data=1çš„æ•ˆæœï¼Œ=2å°±æ˜¯æ³¨é‡Šå–æ¶ˆ--åˆ æ‰ã€‚

![image-20230720102601224](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720102601224.png)



![image-20230720102748844](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720102748844.png)

![image-20230720102827153](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720102827153.png)



æ‰€ä»¥çœ‹åˆ°è¿™ä¸ªMASTER_LOG_POS=2998040;å°±çŸ¥é“mysqldumpå…¨å¤‡çš„åŠ¨ä½œæ˜¯å¯¹åº”åœ¨binlogé‡Œçš„2998040è¿™ä¸ªä½ç½®çš„ï¼Œå¯¹åº”è¿™ä¸ªä½ç½®åšäº†å…¨å¤‡ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„binlogæ˜¯è€æ—¥å¿—ï¼Œä¹‹åçš„å°±æ˜¯æ–°æ—¥å¿—äº†ã€‚å…¨å¤‡è¦+ä¸Šä»è¿™ä¸ªä½ç½®ä»¥åçš„binlogã€‚



æ¯”å¦‚ç°åœ¨å¼€å§‹æœ‰æ•°æ®æ›´æ–°äº†ï¼Œæ¨¡æ‹Ÿä»è¿™ä¸ªä½ç½®å¼€å§‹ä»¥åå­˜åœ¨æ•°æ®å˜åŠ¨

![image-20230720103508160](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720103508160.png)

æ•°æ®å˜åŠ¨äº†ï¼Œbinlogå°±å¢é•¿äº†

![image-20230720103616026](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720103616026.png)

å†åŠ ä¸€æ¡

![image-20230720103705847](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720103705847.png)

æ­¤æ—¶äºŒè¿›åˆ¶æ—¥å¿—è¢«æˆ‘ä»¬ç‹¬ç«‹çš„å­˜æ”¾äº†ï¼Œä¹Ÿä¸å¤ªæ‹…å¿ƒæ•°æ®åº“å´©åã€‚

![image-20230720103930324](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720103930324.png)

ç°åœ¨å°±æ¨¡æ‹Ÿæ•…éšœåœºæ™¯

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720100257409.png" alt="image-20230720100257409" style="zoom:30%;" />

æœ‰å…¨å¤‡ï¼Œç„¶ååˆäºŒè¿›åˆ¶çš„æ–°å¢ï¼Œç„¶ååäº†

åˆ åº“æ¨¡æ‹Ÿæ•°æ®åº“å´©äº†

![image-20230720104148524](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720104148524.png)

å°±åªåˆ é™¤mysql/ä¸‹é¢çš„æ–‡ä»¶ï¼Œmysqlæ–‡ä»¶å¤¹ä¿ç•™äº†ï¼Œè¿™æ ·å°±æ— éœ€å†æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶å¤¹+ä¿®æ”¹æ‰€æœ‰è€…ã€‚

![image-20230720104310505](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720104310505.png)

è™½ç„¶æ­¤æ—¶æ•°æ®åº“æ²¡äº†ï¼Œä½†æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶binlogåˆ†å¼€æ”¾çš„ï¼Œè¿˜åœ¨

è¿˜åŸæ“ä½œå¼€å§‹

1ã€é‡å¯æ•°æ®åº“æœåŠ¡ï¼Œä¼šç”Ÿæˆå´­æ–°çš„æ•°æ®åº“æ–‡ä»¶ã€‚

æˆ‘å®éªŒçš„æ—¶å€™æŠ¥é”™äº†ï¼Œ

![image-20230720104535537](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720104535537.png)

![image-20230720105327235](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720105327235.png)



![image-20230720105337096](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720105337096.png)

æˆ‘å…ˆé‡å¯ä¸‹çœ‹çœ‹ï¼Œé‡å¯è¿˜æ˜¯ä¸è¡Œï¼Œä¿®æ”¹

![image-20230720105719795](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720105719795.png)

æ²¡ç”¨ï¼Œè¿˜å¾—è°·æ­Œ

https://stackoverflow.com/questions/60248748/could-not-increase-number-of-max-open-files-to-more-than-4096-request-4214

![image-20230720110045596](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720110045596.png)

æ‰¾åˆ°äº†ï¼ŒAIæœ‰æ—¶å€™è¿˜æ˜¯ä¸é è°±

ä¸è¿‡ï¼Œé‡ç½®mariadbä¹Ÿè¡Œçš„ï¼Œå•Šå“ˆå“ˆ

æ”¹ä¸€ä¸‹

![image-20230720110219134](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720110219134.png)



æœ‰è¿›å±•ï¼Œä½†è¿˜ä¸å¤Ÿ



![image-20230720110307192](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720110307192.png)



é‡è£…ç®—äº†ï¼Œæ“ï¼

yum -y remove mariadb-server

yum -y install mariadb-server

![image-20230720111301229](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720111301229.png)

å¥½å¥‡æ€ªå•Šï¼Œé‡è£…åï¼Œrm -rf /var/lib/mysql/*    åé‡å¯ç«‹é©¬å°±èµ·ä¸æ¥äº†

ç®—äº†æ•…éšœæ¼”ç¤ºå°±ä¸èƒ½ç”¨rm -rf /var/lib/myqls/*äº†ï¼Œå°±ç®—ç”¨è¿™ä¸­æ–¹å¼ï¼Œä¹Ÿåªèƒ½ç”¨é‡è£…æ¥å¼„ï¼Œå¦åˆ™æŸ¥è¿™ä¸ªé”™å¤ªéº»çƒ¦äº†

![image-20230720111532047](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720111532047.png)

åæ­£é‡è£…åï¼Œ![image-20230720111947286](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720111947286.png)

è¿™ä¸ªå€¼ä¹Ÿä¸ç”¨åŠ¨äº†ã€‚



å¥½äº†ï¼Œå°æ’æ›²ï¼Œç»§ç»­æ¢å¤æ•°æ®å§

ç°åœ¨é‡è£…mariadb-serveråçš„æ•°æ®éƒ½æ˜¯å…‰çš„ï¼Œå¼€å§‹æ¢å¤

![image-20230720112148922](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720112148922.png)

### 1ã€å‡†å¤‡å¥½å…¨å¤‡æ–‡ä»¶ï¼Œbinlogæ–‡ä»¶

å®Œäº†ï¼Œæˆ‘æ²¡æœ‰å¤‡ä»½é…ç½®æ–‡ä»¶ï¼Œå“ˆå“ˆå“ˆ!åé¢æ•™æï¼Œç®—äº†æ‰‹åŠ¨æ„æ€æ„æ€å§

![image-20230720112438141](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720112438141.png)

### 2ã€è¦è¿˜åŸä¹‹å‰å‡è®¾å¥½æ•°æ®åº“ä¸€éƒ¨åˆ†ç”¨æˆ·è¿˜åœ¨ç”¨ç€ï¼Œæ­¤æ—¶éœ€è¦åœæœç»´æŠ¤

â‘ å†ä¸€ä¸ªåœæœç»´æŠ¤çš„æ–‡æœ¬é‡Œå†™ä¸Šè¿™ä¸ªæœºå™¨çš„ä¿¡æ¯ï¼Œè®©ç›¸å…³äººå‘˜å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®ä¼˜åŒ–å‡ºæ¥å°±æ˜¯ä¸€ä¸ªwebå±•ç¤ºé¡µé¢

â‘¡ä¿®æ”¹/etc/my.cnfé‡Œçš„é€‰é¡¹ï¼Œè¡¥ä¸€ä¸ªskip-networking=1å°±å…³é—­3306ç«¯å£

![image-20230720112750552](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720112750552.png)

![image-20230720112758977](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720112758977.png)

### 3ã€å…ˆæŠŠå…¨å¤‡æ–‡ä»¶è¿˜åŸæ‰

æ³¨æ„ï¼Œmysql < /data/all.sql  å°±å¯ä»¥ç›´æ¥è¿˜åŸäº†ï¼Œä½†æ˜¯è¿™ä¸ªè¿˜åŸåŠ¨ä½œ æœ¬èº«ä¹Ÿå°±æ˜¯å¤§é‡sqlè¯­è¨€ï¼Œä¹Ÿä¼šè®°å½•åˆ°binlogé‡Œçš„ï¼Œè€Œè¿™éƒ¨åˆ†è¿˜åŸæ“ä½œï¼Œä¸€èˆ¬æ— éœ€è®°å½•åˆ°binlogé‡Œã€‚

â‘ åœæ­¢æ•°æ®åº“çš„binlogå…ˆ

ä¸€èˆ¬ç”Ÿæˆä¸­binlogå·²ç»å¼€äº†ï¼Œä¸¤ä¸ªå¼€å…³ï¼Œéƒ½éœ€è¦æ‰“å¼€ï¼Œæ‰€ä»¥å…³é—­binlogå°±æ˜¯è¿›å…¥cliäº¤äº’æ¨¡å¼å»å…³ä¸€ä¸ªå°±è¡Œäº†ã€‚ä¹‹å‰æˆ‘æ˜¯é‡è£…äº†mariadbï¼Œæ‰€ä»¥ binlogæ²¡å¼€ï¼Œæˆ‘å…ˆå¼€äº†å»é…ç½®æ–‡ä»¶é‡Œã€‚

![image-20230720113500125](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720113500125.png)

![image-20230720113520263](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720113520263.png)

OKäº†ï¼Œç„¶åï¼Œä½¿ç”¨cliå…³é—­binlogï¼Œå¯¼å…¥å…¨å¤‡æ–‡ä»¶

ä½¿ç”¨ set sql_log_bin=offï¼›å°±è¡Œäº†ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¼šè¯çº§çš„ï¼Œä¸ä¼šå½±å“åˆ«äººï¼Œä¸”é€€å‡ºå¤±æ•ˆã€‚

![image-20230720113701144](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720113701144.png)

æ­¤æ—¶binlogå°±ä¸´æ—¶ç¦ç”¨äº†ã€‚



æ­¤æ—¶binlogçš„ä½ç½®åœ¨

![image-20230720113916128](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720113916128.png)

è€Œå…¨å¤‡çš„åŠ¨ä½œæ‰€åœ¨binlogçš„ä½ç½®åœ¨

![image-20230720113954470](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720113954470.png)

ä¸Šå›¾å¯è§æ˜¯ä»mariadb-bin.000004è¿™ä¸ªæ–‡ä»¶çš„2990804è¿™ä¸ªä½ç½®ä¹‹å‰çš„binlogæœ‰å…¨å¤‡ã€‚

è¿™ä¸ªæ—¶å€™çš„ä¸€ä¸ªè§„èŒƒæ“ä½œå°±æ˜¯ï¼Œâ‘ ç”±äºä½ åœæœäº†ï¼Œæ‰€ä»¥æ•°æ®åº“ä¸ä¼šå˜åŒ–äº†ï¼Œbinlogä¸æ–°å¢äº†â‘¡æ‰€ä»¥æ­¤æ—¶å¯ä»¥åˆ·æ–°ä¸€ä¸ªbinlogï¼Œä»æ–°çš„binlogä¹‹å‰åˆ°--master-dataé‚£ä¸ªä½ç½®å°±æ˜¯å…¨å¤‡ä»¥åéœ€è¦è¡¥å……çš„binlog

![image-20230720114809499](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720114809499.png)

æ‰€ä»¥å°±æ˜¯éœ€è¦ä»å…¨å¤‡è¡¥å……çš„binlogæ¶‰åŠè¿™äº›æ–‡ä»¶

![image-20230720114925573](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720114925573.png)

å‘µå‘µï¼Œè™½ç„¶å¥½å¤šå°±æ˜¯ç©ºçš„ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯æ¼”ç¤ºå˜›ï¼Œä¸¥è°¨äº›ä¹Ÿæ˜¯è¦è¿™ä¹ˆåšçš„ã€‚ 

å…³é”®cliï¼š mysqlbinlog mariadb-bin.000004 >> /data/inc.sql

ä¸‹å›¾å†™çš„æœ‰ç‚¹é—®é¢˜ï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªæ–‡ä»¶å®ƒåªæ˜¯ç²¾ç¡®åˆ°äº†æ–‡ä»¶ï¼Œæ²¡æœ‰ç²¾ç¡®åˆ°ä½ç½®ï¼Œæ‰€ä»¥cliè¦ä¿®æ”¹

```
mysqlbinlog --start-postion=2998040 mariadb-bin.000004 > /data/inc.sql
mysqlbinlog mariadb-bin.000005 >> /data/inc.sql
mysqlbinlog mariadb-bin.000006 > /data/inc.sql
mysqlbinlog mariadb-bin.000007 >> /data/inc.sql
mysqlbinlog mariadb-bin.000008 >> /data/inc.sql
mysqlbinlog mariadb-bin.000009 >> /data/inc.sql
mysqlbinlog mariadb-bin.000010 >> /data/inc.sql
mysqlbinlog mariadb-bin.000011 >> /data/inc.sql
mysqlbinlog mariadb-bin.000012 >> /data/inc.sql
```

![image-20230720115224419](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115224419.png)

é©¬ä¸Šå°±å¼€å§‹è¿˜åŸäº†ï¼Œ

![image-20230720115335161](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115335161.png)

all.sqlå…¨å¤‡+inc.sqlé‡Œçš„all.sqlé‡Œçš„--master-dataçš„ä½ç½®åˆ°è¡Œå°¾

source /data/all.sql  å…ˆè¿˜åŸå…¨å¤‡

![image-20230720115548124](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115548124.png)

ä½ çœ‹å°±å·²ç»æ¢å¤å…¨å¤‡çš„ä¸œè¥¿äº†

![image-20230720115615930](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115615930.png)

![image-20230720115632199](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115632199.png)

åœ¨è¿˜åŸinc.sqlè¿™ä¸ªbinlogè¡¥å…¨çš„

source /data/inc.sql

![image-20230720115739247](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115739247.png)



ä¸¤ä¸ªæ•°æ®å°±å›æ¥äº†

![image-20230720115827240](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720115827240.png)

é€€å‡ºï¼Œsql_log_binå°±ç›´æ¥æ¢å¤æˆONå•¦ã€‚æˆ–è€…set sql_log_bin=on;

ç„¶åä¿®æ”¹/etc/my.cnfé‡Œçš„é€‰é¡¹æ‰“å¼€å¯¹å¤–æœåŠ¡

![image-20230720133220990](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720133220990.png)

![image-20230720133248816](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720133248816.png)

ä»¥ä¸Šå°±æ˜¯æ•°æ®åº“çš„å¤‡ä»½å’Œæ¢å¤ï¼Œ

ä¸è¿‡å‰æå°±æ˜¯ï¼Œbinlogå¾—å®‰å…¨å¾—ä¿å­˜èµ·æ¥ï¼Œä»¥åŠå…¨å¤‡ä¸€æ ·å¾—å¦¥å–„ä¿å­˜ã€‚

1ã€äºŒè¿›åˆ¶æ—¥å¿—å¯ç”¨

2ã€msqldup -A --master-data=2 > /data/all.sql

æ•°æ®ä¿®æ”¹

insert students (name,age) values ('a',20)

insert students (name,age) values ('b',40)

3ã€åˆ åº“ rm -rf /var/lib/mysql/*  æ¨¡æ‹Ÿæ•…éšœï¼Œå®é™…ä¸Šå¯èƒ½ç”Ÿæˆä¸­å°±æ˜¯éƒ¨åˆ†ä¸šåŠ¡æ•…éšœã€‚

4ã€è¿˜åŸ

å¸è½½mariadb-serverï¼Œé‡è£…

4.1ã€é€šå‘Šç»´æŠ¤

4.2ã€å¯¹å¤–åœæœï¼Œä¿®æ”¹skip-network=1

4.3ã€systemc restart mariadb

4.4ã€mysql > show master logs; æŸ¥çœ‹å½“å‰binlogä½ç½®ï¼Œå°±æ˜¯ä¸ºäº†å–--master-dataåˆ°è¿™ä¸ªä½ç½®çš„binlogå»è¿˜åŸã€‚è®°å½•æ­¤ä½ç½®å€¼

```mysql
mysqlbinlog --start-postion=xxxx mariadb-bin.0000x >> /data/inc.sql
mysqlbinlog mariadb-bin.0000x >> /data/inc.sql
mysqlbinlog mariadb-bin.0000x >> /data/inc.sql
```



5ã€mysql > set sql_log_bon=off;

5.1ã€mysql > source /data/all.sql 

5.2ã€mysql > source /data/inc.sql



6ã€mysql > set sql_log_bin=on;  å¼€ä¸ªå±ï¼Œç›´æ¥\qå°±è¡Œäº†ï¼Œsessionçº§é€€å‡ºå°±æ²¡äº†ã€‚

7ã€æ¢å¤é…ç½®æ–‡ä»¶é‡Œçš„skip-networkingï¼Œæˆ–æ”¾å¼€é˜²ç«å¢™å¯¹å¤–ã€‚

8ã€æ£€æŸ¥æ•°æ®ï¼Œç¡®è®¤æ¢å¤ã€‚





## å¦‚æœæ˜¯äººä¸ºæ•…éšœæ¯”å¦‚åˆ è¡¨äº†

![image-20230720135424202](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720135424202.png)

ä¸‹åˆ2ç‚¹å®Œå…¨å¤‡ä»½

18ç‚¹è€6åˆ è¡¨

18ç‚¹10ä½ å¼€å§‹å¤„ç†å»æ¢å¤æ•°æ®



å¥½äº†æ•…äº‹è®²å®Œäº†ï¼Œå¼€å§‹æ¢å¤å§

æ€è·¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå°±æ˜¯

â‘ å…¨å¤‡æ–‡ä»¶æ¢å¤åˆ°2ç‚¹

â‘¡æ‰¾åˆ°binlogï¼Œvimè¿›å»å»æ‰18ç‚¹çš„é‚£ä¸ªdrop table students;è¿™ä¸ªåˆ è¡¨çš„å‘½ä»¤ï¼Œæ©ï¼Ÿä½ é—®æˆ‘ä¸ºä»€ä¹ˆå»æ‰ï¼Œä½ ä¸å»æ‰ï¼Œå¾…ä¼šæ¢å¤binlogä¸€æ ·è¿˜æ˜¯åˆ äº†å•Š

â‘¢æ¢å¤çš„æ“ä½œå°±å’Œä¸Šé¢ä¸€æ ·äº†ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èƒ½å°†æ•°æ®æ¢å¤åˆ°18ç‚¹10åˆ†ã€‚

å†æ¥ä¸€éå®éªŒ

![image-20230720145444652](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720145444652.png)

çœ‹ç€åƒé è°±çš„ï¼Œå°±æ˜¯mysqldumpé»˜è®¤æ˜¯å•è¡¨äº‹åŠ¡ï¼Œä½†æ˜¯æœ‰å¤–é“¾å°±è¦å¤šè¡¨ä¸€ä¸ªäº‹åŠ¡äº†ã€‚ğŸ‘†åæ–‡ä¼šè®²äº‹åŠ¡ä¸‹å¤‡ä»½ã€‚

1ã€å…¨å¤‡-æ¨¡æ‹Ÿå›¾ä¸Š2ç‚¹çš„å…¨å¤‡

![image-20230720144403339](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720144403339.png)

![image-20230720145607493](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720145607493.png)

2ã€æ¥ç€æ¨¡æ‹Ÿ2ç‚¹ä»¥åæ•°æ®å˜åŒ–ï¼Œä»¥åŠåˆ è¡¨æ“ä½œã€‚

![image-20230720145812593](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720145812593.png)

æ¨¡æ‹Ÿ18ç‚¹åˆ è¡¨äº†

![image-20230720150300742](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720150300742.png)

æ¨¡æ‹Ÿåç»­æ–°çš„æ•°æ®å˜åŒ–ï¼Œä½ åªæ˜¯åˆ äº†studentsè¡¨ï¼Œå…¶ä»–ä¸šåŠ¡å¯èƒ½è¿˜æ˜¯å¯ä»¥æ­£å¸¸ï¼Œæ¯”å¦‚teacherè¡¨çš„å†™å…¥ã€‚

![image-20230720150544269](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720150544269.png)



è¿™ä¸ªæ—¶å€™ä½ æ”¶åˆ°æ•…éšœå‘Šè­¦äº†ï¼Œæˆ–è€…æœ‰äººæ‰¾ä½ ï¼Œåˆ åº“çš„è€6ç”µè¯ä½ äº†ï¼Œè¿™ä¸ªè‚¯å®šä¸æ¯”å‘Šè­¦æ…¢äº†~

â‘ ç¦æ­¢ç”¨æˆ·è®¿é—®ï¼Œå°±æ˜¯skip-networking=1æˆ–è€…iptables denyæ‰ï¼›æˆ–è€…åŠ é”flush tables with read lockï¼›è¿™æ ·ä¸æ˜¯å¤ªå¥½ï¼Œå› ä¸ºè¿˜æ˜¯èƒ½è¯»ï¼Œæ•°æ®éƒ½è¢«åˆ äº†ï¼Œè¯»ä¹Ÿæœ‰é—®é¢˜äº†ï¼›ç„¶åskip-networking=1ä¹Ÿä¸æ˜¯å¤ªå¥½ï¼Œå› ä¸ºè¿˜è¦é‡å¯æœåŠ¡ï¼Œiptablesä¸éœ€è¦é‡å¯æœåŠ¡ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œå…¶å®æ— æ‰€è°“ã€‚ä¸€èˆ¬éƒ½åœæœç»´æŠ¤~

![image-20230720151330754](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720151330754.png)

![image-20230720151340089](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720151340089.png)

â‘¡å¼€å§‹è¿˜åŸ

è¦æ³¨æ„ï¼Œè¿˜åŸçš„æ—¶å€™ï¼Œè¦å»æ‰18ç‚¹çš„dropåˆ è¡¨cliï¼Œç„¶åå°±å¯ä»¥è¿˜åŸåˆ°18ç‚¹10åˆ†åœæœçš„æ—¶å€™äº†ã€‚

å»å…¨å¤‡çš„æ–‡ä»¶é‡Œçœ‹ä¸‹--master-dataé‡Œçš„binlogä½ç½®ã€‚

![image-20230720151549971](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720151549971.png)

æ˜¯15ç¼–å·çš„344ä½ç½®åšçš„å…¨å¤‡ã€‚

ä¹Ÿå°±æ˜¯ä»15binlog344ä½ç½®å¾€åä¸€ç›´åˆ°åœæœçš„æ—¶å€™

å…¶å®åœæœçš„æ—¶å€™binlogä¹Ÿè¦åœæ‰äº†ï¼Œä¸è¿‡åœæœäº†binlogè‡ªç„¶ä¹Ÿä¸ä¼šæœ‰äº†ï¼Œå¾…ä¼šè¿˜åŸçš„æ—¶å€™åœæ‰binlogå°±è¡Œäº†ã€‚

![image-20230720152239701](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720152239701.png)

æˆ‘ä»¬å¯ä»¥åˆ·ä¸€ä¸‹æ—¥å¿—

![image-20230720152534253](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720152534253.png)

å°±æ˜¯17ä»¥å‰çš„ï¼Œ15ä»¥åçš„éƒ½æ˜¯è¦å¤„ç†çš„æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯çœ‹èµ·æ¥èˆ’æœç‚¹çš„æ“ä½œã€‚

å°±æ˜¯è¯´17è¿™ä¸ªæ–°binlogï¼Œæ˜¯æˆ‘ä»¬æ‹’ç»äº†åˆ«äººè®¿é—®ååˆ·å‡ºæ¥çš„ï¼Œä¸åº”è¯¥å†æœ‰ä»€ä¹ˆæ–°çš„æ•°æ®äº†ï¼Œä¸ç”¨ç®¡äº†å°±ã€‚

```mysql
mysqlbinlog --start-position=344 /data/logs/logbin/mariadb-bin.000015 > /data/inc.sql

mysqlbinlog /data/logs/logbin/mariadb-bin.000016 >> /data/inc.sql
```



![image-20230720153817937](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720153817937.png)

æ‰¾åˆ°dropé‚£ä¸€è¡Œï¼Œåˆ æ‰ï¼Œè§„èŒƒç‚¹å°±æ˜¯å…ˆå¤åˆ¶ä¸€ä»½å‡ºæ¥ï¼Œç„¶åå†æ”¹ã€‚

![image-20230720160547167](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720160547167.png)



![image-20230720153906637](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720153906637.png)

<img src="2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720154007111.png" alt="image-20230720154007111" style="zoom:50%;" /> 



å…³é—­binlog

![image-20230720160717589](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720160717589.png)

ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œä½ å…¨å¤‡é‡Œé¢æ˜¯æ™®éå­˜åœ¨åˆ è¡¨åé‡å»ºæ“ä½œï¼Œ

1ã€ä½ åˆ æ‰æ‰€æœ‰åº“ï¼Œæ‹¿å…¨å¤‡å»æ¢å¤

2ã€ä½ ç›´æ¥ä¸åˆ æ‰€æœ‰çœ‹ï¼Œç›´æ¥ç”¨å…¨å¤‡è¦†ç›–ï¼Œè¿™ä¸ªå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœå…¨å¤‡åŠ¨ä½œä¹‹ååˆ›å»ºäº†ä¸€ä¸ªè¡¨ï¼Œä½ æ‹¿å…¨å¤‡å»æ¢å¤ï¼Œå®ƒå°±ä¸ä¼šDROPæ‰ï¼Œä¸çŸ¥é“ä¼šä¸ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚

ç„¶åä½ è¿˜æœ‰binlogå»è¡¥å·®ä»·ï¼Œåˆ°æ—¶å€™è¿™ä¸ªè¡¨å°±æœ‰é—®é¢˜å¯èƒ½ï¼Œæ‰€ä»¥å¯èƒ½è¿˜æ˜¯æ¨èåˆ æ‰æ‰€æœ‰çš„åº“ã€‚

```linux
cp -a /etc/my.cnf /root   å¤‡ä»½é…ç½®æ–‡ä»¶
```

![image-20230720161403291](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720161403291.png)

![image-20230720161424443](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720161424443.png)

![image-20230720161436901](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720161436901.png)



```
systemc	restart mariadb
```

![image-20230720161714221](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720161714221.png)

17ä»¥åéƒ½ä¸ç”¨ç®¡ï¼ŒåŒ…æ‹¬17ï¼Œéƒ½æ˜¯rmå’Œyumè‡ªåŠ¨ç”Ÿæˆçš„ã€‚

å…³æ‰binlog

![image-20230720161848341](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720161848341.png)



```
source /data/all_2023-07-20.sql
```

![image-20230720162108377](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720162108377.png)

```
source /data/inc.sql
```

![image-20230720162244632](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720162244632.png)

![image-20230720162442124](2-mysqlå¤‡ä»½è¿˜åŸmysqldumpä½¿ç”¨.assets/image-20230720162442124.png)



ç„¶åå°±æ˜¯é€€å‡ºï¼Œä¿®æ”¹æ³¨é‡Šé…ç½®æ–‡ä»¶é‡Œçš„skip-networkingï¼Œå¯¹å¤–æœåŠ¡ã€‚
