# 3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.md



# redisçš„å‘Šè­¦ä¼˜åŒ–

å¯åŠ¨çš„å‘Šè­¦ï¼Œæˆ‘ç”¨çš„rocky-linuxï¼Œç°åœ¨å°±ä¸€ä¸ªå‘Šè­¦äº†



![image-20241230110527581](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230110527581.png)



ä¸€äº›æŒ‡æ ‡æ— éœ€å…³å¿ƒï¼Œåœ¨æ–°ç‰ˆçš„linuxä¸‹ï¼Œä½†æ˜¯è¿˜æ˜¯äº†è§£ä¸‹

![image-20241230134541251](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230134541251.png)



æ­£å„¿å…«ç»çš„åŠå¼€è¿æ¥å’Œå…¨è¿æ¥çœ‹è¿™ä¸ª

https://www.xiaolincoding.com/network/3_tcp/tcp_queue.html#%E4%BB%80%E4%B9%88%E6%98%AF-tcp-%E5%8D%8A%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%E5%92%8C%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97



<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/3.jpg" alt="åŠè¿æ¥é˜Ÿåˆ—ä¸å…¨è¿æ¥é˜Ÿåˆ—" style="zoom:50%;" />





TCPè¿æ¥çš„æ—¶å€™ï¼š

1ã€å…¨è¿æ¥é˜Ÿåˆ—ï¼š3æ¬¡æ¡æ‰‹æˆåŠŸåçš„è¿æ¥ä¿¡æ¯é˜Ÿåˆ—ï¼Œç”¨æ¥å¯¹æ¥ä¸Šä¼ APPçš„acceptå‡½æ•°çš„ã€‚

2ã€åŠè¿æ¥é˜Ÿåˆ—ï¼šåŠå¼€è¿æ¥ï¼Œæ”¶åˆ°SYNåçš„å­˜å‚¨é˜Ÿåˆ—ç”¨æ¥ç­‰å¾…åç»­2æ¬¡æ¡æ‰‹çš„ã€‚





ç„¶årocky9.2è¿˜æ˜¯æœ‰ä¸€ä¸ªå‘Šè­¦çš„

![image-20241230135001721](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230135001721.png)

![image-20241230135054278](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230135054278.png)



### é€æ˜å¤§é¡µTHPçš„ä¼˜åŒ–ä¹Ÿä¸éœ€è¦

![image-20241230140827377](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230140827377.png)

![image-20241230140917573](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230140917573.png)

è¿™ä¸ªè€ç‰ˆæœ¬çš„linuxéœ€è¦æ”¹ï¼Œè€Œä¸”è¿˜æ²¡æœ‰åŠæ³•é€šè¿‡sysctl.confé‡Œå»ä¿®æ”¹ï¼Œåªèƒ½ä¿®æ”¹å†…å­˜æ–‡ä»¶ï¼Œ/sys/kernel/mm/ä¹Ÿæ˜¯å†…å­˜æ–‡ä»¶ï¼Œé‡å¯ä¹Ÿå°±æ²¡äº†ã€‚æ‰€ä»¥éœ€è¦rc.localé‡Œå†™å¥½echo ä¿®æ”¹çš„å‘½ä»¤ä¿è¯å¼€æœºå¯åŠ¨ğŸ‘‡

![image-20241230141230204](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230141230204.png)



![image-20241230141425106](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230141425106.png)



### redisæ˜¯å¤šçº¿ç¨‹

![image-20241230142755647](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230142755647.png)

æœ‰ä¸ªlå°±ä»£è¡¨å¤šçº¿ç¨‹ï¼Œä¸Šä¸€èŠ‚é‡Œæœ‰è¯´è¿‡rediså•çº¿ç¨‹åªæ˜¯å“åº”ç”¨æˆ·è¯·æ±‚çš„å·¥ä½œæ˜¯å•çº¿ç¨‹ã€‚



![image-20241230142920206](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230142920206.png)

pstreeé‡ŒèŠ±æ‹¬å·å°±æ˜¯çº¿ç¨‹äº†ğŸ‘†





# å®¢æˆ·ç«¯å·¥å…·redis-cli



ç¼–è¯‘å®‰è£…åå°±åœ¨å®‰è£…çš„è·¯å¾„é‡Œ

![image-20241230143159121](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230143159121.png)



å¦‚æœæ˜¯åˆ«çš„æœºå™¨è¦ä½¿ç”¨rediså®¢æˆ·ç«¯è¿è¿‡æ¥ï¼Œå°±ä¸ä¼šå†å»ç¼–è¯‘å®‰è£…æ•´ä¸ªredis(serverå’Œcli)äº†ï¼Œè€Œæ˜¯å•å•å®‰è£…redis-cliäº†ã€‚

ç„¶åé€šè¿‡ldd å¯ä»¥åˆ¤æ–­å‡ºæ•´ä¸ªredis-cliä¸æ˜¯ä¸€ä¸ªç®€å•å¤åˆ¶è¿‡å»å°±èƒ½ç”¨çš„binæ–‡ä»¶ï¼Œéƒ½æ˜¯å…±äº«åº“--åŠ¨æ€ç¼–è¯‘çš„ï¼Œcè¯­è¨€ã€‚

![image-20241230143408863](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230143408863.png)



## **ç”¨telnetè¿æ¥redisï¼Œå……å½“redis-cli**

å…ˆä¿®æ”¹ç›‘å¬åœ°å€

![image-20241230144123464](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230144123464.png)

æ­¤æ—¶ç”¨å¦ä¸€å°æœºå™¨telnetçœ‹çœ‹

![image-20241230144707529](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230144707529.png)

è¦åŠ å¯†ç ï¼Œå¦åˆ™è¿ä¸äº†ï¼Œç”¨redis-cliä¸€æ ·å­˜åœ¨è¿™ä¸ªæƒ…å†µ

![image-20241230144920403](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230144920403.png)



å…ˆç”¨æœ¬åœ°çš„telnetçœ‹çœ‹å¸¸è§„æ“ä½œ



**info çœ‹æ‰€æœ‰çš„**

![image-20241230145602739](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230145602739.png)



**info serveråªçœ‹serverçš„ä¿¡æ¯**

<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230145615744.png" alt="image-20241230145615744" style="zoom:50%;" /> 







**çœ‹key**

<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230145844012.png" alt="image-20241230145844012" style="zoom:50%;" /> 

ç°åœ¨æ˜¯ç©ºçš„ğŸ‘†





**telnetçš„å‚æ•°æ²¡æœ‰redis-cliä¸°å¯Œ**

![image-20241230150047983](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230150047983.png)



**redisä¸ä¼šå¤ªå¤§å†…å­˜çš„åº•å±‚é€»è¾‘**

<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230150358341.png" alt="image-20241230150358341" style="zoom:30%;" />

å‡è®¾redisç”¨512Gå†…å­˜ï¼Œé‚£ä¹ˆæŒä¹…åŒ–ï¼ŒI/Oå°±ä¼šéå¸¸è€—æ—¶ï¼›åŒæ ·ä¸»ä»å¤åˆ¶ä¹Ÿä¼šè€—æ—¶å¤ªä¹…ï¼Œæ‰€ä»¥redisä¸€èˆ¬é¡¶å¤š32G/16Gäº†ä¸èµ·äº†ã€‚



å¦‚æœæœºå™¨æ ‡é…å†…å­˜å°±æ˜¯512Gï¼Œæ­¤æ—¶å°±å¯ä»¥é…ç½®rediså¤šå®ä¾‹æ¥å……åˆ†åˆ©ç”¨èµ·æ¥ã€‚ä½†æ˜¯å¤šå®ä¾‹ä¹Ÿæœ‰é—®é¢˜--å°±æ˜¯å®¿ä¸»ç‰©ç†æœºæŒ‚äº†ï¼Œå…¨éƒ¨å®ä¾‹rediséƒ½æŒ‚äº†ã€‚æ‰€ä»¥ä¸€èˆ¬å°±æ˜¯64G/128Gå†…å­˜ è·‘2-4ä¸ªrediså®ä¾‹å°±å¯ä»¥äº†ã€‚



### redis-cli



![image-20241230150831021](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230150831021.png)



![image-20241230151212271](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230151212271.png)



### å¼€å‘è¯­è¨€å¦‚ä½•è¿æ¥redis-server

è¿˜å¯ä»¥ç”¨å¼€å‘è¯­è¨€æ¥è¿ï¼Œå°±ä¼šæ¶‰åŠredisçš„apiå¼€å‘æ¥å£ï¼Œå°±è¦è°ƒç”¨è¿æ¥redisçš„åº“ï¼Œè¿™äº›åº“è¿˜ä¸æ˜¯å”¯ä¸€çš„ï¼Œå¼€æºçš„ã€‚

https://redis.io/docs/latest/develop/clients/redis-py/

![image-20241230151528407](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230151528407.png)



### pythonå¦‚ä½•å¯¹æ¥redis

![image-20241230161646029](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230161646029.png)

yum install python3-pip -y

pip install redis

![image-20241230161934060](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230161934060.png)

å½“å‰æ²¡å¯†ç ï¼Œåˆ äº†å¯†ç 



![image-20241230162122695](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230162122695.png)



![image-20241230162135669](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230162135669.png) 

...

...

![image-20241230162108597](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230162108597.png)

ä¸Šå›¾RDBæ˜¯è¾¾åˆ°ä¸€å®šæ•°æ®é‡å°±å¼€å§‹åšæŒä¹…åŒ–çš„æŠ¥é”™ï¼Œå…ˆä¸ç®¡ã€‚



ç„¶åç”¨redis-cliç™»å…¥è¿›å»çœ‹çœ‹key-value

![image-20241230162308712](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230162308712.png)



<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20241230162400691.png" alt="image-20241230162400691" style="zoom:50%;" /> 



















# å·¥ä½œæ¡ˆä¾‹

æŠ–éŸ³å¼€å‘è€…å·¥å…·çš„å†…ç½‘ç™½åå•æ”¾è¡Œ

<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20250109101802270.png" alt="image-20250109101802270" style="zoom:50%;" />



é€šè¿‡glasswireæŠ“åŒ…å¼€å‘è€…å·¥å…·è®¿é—®çš„åŸŸå

![image-20250109101929708](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20250109101929708.png)



é€šè¿‡é•¿æˆªå›¾(ä½¿ç”¨æœ‰æŠ€å·§ï¼Œå°±æ˜¯æ¡†é€‰èŒƒå›´è¦å¤§å¾ˆå¤šçš„)  



å†ä¸Šé¢çš„é•¿æˆªå›¾çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æˆªå›¾ï¼Œè·å–æ–‡å­— å’Œ å•ç‹¬å¤åˆ¶æ˜¾ç¤ºä¸å…¨çš„åŸŸåï¼Œå¾—åˆ°ä»¥ä¸‹æ¸…å•

```

ma3-normal-f.zijieapi.com.queniuyk.com
cdn.npmmirror.com.w.cdngslb.com
mssdk.bytedance.com.queniukw.com
mcs.snssdk.com.queniurc.com
mon.zijieapi.com.queniusz.com
mcs.snssdk.com.queniurc.com
hcdnd100.ipv6.c.cdnhwc1.com
I7-online-self-max.s.dsa.cdnbuild.net
i.snssdk.com.queniuyk.com
hcdndyn.zjv6.c.cdnhwc2.com
ma.zijieapi.com.queniuiq.com
17-online-self-max.s.dsa.cdnbuild.net
mssdk.bytedance.com.queniukw.com
If3-short.ibytedapm.com.w.cdngslb.com
hcdndyn.zjv6.c.cdnhwc2.com
If3-short.ibytedapm.com.w.cdngslb.com
www.doubao.com.queniurc.com
ma3-normal-lf.zijieapi.com.queniuyk.com
If3-short.ibytedapm.com.w.cdngslb.com
tron.jiyunhudong.com.queniukw.com
direct.toutiao-websocket-all-v3.lf.bytelb.net
hcdndyn.zjv6.c.cdnhwc2.com
www.doubao.com.queniurc.com
17-online-self-max.s.dsa.cdnbuild.net
cdn.npmmirror.com.w.cdngslb.com
mcs.doubao.com.230b2a2545cfa773.w.cdngslb.com
iv20vsgucpmm0lfjf5ne9rh0l8oip1pkuj3m0f0pi3fms2bn4hsfusjm.tt.x.bsgslb.cn
01t9rh0cf43mjsdiprk0bbe5qnvmq9tf9pjcqntml570vfhfhrevukhl.smogfly.club
lf-developer-cdn.open-douyin.com.230b2a2545cfa773.queniubg.com

imapi2.snssdk.com.queniurc.com
ma3-normal-lf.zijieapi.com.queniuyk.com
dns.iwgame.com
I7-online-self-max.s.dsa.cdnbuild.net
abtestvm.bytedance.com.queniurc.com
unpkg.byted-static.com.queniusy.com
hcdndyn.zjv6.c.cdnhwc2.com
ma.zijieapi.com.queniuiq.com
direct.toutiao-websocket-all-v3.lf.bytelb.net
minigame.zijieapi.com.queniurc.com
ma.zijieapi.com.queniuiq.com
If3-short.ibytedapm.com.w.cdngslb.com
host.docker.internal
```




å°†ä»¥ä¸Šæ¸…å• å¤åˆ¶åˆ° linuxé‡Œå¤„ç†

<img src="3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20250109102709827.png" alt="image-20250109102709827" style="zoom:50%;" />

001 002 003æ˜¯å¼€å‘äººå‘˜å•ç‹¬æçš„å…¶ä»–åŸŸåï¼Œå•ç‹¬å¤„ç†ä¸€ä¸‹ï¼Œæ€è·¯ä¸€æ ·çš„ğŸ‘‡

```shell
 vim 01

 cat 01
 cat 01 |xargs -i dig {} +short
 cat 01 |xargs -i dig {} +short >> 02  # å¤šæ¥å‡ é >=3å§
 cat 01 |xargs -i dig {} +short @223.5.5.5 >> 02  # æ¢ä¸ªdnsä¹Ÿå¤šæ¥å‡ é
 
 cat 02
 cat 02 |sort |uniq
 cat 02 |sort |uniq >> 03
 

 cat 03
 cat 03 |awk -F '.' '{print $1,$2,$3}'
 cat 03 |awk -F '.' '{print $1,$2,$3}' |sort |uniq
 cat 03 |awk -F '.' '{print $1,$2,$3}' |sort |uniq |tr -s ' ' '.'
 cat 03 |awk -F '.' '{print $1,$2,$3}' |sort |uniq |tr -s ' ' '.' > 04
 

 cat 04
 cat 04 |xargs -i echo {}
 cat 04 |xargs -i echo "{}.0"
 cat 04 |xargs -i echo "{}.0" > 05
 
 
 cat 05
 cat 05 |xargs -i echo "set address untrust {}/24 {}/24"
 # å°†ä¸Šé¢çš„cliå±å¹•è¾“å‡ºç»“æœå¤åˆ¶åˆ°ssgé‡Œ
 
 cat 05 |xargs -i echo "set group address "Untrust" "douYinApi" add {}/24"
 # å°†ä¸Šé¢çš„cliè¾“å‡ºç»“æœå¤åˆ¶åˆ°ssgé‡Œ

```



ç„¶åssgé‡Œè¿™æ ·åšï¼Œåœ¨douYinAPiä¸‹é¢å«ä¸€æ¡deny Anyï¼Œå½“ç„¶ä½ çš„çŸ¥é“å½“å‰å¼€å‘äººå‘˜çš„å†…ç½‘æœºå™¨çš„IP

![image-20250109102449785](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20250109102449785.png)

ç„¶åè®©å¼€å‘äººå‘˜æµ‹è¯•

å¦‚æœOKï¼Œå°±OKK

å¦‚æœéƒ¨OKï¼Œå°±è§‚å¯Ÿdeny Anyçš„é‚£ä¸ªæ—¥å¿—ï¼ŒæŸ¥æ¼è¡¥ç¼ºã€‚



å…·ä½“æ€ä¹ˆæŸ¥æ¼è¡¥ç¼ºï¼Œè¦è®©å¼€å‘äººå‘˜å…³é—­æ‰€æœ‰åº”ç”¨ï¼Œåªç•™ä¸€ä¸ªæŠ–éŸ³å¼€å‘å·¥å…·ï¼Œç„¶åssgä¸Šåšå¥½logæ‰“åˆ°linuxçš„rsyslogä¸Šï¼Œç„¶åæ²Ÿé€šå¥½å¼€å§‹æ“ä½œçš„æ—¶é—´ï¼ŒæŠ“å–é‚£å‡ åˆ†é’Ÿçš„ç›®æ ‡IPå°±è¡Œäº†ã€‚ä»€ä¹ˆé‡Œé¢æœ‰äººæ··å…¥äº†ç™¾åº¦ç½‘ç›˜ï¼Ÿ(ï¿£â–½ï¿£)"ï¼Œé‚£å°±åœ¨åšä¸€ä¸ªæ‰€æœ‰äº‘ç›˜çš„åŸŸåå’ŒIPæ¸…å•é¡¶åœ¨å‰é¢DENYæ‰ã€‚

![image-20250109151811466](3.Redisæ€§èƒ½ä¼˜åŒ–å’Œå®¢æˆ·ç«¯è®¿é—®.assets/image-20250109151811466.png)

ä¸‹é¢å°±æ˜¯å’Œä¹‹å‰çš„å¤„ç†ä¸€æ ·äº†ï¼Œç²—çŠ·ç‚¹å°±æ˜¯å–/24ï¼Œå·®ä¸å¤šå°±è¡Œäº†ã€‚





