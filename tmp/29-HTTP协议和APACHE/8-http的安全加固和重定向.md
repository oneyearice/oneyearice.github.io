# ç¬¬8èŠ‚. httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘



ä¹¦æ¥ä¸Šæ–‡çš„ä¸€äº›å…¶ä»–æ³¨æ„ç‚¹



## æµ‹è¯•åŸºäºhttpsè®¿é—®ç›¸åº”çš„ä¸»æœº



### æµè§ˆå™¨éªŒè¯httpsï¼Œå‘µå‘µ

![image-20231013134017446](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013134017446.png)



### openssl éªŒè¯httpsä¸»æœº

openssl s_client [-connect host:port] [-cert filename] [-CApath directory] [-CAfilefilename]

å…¶ä¸­-cert filenameåº”è¯¥æ˜¯clientçš„è¯ä¹¦ï¼Œè¿™ä¸ªä¸ç”¨å†™ï¼Œä¸€èˆ¬serverä¹Ÿä¸ä¼šéªŒè¯clientè¯ä¹¦ã€‚

![image-20231013135124415](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135124415.png)![image-20231013134840428](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013134840428.png)![image-20231013135207956](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135207956.png)![image-20231013135301423](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135301423.png)

ä¸Šå›¾æ˜¯æ‹¼æ¥å‡ºæ¥çš„å“¦ï¼Œæ— ç¼è¡”æ¥ï¼Œä¸€å­—ä¸æ‹‰ï¼Œç‰›é€¼ä¸~

å¦‚æœä¸å¸¦caæ ¹è¯ä¹¦  -CApath . -CAfile cacert.pem   å°±ä¼šerrorçš„å“¦ æ²¡æœ‰ä¸Šå›¾çš„ç»¿è‰²okäº†ï¼Œé¡ºå¸¦ä¸€æç»¿è‰²æ˜¯MobaXtermè‡ªå¸¦çš„ç€è‰²ã€‚

![image-20231013135938820](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135938820.png)

![image-20231013135609525](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135609525.png)

![image-20231013135622839](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135622839.png)

![image-20231013135633718](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013135633718.png)

ä»¥ä¸Šå°±æ˜¯åŸæ¥ç»¿è‰²okå¤„çš„å¯¹åº”æˆªå›¾ï¼Œç°åœ¨éƒ½æ˜¯errorå’Œ Verify return code 19æŠ¥é”™äº†ï¼ŒåŸæ¥æ˜¯Verify return code code 0 okã€‚





### curléªŒè¯https

![image-20231013133934784](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013133934784.png)

#### curl å¸¦ä¸Šæ ¹è¯ä¹¦è¿›è¡Œè®¿é—®httpsç½‘é¡µ

![image-20231013134451655](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013134451655.png)





# ç†è§£ä¸‹ç›®å‰å®éªŒé¡µé¢æ˜¾ç¤ºçŠ¶å†µ

ä¸ºä»€ä¹ˆhttps://www.a.comå’Œhttp://www.a.comå†…å®¹ä¸€æ ·

![image-20231013141817589](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141817589.png)



![image-20231013141742125](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141742125.png)



â‘ é¦–å…ˆæŒ‰https://www.a.comèµ°çš„æ˜¯/etc/httpd/conf.d/ssl.confé‡Œçš„è™šæ‹Ÿä¸»æœº

![image-20231013140833841](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013140833841.png)

è€Œæ­¤å¤„æ²¡æœ‰å®šå½±DocumentRootçš„è·¯å¾„ï¼Œ,æ‰€ä»¥å»çœ‹ä¹‹å‰æˆ‘ä»¬å®šä¹‰çš„/etc/httpd/conf.d/test.confï¼Œè¦å®šä¹‰DocumentRootï¼Œè‡ªç„¶/etc/httpd/conf/httpd.confä¸‹çš„DocumentRootè¦æ³¨é‡Šæ‰çš„

![image-20231013141106103](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141106103.png)

å…¶å®æˆ‘æ„Ÿè§‰è§„èŒƒçš„åšæ³•å°±æ˜¯è™šæ‹Ÿä¸»æœºä¹Ÿé…ç½®ä¸€éè‡ªå·±çš„ï¼Œä¸ç®¡æ˜¯å¦åˆ©ç”¨é»˜è®¤çš„ï¼Œéƒ½é…ä¸€è¾¹æ–¹ä¾¿ç»´æŠ¤ã€‚

![image-20231013141144772](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141144772.png)

![image-20231013141223198](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141223198.png)

ç„¶åâ‘¡çœ‹ä¸‹http://www.a.comèµ°çš„æ˜¯/etc/httpd/conf.d/test.confé‡Œçš„è™šæ‹Ÿä¸»æœº

![image-20231013141351417](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141351417.png)

æµè§ˆå™¨é‡Œè¾“å…¥çš„æ˜¯http://www.a.comï¼Œæ‰€ä»¥å…ˆçœ‹80ï¼Œå†çœ‹headé‡Œçš„hostæ˜¯www.a.comæ‰€ä»¥èµ°çš„æ˜¯/data/www/asiteä¸‹çš„xx.txtï¼Œå¦‚æœæ²¡æœ‰xx.txtå°±æ˜¯index.htmläº†

![image-20231013141505537](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013141505537.png)

æ‰€ä»¥ç»“åˆâ‘ å’Œâ‘¡ï¼Œhttpså’Œhttpéƒ½æ˜¯ä¸€ä¸ªé¡µé¢å•¦



æœ‰äººè¯´ï¼šhttpsä¸èƒ½è¯´é…ç½®å¤šä¸ª"åŸºäºä¸»æœºå¤´çš„-è™šæ‹Ÿä¸»æœº"ã€‚æˆ‘æŒ‰ä»–çš„æ€è·¯ç†è§£æ˜¯å› ä¸ºhttpsåŠ å¯†èŒƒå›´æ˜¯åŒ…å«äº†headå­—æ®µçš„ï¼Œè™šæ‹Ÿä¸»æœºå¤„ç†çš„æ—¶å€™å†sslå¸è½½ä¹‹å‰äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘çŒœçš„ï¼Œå°´å°¬çš„ç‚¹åœ¨äºserverå…·å¤‡å¸è½½sslè¯ä¹¦çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥çœ‹åˆ°ä¸»æœºå¤´ï¼Œä¸ºä»€ä¹ˆä¸èƒ½é’ˆå¯¹å¤šä¸ªhttpsç«™ç‚¹ç”¨åŸºäºheadé‡Œçš„hostæ¥å®ç°è·¯ç”±å‘¢ã€‚é™¤é

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013150527770.png" alt="image-20231013150527770" style="zoom:37%;" />

åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šå®éªŒ

![image-20231013143806986](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013143806986.png)

ä¸ºäº†ä¾¿äºå¯¹æ¯”ï¼Œå°†åŸæ¥çš„https://www.a.comçš„é¡µé¢æ”¹æˆindex.htmlä¸å†ä½¿ç”¨m.txt

![image-20231013144012207](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013144012207.png)

![image-20231013144321180](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013144321180.png)



![image-20231013144351822](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013144351822.png)

è¿™ä¸æ˜¯å¥½å¥½çš„å˜›

![image-20231013144543681](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013144543681.png)



![image-20231013145509556](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145509556.png)



www.b.comå¤åˆ¶çš„www.a.comè™šæ‹Ÿä¸»æœºçš„é…ç½®ï¼Œè¯ä¹¦è¦æ”¹ï¼Œå¦åˆ™ subject alternative nameé‡Œçš„æ²¡æœ‰www.b.comç½‘ç«™åœ°å€ï¼Œä¸èƒ½è®¤ä¸ºå®‰å…¨çš„ğŸ‘‡

![image-20231013145459011](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145459011.png)





åªä¸è¿‡www.b.comæ²¡æœ‰é¢å‘è¯ä¹¦è€Œå·²ã€‚æä¸€ä¸ª

â‘ ç”Ÿæˆcsræ–‡ä»¶

![image-20231013144817447](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013144817447.png)



â‘¡caé¢å‘ä¸€ä¸‹

![image-20231013144917189](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013144917189.png)

å‘ç°æ²¡æœ‰Subject Alternative Nameï¼Œæ‰€ä»¥è¦å»/etc/pki/tls/openssl.confä¸‹å»é…ç½®ä¸€ä¸‹

![image-20231013145023975](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145023975.png)

ç„¶åå°±æœ‰äº†

![image-20231013145119315](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145119315.png)

å›åˆ°serverä¸Šé…ç½®å¥½www.b.comçš„è¯ä¹¦æ–‡ä»¶çš„åŠ è½½ï¼ŒåŒæ ·å’Œwww.a.comçš„ä¸€æ ·ï¼Œåœ¨è™šæ‹Ÿä¸»æœºé‡Œé…ç½®ï¼Œåœ¨/etc/httpd/conf.d/ssl.confé‡Œé…ç½®



![image-20231013145641249](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145641249.png)

åªéœ€è¦æ”¹ä¸€è¡ŒğŸ‘†





PCä¸Šè¡¥ä¸€ä¸ªhostsè®°å½•

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145312768.png" alt="image-20231013145312768" style="zoom:33%;" />

![image-20231013145356152](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145356152.png)



ç„¶åå°±å¥½äº†å•Š

![image-20231013145746384](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145746384.png)

![image-20231013145803638](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013145803638.png)



æ‰€ä»¥é€šè¿‡å®éªŒä¸æ˜¯å‘ç°äº†httpsçš„å¤šç«™ç‚¹ï¼Œå¯ä»¥åŸºäºheadä¸»æœºå¤´hostå­—æ®µè¿›è¡Œé…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºå•Šã€‚

![image-20231013150141363](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013150141363.png)

æˆ‘å°±è§‰çš„serverè‡ªå·±æœ‰èƒ½åŠ›å¸è½½sslè¯ä¹¦-è§£å¯†ï¼Œè€Œä¸”å¸è½½çš„è¯ä¹¦å’Œservernameéƒ½åœ¨ä¸€èµ·é…ç½®çš„ğŸ‘†ï¼Œä¸ºå•¥ä¸èƒ½åŸºäºä¸»æœºå¤´è¿›è¡Œhttpsçš„å¤šè™šæ‹Ÿä¸»æœºé…ç½®å‘¢ï¼Œå¯¹å§ã€‚å®éªŒè¯æ˜å°±æ˜¯å¯ä»¥çš„ã€‚





# ä¸‹é¢å®ç°httpè·³è½¬https



### é¦–å…ˆçŸ¥é“ä¸€ä¸ªchromeçš„é»˜è®¤è¡Œä¸ºï¼Œ

chromeæµè§ˆå™¨ä¼šè‡ªåŠ¨ç»™ä½ è¡¥ä¸Šhttpsçš„ï¼Œæ¯”å¦‚

ä½¿ç”¨è”æƒ³æµè§ˆå™¨è¾“å…¥a.com

![image-20231013153048316](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153048316.png)



ä½¿ç”¨chromeè¾“å…¥a.comï¼Œ**åªæœ‰chromeä¼šå¹²è¿™äº‹ï¼Œå…¶ä»–æµè§ˆå™¨ä¸ä¼šè¯´ è¾“å…¥xx.xx.comè‡ªåŠ¨ç”¨https://**

![image-20231013153149256](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153149256.png)



ä½¿ç”¨ç«ç‹ï¼Œç»“æœå‘ç°ç«ç‹çš„è¯ä¹¦å¥½åƒè¯†åˆ«å¯èƒ½ä¸æ˜¯OSçš„

![image-20231013153223645](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153223645.png)

![image-20231013153519526](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153519526.png)



![image-20231013153546678](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153546678.png)



![image-20231013153608605](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153608605.png)



![image-20231013153715450](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153715450.png)



![image-20231013153744323](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153744323.png)



è¿™æ ·å°±åŠ è½½è¿›å»äº†ï¼Œç«ç‹æœç„¶ä¸æ˜¯ç”¨çš„OSçš„å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ã€‚

ç„¶åç«ç‹æµè§ˆå™¨å°±ä¸å†æŠ¥ä¸å®‰å…¨äº†

![image-20231013153811813](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013153811813.png)

ç„¶åç«ç‹çš„è¡Œä¸º

![image-20231013154119324](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013154119324.png)



![image-20231013154035221](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013154035221.png)



è¾“å…¥https://www.a.comæˆ–https://www.a.com/éƒ½ä¸€æ ·ã€‚

![image-20231013154235922](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013154235922.png)



## ç„¶åæ­£å„¿å…«ç»å¼€å§‹åšserverçš„httpé‡å®šå‘åˆ°https

åŒºåˆ«ä¸Šé¢è¯´çš„Clientçš„chromeçš„é»˜è®¤httpsè¡Œä¸ºï¼Œé˜²æ­¢è¯¯åˆ¤

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013154806030.png" alt="image-20231013154806030" style="zoom:33%;" />

ä¸¤ç§é‡å®šå‘ï¼š301å’Œ302ğŸ‘†ï¼Œé€šè¿‡è¯­å¥é‡Œçš„[status]åŒºåˆ«é…ç½®

![image-20231013155242899](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013155242899.png)

Locationï¼šhttp://www.jd.comå°±æ˜¯301é‡å®šå‘è¿‡å»çš„ç½‘å€ã€‚



![image-20231013155437720](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013155437720.png)



![image-20231013161503514](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013161503514.png)

![image-20231013161622695](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013161622695.png)

æ´»ä¹…è§httpè·³httpï¼Œæµè§ˆå™¨é”™è¯¯æ˜¾ç¤ºäº†å§





![image-20231013162032302](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013162032302.png)



![image-20231013162205195](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013162205195.png)

![image-20231013162221864](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013162221864.png)



jdå°±æ˜¯ä¸¤æ¬¡è·³è½¬ï¼Œä¸€æ¬¡301 ä»http://www.360buy.com/è·³åˆ°http://www.jd.comï¼Œä¸€æ¬¡302ä»http://www.jd.comè·³åˆ°https://www.jd.com;  ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡æ˜¯ ä¸åŒç½‘ç«™çš„httpè·³è½¬-301ï¼›ç¬¬äºŒæ¬¡æ˜¯ç›¸åŒç«™ç‚¹çš„httpè·³httpsã€‚



![image-20231013160105742](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013160105742.png)



<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013160350314.png" alt="image-20231013160350314" style="zoom:50%;" />





<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013160645510.png" alt="image-20231013160645510" style="zoom:33%;" />

å¥½åƒåå°è‡ªåŠ¨ç»™ä½ è½¬ï¼Œå°±æ˜¯ä¸€æ¬¡è¯·æ±‚å°±è¡Œäº†ï¼Œå¥½åƒä¹Ÿæ˜¯æœ‰æ­¤ç±»æŠ€æœ¯çš„ã€‚



## å®éªŒ

è®¿é—®www.a.comè·³è½¬åˆ°www.b.com



![image-20231013161339019](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013161339019.png)

å°†ä¸Šé¢çš„è®¿é—®éƒ½è·³è½¬åˆ°https://www.b.com



![image-20231013163606039](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013163606039.png)



å†æŠŠhttps://www.a.comä¹Ÿé‡å®šå‘äº†

![image-20231013163906812](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013163906812.png)



![image-20231013164004810](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013164004810.png)



è¿™æ ·å°±å®ç°äº†http://www.a.comè·³http://www.b.com;https://www.a.comè·³https://www/b.com

![image-20231013164228767](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013164228767.png)



è¿™æ ·å°±å®ç°äº†http://www.a.comè·³https://www.b.com

![image-20231013164642621](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013164642621.png)

![image-20231013164707496](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013164707496.png)



curl -L çš„è¯´æ˜ï¼Œcurlé»˜è®¤è¡Œä¸ºå°±æ˜¯åªå‘ä¸€æ¬¡è¯·æ±‚ï¼Œ-Lå°±ä¼šfollow redirectsï¼Œå°±æ˜¯ä¼šè·Ÿéšé‡å®šå‘ä»¬ï¼Œå¤šæ¬¡ä¹Ÿæ²¡é—®é¢˜

![image-20231013164939957](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013164939957.png)



![image-20231013170307585](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013170307585.png)



![image-20231013171330534](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013171330534.png)

![image-20231013171427080](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013171427080.png)

å¦‚æœä½ å†åœ¨ä¸Šå›¾ä¸Šåœ°å€æ é‡Œæ•²ä¸€ä¸‹å›è½¦ï¼Œç”±äºæ˜¯chromeå°±ä¼šå¯¼è‡´ä½ è®¿é—®çš„å…¶å®ä¸å†æ˜¯http://www.b.comè€ŒTMDçš„æ˜¯https://www.b.comäº†ç„¶åå°±ä¼šèµ°åˆ«çš„è™šæ‹Ÿä¸»æœºäº†ï¼Œé‡å®šå‘çš„é…ç½®å°±ä¸ç”Ÿæ•ˆäº†ï¼Œæˆ–è€…åˆ«çš„åœ°æ–¹çš„é‡æ–°å‘äº†ï¼Œæˆ‘çš„é…ç½®å¦‚ä¸‹

![image-20231013171747153](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013171747153.png)

![image-20231013171818629](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231013171818629.png)

å¥½çƒ¦å‘ï¼Œç¿»æ¥è¦†å»çš„ï¼Œ(ï¿£â–½ï¿£)"ï¼Œåæ­£è¿™é‡Œè®°ä½ï¼Œå¤„ç†æ€è·¯å°±æ˜¯ç±»ä¼¼ç½‘ç»œè½¬å‘ï¼šPHBï¼Œper-hop-behaviorï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸€æ ·ä¸€è·³ä¸€è·³çš„è·¯ç”±è½¬å‘æŸ¥è¯¢å°±è¡Œäº†ã€‚





![image-20231016101757370](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016101757370.png)

æ·˜å®ç”¨çš„301æ°¸ä¹…é‡å®šå‘ï¼Œå…¶ä»–å¤§å¤šæ•°ç”¨çš„æ˜¯302ä¸´æ—¶é‡å®šå‘ã€‚

ç„¶åå°±æ˜¯æœç´¢å¼•æ“æ¯”å¦‚ç™¾åº¦ï¼Œå°±ä¸ä¼šæŠ“å–301é‡å®šå‘å‰çš„åœ°å€é¡µé¢äº†ï¼Œ302çš„è·³è½¬å‰é¡µé¢è¿˜ä¼šæŠ“çš„ã€‚å› ä¸º301æ°¸ä¹…é‡å®šå‘è¢«è¢«è®¤ä¸ºæ˜¯åºŸå¼ƒçš„åœ°å€äº†ä¸ç”¨äº†ï¼Œä¹Ÿå°±ä¸ä¼šå»è¿™ä¸ªé¡µé¢æŠ“å–å†…å®¹äº†ã€‚



# ä¸åšè™šæ‹Ÿä¸»æœºè¿›è¡Œsslè·³è½¬

æ¢å¤å®éªŒç¯å¢ƒâ‘ ç§»é™¤/etc/httpd/conf.d/test.confâ‘¡æ¢å¤/etc/httpd/conf.d/ssl.confé‡Œçš„é…ç½®ï¼Œè¯ä¹¦ç›¸å…³ä¿ç•™â‘¢æ¢å¤/etc/httpd/conf/httpd.confé‡Œçš„é…ç½®

![image-20231016105055797](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016105055797.png)

![image-20231016105109637](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016105109637.png)

ä¿®æ”¹å¦‚ä¸‹ğŸ‘‡ç›´æ¥åœ¨ä¸»é…ç½®æ–‡ä»¶é‡Œè¡¥ä¸Šé‡å®šå‘çš„é…ç½®å°±è¡Œredirect temp / https://www.a.com

![image-20231016105646725](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016105646725.png)



![image-20231016110029244](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016110029244.png)

æœ€å¤šè·³è½¬50æ¬¡

![image-20231016110444897](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016110444897.png)

äº§ç”Ÿè¿™æ ·çš„è·³è½¬çš„åŸå› ä¸å¤ªæ¸…æ¥šï¼Œè§£å†³æ–¹æ³•æ˜¯æ¢ä¸€ç§é…ç½®æ–¹å¼

```shell
RewriteEngine on
RewriteRule ^(/.*)$ https://%{HTTP_HOSTS}$1 [redirect=302]
```

![image-20231016111619372](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016111619372.png)

é‡å¯æœåŠ¡åç”Ÿæ•ˆ

![image-20231016111653439](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016111653439.png)



# HSTSï¼š

## â‘ HSTS:HTTP Strict Transport Security



è§£å†³å¦‚ä¸‹é—®é¢˜ï¼š

![image-20231016113158169](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016113158169.png)

é™¤éç¬¬ä¸€æ¬¡å°±ç»™ä½ åŠ«æŒäº†ï¼Œå¦åˆ™è¿˜æ˜¯æ¯”è¾ƒå®‰å…¨çš„ï¼Œé çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜è¢«æ¸…ç©ºæˆ–è€…åˆ°æœŸæˆ–ç¼“å­˜æ—¶é—´è®¾ç½®è¾ƒçŸ­ï¼Œè¿˜æ˜¯å­˜åœ¨å®‰å…¨é£é™©çš„å…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š



![image-20231016114024622](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016114024622.png)



HSTS -- HTTP Strict Transport Security ä½¿ç”¨è¯¥æŠ€æœ¯çš„æ¡ˆä¾‹ğŸ‘‡ã€‚å…¶ä»–ç½‘å€çœ‹äº†ä¸‹ï¼Œç”¨çš„ä¸å¤šã€‚

![image-20231016114737887](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016114737887.png)

è€åŒ–æ—¶é—´æ˜¯1å°æ—¶ï¼Œä¹Ÿå°±æ˜¯é‡å®šå‘ç¼“å­˜1å°æ—¶



## â‘¡HTST preload list



æ˜¯Chromeæµè§ˆå™¨ä¸­çš„HSTSé¢„è½½å…¥åˆ—è¡¨ï¼Œåœ¨è¯¥åˆ—è¡¨ä¸­çš„ç½‘ç«™ï¼Œä½¿ç”¨Chromeæµ è§ˆå™¨è®¿é—®æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢æˆHTTPSã€‚Firefoxã€Safariã€Edgeæµè§ˆå™¨ä¹Ÿä¼šé‡‡ç”¨è¿™ä¸ªåˆ—è¡¨



è¿™é‡Œå’Œchromeæµè§ˆå™¨è‡ªåŠ¨ç»™ä½ è¡¥Httpsçš„è¡Œä¸ºè¿˜ä¸æ˜¯ä¸€å›äº‹ã€‚

**â‘ chromeä½ è¾“å…¥www.baidu.comä¼šè‡ªåŠ¨ç»™ä½ è¡¥https://çš„**

![image-20231016120045397](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016120045397.png)



![image-20231016120206079](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016120206079.png)



æ³¨æ„è¿™é‡Œä¸å­˜åœ¨é‡å®šå‘çš„ï¼Œè¦è¾“å…¥http://www.baidu.comæ‰ä¼šæœ‰302å‡ºç°

å½“ç„¶curl ä¹Ÿä¸ä¼šè§¦å‘302ï¼Œæœ‰ç‚¹å¥‡æ€ªï¼Œ

![image-20231016120329760](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016120329760.png)



**â‘¡chromeé‡Œçš„hstsåˆ—è¡¨ï¼Œè¿™æ˜¯preloadé¢„åŠ è½½çš„ï¼Œ**ä½ è¾“å…¥http://www.bing.comå†…éƒ¨å°±ç»™ä½ è½¬æˆhttps://www.bing.com

![image-20231016120415272](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016120415272.png)

ä½¿ç”¨æ— ç—•å•å¼€æ¨¡å¼è¾“å…¥http://bing.comï¼Œä¸è¦åŠ wwwå“¦ï¼Œå› ä¸ºä¸Šå›¾çš„foundæ¸…å•é‡Œå¹¶æ²¡æœ‰www.bing.comåªæœ‰bing.com

ç„¶åé€šè¿‡F12æŸ¥çœ‹æ˜¯ä¸æ˜¯ç›´æ¥å°±æ˜¯httpså‡ºå»äº†

![image-20231016133553512](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016133553512.png)



**â‘¢å°±æ˜¯å„ç§é‡å®šå‘äº†ï¼Œ301ã€302ã€307ä¹‹ç±»çš„**

ä½†æ˜¯åŠ ä¸Šwwwï¼Œç”±äºä¸åœ¨chromeæµè§ˆå™¨çš„hstsæ¸…å•é‡Œæ‰€ä»¥è¿˜æ˜¯èµ°çš„æœåŠ¡çš„é‡å®šå‘ä¸è¿‡è¿™é‡Œæ˜¯307

å½“æˆ‘åœ¨æ— ç—•é‡Œè¾“å…¥http://www.bing.comçš„æ—¶å€™ï¼Œé€šè¿‡F12çœ‹åˆ°çš„æ˜¯307ï¼Œå†…éƒ¨é‡å®šå‘ã€‚

![image-20231016120600435](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016120600435.png)





![image-20231016134221349](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016134221349.png)

![image-20231016134443449](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016134443449.png)

æŠŠå­—ç¬¦é›†æ”¹ä¸€ä¸‹

![image-20231016134752275](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016134752275.png)

æ²¡æ”¹è¿‡æ¥ï¼

å¥½åƒæ˜¯å¼€å¯é‡å®šå‘å°±ä¼šè¿™æ ·ï¼Œä¸‹å›¾ğŸ‘‡æ˜¯ä¸ç”¨è™šæ‹Ÿä¸»æœºæ–¹å¼çš„å†™æ³•ï¼Œä¼šé€ æˆå¾ªç¯é‡å®šå‘ï¼Œè¿™é‡Œä»…ä»…æµ‹è¯•é‡å®šå‘å¯¹å­—ç¬¦é›†çš„å½±å“ã€‚

![image-20231016135222140](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016135222140.png)



é‡å®šå‘éƒ½å…³äº†å°±å¥½äº†

![image-20231016135252366](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016135252366.png)

è¿™äº›cilè¿›ä¸€æ­¥ç ”ç©¶å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ‰‹å†Œhttps://httpd.apache.org/docs/2.4/mod/mod_rewrite.html#rewriterule



# æ­£å‘ä»£ç†å’Œåå‘ä»£ç†



![image-20231016140751549](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016140751549.png)

å›¾ç‰‡ä¸å¤šè¯´äº†ï¼Œè¡¥å……è¦ç»™ä¸€èˆ¬æ­£å‘ä»£ç†å¾€å¾€ä¼šåŠ ä¸€ä¸ªç¼“å­˜åŠŸèƒ½ï¼Œå°±æ˜¯å‡ºå£ä»£ç†ç¼“å­˜æœåŠ¡å™¨ï¼Œæ¯”å¦‚åŸåŸŸç½‘å‡ºå£æƒ³å¿…æ˜¯æœ‰ç¼“å­˜çš„ã€‚æ¯”å¦‚å†…éƒ¨çš„Nexusç§ç½‘åŸç«™(pipæºã€yumæºã€npmæºã€dockeræº)ï¼Œç„¶åclientéƒ½å°†æºæŒ‡å‘nexusä»£ç†æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„åŸºäºå„ç§æºçš„è½¯ä»¶å®‰è£…éƒ½ä¼šä»nexusä»£ç†èµ°ï¼Œç„¶åå‡¡æ˜¯ä»nexusä¸‹è½½è¿‡çš„è½¯ä»¶éƒ½ä¼šåœ¨nexusæœ¬åœ°ç¼“å­˜èµ·æ¥ï¼Œè¿™æ ·ï¼Œä¸‹ä¸€æ¬¡å…¶ä»–äººé€šè¿‡è¯¥ä»£ç†ä¸‹è½½å°±ä¼šä¸ç”¨å†å»äº’è”ç½‘è¯·è¯·æ±‚äº†ã€‚



åŒæ ·ç†è®ºä¸Šä¹Ÿæ˜¯å¯ä»¥åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šåšaclï¼Œé’ˆå¯¹æŸä¸ªç”¨æˆ·æ‹’ç»ä»£ç†æœåŠ¡ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚



åå‘ä»£ç†æœåŠ¡å™¨ï¼Œé€šå¸¸å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ æœåŠ¡ä¸å¥½ Nå¤šä¸ªç”¨æˆ·äº†ï¼Œæ‰éœ€è¦å¤šä¸ªæœåŠ¡å™¨åˆ†æ‹…ã€‚æ‰€è°“æœåŠ¡ä¸å¥½ä¸»è¦æŒ‡ç”¨æˆ·é‡å¤§äº†ï¼Œæˆ–è€…ç”¨æˆ·åœ°ç†ä½ç½®åˆ†æ•£-æœåŠ¡å™¨éœ€è¦æœ‰å°±è¿‘æœåŠ¡éœ€æ±‚ã€‚   ç±»ä¼¼myslqè¯»å†™åˆ†ç¦»çš„è°ƒåº¦å™¨



æ­£å‘ä»£ç†ï¼ŒåŠ é€Ÿã€ç¼“å­˜

åå‘ä»£ç†ï¼Œå‡è¡¡ã€è°ƒåº¦

æ­£åéƒ½æ˜¯æ¬ºéª—ç”¨æˆ·ï¼Œæ¬ºéª—ä¸å¤ªå¥½ï¼Œç”¨æˆ·ä¹ŸçŸ¥é“æœ‰è¿™äº›ä¸œè¥¿ï¼Œæˆ–è€…å«éƒ½æ˜¯ä»£ç†äº†serveræœåŠ¡æ¥ç€ã€‚



**æ­£å‘ä»£ç†è½¯ä»¶ï¼Œsquidè€ç‰Œæ­£å‘ä»£ç†è½¯ä»¶ï¼Œweb cacheå’¯**http://www.squid-cache.org/æœ‰éœ€è¦å†ç ”ç©¶å§

åå‘ä»£ç†å¦‚é‚£ä»¶ï¼Œnginxè¾ƒå¤šï¼Œapacheæœ‰ä½†æ˜¯ç”¨çš„å¾ˆå°‘ï¼Œè¿˜æœ‰LVSã€è¿˜æœ‰F5ã€HAproxyã€‚





## å®éªŒ-apacheçš„åå‘ä»£ç†





ä¸€èˆ¬ä¼šå°†èƒŒåçœŸæ­£çš„æä¾›æœåŠ¡çš„æœåŠ¡å™¨å«åšreal serverğŸ‘‡

![image-20231016143736459](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016143736459.png)



å†è®¾ç½®ä¸€ä¸‹åå‘ä»£ç†æœåŠ¡å™¨

### apacheçš„åå‘ä»£ç†-å¸¸è§„

```shell
ProxyPass "/" "http://192.168.126.130/"      #  clientè®¿é—® æˆ‘"/" è½¬æˆ èº«å realServer 130
ProxyPassReverse "/" "http://192.168.126.130/"   # èº«årealServerå›åŒ…æˆ‘ï¼Œå°†130è½¬æˆæˆ‘è‡ªå·±"/"
```

ğŸ‘†å°±æ˜¯ä¸­é—´ä»£ç†ï¼Œä¸¤å¤´æ¬ºéª—ï¼Œä¸å¥½æ„æ€æˆ‘åˆç”¨äº†æ¬ºéª—ä¸€è¯ã€‚å› ä¸ºæˆ‘æ‰¾ä¸åˆ°æ›´ç®€å•è¯ç”¨æ¥æ›¿ä»£äº†ã€‚æ‰¿æ¥ï¼Ÿä¹Ÿä¸æ˜æ˜¾ã€‚ç”¨çš„å¥½å°±æ˜¯é€æ˜ä»£ç†ï¼Œæ¶æ„çš„å°±æ˜¯æ¬ºéª—äº†å§ã€‚

![image-20231016150916149](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016150916149.png)

è®°å¾—é‡å¯131çš„httpdæœåŠ¡



ç„¶åå°±å¯ä»¥æµ‹è¯•äº†ï¼Œæµ‹è¯•ä¹‹å‰æ‰“å¼€realserverå’Œproxyçš„log

clientä¸Šä¸çŸ¥é“çœŸæ­£çš„æœåŠ¡å™¨sğŸ‘‡ï¼šè®¿é—®çš„æ˜¯proxySer

![image-20231016151151661](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016151151661.png)

proxyserä¸ŠçŸ¥é“çœŸæ­£çš„cå’ŒsğŸ‘‡ï¼šçœ‹åˆ°çš„æ˜¯çœŸæ­£çš„client IP

![image-20231016151205264](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016151205264.png)

realSerä¸Šä¸çŸ¥é“çœŸæ­£çš„cğŸ‘‡ï¼šçœ‹åˆ°çš„æ˜¯proxyè®¿é—®è¿‡æ¥çš„

![image-20231016151223918](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016151223918.png)



### apacheçš„åå‘ä»£ç†-ç‰¹å®šURL

```
ProxyPass "/images"	"http://www.example.com/"
ProxyPassReverse "/images"	http://www.example.com/
```

æ‰¾ä¸ªimageæµ‹è¯•

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016152134433.png" alt="image-20231016152134433" style="zoom:50%;" />



![image-20231016152240126](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016152240126.png)





ä¿®æ”¹proxySerçš„é…ç½®ï¼Œåªé’ˆå¯¹ç‰¹å®šurlè¿›è¡Œè½¬å‘è¿‡å»

![image-20231016152737052](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016152737052.png)



æµ‹è¯•ï¼Œä¸€èˆ¬ä¸è½¬å‘ok

![image-20231016153732442](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016153732442.png)



æµ‹è¯•ï¼Œç‰¹æ®Šurlè½¬å‘ok

![image-20231016153750701](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016153750701.png)

æµ‹è¯•ï¼Œç‰¹æ®Šurlè½¬å‘ok

![image-20231016153803544](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016153803544.png)



### apacheçš„åå‘ä»£ç†-è™šæ‹Ÿä¸»æœºå¤„é…ç½®

è¿™ä¸ªå°±æœ‰ç‚¹åƒnginxäº†å“¦ï¼Œå‘µå‘µï¼ŒåŸºäºä¸»æœºå¤´çš„è´Ÿè½½å‡è¡¡ï¼Œåç«¯ç”¨ç«¯å£åŒºåˆ†ï¼Œä¹Ÿå¯ä»¥ç”¨nodesçš„ipåŒºåˆ†ï¼Œè²Œä¼¼å¯è¡Œã€‚

```
<VirtualHost *>
ServerName www.magedu.com  
ProxyPass / http://localhost:8080/  
ProxyPassReverse / http://localhost:8080/
</VirtualHost>

```

æµ…æµ‹ä¸€ä¸‹

![image-20231016154557362](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016154557362.png)



é…ç½®proxySer

![image-20231016155050333](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016155050333.png)





ä¿®æ”¹windowsè¿™ä¸ªclientä¸Šçš„hosts è§£æåˆ°proxySerä¸Š

![image-20231016154835182](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016154835182.png)



æµ‹è¯•è´Ÿè½½å‡è¡¡

![image-20231016155112669](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016155112669.png)

è¿˜ä¸é”™å•Šï¼Œè²Œä¼¼ç”¨apacheä¸€æ ·åšåå‘ä»£ç†ï¼Œä¸è¿‡nginxç”¨çš„æ¯”è¾ƒå¤šï¼Œapacheç”¨çš„å°‘ï¼Œæ‰€ä»¥å°±æ˜¯é‚£å®¶é¥­åº—åƒé¥­äººå¤šå»å“ªå®¶å°±æ˜¯è¿™ä¸ªæœ´å®æ— åçš„é“ç†ã€‚





# Sendfileæœºåˆ¶-å±äºé›¶å¤åˆ¶æŠ€æœ¯é‡Œçš„ä¸€ç§

å…ˆå¤ä¹ 

![image-20231016163224856](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016163224856.png)



ä¸€ç›´çœ‹åˆ°

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016172825931.png" alt="image-20231016172825931" style="zoom:50%;" />

ç„¶åä¸Šå›¾ğŸ‘†ç»“åˆä¸‹å›¾ç†è§£ä¸€éğŸ‘‡

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016172807156.png" alt="image-20231016172807156" style="zoom:50%;" />



4æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„äº¤äº’å¦‚å›¾ğŸ‘‡

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016174113530.png" alt="image-20231016174113530" style="zoom:33%;" />

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016174302592.png" alt="image-20231016174302592" style="zoom:33%;" />



å›¾ä¸­çš„â‘£æœªæ ‡æ³¨ï¼Œå›¾ä¸­çš„socket bufferåˆ°httpdï¼Œæ˜¯å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œä½†æ˜¯åº”è¯¥ä¸æ˜¯â‘¢çš„write()è¿”å›ã€‚

ç®€å•ç†è§£å°±æ˜¯ç¡®å®å­˜åœ¨4æ¬¡å·¦å³çš„ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„äº¤äº’ã€‚è¿™æ ·å°±å‘ç°æ•°æ®çš„ä¼ é€’å­˜åœ¨ä¸å¿…è¦çš„å¤„ç†è¿‡ç¨‹--æ•°æ®æœ¬æ¥å°±åœ¨å†…æ ¸æ€é‡Œéè¦ä»ç”¨æˆ·æ€ç»•ä¸€åœˆæ²¡å¿…è¦ï¼Œäºæ˜¯sendfileå°±æ¥äº†ã€‚

![image-20231016174831476](8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016174831476.png)

ç®€å•æ¥è®²å°±æ˜¯ğŸ‘‡ä¸‹å›¾çš„ç»¿è‰²ç®­å¤´ï¼Œä¸è¿‡socketbufferå¥½ç†è§£ï¼Œåè®®æ ˆéš¾ä¸æˆç®—åˆ°æ¥å£çš„é˜Ÿåˆ—ç¼“å­˜é‡Œçš„ï¼Ÿ

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016175054302.png" alt="image-20231016175054302" style="zoom:33%;" />



apacheé»˜è®¤å°±å¯ç”¨äº†è¯¥ğŸ‘†sendfileræœºåˆ¶ã€‚

è¯¥æŠ€æœ¯ä¸ä»…ä»…å±äºapacheï¼Œnginxé‡Œä¹Ÿæœ‰ã€‚



sendfileræŠ€æœ¯åˆå**é›¶å¤åˆ¶**ï¼Œå…¶æ„æ€å°±æ˜¯æ²¡æœ‰å°†æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ã€‚

å…·ä½“é›¶å¤åˆ¶ï¼Œè¿˜æ¶‰åŠä¸€äº›åˆ«çš„æŠ€æœ¯ã€‚

<img src="8-httpçš„å®‰å…¨åŠ å›ºå’Œé‡å®šå‘.assets/image-20231016175732158.png" alt="image-20231016175732158" style="zoom:50%;" />



