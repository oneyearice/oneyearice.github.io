# ç¬¬5èŠ‚. httpd2



# ç»§ç»­ä¸Šä¸€ç¯‡çš„é…ç½®



## ä¸»ç«™ç‚¹é¡µé¢-DocumentRoot

**å®šä¹‰'Main' serverçš„æ–‡æ¡£é¡µé¢è·¯å¾„** DocumentRoot â€œ/pathâ€

æ–‡æ¡£è·¯å¾„æ˜ å°„ï¼š

DocumentRootæŒ‡å‘çš„è·¯å¾„ä¸ºURLè·¯å¾„çš„èµ·å§‹ä½ç½® ç¤ºä¾‹ï¼š

DocumentRoot "/app/dataâ€œ

http://HOST:PORT/test/index.html --> /app/data/test/index.html æ³¨æ„ï¼šSELinuxå’Œiptablesçš„çŠ¶æ€



![image-20231007104941607](5-httpd2.assets/image-20231007104941607.png)

è¿™é‡Œä¿®æ”¹ç«™ç‚¹çš„é¡µé¢å­˜æ”¾è·¯å¾„ï¼Œè¿˜éœ€è¦ä¿è¯è¯¥è·¯å¾„çš„æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚æ³¨é‡Šæ‰ğŸ‘†ä¸Šå›¾çš„ä¸»ç«™ç‚¹é…ç½®ã€‚

![image-20231007105533835](5-httpd2.assets/image-20231007105533835.png)

ä¸‹é¢å¯¹å…¶è¿›è¡Œä¿®æ”¹ğŸ‘‡ï¼Œè¿˜æ˜¯ä½¿ç”¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œä¸å¯¹httpd.confè¿™ä¸ªä¸»æ–‡ä»¶è¿›è¡Œä¿®æ”¹

<img src="5-httpd2.assets/image-20231007105037065.png" alt="image-20231007105037065" style="zoom:50%;" /> 

![image-20231007105118589](5-httpd2.assets/image-20231007105118589.png)

æƒé™ğŸ‘†æ²¡é—®é¢˜

selinuxæ²¡é—®é¢˜ğŸ‘‡

![image-20231007105137048](5-httpd2.assets/image-20231007105137048.png)



![image-20231007105631809](5-httpd2.assets/image-20231007105631809.png)

ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œ

![image-20231007105712166](5-httpd2.assets/image-20231007105712166.png)

å¿…é¡»æ˜¯æ–‡ä»¶å¤¹ï¼Œä¸”å…¶ä¸‹æ”¾index.html

<img src="5-httpd2.assets/image-20231007105750876.png" alt="image-20231007105750876" style="zoom:33%;" /> 

é‡å¯OK



ä½†æ˜¯curl å‘ç°ä¸è¡Œ

![image-20231007105841918](5-httpd2.assets/image-20231007105841918.png)

è¿™å°±æ„å‘³ç€é¡µé¢ä¸€æ ·æ˜¯apacheçš„é»˜è®¤é¡µé¢äº†ï¼Œå› ä¸ºindex.htmlæ‰“ä¸å¼€

![image-20231007105921419](5-httpd2.assets/image-20231007105921419.png)

å¯æ˜¯å¯¹åº”çš„æ–‡ä»¶å¤¹çš„è¿›å…¥ï¼Œå’Œæ–‡ä»¶çš„å¯è¯»æƒé™éƒ½æœ‰çš„å•Šï¼Œå¥‡æ€ªäº†

ä½†æ˜¯å°±æ˜¯403 Forbiddenäº†

<img src="5-httpd2.assets/image-20231007110058968.png" alt="image-20231007110058968" style="zoom:44%;" /> 

æ‰€è°“æˆæƒä¸æ˜¯linuxç³»ç»Ÿæ–‡ä»¶çš„æˆæƒï¼Œè€Œæ˜¯httpdæœåŠ¡æœ¬èº«é…ç½®æ–‡ä»¶é‡Œè¦æ˜ç¡®æˆæƒï¼Œæ‰€ä»¥è¿˜æ˜¯é…ç½®æ–‡ä»¶é‡Œçš„é…ç½®ä¸å…¨ã€‚

<img src="5-httpd2.assets/image-20231007110435402.png" alt="image-20231007110435402" style="zoom:50%;" /> 

åŒæ ·å†™é“å•ç‹¬çš„é…ç½®æ–‡ä»¶é‡Œå»

<img src="5-httpd2.assets/image-20231007110625847.png" alt="image-20231007110625847" style="zoom:50%;" /> 

![image-20231007110654272](5-httpd2.assets/image-20231007110654272.png)

---------------è¿™æ ·å°±OKğŸ‘†äº†------------------

ç„¶åå–æ¶ˆ/dataæ–‡ä»¶å¤¹çš„æ‰€æœ‰æƒé™ï¼Œå“ˆå“ˆ

![image-20231007111300759](5-httpd2.assets/image-20231007111300759.png)

å…¶ä¸Šå›¾ä¸ç”¨é‡å¯æœåŠ¡ï¼Œå› ä¸ºä¿®æ”¹çš„osæ“ä½œç³»ç»Ÿçš„æƒé™ï¼Œè€Œä¸æ˜¯httpdæœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼ŒğŸ‘‡è¯æ˜ä¸‹ï¼š

<img src="5-httpd2.assets/image-20231007111415750.png" alt="image-20231007111415750" style="zoom:50%;" /> 

å¦‚æœæ˜¯DocumentRootä¸‹çš„å­ç›®å½•çš„indexå°±æ˜¯è¡¥ä¸€ä¸ªè·¯å¾„å°±å¥½äº†ğŸ‘‡ã€‚

![image-20231007115555925](5-httpd2.assets/image-20231007115555925.png)



#### å¦‚æœå­ç›®å½•ä¸åœ¨DocumentRootä¸‹å‘¢

1ã€<span id = 'jump1'>ç”¨è½¯è¿æ¥è¡Œä¸è¡Œï¼šğŸ‘‡å¯ä»¥çš„ï¼Œæ²¡å¾—é—®é¢˜</span>

![image-20231007115843184](5-httpd2.assets/image-20231007115843184.png)





é‚£ä¸ºä»€ä¹ˆæ–‡ä»¶é»˜è®¤å°±æ˜¯index.htmlï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹å‘¢ï¼Ÿå¯ä»¥ï¼Œåœ¨é…ç½®é‡Œé¢æ‰¾åˆ°å…³é”®è¯DirectoryIndexğŸ‘‡

### **å®šä¹‰ç«™ç‚¹ä¸»é¡µé¢**

DirectoryIndex		index.html

![image-20231007133654437](5-httpd2.assets/image-20231007133654437.png)

å¢åŠ ä¸€ä¸ª

![image-20231007133801205](5-httpd2.assets/image-20231007133801205.png)



![image-20231007134204865](5-httpd2.assets/image-20231007134204865.png)

ä¸Šå›¾ğŸ‘†å°±è¯´æ˜äº†ï¼Œé…ç½®æ–‡ä»¶çš„å†™æ³•ï¼šDirectoryIndex m.txt index.htmlæ˜¯ä¼˜å…ˆçº§ä»å·¦åˆ°å³çš„ã€‚



å¦‚æœm.txtå’Œindex.htmlæ–‡ä»¶éƒ½ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæŠ¥é”™çš„é¡µé¢403 Forbiddenåˆæ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ

![image-20231007134656311](5-httpd2.assets/image-20231007134656311.png)

<img src="5-httpd2.assets/image-20231007134714917.png" alt="image-20231007134714917" style="zoom:50%;" />



åœ¨/etc/httpd/conf.d/ä¸‹æœ‰ä¸€ä¸ªå«welcome.confçš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å°±æœ‰403å¯¹åº”çš„é¡µé¢ğŸ‘‡

![image-20231007134927879](5-httpd2.assets/image-20231007134927879.png)

è¿™é‡Œçš„/.noindex.htmlå°±æ˜¯ç›¸å¯¹äºDocumentRootä¸»é¡µæ ¹è·¯å¾„æ¥è®²çš„ã€‚

ä½†æ˜¯æ²¡æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå¢å¤§ä¿ºçš„ç‹—çœ¼ä»”ç»†çœ‹çœ‹ä¸Šå›¾ æ‰¾æ‰¾çœ‹ï¼ŒAliaså•Šï¼Œ/.noindex.htmlå…¨æ–‡é‡Œå‡ºç°äº†2æ¬¡ï¼Œè¿˜ä¸æ¸…æ¥šå˜›~(/â‰§â–½â‰¦)/

åˆ æ‰è¿™ä¸ªwelcome.confæ–‡ä»¶ï¼Œè§‚å¯Ÿé¡µé¢

<img src="5-httpd2.assets/image-20231007135731812.png" alt="image-20231007135731812" style="zoom:50%;" /> 

é‡å¯æœåŠ¡åğŸ‘‡

<img src="5-httpd2.assets/image-20231007135856543.png" alt="image-20231007135856543" style="zoom:50%;" />

![image-20231007135922545](5-httpd2.assets/image-20231007135922545.png)

æ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹

![image-20231007141003559](5-httpd2.assets/image-20231007141003559.png)



![image-20231007141102616](5-httpd2.assets/image-20231007141102616.png)

é¡µé¢ä¸€æ ·æ•ˆæœğŸ‘‡

<img src="5-httpd2.assets/image-20231007141112133.png" alt="image-20231007141112133" style="zoom:50%;" />



### ç«™ç‚¹è®¿é—®æ§åˆ¶å¸¸è§æœºåˆ¶

å¯åŸºäº**ä¸¤ç§æœºåˆ¶**æŒ‡æ˜å¯¹**å“ªäº›èµ„æº**è¿›è¡Œä½•ç§è®¿é—®æ§åˆ¶

â€‹		**ä¸¤ç§æœºåˆ¶**ï¼šå®¢æˆ·ç«¯æ¥æºåœ°å€ï¼Œç”¨æˆ·è´¦å·

â€‹		**å“ªäº›èµ„æº**ï¼šæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€URLè·¯å¾„



<span id="spam2">**æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼š**</span>

â‘ é’ˆå¯¹æ–‡ä»¶å¤¹â‘¡é’ˆå¯¹æ–‡ä»¶â‘¢å†™æ­£åˆ™åŒ¹é…

```
<Directory	â€œ/path">
...
</Directory>
<File	â€œ/path/fileâ€>
...
</File>
<FileMatch	"PATTERN">
...
</FileMatch>

```

**URLè·¯å¾„ï¼š**

```
<Location	"">
...
</Location>
<LocationMatch "">
...
</LocationMatch>

```

**ç¤ºä¾‹ï¼š**

```
<FilesMatch "\.(gif|jpe?g|png)$">       	# FilesMatchå°±æ˜¯REGEXæ­£åˆ™
<Files â€œ?at.*â€>	é€šé…ç¬¦       			  	  # åº”è¯¥æ˜¯Files å¼€å¤´å°±æ˜¯é€šé…ç¬¦
<Location /status>                			# Locationå°±æ˜¯URL
<LocationMatch "/(extra|special)/data">     # LocationMatchå°±æ˜¯urlé‡Œçš„regexæ­£åˆ™
```



## **å…·ä½“çš„å†™æ³•-å¸¦ä¸Šæº**



### æ¦‚è¿°

```
<Directory>ä¸­â€œåŸºäºæºåœ°å€â€å®ç°è®¿é—®æ§åˆ¶

(1) Optionsï¼šåè·Ÿ1ä¸ªæˆ–å¤šä¸ªä»¥ç©ºç™½å­—ç¬¦åˆ†éš”çš„é€‰é¡¹åˆ—è¡¨
	åœ¨é€‰é¡¹å‰çš„+ï¼Œ- è¡¨ç¤ºå¢åŠ æˆ–åˆ é™¤æŒ‡å®šé€‰é¡¹

å¸¸è§é€‰é¡¹ï¼š
Indexesï¼šæŒ‡æ˜çš„URLè·¯å¾„ä¸‹ä¸å­˜åœ¨ä¸å®šä¹‰çš„ä¸»é¡µé¢èµ„æºç›¸ç¬¦çš„èµ„æºæ–‡ä»¶æ—¶ï¼Œè¿”å›ç´¢å¼•åˆ—è¡¨ç»™ç”¨æˆ·
FollowSymLinksï¼šå…è®¸è®¿é—®ç¬¦å·é“¾æ¥æ–‡ä»¶æ‰€æŒ‡å‘çš„æºæ–‡ä»¶ 
Noneï¼šå…¨éƒ¨ç¦ç”¨
Allï¼š	å…¨éƒ¨å…è®¸

ç¤ºä¾‹ï¼š
<Directory /web/docs>
	Options Indexes FollowSymLinks
</Directory>
<Directory /web/docs/spec>
	Options FollowSymLinks
</Directory>


(2) AllowOverride
	ä¸è®¿é—®æ§åˆ¶ç›¸å…³çš„å“ªäº›æŒ‡ä»¤å¯ä»¥æ”¾åœ¨æŒ‡å®šç›®å½•ä¸‹çš„.htaccessï¼ˆç”±AccessFileNameæŒ‡å®šï¼‰æ–‡ä»¶ä¸­ï¼Œè¦†ç›–ä¹‹å‰çš„é…ç½®æŒ‡ä»¤
åªå¯¹<directory>è¯­å¥æœ‰æ•ˆ
	AllowOverride Allï¼š		.htaccessä¸­æ‰€æœ‰æŒ‡ä»¤éƒ½æœ‰æ•ˆ
	AllowOverride Noneï¼š	.htaccess æ–‡ä»¶æ— æ•ˆ
	AllowOverride AuthConfig .htaccess æ–‡ä»¶ä¸­ï¼Œé™¤äº†AuthConfig å…¶å®ƒæŒ‡ ä»¤éƒ½æ— æ³•ç”Ÿæ•ˆ

```

### Indexesï¼šæŒ‡æ˜çš„URLè·¯å¾„ä¸‹ä¸å­˜åœ¨ä¸å®šä¹‰çš„ä¸»é¡µé¢èµ„æºç›¸ç¬¦çš„èµ„ æºæ–‡ä»¶æ—¶ï¼Œè¿”å›ç´¢å¼•åˆ—è¡¨ç»™ç”¨æˆ·

**å°±æ˜¯è®¿é—®é¡µé¢ä¸å­˜åœ¨ï¼Œè¿”å›å½“å‰è·¯å¾„ä¸‹çš„åˆ—è¡¨ï¼Œé¡µé¢æ˜¾ç¤ºå‡ºæ¥çš„æ–‡ä»¶å¤¹å’Œæ–‡ä»¶éƒ½å¯ä»¥ç‚¹å‡»ï¼Œç±»ä¼¼yumæºç½‘ç«™çš„ç‚¹å‡»æµè§ˆä¸€æ ·**

![image-20231007143821355](5-httpd2.assets/image-20231007143821355.png)

ç„¶åé¡µé¢è®¿é—®æ˜¯é»˜è®¤çš„æŠ¥é”™é¡µé¢

![image-20231007144403825](5-httpd2.assets/image-20231007144403825.png)

åˆ æ‰è¯¥æ–‡ä»¶ä¹Ÿæ²¡ç”¨ï¼

æ‰¾æ‰¾å®˜ç½‘è¯´æ˜

![image-20231007153451751](5-httpd2.assets/image-20231007153451751.png)

è¿™ä¸ªæ¨¡å—ä¹ŸåŠ è½½äº†å•Š

![image-20231007153507904](5-httpd2.assets/image-20231007153507904.png)

æä¸æ‡‚ï¼Œç»§ç»­æŠ˜è…¾ï¼Œå‘ç°è¿˜æ˜¯welcome.confæçš„é¬¼ï¼Œè¿™æ ·å°±å¯ä»¥çœ‹åˆ°äº†ï¼Œå…¶å®å°±æ˜¯ğŸ‘‡è¿™é‡Œå¾—options -Indexesã€‚  - å‡å·å°±æ˜¯ç¦æ­¢å•Šï¼Œç¦ç”¨äº†ç›®å½•ç´¢å¼•åŠŸèƒ½ã€‚

![image-20231007162756638](5-httpd2.assets/image-20231007162756638.png)



ç„¶ådir1ä¸ç°å®ï¼Œdir2å¯ä»¥çš„ï¼Œç ”ç©¶ä¸‹dir1ä¸ºå•¥ä¸æ˜¾ç¤º

![image-20231007155411441](5-httpd2.assets/image-20231007155411441.png)

æä¸æ‡‚dir1ä¸ºå•¥ä¸æ˜¾ç¤ºäº†ï¼Œ[ä¹‹å‰å¯ä»¥çš„å•Š](#jump1)

![image-20231007155538433](5-httpd2.assets/image-20231007155538433.png)



![image-20231007161148352](5-httpd2.assets/image-20231007161148352.png)

å°±æ˜¯dir1å¥½å¥½çš„ä¸è¡Œäº†ï¼Œå“ˆå“ˆ

![image-20231007161141031](5-httpd2.assets/image-20231007161141031.png)



![image-20231007161656178](5-httpd2.assets/image-20231007161656178.png)



ğŸ‘‡ç»“æœå‘ç°æ˜¯è½¯è¿æ¥å¾—é—®é¢˜ï¼Œä½†æ˜¯ä¹‹å‰å¯ä»¥å¾—å•Šï¼

![image-20231007163745035](5-httpd2.assets/image-20231007163745035.png)



![image-20231007164158405](5-httpd2.assets/image-20231007164158405.png)

æƒé™OKğŸ‘†ï¼Œæ‰¾åˆ°å…ƒå©´äº†ï¼ŒğŸ‘‡**å°±æ˜¯å¼€å¯indexeså°±ä¸æ”¯æŒè½¯è¿æ¥äº†ï¼Œå¥‡æ€ªäº†ï¼Œå…ˆè®°ç€è¿™ä¸ªç‚¹**

![image-20231007175831767](5-httpd2.assets/image-20231007175831767.png)

ğŸ‘†åŒæ—¶æ³¨æ„ï¼šcurl ä¸åŒäºæµè§ˆå™¨http://192.168.126.130/dir2 ,  æµè§ˆå™¨è¿™æ ·å›è½¦è‡ªåŠ¨å°±æ˜¯dir2/ è¡¥ä¸€ä¸ªæ–œæ çš„/ï¼›  curl æ²¡æ–œæ†/æœ‰é—®é¢˜çš„ã€‚



æ¥ä¸€å¼ æ€»ç»“å›¾ğŸ‘‡ï¼Œç»“è®ºå°±æ˜¯ **options indexesä¼šå¯¼è‡´ln -s çš„403 Forbiddenã€‚**

![image-20231007180604795](5-httpd2.assets/image-20231007180604795.png)





å¦‚æœè¦æŠŠè½¯è¿æ¥ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œéœ€è¦å†é…ç½®ä¸€ä¸‹

### FollowSymLinksï¼šå…è®¸è®¿é—®ç¬¦å·é“¾æ¥æ–‡ä»¶æ‰€æŒ‡å‘çš„æºæ–‡ä»¶

å½“ç„¶ï¼Œwelcome.confé‡Œçš„-Indexesè¦å»æ‰çš„

![image-20231007181947268](5-httpd2.assets/image-20231007181947268.png)



![image-20231007182031235](5-httpd2.assets/image-20231007182031235.png)

![image-20231007182500958](5-httpd2.assets/image-20231007182500958.png)



è¡¥ä¸Šå¯¹åº”å‚æ•°åå°±å¯ä»¥æ˜¾ç¤ºè½¯è¿æ¥äº†ğŸ‘‡

![image-20231007182638822](5-httpd2.assets/image-20231007182638822.png)

<img src="5-httpd2.assets/image-20231007182931735.png" alt="image-20231007182931735" style="zoom:33%;" />





### .htaccess

![image-20231008091735576](5-httpd2.assets/image-20231008091735576.png)

â‘ åŒæ ·ç”¨æ¥é’ˆå¯¹<directory>è¯­å¥çš„å‚æ•°ï¼Œæ¯”å¦‚Options Indexesï¼Œä¸è¿‡

â‘¡ä¸è¿‡ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå¼€å¯åŠŸèƒ½AllowOverride ALL

â‘¢.htaccessæ˜¯ä¼˜å…ˆäºé…ç½®æ–‡ä»¶çš„ï¼Œä¸ç„¶ä¹Ÿä¸ä¼šå«AllowOverrideå…è®¸è¦†ç›–äº†ã€‚

â‘£.htaccessæœ¬èº«æ˜¯ä¸ä¼šè¢«çœ‹åˆ°çš„ï¼Œå› ä¸ºåœ¨ä¸»é…ç½®æ–‡ä»¶é‡Œæœ‰å¦‚ä¸‹é…ç½®ğŸ‘‡ï¼š

![image-20231008092114883](5-httpd2.assets/image-20231008092114883.png)



å½“å‰çŠ¶æ€ğŸ‘‡

![image-20231008092521918](5-httpd2.assets/image-20231008092521918.png)



å»å“ªé‡Œåˆ›å»º.htaccessæ•´ä¸ªæ–‡ä»¶å‘¢ï¼Œå»accessFileNameï¼Œæ•´ä¸ªæ–‡ä»¶å…¶å®ä¸æ˜¯å•ä¸€çš„è·¯å¾„ï¼Œè€Œæ˜¯ä¸€ä¸ªé€’å½’æ£€ç´¢çš„è·¯å¾„ã€‚

![image-20231008093640760](5-httpd2.assets/image-20231008093640760.png)

æ‰€ä»¥å°±åœ¨documentRooté‡Œåˆ›å»ºå°±è¡Œäº†

![image-20231008094042757](5-httpd2.assets/image-20231008094042757.png)

ä¸Šå›¾ğŸ‘†æ¼äº†ä¸€ä¸ªAllowOverride Allï¼Œè¿™å°±æ˜¯é’ˆå¯¹.htaccessçš„ç”Ÿæ•ˆå¼€å…³ã€‚

<img src="5-httpd2.assets/image-20231008094151843.png" alt="image-20231008094151843" style="zoom:50%;" /> 

ç„¶åå°±å¯ä»¥äº†

<img src="5-httpd2.assets/image-20231008094629122.png" alt="image-20231008094629122" style="zoom:40%;" /> 

é˜¶æ®µæ€»ç»“ä¸€ä¸‹

![image-20231008101257751](5-httpd2.assets/image-20231008101257751.png)

<img src="5-httpd2.assets/image-20231008101308260.png" alt="image-20231008101308260" style="zoom:50%;" />



<img src="5-httpd2.assets/image-20231008101331100.png" alt="image-20231008101331100" style="zoom:50%;" />



ä¸‹é¢å¼€å§‹å­¦ä¹ (3)åŸºäºIPçš„è®¿é—®æ§åˆ¶

## åŸºäºIPçš„è®¿é—®æ§åˆ¶:



å…ˆåšä¸€ä¸ªæ‹’ç»æ‰€æœ‰çš„confæ–‡ä»¶çš„è®¿é—®

![image-20231008101924401](5-httpd2.assets/image-20231008101924401.png)



<img src="5-httpd2.assets/image-20231008101901251.png" alt="image-20231008101901251" style="zoom:67%;" /> 

![image-20231008102010672](5-httpd2.assets/image-20231008102010672.png)

è¿™é‡Œfiles å°±æ˜¯é€šé…ç¬¦ï¼ŒfilesMatchæ‰æ˜¯æ­£åˆ™è¡¨è¾¾å¼äº†ï¼Œå—¯~ o(*ï¿£â–½ï¿£*)oä¸Šé¢çš„é€šé…ç¬¦å†™é”™äº†å“¦ï¼Œæ”¹ä¸‹ğŸ‘‡ï¼š

<img src="5-httpd2.assets/image-20231008102224730.png" alt="image-20231008102224730" style="zoom:33%;" />



é‡å¯æœåŠ¡åï¼Œxxx.confæ–‡ä»¶å°±çœ‹ä¸åˆ°äº†ï¼Œ

![image-20231008102333910](5-httpd2.assets/image-20231008102333910.png)

![image-20231008102402807](5-httpd2.assets/image-20231008102402807.png)



å°†é€šé…ç¬¦æ”¹æˆæ­£åˆ™

![image-20231008103244290](5-httpd2.assets/image-20231008103244290.png)

æ‰“å¼€ä¸Šå›¾æ³¨é‡Šï¼Œå°±ä¼šå®ç°æ‹’ç»è®¿é—® åŒ…å«.confçš„æ–‡ä»¶ï¼Œå½“ç„¶regexè¦å†™å¥½ä¸€ç‚¹ï¼Œä¼˜åŒ–ä¸‹

![image-20231008103504861](5-httpd2.assets/image-20231008103504861.png)

è¿™æ ·å°±å®ç°äº†regexçš„å†™æ³•ï¼Œ[å‚è§ä¸Šæ–‡](#spam2)



è¿›ä¸€æ­¥å®ç°é’ˆå¯¹192.168.126.1è¿™ä¸ªIPï¼Œä¸èƒ½è®¿é—®beijing/index.htmlï¼Œå…¶ä»–éƒ½å¯ä»¥

```
mkdir beijing
echo this is beijingbeijing > beijing/index.html
ls beijing/

```

![image-20231008105507261](5-httpd2.assets/image-20231008105507261.png)



é…ç½®aclåçš„æ•ˆæœï¼š

![image-20231008110519696](5-httpd2.assets/image-20231008110519696.png)

å…¶ä»–éƒ½OK

![image-20231008110553570](5-httpd2.assets/image-20231008110553570.png)

ç”±äºåªæ˜¯é’ˆå¯¹192.168.126.1çš„ç¦æ­¢è®¿é—®/beijing/index.htmlï¼Œæ‰€ä»¥å…¶ä»–IPå¯ä»¥è®¿é—®

![image-20231008110814787](5-httpd2.assets/image-20231008110814787.png)



æ”¹ä¸ºæ‹’ç»æ•´ä¸ªå­ç½‘

<img src="5-httpd2.assets/image-20231008111102582.png" alt="image-20231008111102582" style="zoom:43%;" />



<img src="5-httpd2.assets/image-20231008111121336.png" alt="image-20231008111121336" style="zoom:40%;" />





### ç„¶åç ”ç©¶ä¸‹ä¼˜å…ˆçº§å’Œé»˜è®¤è¡Œä¸º

å…ˆä¸Šç»“è®ºï¼š

â‘ RequireAll æ­é… all granted ç„¶åæ‹’ç»è°ï¼Œè¿™æ˜¯é»‘åå•å†™æ³•

â‘¡RequireAnyæ­é…all deniedç„¶åæ”¾è¡Œè°ï¼Œè¿™æ˜¯ç™½åå•å†™æ³•ã€‚

â‘¢å®‡å®™æ³•åˆ™ä¹‹--ä»ä¸Šåˆ°ä¸‹åŒ¹é…ï¼Œè¢«æ‰“ç ´äº†ï¼Œè¿™é‡Œæ˜æ˜all grantedè¿˜å¯ä»¥ä¸‹é¢denyï¼Œæ˜æ˜all denyäº†è¿˜å¯ä»¥ä¸‹é¢permitæ‰€ä»¥è¿™é‡Œæ‰“ç ´äº†ä»ä¸Šå¾€ä¸‹çš„å®‡å®™æ³•åˆ™ã€‚

<img src="5-httpd2.assets/image-20231008111404423.png" alt="image-20231008111404423" style="zoom:33%;" />

ğŸ‘†ä¸Šå›¾çš„åˆ’çº¢çº¿å‡º æ–‡å­—è¡¨è¾¾æ˜¯æ‘¸æ£±ä¸¤å¯çš„ï¼Œä¸è¦æŒ‰ä»–çš„æ€è·¯ç†è§£ã€‚

å°±ç†è§£æˆ**RequireAllæ˜¯é»‘åå•æœºåˆ¶ï¼ŒRequireAnyæ˜¯ç™½åå•æœºåˆ¶ï¼Œå°±å¥½äº†**å•Šï¼Œè¿˜æŠ˜è…¾å•¥å‘¢ï¼Œæµ…æµ‹ä¸€ä¸‹ğŸ‘‡

![image-20231008113011905](5-httpd2.assets/image-20231008113011905.png)

![image-20231008113149666](5-httpd2.assets/image-20231008113149666.png)

çœ‹æ¥ä¸èƒ½æ³¨é‡Šæ‰ï¼Œå“ˆå“ˆ

æ”¹æˆRequreAnyå°±ä¸è¡Œäº†

![image-20231008113246211](5-httpd2.assets/image-20231008113246211.png)



![image-20231008113339130](5-httpd2.assets/image-20231008113339130.png)

å¯ä»¥å¤§æ¦‚åˆ¤æ–­å‡ºæ¥ï¼Œå°±æ˜¯å›ºå®šå†™æ³•å½“ä½œå°±è¡Œäº†ï¼Œ

anyå°±æ˜¯ä»»æ„ï¼Œä»»æ„å°±æ˜¯ä»»æ„ä¸€ä¸ªOKå°±OKï¼Œæ‰€ä»¥æ˜¯ç™½åå•ï¼›

allå°±æ˜¯æ‰€æœ‰OKï¼Œé’ˆå¯¹æŸä¸ªæ‹’ç»ï¼Œæ‰€ä»¥å°±æ˜¯é»‘åå•äº†ã€‚



ç™½åå•å†™æ³•ğŸ‘‡

![image-20231008115121458](5-httpd2.assets/image-20231008115121458.png)







## ä¸¤ä¸ªæ—¥å¿—

![image-20231008120014457](5-httpd2.assets/image-20231008120014457.png)



![image-20231008132928853](5-httpd2.assets/image-20231008132928853.png)

å¯èƒ½ä¼šå¥‡æ€ªlogä¸æ˜¯åº”è¯¥é€šå¸¸æ”¾åˆ°/var/log/ä¸‹å—ï¼Œæ€ä¹ˆåœ¨/etc/httpd/ä¸‹å‘¢ï¼Œå…¶å®éƒ½æ˜¯å¯¹çš„ï¼Œè¿™é‡Œäººå®¶ç”¨çš„è½¯è¿æ¥

![image-20231008135433393](5-httpd2.assets/image-20231008135433393.png)



![image-20231008135706781](5-httpd2.assets/image-20231008135706781.png)



![image-20231008133212930](5-httpd2.assets/image-20231008133212930.png)



è¿™ç§æ‹’ç»è®¿é—®ä¹Ÿæ˜¯è®°å½•åˆ°é”™è¯¯æ—¥å¿—é‡Œçš„ğŸ‘‡

![image-20231008133412614](5-httpd2.assets/image-20231008133412614.png)



![image-20231008133408599](5-httpd2.assets/image-20231008133408599.png)



### å…³äºFQDNçš„æç¤ºå¤„ç†

é¦–å…ˆï¼Œè¿™ä¸æ˜¯ä¸ªæŠ¥é”™

![image-20231008134838438](5-httpd2.assets/image-20231008134838438.png)

åŒæ ·ä¹Ÿä¼šåœ¨é”™è¯¯æ—¥å¿—é‡Œå­˜æ”¾ï¼Œå½“ç„¶error_logå«é”™è¯¯æ—¥å¿—ä¸ä¸€å®šå°±å•å•å­˜æ”¾é”™è¯¯ä¿¡æ¯ã€‚

![image-20231008134926778](5-httpd2.assets/image-20231008134926778.png)

ä¼˜åŒ–å¤„ç†ä¸‹ï¼Œå¾ˆç®€å•

<img src="5-httpd2.assets/image-20231008135127884.png" alt="image-20231008135127884" style="zoom:50%;" />



æ²¡å•¥å®é™…ä½œç”¨å§åº”è¯¥ã€‚



### å†çœ‹çœ‹è®¿é—®æ—¥å¿—access_logçš„æ ¼å¼

![image-20231008140722944](5-httpd2.assets/image-20231008140722944.png)

ğŸ‘†ä¸Šå›¾å®šä¹‰äº†LogFormatä¸¤ç§æ ¼å¼ï¼Œåˆ†åˆ«å‘½åä¸ºcombinedå’Œcommonï¼Œç„¶åaccess_log(CustomLogå°±æ˜¯ç”¨æˆ·æ—¥å¿—) è°ƒç”¨çš„æ ¼å¼æ˜¯combinedã€‚

çœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¹ˆä¸ªæ ¼å¼

![image-20231008140758770](5-httpd2.assets/image-20231008140758770.png)

å®˜æ–¹è§£é‡ŠğŸ‘‡https://httpd.apache.org/docs/2.4/mod/mod_log_config.html#logformat

![image-20231008141400145](5-httpd2.assets/image-20231008141400145.png)

https://httpd.apache.org/docs/2.4/mod/mod_log_config.html#formats

![image-20231008141501272](5-httpd2.assets/image-20231008141501272.png)



![image-20231008142221197](5-httpd2.assets/image-20231008142221197.png)

```
%h	Remote hostname. Will log the IP address if HostnameLookups is set to Off, which is the default. If it logs the hostname for only a few hosts, you probably have access control directives mentioning them by name. See the Require host documentation.


%l	Remote logname (from identd, if supplied). This will return a dash unless mod_ident is present and IdentityCheck is set On.


%u	Remote user if the request was authenticated. May be bogus if return status (%s) is 401 (unauthorized).            # è¿™æ˜¯åŸºäºbasicçš„éªŒè¯ï¼Œä¸Šä¸€ç« èŠ‚æåˆ°çš„mod_auth_basic.soå¹²çš„æ´»å§åº”è¯¥æ˜¯ã€‚


```

![image-20231008142814887](5-httpd2.assets/image-20231008142814887.png)

```
%t	Time the request was received, in the format [18/Sep/2011:19:18:28 -0400]. The last number indicates the timezone offset from GMT


%r	First line of request.  # ğŸ‘‡å¯¹åº”ä¸‹å›¾çš„\"%r\"ä¹Ÿå°±æ˜¯logé‡Œçš„"GET /beijing/ HTTP/1.1"


%s	Status. For requests that have been internally redirected, this is the status of the original request. Use %>s for the final status.     # è¯´çš„æ˜¯%sï¼Œä½†æ˜¯å…¶å®ç”¨çš„æ˜¯%>sã€‚   è¿™é‡Œæ¶‰åŠé‡å®šå‘ï¼Œæ¯”å¦‚å…ˆä»page1ï¼Œ301åˆ°page2ï¼Œç„¶åå†200ï¼›ä¼°è®¡%så°±æ˜¯301äº†ï¼Œ%>så°±æ˜¯200å•¦ï¼Œè¿™ä¸ªåé¢å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚


è¿™ä¸ª200 403 301 è¿™äº›æ•°å­—æœ¬èº«å°±å¾ˆå¤§ç¨‹åº¦ä¸Šåæ˜ é™¤äº† é¡µé¢è¯·æ±‚çš„ç»“æœï¼Œæ¯”å¦‚200æ˜¯é¡µé¢æ‹¿åˆ°äº†ï¼Œ403æ˜¯ç¦æ­¢è®¿é—®äº†ï¼Œ301æ˜¯é‡å®šå‘ã€‚è¿™ä¸ªå’Œshellé‡Œçš„exit 1000 é€€å‡ºæ—¶å€™çš„è¿”å›1000è¿™ä¸ªæ•°å­—ä¸€ä¸ªé“ç†å•Šï¼›ä¹Ÿå’Œecho $?çœ‹åˆ°çš„0æ˜¯cliæ‰§è¡ŒæˆåŠŸå’Œé0æ‰§è¡Œå¤±è´¥ä¸€ä¸ªé“ç†å•Šã€‚
```

![image-20231008144405570](5-httpd2.assets/image-20231008144405570.png)

![image-20231008144724598](5-httpd2.assets/image-20231008144724598.png)

```
%b	Size of response in bytes, excluding HTTP headers. In CLF format, i.e. a '-' rather than a 0 when no bytes are sent.


```



![image-20231008151525204](5-httpd2.assets/image-20231008151525204.png)

23æ˜¯å¯¹ï¼Œ200è¯·æ±‚OKå23å­—èŠ‚å°±æ˜¯å¯¹çš„ï¼Œç„¶å403æ˜¯ç¦æ­¢äº†199å°±æ˜¯é‚£ä¸ªæŠ¥é”™çš„é¡µé¢å•¦-äººå®¶æ˜¯199ä¸ªå­—èŠ‚

**200 23 æ€ä¹ˆç†è§£**ğŸ‘‡

![image-20231008151551436](5-httpd2.assets/image-20231008151551436.png)

ä¸è¿‡23Byteså…¶å®æ˜¯å»æ‰äº†headå¤´çš„å§

**403 199 æ€ä¹ˆç†è§£ğŸ‘‡**

![image-20231008152036749](5-httpd2.assets/image-20231008152036749.png)



ç»§ç»­-----

![image-20231008152552179](5-httpd2.assets/image-20231008152552179.png)

åœ¨httpdæ—¥å¿—é‡Œçœ‹åˆ°èŠ±æ‹¬å·{}å°±è¡¨ç¤ºå¤´ä¿¡æ¯ï¼Œè¿™é‡ŒLOGé‡Œè®°å½•äº†headä¿¡æ¯é‡Œçš„  Referer--ä»å“ªä¸ªç«™ç‚¹è·³è½¬è¿‡æ¥çš„ä¿¡æ¯ï¼Œä»¥åŠUser-Agentç”¨æˆ·æµè§ˆå™¨ä¿¡æ¯ã€‚è¿™äº›éƒ½æ˜¯<font color=red>%{xxxx}i</font> ä»£è¡¨çš„headé‡Œçš„é”®å€¼å¯¹ä¿¡æ¯ï¼Œå…·ä½“ç”¨å“ªä¸ªä½ å°±å†™å“ªä¸ªå°±è¡Œäº†ã€‚

![image-20231008153529283](5-httpd2.assets/image-20231008153529283.png)

### å…³äºrefereræµ…æµ‹ä¸€ä¸‹

```
<html>
<head>
<title>htmlè¯­è¨€</title>
</head>
<body>
<img src="http:/xxx/xxx/logo.ping" >
<h1>ä½ å¥½</h1>
<p><a href=https://www.bing.com>è¿™æ˜¯è·³è½¬æµ‹è¯•</a>ä½ å¥½å•Š</p>
</body>
</html>

```

å€Ÿé‰´ä¸Šé¢çš„è·³è½¬å†™æ³•ï¼Œåšä¸¤ä¸ªé¡µé¢æ¥å®éªŒ

![image-20231008154702490](5-httpd2.assets/image-20231008154702490.png)

<img src="5-httpd2.assets/image-20231008155112490.png" alt="image-20231008155112490" style="zoom:50%;" /> 



![image-20231008155059899](5-httpd2.assets/image-20231008155059899.png)

æ­¤æ—¶åˆ°test2.htmlç¬¬äºŒä¸ªé¡µé¢å°±å¯ä»¥çœ‹åˆ°refererçš„ä¸Šä¸€ä¸ªè·³è½¬è¿‡æ¥çš„é“¾æ¥äº†ğŸ‘‡

![image-20231008155048713](5-httpd2.assets/image-20231008155048713.png)



![image-20231008155429602](5-httpd2.assets/image-20231008155429602.png)

![image-20231008155945318](5-httpd2.assets/image-20231008155945318.png)

äº§ç”Ÿtest1.htmlä¼šæœ‰refererçš„åŸå› æœ‰ç‚¹å¥‡æ€ªï¼Œå¥½åƒæ˜¯å¶å°”ä»test2.htmlé¡µé¢è¿”å›åé€€å›æ¥F5ä¸€ä¸‹å¼„å‡ºæ¥çš„ã€‚ä¸è¿‡æœ‰æ—¶å€™å‡ºä¸æ¥ï¼Œæä¸æ¸…æ¥šï¼Œ

â€‹          å™¢å™¢å™¢ï¼Œæˆ‘çŸ¥é“ï¼Œæ˜¯è¿™æ ·çš„ï¼Œäººå®¶å†™äº†æ˜¯ä»http://192.168.126.130/ ä¸Šä¸€ä¸ªé¡µé¢æ¥çš„ï¼Œæ‰€ä»¥ç­”æ¡ˆå°±æ¸…æ¥šäº†

![image-20231008160303365](5-httpd2.assets/image-20231008160303365.png)

ä»ğŸ‘†è¿™é‡Œç‚¹è¿›å»ä¸å°±æ˜¯httpdé»˜è®¤ç»™ä½ å¼„å‡ºæ¥çš„è·³è½¬å˜›ï¼Œ

![image-20231008160418839](5-httpd2.assets/image-20231008160418839.png)





å†å¼€ä¸€ä¸ªæœºå™¨192.168.126.131åšä¸€ä¸ªå›¾ç‰‡é¡µé¢ï¼Œ

![image-20231008163031549](5-httpd2.assets/image-20231008163031549.png)

![image-20231008163042270](5-httpd2.assets/image-20231008163042270.png)

ç„¶ååœ¨192.168.126.130ä¸Šåšè·³è½¬refererè¿‡å»



![image-20231008163234284](5-httpd2.assets/image-20231008163234284.png)

å†™é”™äº†å“¦ğŸ‘†ä¸Šå›¾http://192å†™é”™äº†ï¼Œå¯¼è‡´ğŸ‘‡

![image-20231008163514011](5-httpd2.assets/image-20231008163514011.png)

ä¿®æ”¹ä¹‹

![image-20231008163552293](5-httpd2.assets/image-20231008163552293.png)



![image-20231008163640739](5-httpd2.assets/image-20231008163640739-1696754201215-3.png)





![image-20231008163830599](5-httpd2.assets/image-20231008163830599.png)

è¿™å°±æ˜¯ç›—é“¾ï¼Œå¦‚ä½•å‘ç°ç›—é“¾å‘¢ï¼Œå°±æ˜¯å»serverä¸Šçœ‹referer

![image-20231008164401159](5-httpd2.assets/image-20231008164401159.png)

é—®ï¼šæ˜¯å¦å¯ä»¥é€šè¿‡åœ¨serverä¸Šå†™iptables -A INPUT -s 192.168.126.130 -j REJECTæ¥é˜²æ­¢ç›—é“¾å‘¢ï¼Ÿ

ç­”ï¼šè¯¥æ–¹æ³•å®ç°ä¸äº†ï¼Œå› ä¸ºè·³è½¬çš„å®é™…æ•ˆæœæ˜¯è®©ç”¨æˆ·é‡æ–°ä¸‹è½½ä¸€ä¸ªæ–°çš„å†…å®¹ï¼Œæ˜¯ç”¨æˆ·å»è®¿é—®è€Œä¸æ˜¯130è¿™ä¸ªrefererçš„ä¸Šä¸€ä¸ªé“¾æ¥åœ°å€å»è®¿é—®ã€‚   æ‰€ä»¥è¦é˜²æ­¢ç›—é“¾å°±è¦ç»§ç»­å­¦ä¹ å’¯... ...



å†ä¸€ä¸ªï¼Œå¦‚æœæ˜¯refereré‡Œæ˜¾ç¤ºçš„æ˜¯ç™¾åº¦çš„IPï¼Œè¯´æ˜ä»€ä¹ˆï¼Œä¹Ÿæ˜¯ç›—é“¾ä¹ˆï¼Ÿåº”è¯¥å°±ä¸æ˜¯äº†ï¼Œè¿™æ˜¯å¹¿å‘Šè´¹æ²¡ç™½ç»™ï¼Œå“ˆå“ˆï¼Œæˆ–è€…äººå®¶ä¸€æœï¼Œå°±ä½ å®¶çš„ç½‘ç«™ï¼Œæ€»ä¹‹åæœ‰å…«ä¹ç®—æ˜¯å¥½äº‹äº†ï¼Œè¿™ç§æƒ…å†µã€‚



å…³äºæ—¥å¿—çš„é˜¶æ®µæ€§æ€»ç»“PPTæ”¾ç€äº†ï¼Œéšä¾¿çœ‹çœ‹ï¼Œä¸çœ‹ä¹Ÿè¡Œï¼Œå›¾ä¸ªå®Œæ•´æ€§

![image-20231008171325863](5-httpd2.assets/image-20231008171325863.png)

<img src="5-httpd2.assets/image-20231008171343097.png" alt="image-20231008171343097" style="zoom:50%;" />



![image-20231008171400280](5-httpd2.assets/image-20231008171400280.png)





ç„¶åæ—¥å¿—çš„ä¸€ä¸ªè®¿é—®IPæ’åº

![image-20231008171714735](5-httpd2.assets/image-20231008171714735.png)



## å­—ç¬¦é›†

![image-20231008171904913](5-httpd2.assets/image-20231008171904913.png)

iconv -l    # æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†

![image-20231008172202599](5-httpd2.assets/image-20231008172202599.png)



<img src="5-httpd2.assets/image-20231008172213542.png" alt="image-20231008172213542" style="zoom:50%;" /> 





é€šå¸¸å¯ä»¥çœ‹å¾—åˆ°ç½‘é¡µçš„å­—ç¬¦é›†çš„

![image-20231008172604412](5-httpd2.assets/image-20231008172604412.png)



![image-20231008172828858](5-httpd2.assets/image-20231008172828858.png)

![image-20231008172906941](5-httpd2.assets/image-20231008172906941.png)



å¸¦ä¸å¸¦s httpsçš„s ä¹Ÿä¸ä¸€æ ·

![image-20231008173027538](5-httpd2.assets/image-20231008173027538.png)



ä¸è¿‡é’ˆå¯¹ä½¿ç”¨curlç™¾åº¦ï¼Œä¸æ˜¾ç¤ºå­—ç¬¦é›†ğŸ‘‡

![image-20231008173309918](5-httpd2.assets/image-20231008173309918.png)



æµè§ˆå™¨æ˜¯æœ‰çš„

<img src="5-httpd2.assets/image-20231008173228802.png" alt="image-20231008173228802" style="zoom:50%;" />









æ”¹ä¸€ä¸‹å­—ç¬¦é›†çœ‹çœ‹æ•ˆæœ

![image-20231008173541052](5-httpd2.assets/image-20231008173541052.png)





