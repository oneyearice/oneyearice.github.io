# ç¬¬10èŠ‚. httpdæºç ç¼–è¯‘å®‰è£…





![image-20231020112831574](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020112831574.png)

ç¡®å®æœ‰ï¼šhttps://httpd.apache.org/test/flood/

ä½†æ˜¯æœä¸åˆ°ğŸ‘‡

![image-20231020112804497](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020112804497.png)







APRæ˜¯ç»Ÿä¸€çš„è°ƒç”¨OSçš„æ¥å£ï¼Œä¾¿äºå¼€å‘ã€‚è€Œapacheä¹Ÿå°±æ˜¯httpdè½¯ä»¶å°±æ˜¯åŸºäºAPRå¼€å‘çš„ã€‚

<img src="10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020095437175.png" alt="image-20231020095437175" style="zoom:33%;" />

éšç€å¼€å‘é¡¹ç›®çš„è¶Šæ¥è¶Šå¤šï¼Œå°±éœ€è¦APRè¿™ç§æ¥å£ã€å·¥å…·ã€æˆ–è€…å¼•æ“ä¹‹ç±»çš„ä¸“é¡¹å°ç»„ï¼Œè¿™æ ·è§„æ¨¡èµ·æ¥äº†ï¼Œå°±éœ€è¦ç»Ÿä¸€æ¥å£å¼€å‘å°ç»„æ¥èŠ‚çœæ•´ä½“çš„å¼€å‘æˆæœ¬ã€‚



å…¶å®è½¯ä»¶æ˜¯å¦åŸºäºä»€ä¹ˆè½¯ä»¶é€šå¸¸éƒ½å¯ä»¥æŸ¥çš„ğŸ‘‡

<img src="10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020100022104.png" alt="image-20231020100022104" style="zoom:40%;" />



è®²è¿™ä¸ªå°±æ˜¯è¦æ˜ç™½ï¼Œç¼–è¯‘å®‰è£…çš„æ—¶å€™ï¼Œè¦æ³¨æ„apache(httpd)çš„ç‰ˆæœ¬ï¼Œå’ŒAPRçš„ç‰ˆæœ¬æ—¶å€™é€‚é…ã€‚



ä¸€èˆ¬yumå®‰è£…çš„ç‰ˆæœ¬éƒ½ç›¸å¯¹è¾ƒæ—§ä¸€ç‚¹

![image-20231020103640017](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020103640017.png)

å®˜æ–¹æœ‰æ–°çš„ä¸”ç¨³å®šçš„ç‰ˆæœ¬ï¼Œä¹Ÿä¸æ˜¯å°±è¦å®‰è£…æœ€æ–°çš„ï¼Œè¦å®‰è£…ç¨³å®šçš„ã€‚åˆ¤æ–­ä¾æ®æœ‰â‘ è¯¥ç‰ˆæœ¬å‘å¸ƒæ—¶é—´é€šå¸¸æ™šäºæœ€æ–°1å¹´ï¼Ÿâ‘¡å’Œæœ€æ–°çš„éš”1-2ä¸ªç‰ˆæœ¬ã€‚

![image-20231020103620377](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020103620377.png)







![image-20231020105651342](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020105651342.png)

ç†è®ºä¸Šè¦å…ˆç¼–è¯‘å®‰è£…è¾ƒæ–°çš„aprå’Œapr-utilè½¯ä»¶ï¼Œå†ç¼–è¯‘å®‰è£…httpdçš„è¾ƒæ–°ç‰ˆæœ¬ã€‚

ä¹Ÿå¯ä»¥æŠŠä¸‰ä¸ªè½¯ä»¶çš„æºä»£ç æ‹·åœ¨ä¸€èµ·ï¼Œä¸€èµ·ç¼–è¯‘å°±è¡Œäº†ã€‚





### æ–¹æ³•ä¸€ï¼šé€ä¸ªç¼–è¯‘ï¼Œè¿™æ ·å°±è¦æ³¨æ„ä¾èµ–å…³ç³»

![image-20231020132054259](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020132054259.png)

æ¯”å¦‚ğŸ‘†apr-utilä¾èµ–äºaprï¼Œæ‰€ä»¥--withè¦çŸ¥åaprçš„å®‰è£…è·¯å¾„ã€‚

![image-20231020132251445](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020132251445.png)

--with-aprå’Œ--with-apr-utilå°±æ˜¯ä¾èµ–åŒ…çš„æŒ‡å®šï¼Œè¿™äº›ä¾èµ–éƒ½æ˜¯å·²ç»å®‰è£…å¥½çš„ã€‚



### æ–¹æ³•äºŒï¼šä¸€èµ·ç¼–è¯‘

![image-20231020132819890](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020132819890.png)

--with-included-aprå°±è¡¨ç¤ºhttpdé‡Œçš„æºç åŒ…é‡Œå·²ç»æœ‰äº†parçš„æºç åŒ…äº†ã€‚

![image-20231020133556285](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020133556285.png)



ä¸‹é¢å®éªŒå¿«å¼€å§‹ï¼Œç”¨rockyliux9.2å¼„å¾—ï¼Œæ€è·¯è¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·

**1ã€æ‰¾æºç åŒ…**

https://httpd.apache.org/

![image-20231020140019610](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020140019610.png)



**2ã€æ‰¾APRåŒ…**

https://apr.apache.org/

![image-20231020135548189](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020135548189.png)

å¥½åƒæ²¡æœ‰çœ‹åˆ°å„ä¸ªapacheç‰ˆæœ¬å’Œaprçš„ä¸€ä¸ªå¯¹åº”è¡¨ï¼Œä½†æ˜¯æœ‰æ¨èç‰ˆæœ¬ï¼Œæ‰€ä»¥çŒœæµ‹ç”¨è¿™äº›å°±è¡Œäº†ã€‚ä¹Ÿè®¸äººå®¶è½¯ä»¶å‘ä¸‹å…¼å®¹çš„ã€‚



**3ã€ä¸‹è½½**

![image-20231020140544384](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020140544384.png)



**4ã€è§£å‹**

å®‰è£…bzip2

```
yum -y install bzip2
```

tarè§£å‹ï¼Œé€šè¿‡historyæŸ¥çœ‹å’Œawkè¿‡æ»¤çš„æ¯”è¾ƒä¼˜çš„æ–¹æ³•å¦‚ä¸‹ï¼š 

awkçš„æ€è·¯å°±æ˜¯ï¼šç¬¬äºŒåˆ—æ˜¯tarå¹¶ä¸”ä¸åŒ…å«å­—ç¬¦*ï¼Œç„¶åå»æ‰ç¬¬ä¸€åˆ—åºåˆ—å·å•¦ï¼Œå†å»æ‰è¡Œé¦–è¡Œå°¾çš„ç©ºæ ¼ã€‚over~ğŸ‘‡

```shell
[root@server httpd_new]# history  |awk '$2=="tar" && $0!~"*" {$1="";print $0}' |awk '$1=$1' |sort |uniq
tar xvf apr-1.7.4.tar.bz2
tar xvf apr-util-1.6.3.tar.bz2 > /dev/null
tar xvf httpd-2.4.58.tar.bz2

```

å–historyé‡Œçš„éœ€è¦cliçš„æ–¹æ³•â‘ ï¼š

![image-20231020153518135](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020153518135.png)

![image-20231020153600507](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020153600507.png)

![image-20231020153802972](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020153802972.png)

æ–¹æ³•â‘¡ï¼š

![image-20231020155322009](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020155322009.png)

åˆå¹¶ä¸€ä¸‹cli

![image-20231020155851081](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020155851081.png)



![image-20231020160318585](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020160318585.png)



![image-20231020162217358](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020162217358.png)

![image-20231020162241467](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020162241467.png)

å¿…è¦æ—¶å¯ä»¥å»æ‰è¡Œå°¾



![image-20231020170512504](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020170512504.png)



ä¼˜åŒ–ä¸‹

![image-20231020172107417](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020172107417.png)

![image-20231020172333361](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020172333361.png)

å°†ä¸¤ä¸ªawkåˆå¹¶ä¸€ä¸‹



å¾—åˆ°æœ€å±Œçš„cli

![image-20231020174856311](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020174856311.png)

å†æ¥ä¸€ä¸ªæ›´åŠçš„cli

![image-20231020175156022](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020175156022.png)



å¦ˆçš„æˆ‘åœ¨å¹²å˜›...... ä»¥ä¸Šå°±å¾—åˆ°äº†ä¹‹è¿è¡Œçš„å‡ ä¸ªtarå‘½ä»¤ï¼Œ(ï¿£â–½ï¿£)"

![image-20231020175643614](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020175643614.png)



**5ã€åˆå¹¶**

æŠŠaprå’Œapr-utilçš„ä¸œè¥¿å¤åˆ¶åˆ°httpdæºç æŒ‡å®šç›®å½•ä¸‹ã€‚

```
cp -a apr-1.7.4 httpd-2.4.58/srclib/apr
cp -a apr-util-1.6.3 httpd-2.4.58/srclib/apr-util
```

![image-20231020182249573](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231020182249573.png)



**6ã€å®‰è£…ä¸€äº›å¸¸è§„ä¾èµ–åŒ…**

```shell
yum -y install gcc pcre-devel openssl-devel expat-devel; yum -y groupinstall  "Development Tools"

```



**7ã€ç¼–è¯‘å®‰è£…**

```shell
cd httpd-2.4.58

./configure \
--prefix=/app/httpd24 \
--enable-so \
--enable-ssl \
--enable-cgi \
--enable-rewrite \
--with-zlib \
--with-pcre \
--with-included-apr \
--enable-modules=most \
--enable-mpms-shared=all \
--with-mpm=prefork

make && make install
```

![image-20231023095213226](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023095213226.png)

ä¸Šå›¾æ˜¯æ‰¾åˆ°cpuæ ¸æ•°ï¼Œç„¶åå¹¶å‘ç¼–è¯‘çš„



ç¼–è¯‘çš„è¿‡ç¨‹ä¹Ÿä¼šè‡ªåŠ¨è®°å½•ä¸‹æ¥

![image-20231023134143573](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023134143573.png)





**8ã€è¿›å…¥ç¼–è¯‘æŒ‡å®šå®‰è£…è·¯å¾„ä¸‹æŸ¥çœ‹ä¸€ä¸‹å®‰è£…çš„æƒ…å†µï¼Œå¹¶æ·»åŠ PATHå˜é‡æˆ–åšè½¯è¿æ¥**

```shell
cd /app/httpd24
echo 'PATH=/app/httpd24/bin:$PATH' > /etc/profile.d/httpd.sh
. /etc/profile.d/httpd.sh

æˆ–è€…ç”¨ln -s /app/httpd24/bin/apachectl /usr/local/sbin/
ä½†æ˜¯è¦æ³¨æ„å¦‚æœå½“å‰å·²ç»å®‰è£…äº†httpdå…¶ä»–ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦å»æ‰å…¶binæ–‡ä»¶è°ƒç”¨ä¼˜å…ˆã€‚

ä½†æ˜¯æ•´ä¸ªbinæ–‡ä»¶å¤¹ é“¾è¿‡å»æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå¿…é¡»æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶åœ¨$PATHä¸‹ä¸èƒ½å­ç›®å½•ã€‚
```

![image-20231023104123496](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023104123496.png)



----



![image-20231023095610899](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023095610899.png)

awkçš„ç»§ç»­ä¼˜åŒ–ä¹‹å»é™¤å‰å‡ åˆ—å’Œç©ºæ ¼çš„æ–¹æ³•

![image-20231023101519099](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023101519099.png)



![image-20231023103302186](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023103302186.png)

**â‘ è½¯é“¾æ¥æ˜¯æ–‡ä»¶è¿˜å¥½ğŸ‘‡**

![image-20231023111159610](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023111159610.png)

**â‘¡è½¯é“¾æ¥æ˜¯æ–‡ä»¶å¤¹å°±ä¸€å®šè¦å°å¿ƒäº†**

![image-20231023111743987](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023111743987.png)



**9ã€å¯åŠ¨æœåŠ¡**

```
apachectl start
```

![image-20231023133122746](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023133122746.png)

![image-20231023132853457](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023132853457.png)

ä½†æ˜¯æŸ¥çœ‹ä¸è¡Œï¼Œ

![image-20231023134319670](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023134319670.png)

é€šè¿‡ä¿®æ”¹systemctlçš„å¯åŠ¨é…ç½®ä¿®æ­£



ğŸ‘‡è¿™æ˜¯yumå®‰è£…çš„httpdçš„systemctlçš„é…ç½®ï¼Œå‚è€ƒä¿®æ”¹

![image-20231023134519725](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023134519725.png)

ä¿®æ”¹ä¹‹ğŸ‘‡

![image-20231023141800153](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023141800153.png)

systemctlçš„é…ç½®ä¿®æ”¹åéœ€è¦reloadåŠ è½½ä¸€ä¸‹ğŸ‘‰ï¼šsystemctl daemon-reloadï¼Œå†å¯åŠ¨æœåŠ¡

![image-20231023135846393](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023135846393.png)

æ­»æ´»èµ·ä¸æ¥ï¼Œè¿™é‡Œä¸å¤ªå¥½æ’æŸ¥ï¼Œä½†æ˜¯ps auxå¯ä»¥çœ‹åˆ°

![image-20231023140013638](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023140013638.png)

æ‰¾åˆ°ä¸ªè¿™ä¸ªï¼Œç”¨çš„æ˜¯daemonç”¨æˆ·ï¼Œè€Œä¸æ˜¯apacheè¿™ä¸ªç”¨æˆ·ï¼Œä¸è¿‡ä¹Ÿæ²¡å…³ç³»ï¼Œâ‘ æœ‰è¯¥daemonç”¨æˆ·â‘¡httpdå¯ä»¥ä½¿ç”¨è¯¥ç”¨æˆ·æ‰§è¡Œ



å½“æœåŠ¡å¯åŠ¨çš„æ—¶å€™

![image-20231023141221943](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023141221943.png)

statusæ˜¾ç¤ºè¶…æ—¶

![image-20231023141416575](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023141416575.png)

ç»§ç»­æ’æŸ¥é€šè¿‡é”™è¯¯æ—¥å¿—å¯è§ï¼Œ

![image-20231023141236029](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023141236029.png)

å¯ä»¥çœ‹åˆ°  caught SIGWINCHï¼Œshutting down gracefullyçš„æƒ…å†µã€‚



æ”¹å›apachectl startå‘ç°èƒ½èµ·æ¥ï¼Œå°±æ˜¯ss -tlnup ç­‰3så°±èƒ½çœ‹åˆ°80ç«¯å£æ‰“å¼€äº†ï¼Œè¯´æ˜ä½¿ç”¨è¿™ç§æ–¹å¼å¯åŠ¨æœåŠ¡æ²¡é—®é¢˜ã€‚

ç„¶åå»ps auxfçœ‹çœ‹

![image-20231023144451421](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023144451421.png)



å°è¯•å°†systemctlé…ç½®æ–‡ä»¶é‡Œçš„å¯åŠ¨cliæ”¹æˆä¸Šå›¾çš„è¯•è¯•

è¿˜æ˜¯ä¸è¡Œï¼Œç®—äº†æ¢ç§æ–¹å¼å§ï¼Œsystemctl æœ‰é—®é¢˜å®åœ¨ä¸è¡Œå°±æ¢æˆè„šæœ¬çš„æ–¹å¼ğŸ‘‡

![image-20231023150641197](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023150641197.png)



![image-20231023150934872](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023150934872.png)

![image-20231023150944856](10-httpdæºç ç¼–è¯‘å®‰è£….assets/image-20231023150944856.png)

