# 4.Haproxy使用socat工具管理和静态调度算法.md



# socat工具

用来发送消息给socket文件

![image-20240812165740216](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812165740216.png)



![image-20240812165932352](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812165932352.png)

这里help看到是仅仅haproxy.sock支持的指令，不是所有socket文件支持这种方式。



![image-20240812170601374](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812170601374.png)



![image-20240812170758118](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812170758118.png)

## 通过haproxy的socket查看和配置

```bash
[root@realserver2 conf.d]# echo help | socat stdio /var/lib/haproxy/haproxy.sock
The following commands are valid at this level:
  abort ssl ca-file <cafile>              : abort a transaction for a CA file
  abort ssl cert <certfile>               : abort a transaction for a certificate file
  abort ssl crl-file <crlfile>            : abort a transaction for a CRL file

。。。 。。。

  set severity-output [none|number|string]: set presence of severity level in feedback information

。。。
  show backend                            : list backends in the current running config

```



![image-20240812173242635](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812173242635.png)

### 通过这个比如可以查看连接数

1、wget --limit-rate 限速查看长连接

![image-20240812175629310](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812175629310.png)

2、ab 并发来制造连接数

![image-20240812175728541](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812175728541.png)



### **查看后端服务器的状态**

![image-20240812175930865](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812175930865.png)



### 查看调度权重

![image-20240812180611956](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812180611956.png)

注意：3(initial 3) 就是现在是3，最初也是3的权重。说明可能会变化的。比如通过socket修改掉。



```bash
echo "get weight web_servers/web1" |socat stdio /var/lib/haproxy/haproxy.sock

echo "set weight web_servers/web1 10" |socat stdio /var/lib/haproxy/haproxy.sock
```

![image-20240812181039155](4.Haproxy使用socat工具管理和静态调度算法.assets/image-20240812181039155.png)





