# ç¬¬9èŠ‚. LVMç®¡ç†è¯¦è§£

## 1ã€åˆ›å»ºç®¡ç†

åˆ†åŒºä¸€æ—¦åˆ’åˆ†å¥½ï¼Œå°±æ²¡æ³•æ‰©äº†ã€‚è€ŒLVMå°±èƒ½æ‰©å’Œç¼©

LVMçš„åº•å±‚å¯èƒ½å°±æ˜¯raidä¸ºä¸»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å¤šå—ç¡¬ç›˜å’Œåˆ†åŒºã€‚

10å—æ³¨å†Œraid10ï¼ŒOSçœ‹åˆ°çš„å°±æ˜¯sdaä¸€å—ç›˜ï¼Œä»¥å‰å°±ç›´æ¥sdaä¸Šåˆ†åŒºï¼Œä¸€æ—¦åˆ†åŒºå°±å›ºå®šäº†ï¼Œåˆ†åŒºä¸å¤Ÿç”¨ä¹Ÿä¸èƒ½æ‰©ï¼Œæ‰€ä»¥å°±å†sdaä¸ŠåšLVMæ¥ç®¡ç†ï¼Œå¦‚ä½•ç®¡ï¼Œå‡è®¾ä¸€ç»„raid10å¾—åˆ°sdaï¼Œè¿˜æœ‰ä¸€ç»„sdbã€å†æ¥ä¸€ä¸ªsdc1åˆ†åŒºï¼Œè¿™äº›raidä¹Ÿå¥½ã€ç¡¬ç›˜ä¹Ÿå¥½ã€åˆ†åŒºä¹Ÿå¥½ï¼Œéƒ½æ˜¯linux Block Devicesã€‚è¿™äº›å—è®¾å¤‡å¤§å°ä¸é™ï¼Œæ— æ‰€è°“ã€‚

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310175954098.png" alt="image-20220310175954098" style="zoom:80%;" />

æŠŠè¿™äº›å—è®¾å¤‡ç¬¬ä¸€æ­¥é€šè¿‡pvcreateå˜æˆPhysical Volumesç‰©ç†å·ï¼Œæ‰€ä»¥ç‰©ç†å·å°±æ˜¯æ‰“ä¸Šæ ‡ç­¾--æ„æ€å°±æ˜¯è¿™äº›å—è®¾å¤‡ä¸ä½œä¸ºç‹¬ç«‹ç¡¬ç›˜ç”¨ï¼Œå°†æ¥è¦åšé€»è¾‘å·çš„ã€‚

æœ‰å‡ ä¸ªå—è®¾å¤‡(ç¡¬ç›˜æˆ–åˆ†åŒº)å°±ç”Ÿæˆå‡ ä¸ªç‰©ç†å·ï¼Œå°±æ˜¯æ‰“æ ‡ç­¾å—ï¼ŒåŸæ¥è®¾å¤‡å«å•¥åï¼Œç”Ÿæˆåè¿˜å«å•¥åã€‚



ç„¶åé€šè¿‡vgcreateå°†ç‰©ç†å·ä»¬ ç»„æˆä¸€ä¸ªå¤§çš„é›†åˆ ä¹Ÿå°±æ˜¯å·ç»„ã€‚æ­¤æ—¶å·ç»„å°±æ˜¯ä¸€ä¸ªå¤§çš„ç¡¬ç›˜å’¯ã€‚



ç„¶åé€šè¿‡lvcreateå°†å·ç»„ åˆ†æˆä¸€ä¸ªä¸ª é€»è¾‘å·å‡ºæ¥ã€‚



é€»è¾‘å·ä¸å…³å¿ƒä¸Šé¢çš„æ•°æ®å­˜æ”¾åœ¨å“ªå—ç‰©ç†è®¾å¤‡ä¸Šï¼Œ

é€»è¾‘å·çš„åœ°ä½å°±æ˜¯åˆ†åŒºäº†ï¼Œè¯¥åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿå°±åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼Œè¯¥æŒ‚è½½å°±æŒ‚è½½ã€‚



å¦‚æœLVM1 500G ï¼ŒLVM2 200Gï¼Œä¸‹é¢çš„å·ç»„æ˜¯1Tï¼Œå°†æ¥LVM1æ»¡äº†ä¸å¤Ÿç”¨äº†ï¼Œè¿˜å¯ä»¥**åœ¨çº¿**æ‰©å±•åˆ°800Gã€‚æ‰€è°“åœ¨çº¿å°±æ˜¯ç”¨æˆ·æ— æ„Ÿ--ä½¿ç”¨ä¸å—å½±å“ï¼Œæ— éœ€å–æ¶ˆæŒ‚è½½ï¼Œç›´æ¥åœ¨çº¿æŒ‚è½½çš„çŠ¶æ€ä¸‹ï¼Œä¸€æ¡å‘½ä»¤å°±æŒ‚ä¸Šå»äº†ã€‚

å¦‚æœlvm1 800Gä¹Ÿæ»¡äº†ï¼Œæ€ä¹ˆåŠï¼Œå¯ä»¥å†åº•å±‚å—è®¾å¤‡ä¸Šå†åŠ å…¥æ–°çš„ç¡¬ç›˜ã€‚è¿™ä¸€å¥—è¿˜æ˜¯åœ¨çº¿æ‰©å±•å—ï¼Ÿâšª



æ‰€ä»¥linuxé»˜è®¤å®‰è£…çš„æ—¶å€™é»˜è®¤å°±æ˜¯é€»è¾‘å·ã€‚



é€»è¾‘å·çš„æ¦‚å¿µäº†è§£åï¼Œè¿˜æœ‰ä¸€ä¸ªPEï¼Œå«ç‰©ç†ç›˜åŒº**physical Extent**ã€‚åœ¨åˆ›å»ºå·ç»„çš„æ—¶å€™è¦æŒ‡å®šPEï¼Œå‡è®¾PEæ˜¯16Mï¼Œå·ç»„å°±ä¼šæ˜¾ç¤ºæœ‰å¤šå°‘ä¸ªPEï¼Œåˆ›å»ºLVMé€»è¾‘å·çš„æ—¶å€™å¯ä»¥ä»è¿™ä¹ˆå¤šä¸ªPEä¸­å–å‡ºå¤šå°‘ä¸ªPEæ¥ä½œä¸ºé€»è¾‘å·ã€‚æ‰©å±•çš„æ—¶å€™ä¹Ÿå¯ä»¥å¢åŠ å¤šå°‘ä¸ªPEã€‚PEå°±æ˜¯åˆ†é…çš„æœ€å°å•å…ƒäº†ã€‚



åˆ°ç°åœ¨å·²ç»æ˜¯LVM2ä»£äº†ï¼ŒLVM2ã€‚



åœ¨IBM AIXç³»ç»Ÿunixå°å‹æœºï¼Œå°±åªç”¨LVMï¼Œä¸ç”¨åˆ†åŒºã€‚



LVMè¦å»ºç«‹åœ¨raidä¹‹ä¸Šï¼Œç¡¬ç›˜åäº†æœ‰å†—ä½™ã€‚â‘ æ‹…å¿ƒLVMå¤šäº†ä¸€å±‚é€»è¾‘å±‚ï¼Œç¡¬ç›˜åäº†å¯¼è‡´æ•´ä¸ªå·ç»„å‡ºé—®é¢˜â‘¡å¤šä¸€å±‚é€»è¾‘å±‚ï¼Œä¸æ˜¯ç›´æ¥é¢å¯¹ç¡¬ç›˜ï¼Œæ€§èƒ½æ˜¯å¦ä¸å¥½ã€‚æ®è¯´2ç‚¹æ‹…å¿ƒéƒ½æ˜¯å¤šä½™çš„ã€‚åæ­£å¾ˆå¤šä¼ä¸šåœ¨ç”¨ï¼Œä¹Ÿæœ‰ä¼ä¸šä¸ç”¨ã€‚



å­¦å®Œå†æ¥è¿™é‡Œè¡¥å……å‘è¡¨è‡ªå·±çš„è§‚ç‚¹ï¼Œå’Œç½‘ä¸Šæœä¸€ä¸‹ã€‚



ä¸‹é¢å¼€æ“ä½œ

### ç¬¬ä¸€æ­¥ å‡†å¤‡å¥½å—è®¾å¤‡

![image-20220310201034729](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201034729.png)

![image-20220310201114620](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201114620.png)

### è¦æ³¨æ„ä¿®æ”¹åˆ†åŒºçš„IDä¸º8e

![image-20220310201318855](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201318855.png)

![image-20220310201420872](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201420872.png)

å­˜ç›˜é€€å‡º

![image-20220310201446432](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201446432.png)

åŒæ­¥ä¸‹

![image-20220310201516109](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201516109.png)

![image-20220310201549170](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201549170.png)

![image-20220310201647537](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201647537.png)





### ç¬¬ä¸€æ­¥ï¼Œç‰©ç†å·çš„ç”Ÿæˆ-pvcreate x y z\pvs\pvdisplay

pvsæŸ¥çœ‹ä¸‹ï¼Œå½“å‰pvæ˜¯ç©ºçš„

![image-20220310201825556](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310201825556.png)

æŠŠä¸Šé¢çš„ä¸€ä¸ªåˆ†åŒºã€ä¸€ä¸ªç¡¬ç›˜å˜æˆç‰©ç†å·

![image-20220310202010422](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310202010422.png)

ğŸ‘†å› ä¸ºsdb1ä¹‹å‰åšä¸ªswapï¼Œæ‰€ä»¥æœ‰æ ‡è®°ä½ï¼Œæ‰€ä»¥å…ˆddæ¸…ç©ºå‰10Må°±èƒ½è¦†ç›–åˆ°äº†ã€‚ä¹Ÿå¯ä»¥ç›´æ¥æ•²yå°±wipeä¸€æ ·ä¹Ÿæ“¦æ‰äº†ã€‚

ç„¶åå†pvcreate /dev/sdb1 /dev/sddä¹Ÿå¯ä»¥åˆèµ·æ¥äº›ã€‚

è¿™æ ·pvså’Œpvdisplayå°±èƒ½çœ‹åˆ°äº†

![image-20220310202323610](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310202323610.png)

pvså°±æ˜¯summaryæ¦‚å†µï¼Œå…¶ä¸­lvm2å°±æ˜¯é€»è¾‘å·2ä»£ï¼›VGåˆ—æ˜¯ç©º è¡¨ç¤ºå·ç»„æ²¡ç»„å»ºå‘¢è¿˜ã€‚

pvdisplayåŒæ ·å¯è§VGæ˜¯ç©ºï¼›PE Sizeä¹Ÿæ˜¯0 è¿™ä¸ªåªæœ‰åˆ›å»ºVGçš„æ—¶å€™æŒ‡å®šæ‰ä¼šå‡ºç°ã€‚



### ç¬¬äºŒæ­¥ vgcreateåˆ›å»ºå·ç»„

vgå¼€å¤´çš„ä¹Ÿæ˜¯ä¸€å¤§å †å‘½ä»¤

![image-20220310202633432](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310202633432.png)

åŒæ ·æœ‰vgså’Œvgdisplayï¼Œç„¶åpvdisplayè‚¯å®šä¹Ÿèƒ½çœ‹VGå’ŒPEä¹Ÿå°±æ˜¯vgcreateåçš„ä¿¡æ¯ã€‚

![image-20220310202653185](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310202653185.png) 

ä½¿ç”¨å¸®åŠ©çœ‹ä¸‹

![image-20220310202921686](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310202921686.png) 

-s æŒ‡å®šPEçš„å¤§å° pe--physical extent size

![image-20220310203126338](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310203126338.png) 

ä¸Šå›¾å¿˜è®°åŠ å•ä½äº†ï¼Œä¸è¿‡æœ‰é»˜è®¤å€¼çš„pvdisplayå¯è§ã€‚

vgæ•´åˆå¥½å

â‘ pvsçœ‹

![image-20220310203214128](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310203214128.png) 

![image-20220310203233312](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310203233312.png)PEçš„é»˜è®¤å€¼ä¹Ÿçœ‹åˆ°äº†æ˜¯4MBï¼Œä¸Šå›¾PE sizeæ˜¯4MBï¼Œtotal PE 1023å°±æ˜¯1023ä¸ªçš„æ„æ€ã€‚æ€»å®¹é‡ä¹Ÿå°±æ˜¯4Gå’¯ã€‚åŒæ ·/dev/sddä¹Ÿå°±æ˜¯4MB*2559=10G

â‘¡ç„¶åé€šè¿‡vgs å’Œvgdisplayçœ‹çœ‹

![image-20220310203621836](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310203621836.png)

ğŸ‘†vgså¯è§ï¼Œvg0è¿™ä¸ªå·ç»„é‡Œæœ‰2ä¸ªPV--ç‰©ç†å·ï¼ŒLVè¿˜æœªåˆ’åˆ†ï¼Œå¤§å°æ˜¯ä¸¤ä¸ªPVçš„æ€»å’Œ14gçš„æ ·å­ã€‚

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310203730947.png" alt="image-20220310203730947" style="zoom: 50%;" />

å…¨éƒ¨PEä¸ªæ•°3582ä¸ªï¼ŒAlloc PE / Size 0 / 0å°±æ˜¯æ²¡æœ‰åˆ†é…å‡ºå»å‘¢--å› ä¸ºé€»è¾‘å·lvmè¿˜æ²¡æœ‰åˆ†é…å‘¢ã€‚

ç”±äºé€»è¾‘å·lvmè¿˜æ²¡æœ‰åˆ›å»ºï¼Œæ‰€ä»¥è¿˜çœ‹ä¸åˆ°vg0è¿™ä¸ªè®¾å¤‡

![image-20220310203932380](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310203932380.png)



### ç¬¬ä¸‰æ­¥ lvcreateåˆ›å»ºlvm

![image-20220310204019058](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204019058.png)

![image-20220310204030419](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204030419.png) 



lvcreate --helpå¯è§ç”¨æ³•ï¼šä»å“ªä¸ªVG--å·ç»„é‡Œ é€šè¿‡-Lå– å¤šå¤§size  ï¼›é€šè¿‡-l å–å¤šå°‘ä¸ªPEï¼Œè¿™äº‹ä¸ªæ•°

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204201872.png" alt="image-20220310204201872" style="zoom:80%;" /> 

ä¸Šå›¾æœ‰stripedå’Œraid1|mirrorï¼Œè¿™å°±æ˜¯raidäº†ï¼Œå®Œå…¨å¯ä»¥ç”¨lvmå†åšä¸€å±‚raidï¼Œå®é™…ä¸Šåº•å±‚ç‰©ç†è®¾å¤‡åšraidåï¼Œä¸Šå±‚lvmä¸ä¼šå†åšraidäº†ã€‚

![image-20220310204550779](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204550779.png) 



![image-20220310204636582](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204636582.png)

ğŸ‘†èµ·ä¸ªåå­—mysqlï¼Œ-L ç›´æ¥å†™å¤§å°ï¼Œ-læ•°ä¸ªæ•°è¿˜è¦ç®—--ä¸ç”¨ï¼Œä»vg0é‡Œé¢åˆ’åˆ†lvmã€‚

lvs å’Œ lvdisplay

![image-20220310204806905](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204806905.png)

ä¸Šå›¾è¯´æ˜ï¼š

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204926640.png" alt="image-20220310204926640" style="zoom:60%;" /> è¿™ä¸ªå°±æ˜¯å®Œæ•´çš„è®¾å¤‡åï¼Œè¿™å…¶å®æ˜¯è½¯è¿æ¥ğŸ‘‡

![image-20220310204852464](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310204852464.png)

å®é™…ä¸Šå«dm-0ï¼Œè¿˜æœ‰ä¸€ä¸ªå’Œå®ƒä¸€æ ·æŒ‡å‘çš„è½¯è¿æ¥

![image-20220310205112608](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310205112608.png)

æ‰€ä»¥å¾…ä¼šå¯èƒ½çœ‹åˆ°çš„æ˜¯ä¸Šå›¾è¿™ä¸ªåå­—/dev/mapper/vg0-mysql

çœ‹ä¸‹ç°åœ¨çš„dmè®¾å¤‡æœ‰å‡ ä¸ªï¼šå¦‚æœå†åˆ›å»ºä¸€ä¸ªlvmï¼Œè¿™é‡Œå°±ä¼šå¤šä¸€ä¸ªdm-1äº†

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310205245763.png" alt="image-20220310205245763" style="zoom:80%;" /> 

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310205349023.png" alt="image-20220310205349023" style="zoom:50%;" />



![image-20220310205704500](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310205704500.png)

ä¸Šå›¾çš„8Gåˆ°åº•ç”¨çš„å“ªä¸ªç‰©ç†å·ï¼Œé€šè¿‡pvdisplayå¯ä»¥çœ‹åˆ°çš„

![image-20220310205817274](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310205817274.png)

å¯è§/dev/sdb1å…¨éƒ¨ç©ºé—²å°±æ˜¯æ²¡æœ‰ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ª8Géƒ½ç”¨çš„/dev/sddçš„ç©ºé—´4MB*2048ä¹Ÿå°±æ˜¯8Gã€‚åšraidä¹Ÿæ˜¯ä¸å…³å¿ƒå…·ä½“åˆ°åº•å­˜åœ¨é‚£å—ç›˜ä¸Šçš„ï¼Œéƒ½æ˜¯å½“ä½œæ•´ä½“åœ¨ç”¨çš„ã€‚

![image-20220310210034104](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310210034104.png) 

2048ä¸ªPEï¼Œåœ¨LVMå«LEï¼Œå°±æ˜¯PEåœ¨LVMé€»è¾‘å·é‡Œçš„åç§°ã€‚

![image-20220310210211533](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310210211533.png)

ä¸€æ—¦LVMåˆ’åˆ†äº†ï¼Œblkidå°±èƒ½çœ‹åˆ°äº†

![image-20220310210312714](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310210312714.png)

ç°åœ¨ç”±äºè¿˜æ²¡æœ‰åœ¨LVMä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿå‘¢ï¼Œsdb1å’Œsddçš„UUIDè‚¯å®šæ˜¯å„å½’å„çš„ã€‚æ‰€ä»¥è¿˜çœ‹ä¸åˆ°ä¸€ä¸ªsdb1å’Œsddåˆæˆä¸€ä¸ªçš„æƒ…å†µï¼Œå…¶å®åˆæˆä¸€ä¸ªæƒ…å†µæ˜¯blkidæ˜¯çœ‹ä¸åˆ°æ¸…æ¥šçš„ï¼Œåªèƒ½å†ä¸‹é¢çš„æ ¼å¼åŒ–çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ªmysqlçš„é€»è¾‘å·ã€‚è€Œsdb1å’Œsddæ˜¯é€»è¾‘å·çš„æˆå‘˜è€Œå·²ï¼Œå…·ä½“æ˜¯å“ªä¸ªlvmçš„æˆå‘˜è¿˜éœ€è¦å…·ä½“å»çœ‹çš„ã€‚

### ç¬¬å››æ­¥ mkfs.xfsæ ¼å¼åŒ–

![image-20220310210605821](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310210605821.png)

è¿™ä¸ªæ—¶å€™å°±çœ‹åˆ°ï¼Œå¢åŠ äº†ä¸€ä¸ªæ–°çš„è®°å½•ï¼Œmysqlè¿™ä¸ªé€»è¾‘å·å°±æœ‰æ–‡ä»¶ç³»ç»Ÿäº†ã€‚

### ç¬¬äº”æ­¥ æŒ‚è½½

æŒ‚è½½çš„æ—¶å€™ï¼Œè¦å†™è®¾å¤‡åï¼Œå¯ä»¥å†™è¿™é‡Œçš„/dev/mapper/vg0-mysqlå¯ä»¥å†™å½“åˆåˆ›å»ºçš„lvmèµ·çš„åç§°/dev/vg0/mysqlï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºéƒ½æ˜¯è½¯è¿æ¥ã€‚

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211042285.png" alt="image-2022031021104228 5" style="zoom:67%;" /> 

![image-20220310211122143](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211122143.png)

ä¸Šé¢æ˜¯ä¸´æ—¶æŒ‚è½½ï¼Œæ°¸ä¹…æŒ‚è¦å†™fstab

![image-20220310211221800](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211221800.png)

![image-20220310211241343](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211241343.png)

![image-20220310211314788](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211314788.png)

åˆšæ‰æŒ‚è¿‡äº†ï¼Œæ‰€ä»¥å°±è¡Œäº†ï¼Œrebootä¹Ÿä¸æ€•äº†ï¼Œæ­£å¸¸å°±æ˜¯mount -aå°±è¡Œäº†ã€‚



### çœ‹çœ‹æ€§èƒ½

![image-20220310211646809](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211646809.png)

ä¸Šå›¾æ˜¯ä¸æ˜¯æœ‰ç‚¹å¤¸å¼ äº†ï¼Œé€»è¾‘å·èƒ½æé€Ÿè¿™ä¹ˆå¿«çš„ï¼Ÿé€»è¾‘å·åæ­£ä¸ä¼šæ¯”ç‰©ç†åˆ†åŒºæ…¢å°±è¡Œäº†ã€‚

![image-20220310211829155](9-LVMç®¡ç†è¯¦è§£.assets/image-20220310211829155.png)

ä¸Šå›¾å°±æ˜¯conv=fdatasyncå°±æ˜¯ç»“æœæ˜¾ç¤ºçš„æ˜¯å·²ç»åŒæ­¥åˆ°ç¡¬ç›˜é‡Œçš„äº†ã€‚ä¸Šä¸Šå›¾çš„æ˜¯å†™åˆ°å†…å­˜é‡Œäº†å°±æ˜¾ç¤ºç»“æœäº†ã€‚



æ‰€ä»¥lvm + raidï¼Œæ˜¯å¾ˆå¥½ç”¨çš„ã€‚æ…¢ä¹Ÿä¸æ…¢ï¼Œåº•å±‚ç”¨raidå†—ä½™ç‰©ç†è®¾å¤‡ã€‚





## 2ã€ç®¡ç†è¯¦è§£

ä¸‹é¢çœ‹ä¸‹é€»è¾‘å·çš„ç©ºé—´æ‰©å±•

å‡è®¾è¿™ä¸ª8Gç”¨æ»¡äº†ï¼Œä¸‹é¢å¯¹å…¶è¿›è¡Œæ‰©å±•

![image-20220311100828655](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311100828655.png)

è¿™é‡Œå°‘äº†ä¸€æ­¥çœ‹mysqlè¿™ä¸ªlvmåˆ°åº•æ¥è‡ªäºå“ªä¸ªå·ç»„ï¼Œå…¶å®è¿™é‡Œå°±å¯ä»¥å‘ç°äººå®¶ç”¨vg0-mysqlä½œä¸ºè‡ªåŠ¨ç”Ÿæˆçš„è½¯è¿æ¥ æ¥ä½œä¸ºè®¾å¤‡å æœ¬èº«å°±æ˜¯è¦å‘Šè¯‰ä½ mysqlæ¥è‡ªäºvg0ã€‚

é€»è¾‘å·æ‰©å±• è¦å…ˆçœ‹ å·ç»„é‡Œæœ‰æ²¡æœ‰ç©ºé—²ç©ºé—´

![image-20220311100908431](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311100908431.png)

å¯è§å·ç»„é‡Œè¿˜æœ‰6Gç©ºé—²

![image-20220311101710712](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311101710712.png)

lvextend -l å°å†™çš„låœ¨æ‰©å±•å…¨éƒ¨å‰©ä¸‹ç©ºé—´å°±ç‰¹åˆ«å¥½ç”¨ï¼Œå¯ä»¥å†™-l 1534å°±æ˜¯å‰©ä¸‹å…¨éƒ¨çš„Free PEä¸ªæ•°ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸Šå›¾çš„+100%freeæ¥ç›´æ¥æå®šå‰©ä¸‹ç©ºé—´çš„100%ã€‚

![image-20220311150617321](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311150617321.png)

ä¸éœ€è¦æŒ‡å®švgå·ç»„ï¼Œå› ä¸ºmysqlè¿™ä¸ªlvmç³»ç»ŸçŸ¥é“ä»å“ªä¸ªå·ç»„æ¥çš„ï¼Œæ‰€ä»¥æ— éœ€æŒ‡å®šï¼Œç›´æ¥å‘½ä»¤å°±å†™/dev/vg0/mysqlå°±è¡Œã€‚

å›è½¦åå¯è§å·²ç»æ‰©å±•åˆ°13.99GBå…±3582ä¸ªPEã€‚

æ­¤æ—¶å†çœ‹vgdisplayå¯è§å·²ç»æ²¡æœ‰å‰©ä½™äº†

![image-20220311101925544](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311101925544.png)

vgç”¨å…‰äº†ï¼Œvgæ•´åˆçš„pvè‡ªç„¶ä¹Ÿå°±ç”¨å…‰äº†

![image-20220311102006611](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311102006611.png)

![image-20220311102046779](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311102046779.png)

ä½†æ˜¯æ­¤æ—¶ç¡®å‘ç°df -h é‡Œçœ‹åˆ°çš„é€»è¾‘å·çš„ç©ºé—´è¿˜æ²¡æœ‰åˆ·æ–°

![image-20220311102124451](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311102124451.png)

æ³¨æ„ï¼Œè¿™ä¸æ˜¯æ²¡æœ‰åˆ·æ–°å“¦ï¼Œè¿™æ˜¯å› ä¸º ä½ è™½ç„¶æŠŠlvmæ‰©å±•äº†6Gï¼Œä½†æ˜¯è¿™ä¸ª6Gçš„ç©ºé—´è¿˜æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿ(è¿˜æœªè¿›è¡Œæ ¼å¼åŒ–)ï¼Œä¸æ˜¯ç®€å•çš„æ ¼å¼åŒ–ï¼Œè€Œæ˜¯æ ¼å¼åŒ–åå¹¶è¿›å»ï¼Œå…¶å®ç¡®å®æ˜¯ä¸€ä¸ªå‘½ä»¤å°±åŒæ­¥äº†ï¼Œä¹Ÿç®—æ˜¯ç¬¼ç»Ÿçš„åˆ·æ–°äº†ã€‚

![image-20220311102252027](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311102252027.png)

dfçœ‹åˆ°çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ã€‚

ç°åœ¨å°±æ˜¯è¦å°†æ‰©å±•çš„6gç©ºé—´çš„æ–‡ä»¶ç³»ç»ŸåŒæ­¥åˆ°æ—¢æœ‰çš„8gç©ºé—´é‡Œå»ï¼Œä¸æ˜¯ç®€å•çš„mkfs.xfså“¦ã€‚

![image-20220311102550800](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311102550800.png)

ğŸ‘†å¯è§data blocks å˜å¤§äº†ã€‚æ­¤æ—¶df -Tå†çœ‹æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°å°±æ‰©ä¸Šå»äº†ğŸ‘‡

![image-20220311102839875](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311102839875.png)

## æ€»ç»“ä¸‹æ‰©å±•å…¶å®å°±ä¸¤æ¡å‘½ä»¤ï¼ˆåœ¨vgå·ç»„æœ‰ç©ºé—²ç©ºé—´çš„æ—¶å€™ï¼‰

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311103502729.png" alt="image-20220311103502729" style="zoom:67%;" /> 

è€Œç”¨æˆ·æ˜¯æ— æ„Ÿçš„ï¼Œæ‰©å±•çš„çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å–æ¶ˆæŒ‚è½½ï¼Œä¸€ç›´éƒ½æ˜¯æŒ‚ç€çš„ã€‚

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311103618179.png" alt="image-20220311103618179" style="zoom: 80%;" /> 

å†æ¥çœ‹çœ‹æˆ‘çš„centos8çš„é»˜è®¤å°±æ˜¯ä½¿ç”¨çš„é€»è¾‘å·çš„

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311103832336.png" alt="image-20220311103832336" style="zoom:60%;" /> 





## vgæ²¡æœ‰ç©ºé—²ç©ºé—´çš„æ‰©å®¹æ­¥éª¤

![image-20220311110529213](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311110529213.png)

æ­¤æ—¶è¦æ‰©vg0-mysqlï¼Œä½†æ˜¯vg0å·²ç»æ²¡ç©ºé—´äº†æ€ä¹ˆåŠã€‚å°±å†åŠ ä¸€å—æ–°ç¡¬ç›˜ã€‚

### â‘ pvcreate

![image-20220311112638903](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311112638903.png)

åªæœ‰åˆ†åŒºæ‰è¦åŠ æ ‡ç­¾8eï¼Œç¡¬ç›˜æ— éœ€æ”¹

pvcreateåå†blkidå°±çœ‹åˆ°äº†ï¼Œå°±å’Œmkfs.xfs æ ¼å¼åŒ–åå°±çœ‹åˆ°äº†ä¸€æ ·ï¼Œblkidæ˜¯çœ‹å¸¦æ–‡ä»¶ç³»ç»Ÿçš„å—ä¿¡æ¯çš„

![image-20220311112833046](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311112833046.png)

æ­¤æ—¶pvså°±èƒ½çœ‹åˆ°å¤šäº†ä¸ª20gçš„pv

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311112913120.png" alt="image-20220311112913120" style="zoom:80%;" /> 

### â‘¡vgextendæ‰©å±•å·ç»„

![image-20220311113305803](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311113305803.png)

ä¸Šå›¾å¯è§ç°åœ¨vg0æœ‰ä¸¤ä¸ªæˆå‘˜Cur PV 2ï¼Œå†åŠ ä¸€ä¸ªã€‚

vgextend vg0 /dev/sdc

![image-20220311113502324](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311113502324.png)

![image-20220311113528465](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311113528465.png) 

æ­¤æ—¶å·ç»„å°±åˆæœ‰ç©ºé—²ç©ºé—´äº†ï¼Œæ‰©å±•å°±ä¸€æ ·äº†ã€‚è¿˜æ˜¯ä¸¤æ¡å‘½ä»¤çš„äº‹ï¼Œå¯è§æ‰©å±•lvmç¡®å®æ— éœ€å–æ¶ˆæŒ‚è½½ã€‚





## åŒä¸€ä¸ªå·ç»„é‡Œåˆ›å»ºæ–°çš„é€»è¾‘å·

![image-20220311114243756](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311114243756.png)

å†åé¢å­¦ä¹ ä¸­å¯ä»¥æŠŠmysqlçš„æ—¥å¿—æ”¾åˆ°ä¸“é—¨çš„é€»è¾‘å·æˆ–åˆ†åŒºä¸­ï¼Œè¿™é‡Œå°±ä¸“é—¨åˆ›å»ºä¸€ä¸ªbinlogçš„lvm

### â‘ lvs,lvcreate -n binlog -L 10G vg0

![image-20220311114500508](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311114500508.png)

lvdisplayå°±å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªlväº†

![image-20220311114627709](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311114627709.png)

### â‘¡mkfs.ext4 /dev/vg0/binlog

æ ¼å¼åŒ–é€»è¾‘å·ä¸ºext4

![image-20220311114714483](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311114714483.png)

### â‘¢æŒ‚è½½

![image-20220311114842271](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311114842271-16469705225081.png)

æ­¤å¤„çœç•¥äº†æŒç»­æŒ‚è½½fstabçš„ç¼–å†™ï¼Œä¸Šæ–‡æœ‰çš„ã€‚



![image-20220311114952277](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311114952277.png)

é’ˆå¯¹binglogé€»è¾‘å·æ‰©å®¹ï¼Œ-l +1000ä¸ªpe ä¸€ä¸ªpe4MB

![image-20220311115116343](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311115116343.png)

æ­¤æ—¶é€»è¾‘å·ç¡®å®æ‰©å±•äº†

![image-20220311115137918](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311115137918.png)

ç”±äºå¢åŠ çš„éƒ¨åˆ†æ²¡æœ‰æ ¼å¼åŒ–ï¼Œä¹Ÿæ²¡æœ‰åŠ å…¥è¿›å½“å‰çš„binlogæ–‡ä¸€ä¸ªæ•´ä½“ï¼Œæ‰€ä»¥

![image-20220311115328243](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311115328243.png)

åˆšæ‰xfsæ–‡ä»¶ç³»ç»Ÿç”¨çš„æ˜¯xfs_growfs /mnt/mysqlï¼Œç°åœ¨ext4å¾—ç”¨resize2fs /dev/vg0/binlogï¼Œå‰è€…è·Ÿçš„æ˜¯æŒ‚è½½ç‚¹(æ–‡ä»¶å¤¹)ï¼›åè€…è·Ÿçš„æ˜¯è®¾å¤‡åã€‚æ³¨æ„ä¸‹

æ­¤æ—¶å°±æˆåŠŸäº†

![image-20220311115630249](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311115630249.png)



ç”±äºæ–‡ä»¶ç³»ç»Ÿçš„ä¸åŒï¼Œæœ€ååŒæ­¥çš„å‘½ä»¤ä¸åŒï¼Œåé¢è·Ÿçš„éƒ¨åˆ†ä¹Ÿä¸åŒï¼Œæ‰€ä»¥è‡ªåŠ¨åŒ–è„šæœ¬å°±æœ‰ç‚¹éº»çƒ¦ï¼Œæ‰€ä»¥æœ‰æ›´å¥½çš„æ‰©å±•æ–¹æ³•æ¥äº†



## ä¸ç®¡æ˜¯xfsè¿˜æ˜¯ext4éƒ½ä¸€æ¡å‘½ä»¤æ‰©

lvextend -r -l +500 /dev/vg0/binlog

![image-20220311115817371](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311115817371.png)

![image-20220311115938993](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311115938993.png)

ç¿»çœ‹å‰æ–‡å¯çŸ¥åˆšæ‰mysqlè¿™ä¸ªlvmæ˜¯14Gï¼Œç°åœ¨æ‰©äº†500ä¸ªPEï¼Œä¸€ä¸ªPEæ˜¯4MBï¼Œä¹Ÿå°±æ˜¯æ‰©äº†2Gï¼Œè¾¾åˆ°äº†16Gã€‚

ä¸Šmysqlæ˜¯xfsï¼Œä¸‹mainç»§ç»­binlogæ˜¯ext4çš„ä¹Ÿç”¨è¿™ä¸€æ¡æå®š

![image-20220311120125689](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311120125689.png)

ä¸€æ ·æˆåŠŸäº†

![image-20220311120206833](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311120206833.png)



æ­¤æ—¶å°±å‘ç°ä¸Šé¢çš„åŒæ­¥å‘½ä»¤ç™½å­¦äº†ï¼Ÿä¸æ˜¯

![image-20220311120409900](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311120409900.png)

xfs_growfs æŒ‚è½½ç‚¹    --- è¿™ä¸ªæ˜¯æ‰©å±•ç”¨çš„

resize2fs  è®¾å¤‡   --- è¿™ä¸ªæ‰©å±•å’Œç¼©å‡ éƒ½è¡Œ

lvextend -r -l +500 /dev/vg0/binlog è¿™ä¸ªå°±æ˜¯æ‰©å±•lvmçš„æ—¶å€™è‡ªåŠ¨åŒæ­¥äº†ã€‚

æ‰€ä»¥resize2fsåé¢ç¼©å‡è¿˜è¦ç”¨å¾—åˆ°ã€‚ç®—ä¸ä¸Šç™½å­¦~

å…¶å®é€šè¿‡man lvextendå¯è§ å…¶å®-r å°±æ˜¯resizefsï¼Œå“ˆå“ˆ~

![image-20220311120609439](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311120609439.png)



ç¼©å‡æœ‰é£é™©çš„ï¼Œå¦‚æœä¸€ä¸å°å¿ƒå†™é”™äº†--å†™æˆç¼©å‡åˆ°50Gï¼Œè€Œæ­¤æ—¶æ•°æ®å°±æ˜¯100Gï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ•°æ®ä¸¢å¤±50G~ã€‚



ä»¥é˜²å·¥ä½œä¸­ç”¨ï¼Œè¿˜æ˜¯è¦å­¦ä¸€ä¸‹



## ç¼©å‡

![image-20220311121219087](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311121219087.png)

ç¼©å‡ä¸Šå›¾ext4çš„è¿™ä¸ªlvmç©ºé—´

### æ‰©å±•æ˜¯åœ¨çº¿æ‰©å±•ï¼Œç¼©å‡å¿…é¡»ç¦»çº¿ç¼©å‡ï¼Œæ„å‘³ç€å–æ¶ˆæŒ‚è½½ï¼Œç”¨æˆ·è®¿é—®å—å½±å“äº†ã€‚

### â‘ unmount /mnt/binlog

![image-20220311121541100](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311121541100.png)

å›æƒ³æ‰©å±•çš„æ—¶å€™ä¸ç®¡æ˜¯2æ¡å‘½ä»¤è¿˜æ˜¯1æ¡å‘½ä»¤ï¼Œåº•å±‚é€»è¾‘éƒ½æ˜¯å…ˆæ‰©å±•lvmï¼Œå†åŒæ­¥æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ

![image-20220311121719401](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311121719401.png)

ç°åœ¨ç¼©å‡çš„æ—¶å€™å°±æ˜¯å…ˆç¼©å‡æ–‡ä»¶ç³»ç»Ÿï¼Œå†ç¼©å‡é€»è¾‘å·å¤§å°ã€‚

ç¼©å‡å‰çš„lvmå¤§å°å¦‚ä¸‹15.86Gï¼š

![image-20220311142400351](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311142400351.png)

resize2fs /dev/vg0/binlog 10G  # ç¼©å‡åˆ°10G

æ³¨æ„è¿™ä¸ªå‘½ä»¤â‘ åŒæ­¥çš„å‘½ä»¤(åŒæ­¥çš„å‘½ä»¤å…¶å®å°±æ˜¯å°†lvmæ‰©å±•åçš„ç©ºé—´ï¼Œå†æ‰©å±•åˆ°æ–‡ä»¶ç³»ç»Ÿé‡Œå»ï¼Œè¿™ä¸ªåœºæ™¯å…¶å®å°±æ˜¯ä¸å†™å¤šå°‘ä¸ªGå°±æ˜¯å…¨éƒ¨æ‰©å±•è¿›å»ï¼Œå…¶å®ä½ çš„éœ€æ±‚å°±æ˜¯lvmæ‰©å±•åï¼Œå†åŒæ­¥åˆ°æ–‡ä»¶ç³»ç»Ÿé‡Œï¼Œè‡ªç„¶æ˜¯å…¨éƒ¨äº†)â‘¡ç¼©å‡çš„å‘½ä»¤ï¼Œåœ¨åé¢è·Ÿä¸Šç©ºé—´å³å¯è¡¨è¾¾ç¼©å‡åˆ°XXGã€‚

ç¼©å‡çš„æ—¶å€™ä¼šæç¤ºä½ å…ˆæ£€æŸ¥ä¸€éç³»ç»Ÿå®Œæ•´æ€§ï¼Œå†è®©ä½ ç¼©å‡ã€‚

### â‘¡e2fsckæ£€æŸ¥ä¸‹å®Œæ•´æ€§ä¹‹ç±»çš„ã€â‘¢resizeç¼©å‡æ–‡ä»¶ç³»ç»Ÿ

![image-20220311143041494](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311143041494.png)

æ­¤æ—¶ç”±äºæ˜¯resizefs ç¼©å‡çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥lvmè¿˜æ²¡æœ‰ç¼©ï¼Œé€šè¿‡lvså¯è§å¤§å°æ²¡å˜ï¼›ç„¶åå¼€å§‹ç¼©å‡lvm:lvreduce -L 10G /dev/vg0/binlog

### â‘£ç¼©å‡lvm

![image-20220311150831265](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311150831265.png)

-L 10Gï¼Œä¸å¸¦+åŠ å·çš„å°±æ˜¯ç›´æ¥ç¼©å‡åˆ°10Gã€‚man lvextendå¯è§ğŸ‘‡

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311150905713.png" alt="image-20220311150905713" style="zoom: 67%;" />

### â‘¤mountï¼Œç¼©å®Œåé‡æ–°æŒ‚è½½

![image-20220311151012598](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311151012598.png)

### æ³¨æ„ç¼©å‡åªèƒ½ç¼©å‡extçš„ï¼Œä¸èƒ½ç¼©å‡xfsçš„ã€‚

![image-20220311151445033](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311151445033.png)

ä¸Šå›¾å‘½ä»¤è¡¥é½ä¹Ÿå¯è§ä¸€æ–‘ï¼Œåªæœ‰growï¼Œæ²¡æœ‰reduce resizeè¿™äº›è¡¥é½å‘½ä»¤å‡ºç°ã€‚

æ‰€ä»¥â–²xfså“ªé‡Œæ¯”extå¥½äº†ã€‚



## é€»è¾‘å·çš„è¿ç§»

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311152143176.png" alt="image-20220311152143176" style="zoom:67%;" />

### è¿ç§»æ“ä½œä¸¾ä¾‹

![image-20220311152836602](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311152836602.png)

æ‹¿è¿™ä¸ªbç¡¬ç›˜åšå®éªŒï¼Œçœ‹ä¸‹sdb1æœ‰æ²¡æœ‰ç”¨ï¼Œå°±æ˜¯æœ‰æ— æŒ‚è½½å’¯

![image-20220311153331625](C:/Users/MingYi/Desktop/image-20220311153331625.png)

å½“æ—¶åšå®éªŒçš„ï¼Œsdb1æŠ¥é”™ï¼Œè‚¯å®šæ˜¯fstabé‡Œå†™ä¸œè¥¿äº†ï¼Œ

![image-20220311153421435](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311153421435.png)

åˆ æ‰

dd å¹²æ‰åˆ†åŒºæ¸…ä¸€ä¸‹

![image-20220311153514214](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311153514214.png)

å‘ç°ä¸Šå›¾ddæ‰512Båï¼Œåˆ†åŒºsdb1è¿˜åœ¨ï¼Œé‚£æ˜¯å› ä¸ºæ²¡æœ‰åŒæ­¥

partx -d --nr 1 /dev/sdb  # ä¸èƒ½ç”¨-aï¼Œ-aæ˜¯å¢åŠ ï¼Œ-dæ˜¯åˆ é™¤

![image-20220311153610980](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311153610980.png)

æ³¨æ„æç¤ºsdbå¿™

å†æ¬¡df å‘ç°ä¹‹å‰fstabé‡Œå·²ç»åˆ æ‰äº†æŒç»­æŒ‚è½½å“ªä¸€è¡Œï¼Œç°åœ¨è¿˜æ˜¯æœ‰ç±»ä¼¼çš„æŠ¥é”™--åºŸè¯ä½ åˆ æ‰çš„æ˜¯moutçš„é…ç½®æ–‡ä»¶ï¼Œæœ‰æ²¡æœ‰å–æ¶ˆæŒ‚è½½ï¼Œç°åœ¨çš„dfæŠ¥é”™å°±æ˜¯ä¹‹å‰mountè¿‡--é€šè¿‡mountå¯è§--ç„¶åæŒ‚è½½ç‚¹ä¼°è®¡æ˜¯åˆ æ‰äº†è¢«ï¼Œç°åœ¨dfæŠ¥é”™äº†ã€‚é€šè¿‡mountçœ‹å‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼Œ

![image-20220311155202139](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311155202139.png)

è§†é¢‘ä¸­è€å¸ˆçš„æ’é”™æ€è·¯çœ‹ä¸‹

![image-20220311155405631](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311155405631.png)

çœ‹åˆ°è¯´æ˜æ²¡æœ‰å–æ¶ˆæŒ‚è½½

![image-20220311155524128](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311155524128.png)

![image-20220311155756959](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311155756959.png)

![image-20220311155825696](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311155825696-16469855059612.png)

å“ˆå“ˆï¼Œè¿˜æ˜¯åœ¨ï¼Œæˆ‘æ‰æ˜¯ä¸æ˜¯dd 512å¯¼è‡´çš„ï¼Œè¿˜æ²¡æœ‰å–æ¶ˆæŒ‚è½½å°±ddå¯¼è‡´çš„ï¼Ÿ

![image-20220311155925183](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311155925183.png)

é€šè¿‡fuser -v /mnt/sdb1ä¹Ÿæ²¡æœ‰äººç”¨å•Šï¼Œè¿™ä¼šumountæ²¡æŠ¥é”™ï¼Œlsblkä¹Ÿçœ‹åˆ°æ²¡æœ‰æŒ‚è½½äº†ã€‚

å–æ¶ˆæŒ‚åœ¨åï¼Œå†åŒæ­¥ä¸€ä¸‹ï¼Œæ­¤æ—¶åˆ†åŒºsdb1å°±æ²¡äº†

![image-20220311160101317](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311160101317.png)

é‚£ä¸Šé¢è¿‡ç¨‹æ€»ç»“ï¼Œâ‘ æŒ‚è½½æ²¡æœ‰unmountâ‘¡unmoutéœ€è¦æ—¶é—´â‘¢å¥½åƒæ˜¯/mnt/sdb1å…ˆæŒ‚ï¼Œ/mntåæŒ‚ï¼Œè¿™ä¸€ç±»ä¹Ÿæœ‰é—®é¢˜ã€‚



ä¸‹é¢å¼€å§‹é’ˆå¯¹sdbåˆ›å»ºlvmï¼Œç„¶åæ¼”ç¤ºlvmçš„è¿ç§»

å…ˆåˆ›å»ºä¸€ä¸ªå’Œå°†æ¥å·²å·²è¿‡å» åå­— å­˜åœ¨å†²çªçš„vg0å’Œmysqlé€»è¾‘å·

ä¸‹å›¾ğŸ‘‡åˆ›å»ºç‰©ç†å·ã€åˆ›å»ºå·ç»„å¹¶æŒ‡å®šPEã€åˆ›å»ºé€»è¾‘å·æŒ‡åå’ŒæŒ‡å¤§å°å’Œæ‰€å±å·ç»„ã€‚

![image-20220311160731815](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311160731815.png)

æŒ‚è½½

![image-20220311161231403](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161231403.png)

å¤åˆ¶ç‚¹æ–‡ä»¶è¿‡å»

![image-20220311161251586](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161251586.png) 

å¥½äº† LVMå°±æœ‰äº†

![image-20220311161338499](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161338499.png)



ä¸‹é¢è¿›è¡Œè¿ç§»

### å…ˆå–æ¶ˆæŒ‚è½½

![image-20220311161428920](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161428920.png)

è€ƒè™‘åˆ°è¿è¿‡å»çš„å·ç»„ä¹Ÿå«vg0ï¼Œlvmä¹Ÿå«mysqlï¼Œåªè¦vg0æ”¹äº†å°±è¡Œäº†ï¼Œå› ä¸ºæ•´ä½“åç§°vg1-mysqlè¿‡å»å°±å’Œvg0-mysql ä¸ å†²çªäº†

### æ”¹å

![image-20220311161701166](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161701166.png)

![image-20220311161714250](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161714250.png)

![image-20220311161729993](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161729993.png)

### ç¦ç”¨å·ç»„

![image-20220311161826318](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161826318.png)

å·ç»„ç¦ç”¨åï¼Œæ‰€æœ‰çš„é€»è¾‘å·ä¹Ÿå°±ç¦ç”¨äº†ï¼š

![image-20220311161928895](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311161928895.png)

### å¯¼å‡ºvg1

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220311162052695.png" alt="image-20220311162052695" style="zoom:80%;" /> 

![image-20220311162110897](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311162110897.png) 

![image-20220311162139589](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311162139589.png)

### æ‹†ç¡¬ç›˜ã€æ’ç¡¬ç›˜ã€è¯†åˆ«ç¡¬ç›˜

æ­£å¸¸æœåŠ¡å™¨å°±ç›´æ¥æ‹”ï¼Œè¿™é‡Œå®éªŒç”¨çš„æ˜¯Vmwareå·¥ä½œç«™ï¼Œå…ˆå…³æœº

æ˜¯sdbç¡¬ç›˜è¦è¿ç§»

![image-20220311160101317](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311160101317.png)

![image-20220311162433141](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311162433141.png)

è¿™å°±æ˜¯ç¡¬ç›˜å•¦ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°centos7çš„è™šæ‹Ÿæœºä¸Šå»

![image-20220311163553836](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311163553836.png)

ç§»åŠ¨ç¡¬ç›˜å˜›ï¼Œå°±æ˜¯å‰ªåˆ‡è¿‡å»

![image-20220311163733034](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311163733034.png)



å†centos7ä¸ŠåŠ ç¡¬ç›˜ä¹‹å‰çœ‹ä¸‹ å½“å‰ç¡¬ç›˜æ’å·å·²ç»åˆ°däº†

![image-20220311163829140](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311163829140.png)



![image-20220311163937866](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311163937866.png)

![image-20220311164030382](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164030382.png)

![image-20220311164044642](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164044642.png)

å®Œæˆ

![image-20220311164146870](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164146870.png)

ä¸ä¼šè‡ªåŠ¨è¯†åˆ«ï¼Œecho - - - ä¸€ä¸‹

![image-20220311164215418](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164215418.png)

![image-20220311164319976](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164319976.png)

å‡ºæ¥æ˜¯å‡ºæ¥äº†ï¼Œä½†æ˜¯è¿™è¾¹çš„ç³»ç»Ÿè¿˜ä¸èƒ½è¯†åˆ«å…¶ä¸Šçš„LVM

lsblkçœ‹ä¸åˆ°æ²¡å…³ç³»ï¼Œä½¿ç”¨vgdisplayå¯ä»¥çœ‹åˆ°

![image-20220311164515222](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164515222.png)

ä¸Šå›¾ğŸ‘†å¯è§æ­¤æ—¶vg1å·ç»„æ˜¯å‡ºäºexportedå¯¼å‡ºçŠ¶æ€

### å¯¼å…¥å·ç»„

ä½¿ç”¨vgimport vg1å¯¼å…¥

![image-20220311164811340](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164811340.png)

æ­¤æ—¶çŠ¶æ€OK

![image-20220311164848164](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311164848164.png)

é€šè¿‡lvdisplayå¯è§2ä¸ªå·ç»„

![image-20220311165010563](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311165010563.png)

æ³¨æ„ä¸Šå›¾çš„not available

### å¯ç”¨é€»è¾‘å·vg1

![image-20220311165301168](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311165301168.png)

å¯ç”¨åå†çœ‹

![image-20220311165328333](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311165328333.png)

å°±æ­£å¸¸äº†ï¼Œlvmæœ‰äº†ï¼Œå°±å¯ä»¥æŒ‚è½½äº†

### æŒ‚è½½

![image-20220311165442106](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311165442106.png)

æ­¤æ—¶æ•°æ®å°±éƒ½è¿‡æ¥äº†

![image-20220311165453850](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311165453850.png)

![image-20220311165905340](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311165905340.png)

ä»¥ä¸Šè®²è§£äº†lvmçš„åˆ›å»ºã€æ‰©å±•ã€ç¼©å‡ã€è¿ç§»



## ä¸‹é¢æ¥ä¸ªä¾‹å­

![image-20220311170003829](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311170003829.png)

å‡è®¾sddè¿™å—ç¡¬ç›˜ æŒ‡ç¤ºç¯å¼€å§‹é»„ç¯ è¡¨ç¤ºå¿«åäº†ï¼Œè¿˜æ²¡çº¢ï¼Œä½†æ˜¯è¦åäº†ã€‚

æ­¤æ—¶éœ€è¦æŠŠè¿™ä¸ªå—ç¡¬ç›˜å‰”é™¤ä¸‹æ¥ï¼Œé—®é¢˜æ˜¯å…¶ä¸Šæœ‰é€»è¾‘å·ï¼Œä¸èƒ½ç›´æ¥æ‹”ã€‚

é—®ï¼Œæ€ä¹ˆæ‹†èµ°è¿™ä¸ªå—è¦åçš„ç¡¬ç›˜

![image-20220311170337004](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311170337004.png)

è¡¨ç¤ºsddè¿™ä¸ªç‰©ç†å·å·²ç»è¢«åˆ«çš„é€»è¾‘å·ç»™å ç”¨äº†å·²ç»ã€‚

è¦æƒ³æ‹†èµ°è¿™ä¸ªsddï¼Œå¿…é¡»å…ˆæŠŠå…¶ä¸Šçš„2559ä¸ªPEçš„æ•°æ®æ¬åˆ°åŒä¸€ä¸ªå·ç»„vg0ä¸‹çš„å…¶ä»–é€»è¾‘å·ä¸Šï¼Œå¿…é¡»æ˜¯åŒä¸€ä¸ªå·ç»„ã€‚

ä½†æ˜¯ vg0 å‘ç°åªæœ‰2059ä¸ªPEç©ºé—²

![image-20220311171137056](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311171137056.png)

1ã€åªèƒ½åŠ ä¸ªPVäº†ï¼Œä¸ºå•¥ä¸€å®šè¦åŒä¸€ä¸ªå·ç»„å‘¢ï¼Ÿå› ä¸ºæ‰€è°“æ¬å®¶ä½¿ç”¨çš„æ˜¯pvmoveå‘½ä»¤ï¼Œä¼°è®¡è¿™ä¸ªå‘½ä»¤éœ€è¦åŒä¸€ä¸ªå·ç»„ã€‚

2ã€å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç¼©ä¸€ä¸‹ï¼Œç„¶åå†æ¬å®¶ã€‚



è¿™é‡Œè¿˜æ²¡æœ‰åŠ PVï¼Œvg0çš„æ‰€å‰©ç©ºé—´å¹¶ä¸å¤Ÿï¼Œåªæ˜¯æ¼”ç¤ºä¸€ä¸‹ï¼š

![image-20220311171639153](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311171639153.png)

è¿™æ˜¯æŠŠsddä¸Šè¢«å ç”¨çš„PEæ¬å®¶åˆ°åŒä¸€ä¸ªvg0ä¸‹çš„å…¶ä»–ç©ºé—²PEä¸Šå»ï¼Œå‰ææ˜¯ç©ºé—²PEæ•°å¤§äºå ç”¨PEæ•°ã€‚

![image-20220311171844242](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311171844242.png)

æœ‰ä¸ªé—®é¢˜å•Šï¼Œæ¬å®¶æ˜¯æ¬åˆ°å…¶ä»–ç©ºé—²PEæ˜¯å§ï¼Œå…¶ä»–ç©ºé—²PEæ˜¯å¦åˆ†æ•£åœ¨ä¸åŒçš„å‡ ä¸ªLVMä¸Šå‘¢ï¼Œè¿™æ ·æ–‡ä»¶åˆè¯¥æ€ä¹ˆç´¢å¼•æ‰¾åˆ°å‘¢ï¼Œéš¾é“åŸæ¥ä¸€ç›®å½•ä¸‹çš„åˆ†æ•£åˆ°å¥½å‡ ä¸ªç›®å½•ä¸‹äº†ï¼Ÿæ˜¾ç„¶ä¸å¯èƒ½è¿™ä¹ˆç©å•Šã€‚

![image-20220311172221596](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311172221596.png)

å®é™…ä¸Šæ•°æ®æ²¡å¤šå°‘ï¼Œä½†æ˜¯æ¬å®¶æ¬çš„æ˜¯ç©ºé—´ï¼Œç¡¬ç›˜æ‹†èµ°ï¼Œç¡¬ç›˜å…¶ä¸Šå¾—lvmå½“åˆæ‰¿è¯ºå‡ºå»çš„ç©ºé—´æ˜¯16Gçš„9.8Gï¼Œç°åœ¨sddä¸€æ‹†ï¼Œæ‰¿è¯ºå‡ºå»çš„2559ä¸ªPEå·®ä¸å¤š10Gçš„æ‰¿è¯ºç©ºé—´å°±æ²¡äº†ã€‚

å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç¼©ä¸€ä¸‹ï¼Œç„¶åå†æ¬å®¶ã€‚



ç¼©çš„é—®é¢˜ä¹Ÿæ¥äº†

![image-20220311172607384](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311172607384.png)

ä¸çŸ¥é“è¿™2559ä¸ªPEåˆ°åº•æ˜¯å“ªä¸ªLVMå ç”¨çš„ã€‚

é€šè¿‡lsblkæŸ¥çœ‹

![image-20220311172702466](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311172702466.png)

å¯çŸ¥æ˜¯vg0-mysqlé€»è¾‘å·å ç”¨äº†sddçš„å…¨éƒ¨PEï¼Œè€Œä¸”vg-mysqlè¿˜å ç”¨äº†sdcçš„PE

åªè¦æŠŠvg0-mysqlçš„å®¹é‡å˜å°ï¼Œå°±å¯ä»¥æ¬å®¶äº†

æ­¤æ—¶vg0-mysql lvmæ‰ç”¨äº†å¾ˆå°‘ï¼š

![image-20220311172841030](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311172841030.png)

å†è¿›ä¸€æ­¥å‘ç°ï¼Œæœ€ç»ˆè¿˜æ˜¯ç¼©ä¸äº†

![image-20220311172927226](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311172927226.png)

åªèƒ½åŠ ç¡¬ç›˜äº†



æŠŠsdeå‰©ä¸‹çš„18Gç©ºé—´åŠ åˆ°vg0é‡Œé¢

![image-20220311173114959](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311173114959.png)

ä¸éœ€è¦å¤ªå¤šï¼ŒğŸ‘‡åªéœ€è¦500ä¸ªPEï¼Œä¹Ÿå°±æ˜¯2Gçš„å¤§å°ã€‚

![image-20220311173145672](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311173145672.png)

ç„¶å...ğŸ‘‡

![image-20220311173250992](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311173250992-16469911712233.png)

å‘ç°æ•´ä¸ªsdeéƒ½åœ¨vg1é‡Œäº†ï¼Œæ²¡åŠæ³•ç»™éƒ½vg0äº†ã€‚



é‡æ–°å¼„ä¸ªåˆ†åŒºæ¥åšå§

![image-20220311173712793](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311173712793.png) 

ä»¥ä¸Šåˆ†æå°±æ˜¯å…³é”®æ€è·¯

![image-20220311173859478](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311173859478.png)

![image-20220311173922961](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311173922961.png)

![image-20220311174221723](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174221723.png)

![image-20220311174239205](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174239205.png)

![image-20220311174255405](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174255405.png)

![image-20220311174303319](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174303319.png)

![image-20220311174328084](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174328084.png)

æ³¨æ„æ­¤æ—¶blkidè¿˜æ²¡æœ‰å‘¢ï¼Œéœ€è¦pvcreateåæ‰æœ‰

![image-20220311174433102](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174433102.png)

![image-20220311174619431](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174619431.png)

pvcreateåblkidå°±çœ‹åˆ°äº†

![image-20220311174703173](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174703173.png)

åŠ PVå°±æ˜¯è´´æ ‡ç­¾



åŠ åˆ°vg0å·ç»„é‡Œ

![image-20220311174923126](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174923126.png)

![image-20220311174850307](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174850307.png)

![image-20220311174956485](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311174956485.png)

è‡³æ­¤vg0çš„å®¹é‡å°±æ‰©ä¸Šå»ï¼Œå‰©ä¸‹3338ä¸ªPEï¼Œsddçš„2559ä¸ªPEå°±å¯ä»¥æ¬å®¶äº†

![image-20220311175043873](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311175043873.png)

![image-20220311175549591](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311175549591.png)

æ­¤æ—¶sddçš„PEä»¬å°±æ¬å®¶åˆ°åŒä¸€ä¸ªå·ç»„vg0ä¸‹çš„å…¶ä»–PVä¸Šå»äº†ï¼Œè‡³äºæ˜¯å“ªäº›PVä¸å…³å¿ƒï¼Œåæ­£æœ‰åœ°æ–¹ï¼Œæœ‰æ–‡ä»¶å¤¹å…¥å£è®¿é—®å°±è¡Œäº†ã€‚

æ³¨æ„æ¬çš„æ˜¯ç©ºé—´ï¼Œä¸æ˜¯æ•°æ®ï¼Œç©ºé—´è¿‡å»äº†æ•°æ®è‡ªç„¶ä¹Ÿè¿‡å»ã€‚

![image-20220311175738085](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311175738085.png) 



åˆšæ‰çš„sdb3çš„5ä¸ªGç©ºé—´ç”¨å®Œäº†ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–çš„PVä¹Ÿä¼šåˆ†æ‹…ä¸€éƒ¨åˆ†sddçš„ç©ºé—´

![image-20220311175844554](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311175844554.png)

sddä¸Šçš„ç©ºé—´å°±æ¬èµ°äº†

![image-20220311180128713](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180128713.png)



æ­¤æ—¶sddä¸Šæ—¢ç„¶æ²¡æœ‰æ•°æ®äº†ï¼Œå°±å¯ä»¥è€ƒè™‘ç§»é™¤äº†

å½“å‰vg0é‡Œ4ä¸ªPVï¼Œè®¡åˆ’åˆ é™¤sddè¿™ä¸ªå·²è¿‘æ¬å®Œç©ºé—´çš„PV

![image-20220311180256475](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180256475.png)



![image-20220311180345582](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180345582.png) 



![image-20220311180418473](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180418473.png)

å˜æˆ3ä¸ªäº†

![image-20220311180502346](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180502346.png)

æ­¤æ—¶/sddå°±ä¸å±äºä»»ä½•å·ç»„äº†ã€‚

ç„¶åå†åˆ é™¤sddçš„PV--ç‰©ç†å·  æ ‡ç­¾

![image-20220311180556607](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180556607.png)

![image-20220311180631302](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180631302.png) 

sddå°±æ²¡æœ‰äº†

![image-20220311180647337](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180647337.png)

æ­¤æ—¶sddå°±æ˜¯ä¸€ä¸ªå®Œå…¨å’Œé€»è¾‘å·æ²¡æœ‰å…³ç³»çš„ç¡¬ç›˜äº†

å°±å¯ä»¥æ‹”äº†~



ä¸Šé¢çš„åˆ†æè¾ƒå¤šï¼ŒæŸ¥çœ‹è¾ƒå¤šï¼ŒçœŸæ­£çš„å‘½ä»¤å°±3æ¡--å½“ç„¶å‰ææ˜¯ç©ºé—´å¤Ÿ

![image-20220311180954696](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311180954696.png) 

æ³¨æ„ï¼Œä»å¤´åˆ°ä½éƒ½æ˜¯åœ¨çº¿æ“ä½œï¼Œæ²¡æœ‰å–æ¶ˆæŒ‚è½½ã€‚



æ‰©å±•ã€ç¼©å‡ã€è¿ç§»ã€æ‹†é™¤ éƒ½è®²äº†



## LVMçš„åˆ é™¤



æŸä¸ªvgçš„æ‰€æœ‰lvméƒ½ä¸è¦äº†

![image-20220311181552668](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311181552668.png)

### â‘ å–æ¶ˆæŒ‚è½½

![image-20220311181651534](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311181651534.png)

å¦‚æœæ˜¯fstabé‡Œæœ‰å†™ï¼Œä¹Ÿè¦åˆ é™¤



### â‘¡åˆ lvm

åˆ ä¹‹å‰è¦ç¡®å®šä¸Šé¢çš„æ•°æ®ä¸è¦äº†

![image-20220311181758731](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311181758731.png)

![image-20220311181805509](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311181805509.png)

æ­¤æ—¶vg1é‡Œçš„ç©ºé—´å°±æ²¡äºº(lvm)ç”¨äº†

![image-20220311181828954](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311181828954.png)

vg1æ²¡äººç”¨äº†ä¹Ÿå¯åˆ äº†

### â‘¢åˆ vg

![image-20220311182211194](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311182211194.png) 

æ­¤æ—¶sdeè¿™ä¸ªpvå°±ä¸å±äºä»»ä½•vgäº†ï¼Œä¹Ÿå¯ä»¥åˆ è¿™ä¸ªPVäº†

![image-20220311182245067](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311182245067.png) 

åˆ PVä¹‹å‰blkidå¯è§æ ‡ç­¾ğŸ‘‡

![image-20220311182310023](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311182310023.png)

### â‘£åˆ PV

![image-20220311182345411](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311182345411.png)

æ­¤æ—¶sdeå†PVSä¸­ä¸å¯è§ï¼Œå°±æˆäº†ä¸€ä¸ªçº¯ç²¹ç¡¬ç›˜äº†

![image-20220311182429106](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311182429106.png)

ä¹Ÿå¯ä»¥æ‹”èµ°äº†ã€‚





![image-20220311182649198](9-LVMç®¡ç†è¯¦è§£.assets/image-20220311182649198.png)





## 3ã€å¿«ç…§ç®¡ç†

é€»è¾‘å·è¿˜æœ‰ä¸ªåŠŸèƒ½æ˜¯åˆ†åŒºåšä¸åˆ°çš„--å¿«ç…§

VMwareé‡Œçš„å¿«ç…§ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†



å·ç»„é‡Œåˆ›å»ºå¤šä¸ªlvmï¼Œ/dev/vg0/mysqlæ˜¯vg0é‡Œçš„ä¸€ä¸ªé€»è¾‘å·ã€‚500Gçš„æ•°æ®å¤‡ä»½æ—¶é—´å¾ˆé•¿äº†ï¼Œä½†æ˜¯å¿«ç…§å°±ç§’åšã€‚ä½ éœ€æ±‚ä¸æ˜¯å¤‡ä»½æ•°æ®ï¼Œåªæ˜¯èƒ½å¤Ÿå›åˆ°æŸä¸ªæ—¶é—´èŠ‚ç‚¹çš„æ•°æ®ï¼Œæ‰€ä»¥åªéœ€è¦é’ˆå¯¹å˜åŠ¨çš„æ•°æ®åšå¤‡ä»½å°±è¡Œäº†ã€‚



å‡è®¾å¾…ä¼šæœ‰100Gçš„æ•°æ®è¦äº§ç”Ÿä¿®æ”¹ï¼Œè¦æ˜¯ç›´æ¥å¤‡ä»½ç€500Gå¾ˆèŠ±æ—¶é—´ï¼Œæ‰€ä»¥åœ¨åŒä¸€ä¸ªå·ç»„VG0ä¸‹å†åˆ›å»ºä¸€ä¸ªé€»è¾‘å·--å¿«ç…§é€»è¾‘å·--mysql_snapshotï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸ªé€»è¾‘å·ï¼Œåªä¸è¿‡æ˜¯ä¸ªç‰¹æ®Šçš„é€»è¾‘å·ã€‚å› ä¸ºå‡è®¾æ˜¯å°†æ¥è¦æ”¹100Gçš„æ•°æ®ï¼Œæ‰€ä»¥åˆ›å»ºå¿«ç…§é€»è¾‘å·çš„æ—¶å€™å°±æŒ‡å®šåˆ›å»ºçš„ç©ºé—´ä¸º100Gã€‚æ‰€ä»¥å¿«ç…§é€»è¾‘å·çš„å¤§å°ä¸ç”¨å’Œæºé€»è¾‘å·çš„å¤§å°ä¸€æ ·ï¼Œè¿™ä¸ªè…¾è®¯äº‘ä¸Šå¥½åƒä¹Ÿæœ‰å»ºè®®å€¼ï¼Œä¸€åŠå§å¥½åƒã€‚

![image-20220314092140175](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314092140175.png)

å¿«ç…§çš„åŸç†ï¼ŒåŒºåˆ«äºæ™®é€š çš„å¤‡ä»½ï¼Œæ˜¯é’ˆå¯¹å˜åŠ¨çš„æ–‡ä»¶åšçš„å¤‡ä»½ï¼Œæ–‡ä»¶è¦ä¿®æ”¹å‰å…ˆå¤‡ä»½åˆ°å¿«ç…§é€»è¾‘å·é‡Œï¼Œæ‰€ä»¥æ€§èƒ½ä¼šæœ‰æ‰€ä¸‹é™ï¼Œä½†æ˜¯è¿˜åŸå¿«ï¼Œç©ºé—´å ç”¨å°ã€‚

1ã€å¿«ç…§çš„åˆ›å»ºçš„ç¬é—´ï¼Œå…¶å®åªæ˜¯åˆ†é…äº†XXXGçš„ç©ºé—´ï¼Œå¹¶æ²¡æœ‰å¤‡ä»½ä»»ä½•æ•°æ®ï¼Œ

2ã€åªæœ‰åé¢æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰ä¼šå¤‡ä»½ï¼Œ**æ‰€ä»¥æ€§èƒ½æ˜¯æœ‰æ‰€ä¸‹é™çš„**ã€‚

![image-20220314093606497](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314093606497.png)

åŒæ ·æ”¹F2ä¸ºF2'ï¼Œä¹Ÿä¼šå°†F2å¤åˆ¶è¿‡å»

3ã€åªè¦æ²¡æ”¹è¿‡çš„æ•°æ®éƒ½æ˜¯åœ¨åŸæ¥çš„é€»è¾‘å·é‡Œï¼Œåªè¦æ”¹è¿‡çš„éƒ½ä¼šåœ¨å¿«ç…§é‡Œå­˜åœ¨ä¸€ä»½ï¼Œå‡è®¾F3æ”¹äº†å¥½å¤šæ¬¡ï¼Œé—®ç¬¬ä¸€æ¬¡çš„æ”¹åŠ¨çš„ç‰ˆæœ¬åœ¨å“ªï¼Œä¸­é—´çš„Nå¤šç‰ˆæœ¬åœ¨å“ªï¼Œæœ€åä¸€æ¬¡çš„ç‰ˆæœ¬åœ¨å“ªï¼›è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œåªè¦æŠ“ä½å¿«ç…§çš„æœ¬è´¨ï¼Œå°±æ˜¯æ‹ç…§ç‰‡çš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡æ”¹åŠ¨çš„ç‰ˆæœ¬åœ¨å¿«ç…§é‡Œï¼Œä¸­é—´éƒ½æ²¡äº†ï¼Œæœ€åä¸€æ¬¡ç‰ˆæœ¬è¿˜æ˜¯åœ¨åŸæ¥çš„lvmé‡Œå’¯ã€‚**ä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼ŒF2ä¸€æ—¦æ”¹åŠ¨è¿‡ä¸€æ¬¡ï¼Œåé¢çš„å°±ä¸ä¼šå†æ¨é€åˆ°å¿«ç…§é€»è¾‘å·äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æ€§èƒ½å°±åˆå›å‡äº†**ï¼Œ**æ‰€ä»¥è¯´åªè¦æ‰€æœ‰å¯èƒ½å‘é€å˜åŠ¨çš„æ•°æ®éƒ½å˜è¿‡ä¸€æ¬¡åï¼Œå¿«ç…§çš„æ€§èƒ½å°±å›å‡äº†ã€‚**

**ä»ä½¿ç”¨å®é™…è§’åº¦æ¥è®²ï¼Œä¸å¯èƒ½æ‰€æœ‰æ–‡ä»¶éƒ½å˜è¿‡ä¸€æ¬¡ï¼Œæ€»æœ‰ç¬¬ä¸€æ¬¡å˜åŠ¨çš„æ—¶å€™ï¼Œæ‰€ä»¥å¿«ç…§ä½¿ç”¨å®Œå°±å¹²å‡€åˆ é™¤ï¼Œé˜²æ­¢æ€§èƒ½æŸå¤±**

4ã€å¿«ç…§çš„å‰ææ˜¯ ï¼Œå¿«ç…§å·å’Œéœ€è¦é•œåƒçš„å· å¿…é¡»åœ¨åŒä¸€ä¸ªå·ç»„ä¸­ã€‚

5ã€å¿«ç…§çš„ç©ºé—´ä¸€èˆ¬æ˜¯åŸlvmçš„ å¤šå°‘å‘¢ï¼Œåæ­£å¤§äºåŸæ¥å·æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚



### å¦‚ä½•å®ç°å¿«ç…§



ä¸¾ä¸ªä¾‹å­

![image-20220314111336067](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314111336067.png)

mysqlè¿™ä¸ªlvmç›®å‰æ˜¯16GBä¸åˆ°ï¼Œ

åˆ›å»ºå¿«ç…§é€»è¾‘å· è¦è€ƒè™‘å·ç»„é‡Œæœ‰æ²¡æœ‰å‰©ä½™ç©ºé—´

![image-20220314111429629](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314111429629.png)

å¼„ä¸‰ä¸ªå°æ–‡ä»¶åšå®éªŒ

![image-20220314111558610](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314111558610.png)

f1åˆ æ‰ å¿«ç…§é‡Œæ‰¾å›ï¼›f2ä¿®æ”¹ å¿«ç…§é‡Œæ‰¾å›ï¼›f3ä¸åŠ¨ å¿«ç…§é‡Œæ²¡æœ‰ã€‚

![image-20220314111958369](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314111958369.png)

```
-n mysql_snapshot èµ·ä¸ªåå­—

-s æŒ‡å®šä¸ºå¿«ç…§snaphostè€Œä¸æ˜¯æ™®é€šé€»è¾‘å·

-L 1G åšå®éªŒä¸è®²ç©¶äº†å°±ç»™äº†1Gï¼Œå› ä¸ºåŸlvmçš„å¤§å°è™½ç„¶æ˜¯16GBï¼Œä½†æ˜¯æµ‹è¯•çš„æ–‡ä»¶æ‰3ä¸ªå°æ–‡ä»¶ï¼Œå¤Ÿäº†ã€‚

-p r å°±æ˜¯å±æ€§æ˜¯readonlyåªè¯»çš„ï¼Œè¿™é‡Œä¸å†™ä¹Ÿè¡Œï¼Œå°±æ˜¯åé¢å¿«ç…§é€»è¾‘å·æŒ‚è½½çš„æ—¶å€™åŠ åªè¯»å±æ€§mount -o ro ä¹Ÿè¡Œã€‚è¿™æ ·é€»è¾‘å·å°±ä¸èƒ½è¢«åˆ«äººç¯¡æ”¹äº†ï¼Œæ­£å¸¸çš„å¿«ç…§å¤‡ä»½ä¸šåŠ¡æ˜¾ç„¶OKçš„ã€‚

/dev/vg0/mysqlå°±æ˜¯ç»™è°åšå¿«ç…§ã€‚
```



![image-20220314112350883](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314112350883.png)

æ­¤æ—¶ğŸ‘†å°±çœ‹åˆ°äº† å¤šäº†ä¸€ä¸ªLV snapshot statuså±æ€§ï¼šmysql_snapshotæ—¶active destiantion for mysqlæ˜¯mysqlè¿™ä¸ªlvmçš„å¿«ç…§ã€‚

è€Œä¸”çœ‹åˆ°LV Write Accessæ˜¯ åªè¯»çš„ã€‚

åŒæ ·çš„å»çœ‹åŸlvmå°±æ˜¯åšäº†å¿«ç…§çš„é‚£ä¸ªlvmä¹Ÿå¤šäº†1ä¸ªå±æ€§

![image-20220314112751810](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314112751810.png)



ç„¶ååˆ é™¤f1ï¼Œä¿®æ”¹f2ï¼›åˆ›å»ºf4

![image-20220314114114145](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314114114145.png) 



ç„¶åå»æŒ‚è½½ä¸€ä¸‹å¿«ç…§çœ‹ä¸‹

![image-20220314114223628](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314114223628.png)

å¿«ç…§é€»è¾‘å·å‘ç°ä¸èƒ½æŒ‚è½½ï¼Œblkidå¯è§ğŸ‘‡

![image-20220314114351602](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314114351602.png)

å¿«ç…§å·å’ŒåŸé€»è¾‘å·çš„UUIDä¸€æ ·ï¼ŒXFSæ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯åŒæ ·çš„UUIDçš„è®¾å¤‡ä¸èƒ½åŒæ—¶æŒ‚è½½çš„ã€‚

![image-20220314114623183](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314114623183.png) 

æç¤ºä¸èƒ½æŒ‚è½½åªè¯»çš„å¿«ç…§ï¼Œåˆšæ‰åˆ›å»ºå¿«ç…§é€»è¾‘å·çš„æ—¶å€™-p räº†ã€‚

å³ä½¿è¿™é‡Œå†™ä¸ªrwä¹Ÿæ²¡ç”¨

![image-20220314114752591](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314114752591.png)

å› ä¸ºå¿«ç…§æ˜¯åªè¯»çš„

![image-20220314114822822](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314114822822.png)

æ²¡æœ‰åŠæ³•æŒ‚è½½çš„æ—¶å€™æ”¹æˆrw

åªèƒ½é‡æ–°åˆ›å»ºä¸€ä¸ªrwçš„å¿«ç…§ï¼Œå»æŒ‚è½½äº†ï¼Œä¹Ÿè®¸æœ‰åŠæ³•ä¿®æ”¹

![image-20220314115226188](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314115226188.png)

æŠŠåŸæ¥çš„åˆ äº†å§

![image-20220314115417263](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314115417263.png)

åŸæ¥çš„ä¹Ÿæ²¡æŒ‚è½½ï¼Œæ‰€ä»¥ç›´æ¥lvremoveåˆ äº†

![image-20220314115457283](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314115457283.png)

![image-20220314115513365](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314115513365.png)

è¿™æ¬¡çš„å¿«ç…§2åˆ›å»ºåï¼ŒåŒæ ·éœ€è¦ä¿®æ”¹æ•°æ®ï¼Œæ•°æ®æ²¡å˜ï¼Œæ‰€ä»¥æ­¤æ—¶å¿«ç…§é‡Œæ²¡æœ‰æ•°æ®ã€‚

![image-20220314115818186](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314115818186.png)

ğŸ‘†åŒæ ·çš„é—®é¢˜ï¼ŒUUIDä¸€æ ·ï¼Œåˆæ˜¯xfsç³»ç»Ÿï¼ŒæŒ‚è½½éœ€è¦å¿½ç•¥UUIDå†²çªã€‚

![image-20220314115928758](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314115928758.png) 

ğŸ‘†æ­¤æ—¶lvdisplayå°±çœ‹åˆ°è¿™ä¸ªå¿«ç…§å°±æ˜¯rwå¯è¯»å¯å†™çš„ã€‚

å‘ç°æ•°æ®æ²¡æ”¹è¿‡ï¼Œå¿«ç…§æ–‡ä»¶å¤¹é‡Œå°±å·²ç»æœ‰äº†ï¼Œå¥½å¥‡æ€ª

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220314120111336.png" alt="image-20220314120111336" style="zoom:80%;" /> 

å±æ€§ä¹Ÿä¸€æ ·ğŸ‘‡

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220314120131556.png" alt="image-20220314120131556" style="zoom:80%;" /> 

1ã€æ–‡ä»¶æ²¡æœ‰æ”¹ï¼Œå¿«ç…§é‡Œå°±æ˜¯æ²¡æœ‰çš„ï¼Œ

2ã€è™½ç„¶æˆ‘ä»¬ä»å¿«ç…§æŒ‚è½½çš„æ–‡ä»¶å¤¹é‡Œçœ‹åˆ°åŸæ¥çš„æ•°æ®ï¼Œä½†è¿™äº›æ•°æ®å®é™…ä¸Šè¿˜ä¸åœ¨å¿«ç…§é‡Œã€‚ä¹Ÿå°±æ˜¯ç±»ä¼¼äºé“¾æ¥ä¹‹ç±»çš„æœºåˆ¶ã€‚

3ã€è¿™æ ·åšçš„å°±æ˜¯è®©ç”¨æˆ·æœ‰ä¸€ä¸ªå¿ƒç†å®‰æ…°ï¼Œè®©ä½ çœ‹åˆ°æ•°æ®åœ¨çš„ï¼Œå…¶å®ä¸åœ¨ã€‚



ä¸‹é¢å¯¹æ–‡ä»¶åšä¸€äº›å˜åŠ¨

f2åˆ äº†ã€f3æ”¹äº†ã€f4æ²¡åŠ¨ã€f5æ–°å»º

![image-20220314120819682](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314120819682.png)

æ­¤æ—¶çœ‹çœ‹å¿«ç…§æ–‡ä»¶å¤¹é‡Œçš„ä¸œè¥¿ï¼Œå°±æ˜¯å½“æ—¶åˆ›å»ºå¿«ç…§æ—¶å€™çš„æ•°æ®ã€‚

![image-20220314120858688](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314120858688.png) 



### å¦‚ä½•æ¢å¤å¿«ç…§çš„æ–‡ä»¶

æ¥ç€ä¸Šå›¾ï¼Œå¯ä»¥æŠŠå¿«ç…§æŒ‚è½½çš„æ–‡ä»¶å¤¹é‡Œçš„æ•°æ®å¤åˆ¶å›å»ï¼Œå…¶å®æœ‰ä¸“é—¨çš„å‘½ä»¤ã€‚

å…ˆå–æ¶ˆæŒ‚è½½ï¼Œæ‰€ä»¥æŒ‚è½½å¿«ç…§å·å…¶å®æ˜¯æ²¡å¿…è¦çš„æ“ä½œï¼Œåªæ˜¯ä¸ºäº†å®éªŒçœ‹çœ‹ï¼Œæ‰€ä»¥åˆ›å»ºå¿«ç…§å·çš„æ—¶å€™ç¡®å®å¯ä»¥-p rè®¾ç½®ä¸ºåªè¯»çš„ã€‚

1ã€å–æ¶ˆæŒ‚è½½å¿«ç…§å·---è¿™æ˜¯å› ä¸ºå®éªŒç¯èŠ‚çš„æ“ä½œï¼Œæ­£å¸¸ç”Ÿæˆä¸­ä¸éœ€è¦ã€‚

2ã€å–æ¶ˆæŒ‚è½½åŸé€»è¾‘å·çš„çš„æŒ‚è½½ï¼Œè¿™æ˜¯ç¡®ç¡®å®å®éœ€è¦çš„æ“ä½œã€‚

å› ä¸ºè¦åˆå¹¶å¿«ç…§å’ŒåŸlvmï¼Œæ‰€ä»¥éœ€è¦å–æ¶ˆæŒ‚è½½

![image-20220314121307963](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314121307963.png)

![image-20220314121349797](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314121349797.png)

ç­‰ä¼šå°±å¥½äº†

![image-20220314121401660](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314121401660.png) 

ç„¶åå†æŒ‚å›å»ï¼Œæ•°æ®å°±æ¢å¤äº†

![image-20220314121440705](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314121440705.png)



è¿˜åŸåï¼Œé€»è¾‘å·çš„å¿«ç…§å·å°±æ²¡äº†ï¼Œä½¿å‘½å®Œæˆï¼Œå°±æ˜¯è¯´lvconvert --merge xxxåè¿™ä¸ªxxxå¿«ç…§å·å°±æ²¡äº†ã€‚å¿«ç…§æ˜¯ä¸€æ¬¡æ€§çš„ï¼Ÿvmwareè‡³å°‘ä¸æ˜¯ã€‚äº‘ä¸Šå¥½åƒä¹Ÿä¸æ˜¯çš„å§ã€‚



ä»¥ä¸Šå°±æ˜¯é’ˆå¯¹xfsç³»ç»Ÿçš„å¿«ç…§åˆ¶ä½œå’Œè¿˜åŸ

![image-20220314121902136](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314121902136.png)

ä¸Šå›¾é—æ¼ä¸€ä¸ªç‚¹ï¼Œlvcreate å»æ‰-p råï¼ŒæŒ‚è½½å°±éœ€è¦åŠ ä¸Šroï¼Œä¿è¯å¿«ç…§çš„å®‰å…¨æ€§ã€‚

![image-20220314135140311](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314135140311.png)



### é’ˆå¯¹extåšå¿«ç…§

![image-20220314133619735](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314133619735.png)

é’ˆå¯¹binglogè¿™ä¸ªé€»è¾‘å·æ¥åšå¿«ç…§

åˆ›å»º3ä¸ªæ–‡ä»¶ä½œä¸ºé•œåƒè¿˜åŸçš„å¯¹æ¯”

![image-20220314133740703](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314133740703.png)

åˆ›å»ºå¿«ç…§å·ï¼Œå› ä¸ºä¸æ˜¯xfsï¼Œæ‰€ä»¥é¢å¯ä»¥-p rè®¾ç½®ä¸ºåªè¯»å¿«ç…§ã€‚

![image-20220314133940902](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314133940902.png)

![image-20220314134036925](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134036925.png)

UUIDä¾ç„¶æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¿™å›æ˜¯ext4çš„

![image-20220314134145979](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134145979.png)

![image-20220314134219408](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134219408.png)

ğŸ‘†ext4ä¸éœ€è¦-o nouuid--ä¹Ÿå°±æ˜¯è¯´UUIDä¸€æ ·ä¹Ÿèƒ½æŒ‚ï¼Œç„¶åä¹Ÿä¸éœ€è¦lvmæ˜¯rwçš„read-onlyçš„ä¹Ÿèƒ½æŒ‚

å¿«ç…§é‡Œçš„æ•°æ®ä¼šæœ‰çš„ï¼Œè™½ç„¶è¿™æ˜¯å‡è±¡--æˆ–è€…å«ä¼˜åŒ–ç”¨æˆ·ä½“éªŒçš„æ•ˆæœ--ç±»ä¼¼é“¾æ¥ã€‚

![image-20220314134542688](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134542688.png)

åŸæ¥lvmçš„æ•°æ®ğŸ‘‡ï¼š

![image-20220314134608931](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134608931.png)

åˆ é™¤f1ï¼Œä¿®æ”¹f2ï¼Œåˆ›å»ºf4

![image-20220314134644867](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134644867.png) 

è¿˜åŸ ä¹‹å‰å…ˆå–æ¶ˆæŒ‚è½½

![image-20220314134726788](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134726788.png)

è¿˜åŸ-åˆå¹¶å°±æ˜¯ç”¨snopshortè¦†ç›–åŸlvm

![image-20220314134817745](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134817745.png)

æ­¤æ—¶lvdisplayå°±çœ‹ä¸åˆ°è¿™ä¸ªå¿«ç…§äº†

æŒ‚å›å»

![image-20220314134910003](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134910003.png)

æ­¤æ—¶å°±å›æ¥äº†

![image-20220314134926810](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314134926810.png)



![image-20220314135322690](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314135322690.png)



å®Œæ•´çš„è¿‡ç¨‹å¦‚ä¸‹

![image-20220314135624813](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314135624813.png)





![image-20220314135732211](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314135732211.png)

ä¸Šå›¾æœ‰ç‚¹å°é—®é¢˜ï¼Œâ‘ å¿«ç…§ä¸ç”¨åˆ ï¼Œæ¢å¤åè‡ªåŠ¨å°±æ²¡äº†ï¼Œé™¤éä½ è¿˜æ²¡æ¢å¤å‘¢ç›´æ¥åˆ â‘¡-p ræ˜¯xfsçš„æ—¶å€™å»æ‰ï¼Œå†ç»“åˆmount -ro -o nouuidâ‘¢ext4 å¯ä»¥ç”¨-p rã€‚å…·ä½“ä¸Šæ–‡éƒ½æœ‰è¯´è¿‡äº†ã€‚



ç»ƒä¹ 

![image-20220314140035925](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314140035925.png)



æ³¨æ„/bootåˆ†åŒºä¸èƒ½æŒ‚åˆ°é€»è¾‘å·é‡Œã€‚/bootæ˜¯å¯åŠ¨çš„æ—¶å€™å°±è¦æŒ‚è½½ä½¿ç”¨çš„ï¼Œè¿™æ ·ç³»ç»Ÿæ‰èƒ½å¯å¾—èµ·æ¥ã€‚è€Œå¯åŠ¨çš„æ—¶å€™ç³»ç»Ÿè¿˜ä¸çŸ¥é“å•¥å«lvmå‘¢ã€‚

lvmä¹Ÿæ˜¯è¦å†…æ ¸é©±åŠ¨æ¨¡å—æ”¯æŒçš„ï¼Œåˆšå¯åŠ¨çš„ç³»ç»Ÿè¿˜æ²¡æœ‰åŠ è½½lvmçš„é©±åŠ¨å‘¢ã€‚

![image-20220314150029235](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314150029235.png)

æ’ç‰ˆæ ¼å¼åŒ– df - Pé€‰é¡¹ã€å…³é”®å­—ï¼šå¤ªé•¿ã€å¯¹é½ã€ä¸€æ’ã€‚

é€šè¿‡lvdisplayå¯ä»¥çœ‹åˆ°LogVol00æ˜¯ç»™æ ¹ï¼Œè¿˜æœ‰ä¸ªç»™åˆ°äº†swap

![image-20220314151055473](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314151055473.png)

åŒæ ·centos8çš„lvmçœ‹çœ‹

![image-20220314150544259](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314150544259.png)



### åˆ é™¤æ‰€æœ‰çš„lvm

1ã€unmount

![image-20220314151709560](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314151709560.png)

2ã€å…ˆåˆ å¿«ç…§ï¼Œå†åˆ é€»è¾‘å·

ä¸€æ¡å‘½ä»¤å¥½åƒå¯ä»¥ä¸¤ä¸ªéƒ½åˆ äº†

![image-20220314151902705](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314151902705.png)

lvå°±æ²¡äº†

3ã€åˆ å·ç»„

![image-20220314151939645](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314151939645.png) 

<img src="9-LVMç®¡ç†è¯¦è§£.assets/image-20220314151959547.png" alt="image-20220314151959547" style="zoom:80%;" /> 

![image-20220314152023071](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314152023071.png) 

![image-20220314152044290](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314152044290.png) 

åˆ°æ­¤å°±åˆ å¹²å‡€äº†ã€‚

![image-20220314152114584](9-LVMç®¡ç†è¯¦è§£.assets/image-20220314152114584.png) 



åˆ†åŒºç”¨ä¸ç€åˆ ã€ç¡¬ç›˜ä¸ç”¨äº†æ‹†ã€‚





