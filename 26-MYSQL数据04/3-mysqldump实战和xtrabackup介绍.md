# ç¬¬3èŠ‚. mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç»



![image-20230720174307740](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720174307740.png)

-F --flush-logsï¼šå­˜åœ¨æ»šåŠ¨å¤šæ¬¡æ•°æ®åº“-A -Bæ¶‰åŠå¤šä¸ªæ•°æ®åº“ï¼Œä¼°è®¡ä¸€ä¸ªæ•°æ®åº“å°±ä¼šæ»šåŠ¨ä¸€æ¬¡ï¼›æ‰€ä»¥éœ€è¦é…åˆ--single-transactionæ¥åšä¸€æ¬¡äº‹åŠ¡æ»šåŠ¨ä¸€æ¬¡ï¼Œå°±æ˜¯ç›¸å½“äºä¸ç”¨ äººå·¥flush logsåˆ·æ–°binlogäº†ã€‚--master-dataè‚¯å®šè¦çš„ï¼ŒmysqldumpåŠ¨ä½œå¯¹åº”çš„binlogä½ç½®å¾—è®°ä¸‹æ¥çš„ã€‚

![image-20230720175721854](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720175721854.png)

![image-20230720175735534](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720175735534.png)

è¿™ä¸ªå°±ç›´æ¥STD è¾“å‡ºåˆ°å±å¹•ä¸Šäº†å“¦ï¼Œç„¶åå†çœ‹çœ‹binlog

![image-20230720175810296](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720175810296.png)

ä»34å¼€å§‹åˆ°45ï¼Œå¤šäº†12ä¸ªã€‚

![image-20230720180038255](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720180038255.png)

åªä¼šåˆ·å‡ºä¸€ä¸ªbinlog

![image-20230720180106778](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720180106778.png)

-F æ»šåŠ¨çš„å¥½å¤„ä¹Ÿå°±æ˜¯flush logsçš„å¥½å¤„ï¼Œå°±æ˜¯ä¸Šå›¾çš„000046å·æ–‡ä»¶æ˜¯æ–°çš„æ—¥å¿—ï¼Œå’Œè€æ—¥å¿—åˆ†å¼€æ¥æ”¾äº†ï¼Œå°±æ˜¯æ–°è€æ—¥å¿—å­˜æ”¾æ¸…æ™°ï¼Œå¤„ç†å¤‡ä»½è¿˜åŸå°±æœ‰æ˜ç¡®çš„000045--è€æ—¥å¿—ï¼Œ000046æ–°æ—¥å¿—ï¼Œæ˜ç¡®çš„æ–‡ä»¶åˆ†ç•Œçº¿å°±å‡ºæ¥äº†ï¼Œæ— éœ€å»æ–‡ä»¶é‡Œæ‰’ä½ç½®å»å®šç•Œäº†ã€‚



çœ‹ä¸‹è¿™æ¡ä¼˜åŒ–å¤‡ä»½CLIçš„å®æ“æ•ˆæœ

```shell
mysqldump -F -A --single-transaction --master-data=2 > /data/all_`date +%F`.sql
```

![image-20230720181446130](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720181446130.png)

ç°åœ¨000046å·æ–‡ä»¶389ï¼Œ

```
drop table coc;
show master logs;
```

<img src="3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720181726077.png" alt="image-20230720181726077" style="zoom:50%;" /> 

<img src="3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720181741273.png" alt="image-20230720181741273" style="zoom:50%;" /> 

![image-20230720181827857](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720181827857.png)

![image-20230720181839060](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720181839060.png)

å¥½ï¼Œæ­¤æ—¶000046çš„sizeè¾¾åˆ°äº†711ï¼Œä»389ã€‚æ—¥å¿—å¢é•¿äº†å¾ˆå¤šã€‚

![image-20230720182015058](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720182015058.png)

![image-20230720182117775](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720182117775.png)

-Fçš„æ•ˆæœå°±å‡ºæ¥äº†ï¼Œç»“åˆ--single-transactionä»¥åŠ--master-data=2

å°±æ˜¯æ–°çš„binlogæ–‡ä»¶000047çš„389è¿™ä¸ªä½ç½®ä½œä¸ºmysqldumpçš„èŠ‚ç‚¹ï¼Œå»çœ‹çœ‹all_`date +%F`.sqlæ–‡ä»¶é‡Œå¿…ç„¶ä¹Ÿå†™ç€000047 389è¿™ä¸ªä½ç½®ç‚¹

![image-20230720182356563](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720182356563.png)

ç›¸å½“äºflushäº†ä¸€ä¸ªæ–°æ—¥å¿—æ–‡ä»¶ï¼Œä»è¿™ä¸ªæ–‡ä»¶ä»¥å‰çš„binlogå°±åŒ…å«åœ¨äº†å…¨å¤‡æ–‡ä»¶äº†ï¼Œä»è¿™ä¸ªèŠ‚ç‚¹å¼€å§‹ä»¥åå°±ä¸åŒ…å«åœ¨å…¨å¤‡é‡Œã€‚



å…¨å¤‡å·²ç»åŒ…å«çš„binlogå°±å¯ä»¥æ¸…ä¸€ä¸‹äº†ï¼Œå“¦ï¼Œæ‰€ä»¥binlogæ¸…é‡Œæ˜¯è¿™ä¹ˆæ¸…çš„ï¼

![image-20230720182928051](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720182928051.png)

ç£ç›˜ä¸Šè‡ªç„¶ä¹ŸåŒæ­¥äº†

![image-20230720183019294](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720183019294.png)

ğŸ‘‡è¿™ä¸ªresetæ²¡å¿…è¦å§ï¼Œä¸ç„¶ä½ è¿˜åŸçš„å…¨å¤‡æ²¡é—®é¢˜ï¼Œè¡¥å·®ä»·çš„æ—¶å€™å¤„ç†binlogå°±ä¸èƒ½ç›´æ¥å¤åˆ¶mysqldump --master-data äº§ç”Ÿå¾—binlogç¼–å·å’Œä½ç½®äº†

![image-20230720183108259](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720183108259.png)

å¾—æ”¹æˆæ–°çš„binlogç¼–å·ï¼Œå’Œä½ç½®ï¼Œä¸è¿‡-Fæ˜¯åˆ·æ–°å¾—ï¼Œä½ç½®ä¸ç”¨å†™äº†ç›´æ¥ç¼–å·å°±è¡Œäº†ã€‚

![image-20230720183441328](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720183441328.png)

![image-20230720183426054](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230720183426054.png)





### æ¸©å¤‡-MyISAMä¸æ”¯æŒäº‹åŠ¡ï¼Œè¦åŠ é”ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

![image-20230721095441971](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721095441971.png)

MyISAMå¤‡ä»½è¦ç”¨-xï¼Œå…¨éƒ¨åŠ ä¸Šè¯»é”ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

-l  åˆ«ç”¨äº†ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå› ä¸ºä¸€ä¸ªåº“ä¸€ä¸ªåº“çš„åŠ é”ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚

æ‰€ä»¥InnoDBä¸è¦ç”¨è¿™äº›é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹æ˜¯MyISAMæ‰éœ€è¦çš„ã€‚



çƒ­å¤‡-InnoDBï¼Œå¼€å¯äº‹åŠ¡

![image-20230721100742777](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721100742777.png)

å°±æ˜¯æ‰€æœ‰çš„mysqldumpåœ¨ä¹Ÿç»™äº‹åŠ¡é‡Œï¼Œè€Œäº‹åŠ¡çš„é»˜è®¤éš”ç¦»çº§åˆ«æ˜¯"å¯é‡å¤è¯»"ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°æ‰€æœ‰æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚

â€‹		ä½†æ˜¯äº‹åŠ¡å¯ä»¥éš”ç¦»DMLï¼Œä¸èƒ½éš”ç¦»DDLã€‚è¯·çœ‹ä¸‹å›¾ğŸ‘‡

![image-20230721112409156](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721112409156.png)

![image-20230721112637904](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721112637904.png)



DDLè¯­è¨€ï¼šdrop table,   rename table, truncate tableï¼›è¿™äº›äº‹åŠ¡é’ˆå¯¹è¿™äº›æ˜¯ä¸å…·å¤‡éš”ç¦»æ€§çš„ã€‚

æ³¨æ„truncate tableå’Œdelete fromçš„åŒºåˆ«ï¼Œå‰è€…æ˜¯DDLï¼Œåç¼€æ˜¯DMLã€‚è¿™äº›äº‹åŠ¡å…·å¤‡å¯¹å…¶çš„éš”ç¦»æ€§ã€‚



![image-20230721133619769](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721133619769.png)

![image-20230721133644846](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721133644846.png)

-qå°±æ˜¯--quickçœ‹æ¥è¿˜ä¸é”™



## å¤„ç†æ–¹å¼

ä¸€èˆ¬æ¥è®²MyISAMï¼Œ-x

å¯¹äºInnoDBï¼Œ--single-transaction

ä½†æ˜¯å¯¹äºæ•°æ®åº“æ¥è®²ï¼Œåˆæœ‰mysqlè¿™ç§ç³»ç»Ÿåº“æ˜¯MyISAMçš„ï¼Œåˆæœ‰å¸¸è§„çš„å…¶ä»–æ‰€æœ‰åº“å°±éƒ½æ˜¯InnoDBã€‚

å¦‚æœ

mysqldump -x --single-transaction ï¼Œ-xå°±å¤±æ•ˆäº†ï¼Œä¸Šå›¾é‡Œæœ‰æåˆ°çš„ã€‚



-Aåº”è¯¥å°±åŒ…å«äº†-E -R --triggers --default-characterè¿™äº›äº†ï¼Œå› ä¸º-AåŒ…å«äº†mysqlç³»ç»Ÿåº“ã€‚

ä½†æ˜¯-Få’Œ--hex-blobç†è®ºä¸Šæ˜¯éœ€è¦çš„ï¼Œç„¶å--deafult-character-setè¿™ä¸ªéœ€è¦ç‰¹å®šæŒ‡å®šå—ï¼Ÿä¸å†™ä¼šä¸ä¼šæ›´å¥½ï¼Œå†™çš„å°±è¦çœ‹ä¸‹æ˜¯å¦å’ŒåŸæœ¬çš„æ•°æ®åº“çš„é»˜è®¤å­—ç¬¦é›†ä¸€è‡´ï¼Œè¦å†™æˆä¸€è‡´çš„å­—ç¬¦é›†ã€‚

--master-data=1å°±æ˜¯æœ‰ä¸»ä»å¤åˆ¶äº†ã€‚

```
InnoDBå»ºè®®å¤‡ä»½ç­–ç•¥
mysqldump â€“uroot â€“A â€“F â€“E â€“R --single-transaction --master-data=1 --
flush-privileges --triggers --default-character-set=utf8 --hex-blob
>$BACKUP/fullbak_$BACKUP_TIME.sql

MyISAMå»ºè®®å¤‡ä»½ç­–ç•¥
mysqldump â€“uroot â€“A â€“F â€“E â€“R â€“x --master-data=1 --flush-privileges --  triggers --default-character-set=utf8 --hex-blob
>$BACKUP/fullbak_$BACKUP_TIME.sql

```

MyISAMå°±æ˜¯éœ€è¦åŠ ä¸Š-xé€‰é¡¹ã€‚





## åˆ†åº“å¤‡ä»½

ä¹‹å‰-Aå¯èƒ½å¤‡çš„å¤ªå¤šäº†ï¼Œæ²¡å¿…è¦ï¼Œäºæ˜¯è¿™é‡Œå¼€å§‹å­¦ä¹ ä¸€ä¸‹åˆ†åº“å¤‡ä»½

æ¥çœ‹çœ‹é”™è¯¯å¾—æ¡ˆä¾‹ï¼š

![image-20230721160941655](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721160941655.png)

ä¸Šå›¾å¾—grep ç”¨çš„å€’æ˜¯æŒºæºœå¾—ï¼Œä¸è¿‡ä¹Ÿå°±æ˜¯-wçš„äº‹ï¼Œå†™æˆäº†^xxx$ï¼›

ç„¶åä¸Šå›¾ç”¨for å¾ªç¯é‡Œçš„--single-transactionæ˜¯ä¸æ˜¯æœ‰æ¯’ï¼Œä¸€ä¸ªå¾ªç¯ä¸€ä¸ªæ•°æ®ä¸€ä¸ªå¯¹ç«‹çš„äº‹åŠ¡ï¼ŒTMæœ‰10ä¸ªdbå°±è¦å¼€å¯10ä¸ªäº‹åŠ¡ï¼Œæ•°æ®çš„ä¸€è‡´æ€§è¿˜æœ‰å—ï¼Ÿ



æ˜æ˜-Bå°±å¯ä»¥è·Ÿå¤šä¸ªdbï¼Œéè¦ç§€forã€‚

<img src="3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721161302765.png" alt="image-20230721161302765" style="zoom:50%;" /> 

![image-20230721161326013](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721161326013.png)



ä¼˜åŒ–ä¸‹ï¼Œå–å‡ºæ‰€æœ‰éœ€è¦å¤‡ä»½çš„æ•°æ®åº“

![image-20230721161500085](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721161500085.png)

è¿™æ ·ğŸ‘‡å°±å¯ä»¥å•¦ï¼š

![image-20230721162621397](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721162621397.png)

OKï¼Œåº“éƒ½å¤‡å¥½äº†ğŸ‘‡ï¼š

![image-20230721180354880](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721180354880.png)

æˆ–è€…ğŸ‘‡è¿™æ ·ï¼š

![image-20230721162943898](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721162943898.png)

çœ‹ç€æœ‰ç‚¹é—®é¢˜ï¼Œä½†æ˜¯echoå‡ºæ¥çš„cliç›´æ¥å¤åˆ¶æ˜¯å¯ä»¥çš„ï¼Œçœ‹ç€åƒæ²¡æœ‰è°ƒç”¨bash

ä¼˜åŒ–ä¸‹å°±å¯ä»¥äº†

![image-20230721164018891](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721164018891.png)

OKäº†ï¼Œå¤§å°å’Œç¬¬ä¸€ä¸ªå‘½ä»¤å†™æ³•ä¸€æ ·

![image-20230721164054288](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721164054288.png)

å’Œå‹ç¼©æ‰“åŒ…ç»“åˆä¸€ä¸‹

![image-20230721171035131](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721171035131.png)



ç„¶åè¡¥å……ä¸€ä¸ªè§†é¢‘é‡Œé”™è¯¯çš„æ€è·¯ï¼ˆè¿˜æ˜¯-B åªå¸¦äº†ä¸€ä¸ªdbï¼‰ï¼Œä½†æ˜¯æœ‰æ„æ€çš„å†™æ³•ï¼ˆsedå†™çš„6ï¼‰

![image-20230721181016396](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721181016396.png)

ä½†æ˜¯ç”Ÿæˆçš„å‘½ä»¤æ²¡æœ‰æ‰§è¡Œï¼Œè¿˜éœ€è¦é‡å®šå‘åˆ°bashï¼Œæˆ–è€…\`\`åæ–œæ æ‰è¡Œã€‚

![image-20230721181256685](3-mysqldumpå®æˆ˜å’Œxtrabackupä»‹ç».assets/image-20230721181256685.png)



