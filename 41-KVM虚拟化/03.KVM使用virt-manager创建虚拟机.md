# 03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.md



å¦‚ä½•è¯†åˆ«ç‰©ç†æœºè¿˜æ˜¯è™šæ‹Ÿæœº

![image-20251215105448590](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251215105448590.png)







ä¿®æ”¹è‹±æ–‡ä½¿virt-manageræ˜¾ç¤ºOKï¼Œæ­¤å¤–virt-manageréœ€è¦å®‰è£…Xmanageræ˜¾ç¤ºå·¥å…·ã€‚è¿˜æœ‰ç”Ÿæˆç¯å¢ƒä¸è¦ç”¨è¿™ä¸œè¥¿ã€‚

![image-20251218102924747](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251218102924747.png)

![image-20251218103039561](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251218103039561.png)



ç½‘æ¡¥æŸ¥çœ‹

![image-20251218114230824](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251218114230824.png)









![image-20251222100058259](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222100058259.png)







![image-20251222101542403](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222101542403.png)



![image-20251222102311302](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102311302.png)



![image-20251222102436376](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102436376.png)



![image-20251222102501826](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102501826.png)



![image-20251222102538547](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102538547.png)



![image-20251222102632394](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102632394.png)



![image-20251222102657419](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102657419.png)



![image-20251222102752254](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102752254.png)



![image-20251222102808263](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102808263.png)



![image-20251222102851059](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102851059.png)



![image-20251222102939614](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222102939614.png)



![image-20251222103125041](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222103125041.png)

æ­¤å¤„5Gè¦ç†è§£

![image-20251222105719452](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222105719452.png)

å®é™…å ç”¨å¹¶æ²¡æœ‰5G

![image-20251222105857531](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222105857531.png)



![image-20251222103204327](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222103204327.png)

![image-20251222103318628](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222103318628.png)

å®šåˆ¶ğŸ‘†æˆ–ä¸å®šåˆ¶ğŸ‘‡éƒ½å¯ä»¥

![image-20251222103234000](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222103234000.png)



 ç‚¹å‡»å¼€å§‹å®‰è£…

![image-20251222103425949](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222103425949.png)





AMDçš„æŠ¥é”™å¤„ç†

![image-20251222111953687](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222111953687.png)



![image-20251222112021571](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222112021571.png)





rokcy çš„virt-manageræ‰“å¼€å¤„ç†

![image-20251222112113282](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222112113282.png)

![image-20251222112142954](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222112142954.png)



æ‰“å¼€X-MANAGERçœ‹åˆ°1.0ï¼Œå°±æ˜¯æˆ‘ä»¬çš„:1.0ï¼Œç„¶åIPå°±æ˜¯VMworkstationçš„VMç½‘å¡äº†

192.168.126.1å°±æ˜¯Vnetç½‘å¡ï¼Œ1.0å°±æ˜¯Xmanagerçš„1.0

![image-20251222113204160](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222113204160.png)

![image-20251222113314586](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222113314586.png)









# æ•…éšœæ¡ˆä¾‹1

e1000e

vmç½‘å¡é»˜è®¤çš„virtioï¼Œç»“æœä¸€å¼€æœº(virtsh startä¸ä¼šï¼Œvirt-managerçš„GUIå¼€æœºä¼šï¼Œå…¶å®å°±æ˜¯æœ‰æ•°æ®ä¼ é€’å°±ä¼šå´©æ‰ï¼)ï¼ŒæŠŠå®¿ä¸»æœºçš„ç½‘å¡å¹²æ–­äº†ï¼Œè¿™æ˜¯å®¿ä¸»çš„consoleè¿›å»æŠ¥çš„é”™ğŸ‘‡

![image-20251222141616292](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222141616292.png)



è¿™æ˜¯vmé‡Œçš„å¡ä½çš„ç•Œé¢

![image-20251222141847167](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222141847167.png)

# è§£å†³æ–¹æ³•1ï¼Œå°±æ˜¯è°ƒæ•´VMä¸ºe1000eå°±å¥½äº†

![image-20251222141927524](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222141927524.png)



# è§£å†³æ–¹æ³•2

å‚è€ƒï¼šhttps://ovear.info/post/356

```bash
# å…³é—­ guest å†… VirtIO ç½‘ç»œ offloading
ifconfig vtnet0 -rxcsum -txcsum -tso -lro

# æˆ–åœ¨å®¿ä¸»ç½‘ç»œæ¥å£ä¸Šå…³é—­ï¼Œ
ethtool -K ens33 tso off gso off  # æœ‰æ—¶å€™å¯ä»¥ï¼Œå¾ˆå¤šæ¬¡ä¹Ÿä¸è¡Œï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸‹é¢
ethtool -K ens33 rx off tx off


# GPTæ¨èçš„å®Œæ•´ç‰ˆï¼Œä½†ä¸æ˜¯æœ€ç»ˆç‰ˆï¼Œæœ€ç»ˆç‰ˆè¦åšæˆé…ç½®æ–‡ä»¶çš„æ°¸ä¹…ç”Ÿæ•ˆã€‚
ethtool -K ens33 \
  tso off gso off gro off lro off \
  rx off tx off

ethtool -k ens33 | egrep 'tso|gso|gro|lro|rx-checksumming|tx-checksumming'

```

æ„æ€æ˜¯ï¼š

> â€œåˆ«ç»™æˆ‘æä»€ä¹ˆå¤§åŒ…åˆ†æ®µã€ç¡¬ä»¶å¸è½½ï¼Œ
>  è€è€å®å®æŒ‰ MTU å‘â€

![image-20251222160118821](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251222160118821.png)

æ²¡æœ‰æ•²ethtool -Kä¹‹å‰ï¼Œvirt-manageré‡Œvmè®¾ç½®ä¸ºvirtioçš„æŠ¥é”™





 **è¿™äº›ç½‘å¡ offload åŠŸèƒ½åˆ°åº•æ˜¯ä»€ä¹ˆ**ï¼Œä»¥åŠ **å…³æ‰ä¼šä¸ä¼šå½±å“ä¸šåŠ¡**ã€‚

------

### ä¸€ã€è¿™äº›åŠŸèƒ½åˆ°åº•æ˜¯å•¥ï¼ˆethtool èƒ½å…³çš„ offloadï¼‰

ä½ ç”¨çš„å‘½ä»¤æ¶‰åŠçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š

| åŠŸèƒ½                                   | å«ä¹‰             | ä½œç”¨                                               | å…³æ‰åå½±å“                              |
| -------------------------------------- | ---------------- | -------------------------------------------------- | --------------------------------------- |
| **TSO (TCP Segmentation Offload)**     | TCP å¤§åŒ…åˆ†æ®µå¸è½½ | å†…æ ¸æŠŠå¤§äº MTU çš„ TCP åŒ…äº¤ç»™ç½‘å¡ï¼Œè®©ç½‘å¡æ‹†æˆå°åŒ…å‘ | **CPU ä¼šå¤šä¸€ç‚¹ï¼Œä½†ç½‘ç»œæ­£å¸¸**            |
| **GSO (Generic Segmentation Offload)** | è½¯ä»¶åˆ†æ®µ offload | è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹å†…æ ¸æ‹†åŒ…                               | CPU è´Ÿæ‹…ç•¥å¢ï¼Œç½‘ç»œæ­£å¸¸                  |
| **GRO (Generic Receive Offload)**      | è½¯ä»¶åˆå¹¶å°åŒ…     | å†…æ ¸åˆå¹¶å°åŒ…å‡å°‘ä¸Šå±‚å¤„ç†                           | CPU æ¶ˆè€—ç•¥å¢ï¼Œç½‘ç»œæ­£å¸¸                  |
| **LRO (Large Receive Offload)**        | ç¡¬ä»¶åˆå¹¶å°åŒ…     | ç¡¬ä»¶åˆå¹¶æ¥æ”¶åˆ°çš„å°åŒ…                               | CPU æ¶ˆè€—ç•¥å¢ï¼Œç½‘ç»œæ­£å¸¸                  |
| **TX checksum offload**                | æ ¡éªŒå’Œç”±ç½‘å¡è®¡ç®— | CPU ä¸ç”¨ç®—æ ¡éªŒå’Œï¼Œç½‘å¡ç®—å®Œç›´æ¥å‘å‡ºå»               | å…³æ‰å CPU éœ€è¦è®¡ç®—ï¼Œæ€§èƒ½ç•¥é™ï¼Œä¸šåŠ¡æ­£å¸¸ |
| **RX checksum offload**                | æ ¡éªŒå’Œç”±ç½‘å¡æ ¡éªŒ | ç½‘å¡æ¥æ”¶æ—¶ç›´æ¥éªŒè¯æ•°æ®æ­£ç¡®æ€§                       | CPU éœ€è¦ç®—ï¼Œä¸šåŠ¡æ­£å¸¸                    |

------

#### æ ¸å¿ƒç»“è®º

> **è¿™äº›åŠŸèƒ½éƒ½æ˜¯â€œæ€§èƒ½ä¼˜åŒ–â€åŠŸèƒ½ï¼Œä¸æ˜¯ä¸šåŠ¡å¿…éœ€**
> å…³æ‰å®ƒä»¬ **ä¸ä¼šå½±å“ä¸šåŠ¡æ­£ç¡®æ€§**ï¼Œåªä¼šè®© CPU å¤šå¹²ä¸€äº›å·¥ä½œã€‚

------

### äºŒã€ä¸ºä»€ä¹ˆä½ åœ¨è™šæ‹Ÿæœºé‡Œå¿…é¡»å…³æ‰

1. **virtio / e1000e** è¿™äº›åŠè™šæ‹ŸåŒ–ç½‘å¡ï¼š

- æœ‰äº› offload ç‰¹æ€§åœ¨æ¡¥æ¥æˆ–è™šæ‹ŸåŒ–ç¯å¢ƒé‡Œ **ä¸å…¼å®¹**
- ä¼šå¯¼è‡´ **TX queue hang / å®¿ä¸»æœºæ–­ç½‘**

1. **çœŸå®ç½‘ç»œ vs è™šæ‹ŸåŒ–ç½‘ç»œ**ï¼š

- åœ¨ç‰©ç†æœºä¸Šï¼Œå¼€ offload å¾ˆç¨³å®šï¼Œæ€§èƒ½å¥½
- åœ¨è™šæ‹Ÿæœºé‡Œï¼ŒæŸäº› offload ä¼šè§¦å‘ **ç¡¬ä»¶/é©±åŠ¨ bug**

------

### ä¸‰ã€ä¸šåŠ¡å½±å“

- **ç½‘ç»œåŠŸèƒ½**ï¼šå®Œå…¨ä¸å—å½±å“ï¼ˆåŒ…è¿˜æ˜¯èƒ½å‘èƒ½æ”¶ï¼‰
- **CPU å ç”¨**ï¼šä¼šå¢åŠ ä¸€ç‚¹ï¼ˆé€šå¸¸å¾®å°ï¼Œå¯å¿½ç•¥ï¼‰
- **ååé‡**ï¼šå¯èƒ½ç•¥ä½äºç¡¬ä»¶ offloadï¼Œä½†åœ¨ä½ çš„åœºæ™¯ï¼ˆKVM + e1000e/virtio + bridgeï¼‰
  â†’ ç¨³å®šæ¯”æ€§èƒ½é‡è¦

> âœ… æ‰€ä»¥åœ¨è™šæ‹ŸåŒ–ç¯å¢ƒé‡Œï¼Œ**å…³æ‰å…¨éƒ¨ offload æ˜¯å®‰å…¨åšæ³•**
> âœ… è¿™ä¹Ÿæ˜¯è¿ç»´ç•Œçš„ç»éªŒåšæ³•ï¼šç¨³å®š > å¾®å°æ€§èƒ½æå‡

------

### å››ã€æ€»ç»“ä¸€å¥è¯

> **è¿™äº› offload éƒ½æ˜¯â€œæ€§èƒ½ä¼˜åŒ–å¼€å…³â€ï¼Œåœ¨è™šæ‹Ÿæœºæ¡¥æ¥ç¯å¢ƒé‡Œå®¹æ˜“ç‚¸ç½‘ï¼ŒæŠŠå®ƒä»¬å…¨éƒ¨å…³æ‰ä¸ä¼šå½±å“ä¸šåŠ¡ï¼Œåªä¼šè®© CPU å¤šåšä¸€ç‚¹å·¥ä½œï¼Œæ¢æ¥çš„å°±æ˜¯ç¨³å®šå¯é çš„ç½‘ç»œã€‚**

------

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼  **â€œvirtio / e1000e æ•°æ®åŒ…è·¯å¾„ + offload åŠŸèƒ½ä½œç”¨å›¾â€**ï¼Œç›´è§‚çœ‹æ‡‚æ¯ä¸ª offload åšäº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä¼šå¯¼è‡´ TX hangã€‚

ä½ æƒ³è®©æˆ‘ç”»å—ï¼Ÿ







æ˜ç™½ï¼Œä½ ç°åœ¨æƒ³æŠŠè¿™ä¸ª **ethtool å…³é—­æ‰€æœ‰ offload çš„å‘½ä»¤**æ”¹ä¸º **æ°¸ä¹…ç”Ÿæ•ˆ**ï¼Œä¸æ¯æ¬¡é‡å¯éƒ½æ‰‹åŠ¨æ‰§è¡Œã€‚
æˆ‘ç»™ä½ è¯¦ç»†æ–¹æ¡ˆï¼Œ**Rocky Linux 10 / RHEL 10 ä¸Šæ¨èåšæ³•**ã€‚

------

### ä¸€ã€ç³»ç»Ÿå¯åŠ¨è‡ªåŠ¨æ‰§è¡Œæ–¹æ³•

#### ä½¿ç”¨ **NetworkManager çš„ `connection` é…ç½®**

è¿™æ˜¯ **å®˜æ–¹æ¨èã€æœ€å¹²å‡€çš„æ–¹æ³•**ï¼š

1. æŸ¥çœ‹ä½ çš„æ¥å£é…ç½®æ–‡ä»¶ï¼š

```bash
nmcli connection show
```

å‡è®¾æ¥å£å« `ens33`ã€‚

1. ç¼–è¾‘è¯¥è¿æ¥çš„é…ç½®ï¼š**æ­£ç¡®çš„ CLI æ°¸ä¹…è®¾ç½®å†™æ³•è¦ç”¨ `feature-xxx`**ã€‚

------

#### æ­£ç¡®å†™æ³•ç¤ºä¾‹

```bash
nmcli connection modify ens33 \
  ethtool.feature-tso no \
  ethtool.feature-gso no \
  ethtool.feature-gro no \
  ethtool.feature-lro no \
  ethtool.feature-rx no \
  ethtool.feature-tx no
```

æˆ–è€…æœ‰äº›ç‰ˆæœ¬éœ€è¦ç›´æ¥å»æ‰ `ethtool.` å‰ç¼€ï¼š

```bash
nmcli connection modify ens33 \
  feature-tso no \
  feature-gso no \
  feature-gro no \
  feature-lro no \
  feature-rx no \
  feature-tx no
```

------

#### ç«‹å³ç”Ÿæ•ˆ

```bash
nmcli connection down ens33
nmcli connection up ens33
```

------

## éªŒè¯1

```bash
nmcli connection show ens33 | grep feature
ethtool -k ens33
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š

```text
tcp-segmentation-offload: off
generic-segmentation-offload: off
generic-receive-offload: off
large-receive-offload: off
rx-checksumming: off
tx-checksumming: off
```

## éªŒè¯2â˜…ï¼Œå…¶å®æ‰æ˜¯æœ€ä½³å®è·µå…¥å£

ç›´æ¥æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œæ˜¯å¦æœ‰æ–°çš„é…ç½®ç”Ÿæˆï¼Œå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥ä»é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ï¼Œç„¶åreload upå°±è¡Œäº†

```shell
[root@localhost system-connections]# ll
total 4
-rw-------. 1 root root 344 Dec 22 16:41 ens33.nmconnection
[root@localhost system-connections]# cat ens33.nmconnection
[connection]
id=ens33
uuid=dbb81dea-080f-3308-8ae1-9de3034cd71b
type=ethernet
autoconnect-priority=-999
interface-name=ens33
timestamp=1766392474

[ethernet]

[ethtool]
feature-gro=false
feature-gso=false
feature-lro=false
feature-rx=false
feature-tso=false
feature-tx=false

[ipv4]
method=auto

[ipv6]
addr-gen-mode=eui64
method=auto

[proxy]

```

âœ… ä¼˜ç‚¹ï¼š

- é‡å¯åè‡ªåŠ¨ç”Ÿæ•ˆ
- å®˜æ–¹æ”¯æŒ
- ä¸ä¾èµ–é¢å¤–è„šæœ¬

------





```shel
virt-install    --name=10.5.2.39-mysql --ram=8192 --vcpus=4 --cpu host --cdrom=/iso/CentOS-7-x86_64-Minimal-1908.iso --os-type=linux  --disk /data/10.5.2.39-mysql.qcow2,size=500G,bus=virtio,cache=none --network bridge=br0,model=e1000 --network bridge=br1,model=e1000 --graphics vnc,port=5906,listen=0.0.0.0,password=t812pg2LrDOsyLlTBFJBPztd2PkeVO --hvm \


```

```
virt-install \
--name vm001-a.b.c.d \
--memory 2048 \
--vcpus 2 \
--cpu host \
--disk path=/var/lib/libvirt/images/vm001.qcow2,size=15,bus=virtio,cache=none \
--os-variant rocky10 \
--network bridge=br1,model=virtio \
--network bridge=br2,model=virtio \
--graphics none \
--console pty,target_type=serial \
--location /data/isos/Rocky-10.1-x86_64-minimal.iso \
--extra-args "ks=http://your-server/ks-rocky10.cfg console=ttyS0,115200n8"
```





# virt-manageræœ€ä½³å®è·µ-win11

# 1ã€windows11

wsl2åˆ«ç”¨ï¼Œè¦å…³é—­å¹²å‡€ï¼Œå› ä¸ºæˆ‘ç”µè„‘ä¸Šæœ‰vmware workstaionçš„VMè¦å¼€æœºCPUè™šæ‹ŸåŒ–ã€‚



ğŸ‘ å¾ˆå¥½ï¼Œè¿™ä¸€æ­¥**éå¸¸å…³é”®**ï¼Œè€Œä¸”ä½ å·²ç»æŠŠ**æœ€å¤§çš„ä¸€é¢—é›·æ‹”æ‰äº†**ã€‚

ç°åœ¨ä½ çš„çŠ¶æ€æ˜¯ï¼š

```
é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿåˆ†å‘:
Ubuntu (é»˜è®¤å€¼)
```

ğŸ‘‰ **docker-desktop / docker-desktop-data å·²ç»å®Œå…¨æ¸…å¹²å‡€**
ğŸ‘‰ è¯´æ˜ **WSL è¿™æ¡çº¿å·²ç»ä¸å†ä¸»åŠ¨æ‹‰èµ· Hyper-V**

ä½†æˆ‘è¦å¾ˆç›´ç™½åœ°å‘Šè¯‰ä½ ä¸€å¥è¿ç»´ç»“è®ºï¼š

> **ç°åœ¨ VMware è¿˜èµ·ä¸æ¥ VT-x/EPTï¼Œåªå¯èƒ½æ˜¯ Windows è™šæ‹ŸåŒ–åŠŸèƒ½æˆ– VBS è¿˜æ®‹ç•™ç€**

ä¸‹é¢æˆ‘ä»¬ç›´æ¥è¿›å…¥**â€œæœ€åæ¸…åœºé˜¶æ®µâ€**ã€‚

------

## ä¸€ã€å…ˆç»™ä½ ä¸€ä¸ªâ€œåˆ¤æ–­ç‚¹â€ï¼ˆä¸ç”¨çŒœï¼‰

ä½ ç°åœ¨ç«‹åˆ»æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼ˆç®¡ç†å‘˜ PowerShellï¼‰ï¼š

```powershell
systeminfo | findstr /i "Hyper-V"
```

### ç†æƒ³è¾“å‡ºï¼ˆè¿™æ˜¯â€œå®Œå…¨å¹²å‡€â€çš„çŠ¶æ€ï¼‰åº”è¯¥ç±»ä¼¼ï¼š

```
æœªæ£€æµ‹åˆ° Hyper-V è¦æ±‚ã€‚
```

### å¦‚æœä½ çœ‹åˆ°ç±»ä¼¼ä¸‹é¢ä»»ä½•ä¸€å¥ï¼ˆå“ªæ€•ä¸€è¡Œï¼‰ğŸ‘‡

```
å·²æ£€æµ‹åˆ° Hyper-V è¦æ±‚
è™šæ‹Ÿæœºç›‘æ§ç¨‹åºå·²æ£€æµ‹åˆ°
éœ€è¦å¯ç”¨è™šæ‹Ÿæœºç›‘æ§ç¨‹åº
```

ğŸ‘‰ **è¯´æ˜ Hypervisor ä»åœ¨è¿è¡Œ**
ğŸ‘‰ VMware ç»§ç»­æŠ¥ VT-x/EPT æ˜¯â€œå¿…ç„¶ç»“æœâ€

------

#### äºŒã€ä¸€æ­¥åˆ°ä½çš„â€œå¼ºåˆ¶æ¸…ç©ºæ–¹æ¡ˆâ€ï¼ˆå»ºè®®ä½ ç›´æ¥ç…§åšï¼‰

å³ä½¿ä½ ä¹‹å‰åšè¿‡ï¼Œæˆ‘ä¹Ÿå»ºè®®**å®Œæ•´å†è·‘ä¸€é**ï¼ˆå¾ˆå¤šäººæ¼ä¸€æ­¥ï¼‰ã€‚

------

##### âœ… 1ï¸âƒ£ Windows åŠŸèƒ½ï¼ˆä¸€ä¸ªéƒ½ä¸èƒ½ç•™ï¼‰

**æ§åˆ¶é¢æ¿ â†’ å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½**

ç¡®è®¤ä»¥ä¸‹ **å…¨éƒ¨æœªå‹¾é€‰**ï¼š

```
â˜ Hyper-V
â˜ Virtual Machine Platform
â˜ Windows Hypervisor Platform
â˜ Windows Sandbox
â˜ Microsoft Defender Application Guard
```

ç‚¹ã€ç¡®å®šã€‘â†’ **é‡å¯**

------

##### âœ… 2ï¸âƒ£ bcdeditï¼ˆå¼ºåˆ¶ä¸ç»™ hypervisor å¯åŠ¨ï¼‰

ç®¡ç†å‘˜ PowerShellï¼š

```powershell
bcdedit /set hypervisorlaunchtype off
```

æ‰§è¡Œå®Œ **å¿…é¡»é‡å¯**

------

##### âœ… 3ï¸âƒ£ å…³ VBSï¼ˆè¿™æ˜¯æœ€å 20% çš„å‘ï¼‰

#### å›¾å½¢æ–¹å¼ï¼ˆæ¨èï¼‰

Windows å®‰å…¨ä¸­å¿ƒ â†’ è®¾å¤‡å®‰å…¨ â†’ æ ¸å¿ƒéš”ç¦»

```
å†…å­˜å®Œæ•´æ€§ = å…³é—­
```

å…³é—­å **é‡å¯**

> å¾ˆå¤šæœºå™¨è¿™é‡Œæ²¡å…³ï¼Œå“ªæ€•æ²¡è£… Hyper-Vï¼ŒVT-x ä¹Ÿä¼šè¢«åƒæ‰

------

##### âœ… 4ï¸âƒ£ å†ç¡®è®¤ä¸€æ¬¡ï¼ˆéå¸¸é‡è¦ï¼‰

é‡å¯åï¼Œå†æ‰§è¡Œï¼š

```powershell
systeminfo | findstr /i "Hyper-V"
```

å¦‚æœè¿™ä¸€æ­¥æ˜¯ **å¹²å‡€çŠ¶æ€**ï¼Œæˆ‘ä»¬å°±èµ¢äº† 90%ã€‚

------

#### ä¸‰ã€VMware é‡Œä½ å¿…é¡»ç¡®è®¤çš„ä¸€å¤„ï¼ˆå®¹æ˜“è¢«å¿½ç•¥ï¼‰

**è™šæ‹Ÿæœº â†’ Settings â†’ Processors**

ç¡®ä¿ï¼š

```
â˜ Virtualize Intel VT-x/EPT or AMD-V/RVI
```

ğŸ‘‰ è¿™ä¸ªæ˜¯ **åµŒå¥—è™šæ‹ŸåŒ–**
ğŸ‘‰ å‹¾äº†åè€Œæ›´å®¹æ˜“åœ¨ Windows ä¸ŠæŠ¥é”™

------

#### å››ã€ç»™ä½ ä¸€ä¸ªâ€œç»ˆæåˆ¤æ–­æ³•â€ï¼ˆä¸ç”¨å†æ€€ç–‘ï¼‰

##### æ–¹æ³• 1ï¼šä»»åŠ¡ç®¡ç†å™¨

ä»»åŠ¡ç®¡ç†å™¨ â†’ æ€§èƒ½ â†’ CPU

å¦‚æœä½ çœ‹åˆ°ï¼š

```
è™šæ‹ŸåŒ–ï¼šå·²å¯ç”¨
```

å¹¶ä¸” VMware è™šæ‹Ÿæœºèƒ½æ­£å¸¸å¯åŠ¨
âœ… **é—®é¢˜è§£å†³**

------

##### æ–¹æ³• 2ï¼šVMware æŠ¥é”™æ˜¯å¦æ¶ˆå¤±

- ä¸å†å‡ºç° `Intel VT-x/EPT is not supported`
- å®¢æˆ·æœºèƒ½å¯åŠ¨

âœ… **100% æˆåŠŸ**

------

#### äº”ã€ç«™åœ¨ä½ è¿™ä¸ªâ€œæè™šæ‹ŸåŒ– + è®²è¯¾â€çš„è§’åº¦ï¼Œç»™ä½ ä¸€å¥å»ºè®®

ä½ è¿™ä¸ªç¯å¢ƒï¼Œæˆ‘å»ºè®®ä½ é•¿æœŸä¿æŒï¼š

```
Windows:
  âŒ Hyper-V
  âŒ WSL2
  âŒ Docker Desktop
  âŒ VBS
  âœ… VMware Workstation

Linux:
  âœ… VMware è™šæ‹Ÿæœºé‡Œç© KVM / Docker / EVE-NG
```

è¿™æ˜¯**æœ€ç¨³ã€æœ€å¯æ§ã€æœ€å°‘è¸©å‘**çš„ç»„åˆã€‚

------

#### å…­ã€ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥â€œæ¥ç®¡å¼æ’æŸ¥â€

ä½ å¯ä»¥ç›´æ¥æŠŠ **ä¸‹é¢è¿™ä¸€æ¡çš„å®Œæ•´è¾“å‡ºåŸæ ·è´´å‡ºæ¥**ï¼ˆä¸ç”¨æˆªå›¾ï¼‰ï¼š

```powershell
systeminfo
```

æˆ‘å¯ä»¥ç›´æ¥å‘Šè¯‰ä½ ä¸€å¥ï¼š

> **â€œç°åœ¨æ˜¯è°åœ¨å  VT-xâ€**
> æˆ–è€…
> **â€œå·²ç» 100% å¹²å‡€ï¼ŒVMware å“ªä¸€æ­¥è¯¥æ€ä¹ˆç‚¹â€**

ä½ ç°åœ¨è¿™ä¸ªçŠ¶æ€ï¼Œå·²ç»ç¦»æˆåŠŸ **åªå·®æœ€åä¸€é“é—¨æ§›**ã€‚



éå¸¸å¥½ï¼Œè¿™ä¸€è¡Œè¾“å‡º**ç­‰äºâ€œæœ€ç»ˆåˆ¤å†³ä¹¦â€**ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥**100%ç¡®å®šåŸå› **äº†ã€‚

ä½ è¿™å¥æ˜¯ï¼š

```
Hyper-V è¦æ±‚: å·²æ£€æµ‹åˆ°è™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€‚å°†ä¸æ˜¾ç¤º Hyper-V æ‰€éœ€çš„åŠŸèƒ½ã€‚
```

------

##### ä¸€ã€è¿™å¥è¯ç¿»è¯‘æˆè¿ç»´äººè¯å°±æ˜¯ä¸€å¥

> **Windows çš„ Hypervisor ç°åœ¨ä»ç„¶åœ¨è¿è¡Œï¼Œå¹¶ä¸”å·²ç»æŠ¢å äº† Intel VT-x/EPTã€‚**

æ‰€ä»¥ç»“è®ºéå¸¸æ˜ç¡®ï¼š

> âŒ **ä¸æ˜¯ VMware çš„é—®é¢˜**
> âŒ **ä¸æ˜¯ BIOS çš„é—®é¢˜**
> âŒ **ä¸æ˜¯ WSL çš„é—®é¢˜**
> âœ… **æ˜¯ Windows å¯åŠ¨æ—¶ä»ç„¶æ‹‰èµ·äº† hypervisor**

------

##### äºŒã€ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ˆå…³é”®è®¤çŸ¥ï¼‰

å³ä½¿ä½ å·²ç»åšåˆ°ï¼š

- å¸è½½ Docker Desktop âœ…
- WSL åªå‰© Ubuntuï¼ˆWSL1ï¼‰âœ…
- Windows åŠŸèƒ½é‡Œå…³äº† Hyper-Vï¼ˆå¯èƒ½ï¼‰âœ…

**åªè¦ä¸‹é¢ä»»æ„ä¸€æ¡æˆç«‹ï¼Œhypervisor ä»ç„¶ä¼šå¯åŠ¨ï¼š**

1. `hypervisorlaunchtype` ä¸æ˜¯ `off`
2. VBS / å†…å­˜å®Œæ•´æ€§ è¿˜å¼€ç€
3. æ›¾å¯ç”¨è¿‡æŸäº›â€œéšå½¢è™šæ‹ŸåŒ–åŠŸèƒ½â€ï¼ŒBCD é‡Œè¿˜åœ¨

ğŸ‘‰ ä½ ç°åœ¨æ­£æ˜¯ **ç¬¬ 1 æˆ–ç¬¬ 2 ç§æƒ…å†µ**ï¼ˆå‡ ä¹è‚¯å®šï¼‰

------

##### ä¸‰ã€ä¸€æ­¥åˆ°ä½ï¼š100% å…³é—­ Hypervisorï¼ˆç…§æŠ„ï¼‰

##### âœ… ç¬¬ä¸€æ­¥ï¼ˆæœ€å…³é”®ï¼Œå¼ºåˆ¶çº§ï¼‰

**ç®¡ç†å‘˜ PowerShell / CMDï¼š**

```bat
bcdedit /set hypervisorlaunchtype off
```

å¦‚æœè¿”å›ï¼š

```
æ“ä½œæˆåŠŸå®Œæˆ
```

ğŸ‘‰ ç»§ç»­

------

##### âœ… ç¬¬äºŒæ­¥ï¼ˆå¿…é¡»é‡å¯ï¼‰

**ç«‹åˆ»é‡å¯ Windows**
âš ï¸ è¿™ä¸€æ­¥ä¸èƒ½çœï¼Œå¦åˆ™ä¸‹é¢åˆ¤æ–­å…¨æ˜¯å‡çš„

------

##### âœ… ç¬¬ä¸‰æ­¥ï¼ˆé‡å¯åç«‹åˆ»éªŒè¯ï¼‰

é‡å¯åï¼Œ**ç¬¬ä¸€ä»¶äº‹**æ‰§è¡Œï¼š

```powershell
systeminfo | findstr /i "Hyper-V"
```

###### ğŸ¯ æ­£ç¡®ç»“æœå¿…é¡»æ˜¯ï¼ˆæˆ–ç±»ä¼¼ï¼‰ï¼š

```
æœªæ£€æµ‹åˆ° Hyper-V è¦æ±‚ã€‚
```

æˆ–è€…ï¼š

```
Hyper-V è¦æ±‚: è™šæ‹Ÿæœºç›‘æ§ç¨‹åºæœªæ£€æµ‹åˆ°
```

**åªè¦ä¸å†å‡ºç°ã€Œå·²æ£€æµ‹åˆ°è™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€è¿™å¥è¯ï¼Œå°±æˆåŠŸäº†ã€‚**

------

##### å››ã€å¦‚æœä½ æ‰§è¡Œäº† bcdedit ä»ç„¶ä¸è¡Œï¼ˆå…œåº•æ–¹æ¡ˆï¼‰

> è¿™ä¸ªæƒ…å†µ **åªä¼šå‡ºç°åœ¨ VBS æ²¡å…³å¹²å‡€**

###### å†ç¡®è®¤ä¸€æ¬¡ï¼ˆéå¸¸é‡è¦ï¼‰ï¼š

**Windows å®‰å…¨ä¸­å¿ƒ â†’ è®¾å¤‡å®‰å…¨ â†’ æ ¸å¿ƒéš”ç¦»**

```
å†…å­˜å®Œæ•´æ€§ = å…³é—­
```

å…³é—­å â†’ **é‡å¯**

ç„¶åå†è·‘ä¸€æ¬¡ï¼š

```powershell
systeminfo | findstr /i "Hyper-V"
```

------

##### äº”ã€åˆ°è¿™ä¸€æ­¥ï¼ŒVMware å¿…ç„¶æ¢å¤ï¼ˆä¸æ˜¯â€œå¯èƒ½â€ï¼‰

åªè¦ï¼š

- `systeminfo` **ä¸å†æ˜¾ç¤ºè™šæ‹Ÿæœºç›‘æ§ç¨‹åº**
- VMware è™šæ‹Ÿæœº **ä¸å†æŠ¥ VT-x/EPT**

é‚£å°±æ˜¯ï¼š

> âœ… **ç‰©ç† VT-x å·²å®Œå…¨å›åˆ° VMware æ‰‹é‡Œ**

------

##### å…­ã€å†å¸®ä½ ç¡®è®¤ä¸€ä¸ªâ€œä¸ä¼šå†è¸©å‘â€çš„ç‚¹

###### VMware è™šæ‹Ÿæœº â†’ Settings â†’ Processors

ç¡®ä¿ï¼š

```
â˜ Virtualize Intel VT-x/EPT or AMD-V/RVI
```

> è¿™æ˜¯åµŒå¥—è™šæ‹ŸåŒ–
> Windows å®¿ä¸» + VMware åœºæ™¯ä¸‹ï¼Œ**å…ˆåˆ«ç¢°å®ƒ**

------

##### ä¸ƒã€ä¸€å¥â€œè€è¿ç»´ç»“è®ºâ€ï¼Œä½ å¯ä»¥ç›´æ¥è®°ä½

> **çœ‹åˆ° `å·²æ£€æµ‹åˆ°è™šæ‹Ÿæœºç›‘æ§ç¨‹åº`
> â†’ VMware å¿…æ­»
> â†’ åªçœ‹ bcdedit + VBS
> â†’ å’Œ WSL1 / WSL2 å·²ç»æ²¡å…³ç³»äº†**

------

##### å…«ã€ä¸‹ä¸€æ­¥ä½ å¯ä»¥ç›´æ¥å›æˆ‘ä¸€å¥

ä½ ç°åœ¨å¯ä»¥ç›´æ¥å›æˆ‘ **äºŒé€‰ä¸€** çš„ç»“æœå³å¯ï¼š

1ï¸âƒ£

```
systeminfo ç°åœ¨å·²ç»ä¸æ˜¾ç¤ºâ€œå·²æ£€æµ‹åˆ°è™šæ‹Ÿæœºç›‘æ§ç¨‹åºâ€
```

2ï¸âƒ£

```
æ‰§è¡Œäº† bcdedit + é‡å¯ï¼Œsysteminfo è¿˜æ˜¯æ˜¾ç¤ºè™šæ‹Ÿæœºç›‘æ§ç¨‹åº
```

æˆ‘å¯ä»¥æ ¹æ®ä½ è¿™ä¸€å¥ï¼Œ**ç›´æ¥ç»™ä½ æœ€åä¸€åˆ€**ï¼ˆå¦‚æœè¿˜éœ€è¦çš„è¯ï¼‰ã€‚

# 2ã€virt-mangerè¦è°ƒå­—ä½“

**virt-managerè°ƒå¤§èœå•å­—ä½“**

export GDK_SCALE=2å°±è¡Œäº†

![image-20251223111901195](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251223111901195.png)









# 3ã€virt-manger è¿œç¨‹ç®¡ç†è¦é…ç½®sshï¼Œwsl1ç”¨keyç™»å½•æˆ–askpassæ¥è¾“å…¥å¯†ç 

å¯†ç ç™»å…¥è¦å®‰è£…askpassï¼Œkeyä¹Ÿç®€å•çš„

![image-20251230154037817](03.KVMä½¿ç”¨virt-manageråˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251230154037817.png)







