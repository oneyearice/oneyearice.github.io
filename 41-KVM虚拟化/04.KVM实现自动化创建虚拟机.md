# 04.KVMå®žçŽ°è‡ªåŠ¨åŒ–åˆ›å»ºè™šæ‹Ÿæœº.md



# 1ã€æŸ¥çœ‹æ”¯æŒçš„osçš„ä¸¤ä¸ªcli 

```shell
virt-install --osinfo list
osinfo-query os
```

![image-20251223150350946](04.KVMå®žçŽ°è‡ªåŠ¨åŒ–åˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251223150350946.png)



 è¿™æ˜¯win2016 2008è¿™ä¸‹ðŸ‘‡

![image-20251223150616911](04.KVMå®žçŽ°è‡ªåŠ¨åŒ–åˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251223150616911.png)



![image-20251223150820271](04.KVMå®žçŽ°è‡ªåŠ¨åŒ–åˆ›å»ºè™šæ‹Ÿæœº.assets/image-20251223150820271.png)







```
# ===============================
# åŸºç¡€å®‰è£…æ–¹å¼
# ===============================
install
text
reboot
cdrom

# ===============================
# è¯­è¨€ / é”®ç›˜ / æ—¶åŒº
# ===============================
lang zh_CN.UTF-8
keyboard us
timezone Asia/Shanghai --isUtc

# ===============================
# ç½‘ç»œï¼ˆDHCPï¼Œç”Ÿäº§å»ºè®®è£…åŽå†æ”¹ï¼‰
# ===============================
network --bootproto=dhcp --device=eth0 --onboot=on

# ===============================
# Root å¯†ç ï¼ˆå»ºè®®ä¸Šçº¿åŽç«‹åˆ»æ”¹ï¼‰
# ===============================
rootpw --plaintext ChangeMe123!

# ===============================
# SELinux / é˜²ç«å¢™ï¼ˆç”Ÿäº§æŽ¨èï¼‰
# ===============================
selinux --permissive
firewall --enabled --service=ssh

# ===============================
# å¯åŠ¨å™¨
# ===============================
bootloader --location=mbr

# ===============================
# ç£ç›˜åˆ†åŒºï¼ˆç”Ÿäº§å¸¸ç”¨ï¼‰
# ===============================
zerombr
clearpart --all --initlabel

part /boot --fstype=xfs --size=1024
part swap --size=8192

part pv.01 --grow
volgroup vg0 pv.01

logvol /     --vgname=vg0 --size=20480 --name=root --fstype=xfs
logvol /var  --vgname=vg0 --size=20480 --name=var  --fstype=xfs
logvol /data --vgname=vg0 --grow  --name=data --fstype=xfs

# ===============================
# è½¯ä»¶åŒ…
# ===============================
%packages
@^minimal-environment
@core

vim
wget
curl
bash-completion
net-tools
bind-utils
chrony
rsyslog
lsof
tcpdump
htop
git

-audio
-plymouth
%end

# ===============================
# å®‰è£…åŽé…ç½®
# ===============================
%post --log=/root/ks-post.log

# è®¾ç½®æ—¶é’Ÿ
systemctl enable chronyd
systemctl start chronyd

# SSH åŸºç¡€åŠ å›º
sed -i 's/^#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config
sed -i 's/^GSSAPIAuthentication yes/GSSAPIAuthentication no/' /etc/ssh/sshd_config
systemctl restart sshd

# æé«˜æ–‡ä»¶å¥æŸ„
cat >> /etc/security/limits.conf <<EOF
* soft nofile 1048576
* hard nofile 1048576
* soft nproc  65535
* hard nproc  65535
EOF

# sysctl å¸¸ç”¨ä¼˜åŒ–
cat > /etc/sysctl.d/99-prod.conf <<EOF
net.ipv4.ip_forward = 0
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.core.somaxconn = 65535
fs.file-max = 2097152
vm.swappiness = 10
EOF

sysctl --system

%end

```

