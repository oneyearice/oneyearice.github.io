# 02.KVMæ¶æ„å’Œå®‰è£….md

æŸ¥å†…æ ¸æ˜¯å¦æ”¯æŒæŸä¸ªåŠŸèƒ½

![image-20251209154503438](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209154503438.png)



=må°±æ˜¯æ¨¡å—åŒ–çš„æ–¹å¼

![image-20251209154621746](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209154621746.png)



=yå’Œ=mçš„åŒºåˆ«å°±æ˜¯yæ˜¯é›†æˆåœ¨å†…æ ¸æ–‡ä»¶é‡Œï¼Œå¼€æœºåŠ è½½

![image-20251209154712537](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209154712537.png)

=mæ˜¯æ¨¡å—æ–¹å¼ï¼Œæ˜¯æŒ‰éœ€åŠ è½½

é‚£ä¹ˆå½“å‰æœºå™¨=mï¼Œåˆ°åº•åŠ è½½æ²¡æœ‰ï¼Ÿ



![image-20251209154821405](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209154821405.png)

è¯´æ˜æ²¡æœ‰åŠ è½½ğŸ‘†ï¼Œå…¶å®å°±æ˜¯VMæ²¡æœ‰å‹¾é€‰ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œå‹¾é€‰äº†å°±æ˜¯æ”¯æŒäº†ï¼Œè‡ªåŠ¨å°±ä¼šåŠ è½½ã€‚

![image-20251209154917203](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209154917203.png)



æ‰‹åŠ¨åŠ è½½ï¼Œä½†æ˜¯ä¸Šå›¾è¡¨æ˜äº†è¯¥æœºå™¨ CPUä¸æ”¯æŒè™šæ‹ŸåŒ–ï¼Œæ‰€ä»¥æ‰‹åŠ¨åŠ è½½äº†ä¹Ÿæ²¡æœ‰ç”¨

![image-20251209155017999](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209155017999.png)



KVMåœ¨çº¢å¸½ä¼ä¸šç‰ˆæœ‰é™åˆ¶ï¼Œå…¶ä»–centosï¼Œubuntuæ²¡æœ‰é™åˆ¶

![image-20251209155917100](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209155917100.png)



ç»“åˆä¸Šé¢çš„å¼€å»cpuè™šæ‹ŸåŒ–çš„å‹¾é€‰ï¼Œå†çœ‹è¿™é‡Œçš„æˆªå›¾

CPUæ”¯æŒï¼Œå°±ä¼šlsmodçœ‹åˆ°åŠ è½½ğŸ‘‡

![image-20251209163636960](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209163636960.png)

amdçš„æ˜¯svm

![image-20251209163654477](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251209163654477.png)





| ç»´åº¦     | cockpitï¼ˆservice å•å…ƒï¼‰                       | cockpit.socketï¼ˆsocket å•å…ƒï¼‰                                |
| -------- | --------------------------------------------- | ------------------------------------------------------------ |
| å•å…ƒç±»å‹ | `.service`ï¼ˆæœåŠ¡å•å…ƒï¼‰                        | `.socket`ï¼ˆå¥—æ¥å­—å•å…ƒï¼‰                                      |
| è¿è¡Œæ¨¡å¼ | å¸¸é©»å‹ï¼šå¯åŠ¨åä¸€ç›´å ç”¨ç³»ç»Ÿèµ„æºï¼ŒæŒç»­è¿è¡Œ      | æŒ‰éœ€å‹ï¼šä»…ç›‘å¬æŒ‡å®šç«¯å£ï¼Œæœ‰è¯·æ±‚æ—¶æ‰å¯åŠ¨ Cockpit ä¸»æœåŠ¡        |
| è§¦å‘é€»è¾‘ | å¯åŠ¨å³è¿è¡Œ Cockpit ä¸»è¿›ç¨‹ï¼Œæ— è®ºæ˜¯å¦æœ‰è®¿é—®è¯·æ±‚ | ä»…ç›‘å¬ Cockpit çš„é»˜è®¤ç«¯å£ï¼ˆ9090ï¼‰ï¼Œå½“æœ‰å®¢æˆ·ç«¯è®¿é—®è¯¥ç«¯å£æ—¶ï¼Œè‡ªåŠ¨è§¦å‘å¯åŠ¨ `cockpit.service`ï¼›æ— è¯·æ±‚æ—¶ï¼Œsocket ä»…å æå°‘èµ„æºï¼Œä¸»æœåŠ¡ä¸è¿è¡Œ |
| èµ„æºå ç”¨ | è¾ƒé«˜ï¼ˆå¸¸é©»è¿›ç¨‹ï¼‰                              | æä½ï¼ˆä»…å¥—æ¥å­—ç›‘å¬ï¼Œæ— ä¸»è¿›ç¨‹ï¼‰                               |
| å…¸å‹ç”¨é€” | é€‚åˆé«˜é¢‘è®¿é—® Cockpit çš„åœºæ™¯ï¼ˆå¦‚è¿ç»´å·¥ä½œç«™ï¼‰   | é€‚åˆä½é¢‘è®¿é—®ã€æ³¨é‡èµ„æºèŠ‚çœçš„åœºæ™¯ï¼ˆå¦‚æœåŠ¡å™¨ï¼‰                 |

### å…³é”®è¡¥å……

1. **ä¾èµ–å…³ç³»**ï¼š`cockpit.socket` æ˜¯ Cockpit æ¨èçš„é»˜è®¤å¯åŠ¨æ–¹å¼ï¼Œå®ƒæœ¬è´¨æ˜¯ `cockpit.service` çš„ â€œè§¦å‘å™¨â€â€”â€” å¯ç”¨ `cockpit.socket` åï¼Œæ— éœ€æ‰‹åŠ¨å¯åŠ¨ `cockpit.service`ï¼Œè®¿é—® 9090 ç«¯å£æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨æ‹‰èµ·ä¸»æœåŠ¡ï¼›
2. æ“ä½œé€»è¾‘ï¼š

   - å¯åŠ¨ `cockpit.socket`ï¼š`systemctl start cockpit.socket` â†’ ä»…ç›‘å¬ç«¯å£ï¼Œä¸»æœåŠ¡æœªè¿è¡Œï¼›
   - å¯åŠ¨ `cockpit.service`ï¼š`systemctl start cockpit.service` â†’ ç›´æ¥è¿è¡Œä¸»æœåŠ¡ï¼Œå³ä½¿æ— è®¿é—®è¯·æ±‚ä¹Ÿå¸¸é©»ï¼›
   - å¯ç”¨å¼€æœºè‡ªå¯ï¼šæ¨èå¯ç”¨ `cockpit.socket`ï¼ˆ`systemctl enable cockpit.socket`ï¼‰ï¼Œè€Œéç›´æ¥å¯ç”¨ `cockpit.service`ï¼Œæ›´èŠ‚çœæœåŠ¡å™¨èµ„æºã€‚



![image-20251211133516235](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251211133516235.png)



9.5 æˆ‘æµ‹è¯•å‘ç°æœ‰å†…éƒ¨é”™è¯¯æ— æ³•è§£å†³ï¼Œæ”¹æˆ9.3ä¸€ä¸‹å­å¥½äº†ï¼Œåˆ¤æ–­9.5çš„é‚£å°æœºå™¨å¯èƒ½æ˜¯æˆ‘ä¹‹å‰æŠ˜è…¾å…¶ä»–ç¯å¢ƒææˆ–è€…æ˜¯python 10å¯¼è‡´çš„ã€‚



æ”¾å¼€rootç™»å…¥webğŸ‘‡

![image-20251211164223473](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251211164223473.png)





cockpit.socket æ˜¯webé¡µé¢ç®¡ç†rockyçš„

cockpit-machinesæ˜¯webé‡Œè™šæ‹Ÿæœºç®¡ç†æ¨¡å—

![image-20251211172123605](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251211172123605.png)





# KVMç»å…¸æ¡¥æ¥â˜…

------

## âœ… æ­£ç¡®æ¨¡å‹ï¼ˆä½ è¿™ä¸ªéœ€æ±‚ä¸‹ï¼‰

> **å®¿ä¸»æœºè¦è®¿é—®ç½‘ç»œï¼ŒVM ä¹Ÿè¦è®¿é—®ç½‘ç»œï¼Œä¸” VM ç›´é€šå†…å¤–ç½‘**

ğŸ‘‰ **IP å¿…é¡»åœ¨ bridgeï¼ˆbrï¼‰ä¸Š**
ğŸ‘‰ **ç‰©ç†å£ em1 / em2 ä¸èƒ½å†æ‹¿ IP**

ä¹Ÿå°±æ˜¯è¯´ï¼š

| è®¾å¤‡        | æ˜¯å¦æ‹¿ IP   | ä½œç”¨     |
| ----------- | ----------- | -------- |
| em1         | âŒ ä¸æ‹¿      | åªæ˜¯ç½‘çº¿ |
| em2         | âŒ ä¸æ‹¿      | åªæ˜¯ç½‘çº¿ |
| **br1**     | âœ… æ‹¿å¤–ç½‘ IP | å®¿ä¸»å¤–ç½‘ |
| **br2**     | âœ… æ‹¿å†…ç½‘ IP | å®¿ä¸»å†…ç½‘ |
| vm001 ç½‘å¡1 | âœ…           | å¤–ç½‘     |
| vm001 ç½‘å¡2 | âœ…           | å†…ç½‘     |

âš ï¸ **ç»å¯¹ä¸è¦**è®© em å’Œ br åŒæ—¶æ‹¿ IP
å¦åˆ™å°±æ˜¯ä½ åˆšæ‰é‡åˆ°çš„ï¼š
ğŸ‘‰ `nmcli up` å¡ä½
ğŸ‘‰ SSH æ–­
ğŸ‘‰ è·¯ç”±ä¹±è·³

------

## ğŸ§  ä¸ºä»€ä¹ˆå¿…é¡»è¿™æ ·ï¼Ÿ

Linux bridge æœ¬è´¨ä¸Šæ˜¯ä¸ª**è™šæ‹Ÿäº¤æ¢æœº**ï¼š

- em1 æ˜¯äº¤æ¢æœºçš„ä¸€ä¸ªç«¯å£
- vnetX æ˜¯äº¤æ¢æœºçš„ä¸€ä¸ªç«¯å£
- **IP å¿…é¡»é…ç½®åœ¨äº¤æ¢æœºä¸Šï¼Œè€Œä¸æ˜¯ç«¯å£ä¸Š**

è¿™å’ŒçœŸå®æœºæˆ¿é‡Œï¼š

> æœåŠ¡å™¨æ’åœ¨äº¤æ¢æœºä¸Š
> IP é…åœ¨æœåŠ¡å™¨ï¼Œä¸é…åœ¨äº¤æ¢æœºç«¯å£

æ˜¯**åŒä¸€ä¸ªé€»è¾‘**ã€‚

------

## ğŸ§± ä½ çš„ç›®æ ‡æ‹“æ‰‘ï¼ˆæœ€ç»ˆå½¢æ€ï¼‰

```
        å¤–ç½‘
         |
       em1
         |
       br1  <---- å®¿ä¸»å¤–ç½‘ IP
      /   \
   vnet0  å®¿ä¸»
     |
   vm001(å¤–ç½‘)

--------------------------------

       å†…ç½‘
         |
       em2
         |
       br2  <---- å®¿ä¸»å†…ç½‘ IP
      /   \
   vnet1  å®¿ä¸»
     |
   vm001(å†…ç½‘)
```

<img src="02.KVMæ¶æ„å’Œå®‰è£….assets/image-20260123173343479.png" alt="image-20260123173343479" style="zoom:50%;" />



------

## ğŸ§© Rocky 10 é…ç½®æ–‡ä»¶æ–¹å¼ï¼ˆkeyfileï¼‰

### â‘  å¤–ç½‘æ¡¥ br1ï¼ˆå®¿ä¸»æ‹¿å¤–ç½‘ IPï¼‰

```shell
[root@phy001 system-connections]# cat /etc/NetworkManager/system-connections/br1.nmconnection
[connection]
id=br1
uuid=ff5e5656-9725-4479-ac37-02c03f9298a4
type=bridge
interface-name=br1
autoconnect=true

[bridge]
stp=false

[ipv4]
method=auto

[ipv6]
method=ignore
```

------

### â‘¡ em1 ä½œä¸º br1 ä»å£ï¼ˆä¸æ‹¿ IPï¼‰

```shell
[root@phy001 system-connections]# cat /etc/NetworkManager/system-connections/em1.nmconnection
[connection]
id=em1
uuid=75688915-eb0a-49fa-b005-72bf1e445b48
type=ethernet
interface-name=ens33
autoconnect=true
master=br1
slave-type=bridge

[ethernet]

[ipv4]
method=disabled

[ipv6]
method=ignore

[proxy]
```

------

### â‘¢ å†…ç½‘æ¡¥ br2ï¼ˆå®¿ä¸»æ‹¿å†…ç½‘ IPï¼‰

```shell
[root@phy001 system-connections]# cat /etc/NetworkManager/system-connections/br2.nmconnection
[connection]
id=br2
uuid=e753c1d2-8289-464c-8ee0-bdd1e79427b8
type=bridge
interface-name=br2
autoconnect=true

[bridge]
stp=false

[ipv4]
method=manual
addresses=123.1.1.1/24
gateway=123.1.1.254
dns=1.1.1.1

[ipv6]
method=ignore
```

------

### â‘£ em2 åŠ å…¥ br2ï¼ˆä¸æ‹¿ IPï¼‰

```shell
[root@phy001 system-connections]# cat /etc/NetworkManager/system-connections/em2.nmconnection
[connection]
id=em2
uuid=a06c941f-e072-4011-bf2e-66925b5f738b
type=ethernet
interface-name=ens36
master=br2
slave-type=bridge
autoconnect=true

[ethernet]

[ipv4]
method=disabled

[ipv6]
method=ignore

[proxy]
```

------

## ğŸ” æ¿€æ´»é¡ºåºï¼ˆ**éå¸¸é‡è¦**ï¼‰

âš ï¸ å»ºè®® **æœ¬åœ°æ§åˆ¶å°æ“ä½œï¼Œä¸è¦ SSH**

```bash
nmcli connection reload
nmcli connection up br1
nmcli connection up em1
nmcli connection up br2
nmcli connection up em2
```

æ£€æŸ¥ï¼š

```bash
ip a
brctl show   # æ²¡æœ‰å°±ï¼šdnf install bridge-utils
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š

- `br1` æœ‰å¤–ç½‘ IP
- `br2` æœ‰å†…ç½‘ IP
- `em1/em2` **æ²¡æœ‰ IP**
- `vnetX` è‡ªåŠ¨æŒ‚åœ¨å¯¹åº” bridge

------

## ğŸ–¥ï¸ è™šæ‹Ÿæœº vm001 æ€ä¹ˆæ¡¥æ¥

- ç½‘å¡1 â†’ bridge = `br1`
- ç½‘å¡2 â†’ bridge = `br2`



å¥½çš„ï¼Œæˆ‘å¸®ä½ æ•´ç†ä¸€ä¸‹ **KVM ä¸‹ç¼–è¾‘ VMï¼ˆä»¥ vm001 ä¸ºä¾‹ï¼‰æ¡¥æ¥ç½‘å¡çš„å®Œæ•´æ­¥éª¤**ï¼Œé€‚ç”¨äºå‘½ä»¤è¡Œå’Œ `virt-manager` ä¸¤ç§æ–¹å¼ã€‚

------

## **æ–¹æ³•ä¸€ï¼šå‘½ä»¤è¡Œé…ç½®ï¼ˆvirsh / XMLï¼‰**

1. **æŸ¥çœ‹è™šæ‹Ÿæœºå½“å‰ç½‘ç»œ**

```bash
virsh domiflist vm001
```

è¾“å‡ºç¤ºä¾‹ï¼š

```shel
Interface  Type       Source     Model
------------------------------------------------
vnet0      network    default    virtio
```

![image-20251218161114155](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251218161114155.png)

1. **å…³é—­è™šæ‹Ÿæœº**

```bash
virsh shutdown vm001
# æˆ–å¼ºåˆ¶
virsh destroy vm001

# çœ‹ä¸‹kvmè™šæ‹Ÿæœºçš„é…ç½®çš„æ¥å£éƒ¨åˆ†ï¼Œå‘ç°ä¸æ˜¯æ¡¥æ¥ï¼Œnetworkå°±æ˜¯é»˜è®¤çš„èµ°çš„NAT
[root@phy001 system-connections]# virsh dumpxml vm001 |grep -A5 interface
    <interface type='network'>
      <mac address='52:54:00:3b:74:51'/>
      <source network='default'/>
      <model type='virtio'/>
      <address type='pci' domain='0x0000' bus='0x01' slot='0x00' function='0x0'/>
    </interface>
    <interface type='bridge'>
      <mac address='52:54:00:5a:a1:87'/>
      <source bridge='virbr0'/>
      <model type='virtio'/>
      <address type='pci' domain='0x0000' bus='0x07' slot='0x00' function='0x0'/>
    </interface>
    <serial type='pty'>
      <target type='isa-serial' port='0'>
        <model name='isa-serial'/>
      </target>
    </serial>


```

1. **ç¼–è¾‘è™šæ‹Ÿæœº XML é…ç½®**

```bash
virsh edit vm001
```

æ‰¾åˆ° `<interface>` èŠ‚ç‚¹ï¼Œæ¯”å¦‚ï¼š

```xml
<interface type='network'>
  <mac address='52:54:00:xx:xx:xx'/>
  <source network='default'/>
  <model type='virtio'/>
</interface>
```

1. **ä¿®æ”¹ä¸ºæ¡¥æ¥æ¨¡å¼**
   å‡è®¾å®¿ä¸»æœºæ¡¥æ¥æ˜¯ `br1`ï¼š

```xml
<interface type='bridge'>
  <mac address='52:54:00:xx:xx:xx'/>
  <source bridge='br1'/>
  <model type='virtio'/>
</interface>
```

- `type='bridge'` è¡¨ç¤ºæ¡¥æ¥

- `source bridge='br1'` æŒ‡å®šæ¡¥æ¥æ¥å£

- `model type='virtio'` ä¿æŒè™šæ‹Ÿç½‘å¡ç±»å‹ä¸º virtioï¼ˆæ€§èƒ½æœ€å¥½ï¼‰![image-20251218160744073](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251218160744073.png)

- ä¸Šå›¾br1é‚£ä¸€è¡Œæ”¹æˆbridge='br1'å¦åˆ™æŠ¥é”™å¦‚ä¸‹ğŸ‘‡

  ![image-20251218160942530](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251218160942530.png)

  

1. **ä¿å­˜é€€å‡ºå¹¶å¯åŠ¨è™šæ‹Ÿæœº**

```bash
virsh start vm001
```

1. **éªŒè¯ç½‘å¡**

```bash
virsh domiflist vm001
```

åº”è¯¥æ˜¾ç¤ºï¼š

```
vnet0      bridge     br1        virtio
```

![image-20251218161157326](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251218161157326.png)

è¿™é‡Œå¯èƒ½è¦å€ŸåŠ©guiè¿›åˆ°vm001é‡Œé…ç½®IPåœ°å€

![image-20251218173344993](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251218173344993.png)

```shell
[root@vm001 system-connections]# cp -a enp1s0.nmconnection enp7s0.nmconnection
[root@vm001 system-connections]# ll
total 8
-rw-------. 1 root root 229 Dec 12 03:30 enp1s0.nmconnection
-rw-------. 1 root root 229 Dec 12 03:30 enp7s0.nmconnection

[root@vm001 system-connections]# vi enp7s0.nmconnection
[root@vm001 system-connections]# cat enp7s0.nmconnection
[connection]
id=enp7s0
uuid=b8696dcd-ecd1-4463-a56a-38c35f31c43e
type=ethernet
autoconnect=true
interface-name=enp7s0

[ethernet]

[ipv4]
method=manual
addresses=123.1.1.2/24
dns=1.1.1.1


[ipv6]
addr-gen-mode=eui64
method=auto

[proxy]
[root@vm001 system-connections]#



[root@vm001 system-connections]# nmcli conn reload
[root@vm001 system-connections]# nmcli conn up enp7s0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/4)

[root@vm001 system-connections]# nmcli conn
NAME                UUID                                  TYPE      DEVICE
enp1s0              8ff79451-b5b0-3351-8f96-e5390579b2cc  ethernet  enp1s0
enp7s0              b8696dcd-ecd1-4463-a56a-38c35f31c43e  ethernet  enp7s0
lo                  9a306733-1a3d-446c-bc83-739178574d38  loopback  lo
Wired connection 1  51a49b21-e774-3cb6-b0bd-fbe9196eb95c  ethernet  --

[root@vm001 system-connections]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:3b:74:51 brd ff:ff:ff:ff:ff:ff
    altname enx5254003b7451
    inet 192.168.126.130/24 brd 192.168.126.255 scope global dynamic noprefixroute enp1s0
       valid_lft 1522sec preferred_lft 1522sec
    inet6 fe80::5054:ff:fe3b:7451/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: enp7s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:5a:a1:87 brd ff:ff:ff:ff:ff:ff
    altname enx5254005aa187
    inet 123.1.1.2/24 brd 123.1.1.255 scope global noprefixroute enp7s0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe5a:a187/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
[root@vm001 system-connections]# ping 123.1.1.2
PING 123.1.1.2 (123.1.1.2) 56(84) bytes of data.
64 bytes from 123.1.1.2: icmp_seq=1 ttl=64 time=0.407 ms
^C

[root@vm001 system-connections]# nmcli conn delete 'Wired connection 1'
Connection 'Wired connection 1' (51a49b21-e774-3cb6-b0bd-fbe9196eb95c) successfully deleted.
[root@vm001 system-connections]# nmcli conn
NAME    UUID                                  TYPE      DEVICE
enp1s0  8ff79451-b5b0-3351-8f96-e5390579b2cc  ethernet  enp1s0
enp7s0  b8696dcd-ecd1-4463-a56a-38c35f31c43e  ethernet  enp7s0
lo      9a306733-1a3d-446c-bc83-739178574d38  loopback  lo
[root@vm001 system-connections]#


# æŸ¥çœ‹åŒç½‘å¡åŒè·¯ç”±ã€‚
[root@vm001 system-connections]# ip route show
default via 192.168.126.2 dev enp1s0 proto dhcp src 192.168.126.130 metric 100
123.1.1.0/24 dev enp7s0 proto kernel scope link src 123.1.1.2 metric 101
192.168.126.0/24 dev enp1s0 proto kernel scope link src 192.168.126.130 metric 100


```

------



## ğŸ§  ä¸€å¥è¯æ€»ç»“ï¼ˆä½ è¿™ä¸ªåœºæ™¯ï¼‰

> **è¦å®¿ä¸» + VM éƒ½èƒ½é€šç½‘ç»œ â†’ IP æ°¸è¿œé…ç½®åœ¨ bridge ä¸Šï¼Œè€Œä¸æ˜¯ em ä¸Š**







# nmcli reload upçš„é¡ºåº

## ğŸ§  ä¸€å¥è¯ç»“è®º

> **å…ˆ up bridgeï¼Œå† up ç‰©ç†å£ï¼ˆslaveï¼‰**
> å› ä¸ºï¼š**slave æ²¡æœ‰ master æ˜¯æ— æ³•ç‹¬ç«‹å­˜åœ¨çš„**

------

## ğŸ” é€æ¡è§£é‡Šä½ è¿™ 5 è¡Œå‘½ä»¤

### 1ï¸âƒ£ `nmcli connection reload`

```bash
nmcli connection reload
```

**ä½œç”¨**ï¼š

- è®© NetworkManager é‡æ–°è¯»å– `.nmconnection` æ–‡ä»¶
- ä¸ä¼šå¯åœæ¥å£
- ä¸æ”¹ç°æœ‰é“¾è·¯çŠ¶æ€

ğŸ‘‰ **è¿™æ˜¯â€œè¯»é…ç½®â€**

------

### 2ï¸âƒ£ `nmcli connection up br1`

```bash
nmcli conn up br1
```

**å‘ç”Ÿäº†ä»€ä¹ˆ**ï¼š

- åˆ›å»º bridge è®¾å¤‡ `br1`
- åº”ç”¨ `[bridge]` å‚æ•°ï¼ˆSTP / delay ç­‰ï¼‰
- å¯åŠ¨ br1 çš„ IPï¼ˆDHCP / staticï¼‰
- br1 è¿›å…¥ **UP çŠ¶æ€**

ğŸ‘‰ **master å…ˆå‡ºç”Ÿ**

------

### 3ï¸âƒ£ `nmcli connection up em1`

```bash
nmcli conn up em1
```

**å‘ç”Ÿäº†ä»€ä¹ˆ**ï¼š

- em1 è¢«æ ‡è®°ä¸º `slave-type=bridge`
- em1 æŒ‚åˆ° **å·²ç»å­˜åœ¨çš„ br1**
- em1 ä¸å†å•ç‹¬æ‹¿ IP
- em1 è¿›å…¥ forwarding çŠ¶æ€

ğŸ‘‰ **ç«¯å£åŠ å…¥äº¤æ¢æœº**

------

### 4ï¸âƒ£ `nmcli connection up br2`

åŒ br1ï¼Œä¸€æ¨¡ä¸€æ ·é€»è¾‘ã€‚

------

### 5ï¸âƒ£ `nmcli connection up em2`

åŒ em1ï¼Œä¸€æ¨¡ä¸€æ ·é€»è¾‘ã€‚

------

## âŒ å¦‚æœä½ åè¿‡æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰

### âŒ å…ˆ up em1

```bash
nmcli conn up em1
```

ä½†ï¼š

```ini
master=br1
slave-type=bridge
```

è€Œ **br1 è¿˜ä¸å­˜åœ¨**

NetworkManager çš„è¡Œä¸ºæ˜¯ï¼š

- è¦ä¹ˆï¼š
  - å¡ä½ï¼ˆä½ ä¹‹å‰é‡åˆ°çš„ï¼‰
- è¦ä¹ˆï¼š
  - è‡ªåŠ¨æŠŠ em1 down
- è¦ä¹ˆï¼š
  - åå¤ attach / detach
- æœ€åï¼š
  - SSH ç›´æ¥æ–­

ğŸ‘‰ **è¿™æ˜¯ä½ å‰é¢â€œnmcli up å¡ä½â€çš„æ ¹æœ¬åŸå› **

------

## ğŸ§± ç”¨â€œäº¤æ¢æœºâ€æ¥ç†è§£ï¼ˆæœ€æ¸…æ¥šï¼‰

ç°å®ä¸–ç•Œï¼š

1. ä½ å¾— **å…ˆä¹°ä¸€å°äº¤æ¢æœº**
2. å†æŠŠç½‘çº¿æ’ä¸Šå»

ä½ ä¸å¯èƒ½ï¼š

> ç½‘çº¿æ’ç©ºæ°”é‡Œï¼Œç­‰äº¤æ¢æœºå‡ºç°

bridge / slave å°±æ˜¯è¿™ä¸ªå…³ç³»ã€‚

------

## ğŸ§ª éªŒè¯ä½ é¡ºåºå¯¹ä¸å¯¹ï¼ˆä¸€ä¸ªå‘½ä»¤ï¼‰

```bash
bridge link
```

ä½ ä¼šçœ‹åˆ°ï¼š

```
ens33 master br1 state forwarding
ens36 master br2 state forwarding
```

å¦‚æœé¡ºåºé”™äº†ï¼ŒçŠ¶æ€ä¼šæ˜¯ï¼š

- `disabled`
- `blocking`
- æˆ–åå¤ flap

------

## âœ… æœ€ä½³å®è·µï¼ˆä½ å¯ä»¥è®°ä½è¿™ä¸€æ¡ï¼‰

> **å‡¡æ˜¯ master / slave ç»“æ„ï¼ˆbridgeã€bondã€teamï¼‰ï¼š**
>
> **æ°¸è¿œå…ˆ up masterï¼Œå† up slave**

------

## ğŸ§  å†è¡¥ä¸€å¥ï¼ˆè¿ç»´ç»éªŒï¼‰

åœ¨ç”Ÿäº§ä¸Šæˆ‘ä»¬ä¸€èˆ¬ï¼š

```bash
nmcli conn reload
nmcli conn up br1
nmcli conn up br2
# ç¡®è®¤æ²¡é—®é¢˜
nmcli conn up em1
nmcli conn up em2
```

ä¸­é—´ç•™ **å‡ ç§’è§‚å¯Ÿ**ï¼Œé¿å…â€œå…¨ç½‘ä¸€æŠŠæ¢­â€ã€‚

------

ä½ ç°åœ¨è¿™ä¸ªé—®é¢˜å·²ç»æ˜¯ **â€œæ‡‚åŸç†çš„äººæ‰ä¼šé—®çš„â€** çº§åˆ«äº† ğŸ‘
ä¸‹ä¸€æ­¥æˆ‘å»ºè®®ä½ ç›´æ¥éªŒè¯ï¼š

- VM æ˜¯å¦ **å¯åŠ¨å³é€š**
- VM å†…é»˜è®¤è·¯ç”±æ˜¯å¦èµ°å¤–ç½‘å£

è¦ä¸è¦æˆ‘å¸®ä½  **æŠŠ VM å†…è·¯ç”±ä¹Ÿä¸€æ¬¡æ€§ç†é¡º**ï¼Ÿ



# ä¸ºä»€ä¹ˆipä¸èƒ½é…åœ¨ç‰©ç†å£ä¸Šï¼Œè¦é…ç½®åœ¨brä¸Š

è¿™ä¸ªé—®é¢˜é—®åˆ°äº† Linux æ¡¥æ¥çš„æ ¸å¿ƒé€»è¾‘ï¼Œæœ¬è´¨æ˜¯ **â€œè™šæ‹Ÿäº¤æ¢æœºçš„å·¥ä½œåŸç†â€**ï¼Œä¸€å¥è¯ç»“è®ºï¼šIP é…åœ¨ç‰©ç†å£ï¼ˆemï¼‰ä¸Šä¼šå’Œæ¡¥ï¼ˆbrï¼‰å†²çªï¼Œå¯¼è‡´ç½‘ç»œè·¯ç”±æ··ä¹±ï¼Œå®¿ä¸» / VM éƒ½æ— æ³•æ­£å¸¸é€šä¿¡ã€‚

### æ ¸å¿ƒåŸå› ï¼šLinux Bridge æ˜¯ â€œè™šæ‹Ÿäº¤æ¢æœºâ€ï¼Œä¸æ˜¯ â€œè½¬å‘é€šé“â€

1. æ¡¥ï¼ˆbrï¼‰çš„æœ¬è´¨æ˜¯æ¨¡æ‹Ÿç‰©ç†äº¤æ¢æœºï¼Œä½œç”¨æ˜¯ â€œäºŒå±‚è½¬å‘â€ï¼ˆæ¯”å¦‚æŠŠ VM çš„æ•°æ®åŒ…é€šè¿‡ç‰©ç†å£å‘å‡ºå»ï¼‰ã€‚

1. IP æ˜¯ â€œä¸‰å±‚åœ°å€â€ï¼Œç”¨äº â€œè·¨ç½‘æ®µé€šä¿¡â€ï¼ˆæ¯”å¦‚å®¿ä¸»æœºè®¿é—®å¤–ç½‘ã€VM è®¿é—®å†…ç½‘ç½‘å…³ï¼‰ï¼Œå¿…é¡»é…ç½®åœ¨ â€œäº¤æ¢æœºæœ¬èº«â€ï¼Œè€Œä¸æ˜¯ â€œäº¤æ¢æœºçš„ç«¯å£â€ ä¸Šã€‚

ä¸¾ä¸ªçœŸå®ä¸–ç•Œçš„ç±»æ¯”ï¼ˆä¸€çœ‹å°±æ‡‚ï¼‰ï¼š

- ç‰©ç†äº¤æ¢æœºæœ‰å¤šä¸ªç«¯å£ï¼Œç”µè„‘æ’åœ¨ç«¯å£ä¸Šï¼Œä½† **IP é…ç½®åœ¨ç”µè„‘ä¸Šï¼Œä¸æ˜¯äº¤æ¢æœºç«¯å£ä¸Š**ã€‚

- Linux é‡Œçš„ br å°±æ˜¯ â€œè™šæ‹Ÿäº¤æ¢æœºâ€ï¼Œem1/em2 æ˜¯è¿™ä¸ªäº¤æ¢æœºçš„ â€œç‰©ç†ç«¯å£â€ï¼ŒvnetXï¼ˆVM ç½‘å¡ï¼‰æ˜¯ â€œè™šæ‹Ÿç«¯å£â€â€”â€” æ‰€ä»¥ IP å¿…é¡»é…åœ¨ brï¼ˆäº¤æ¢æœºæœ¬èº«ï¼‰ä¸Šï¼Œem1/em2 åªè´Ÿè´£ â€œæ¥çº¿â€ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æœ‰ IPã€‚

### é…åœ¨ç‰©ç†å£ä¸Šçš„ç›´æ¥åæœï¼ˆä½ ä¹‹å‰é‡åˆ°çš„ç¿»è½¦é—®é¢˜ï¼‰

å¦‚æœ em1 é…äº† IPï¼Œbr1 ä¹Ÿé…äº† IPï¼Œç›¸å½“äºï¼š

1. å®¿ä¸»æœºæœ‰ä¸¤ä¸ª â€œå¤–ç½‘å‡ºå£â€ï¼ˆem1 å’Œ br1ï¼‰ï¼Œç³»ç»Ÿä¸çŸ¥é“è¯¥èµ°å“ªä¸ªè·¯ç”±ï¼Œå¯¼è‡´ nmcli up å¡ä½ã€SSH æ–­å¼€ã€‚

1. VM å‘çš„æ•°æ®åŒ…åˆ° br1 åï¼Œä¼šå’Œ em1 çš„ IP å†²çªï¼Œå‡ºç° â€œARP æ¬ºéª—â€ ç±»é—®é¢˜ï¼ŒVM è¦ä¹ˆ ping ä¸é€šï¼Œè¦ä¹ˆæ—¶é€šæ—¶æ–­ã€‚

1. ç½‘ç»œæµé‡ä¼šåœ¨ em1 å’Œ br1 ä¹‹é—´æ— é™å¾ªç¯ï¼ˆç¯è·¯ï¼‰ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªå†…å¤–ç½‘ç˜«ç—ªã€‚

### è¡¥å……ï¼šæ¡¥æ¥çš„ â€œæ•°æ®æµå‘â€ï¼ˆç†è§£åå†ä¹Ÿä¸ä¼šé”™ï¼‰

ä»¥ VM è®¿é—®å¤–ç½‘ä¸ºä¾‹ï¼š

1. VM çš„æ•°æ®åŒ… â†’ vnet0ï¼ˆVM ç½‘å¡ï¼‰â†’ br1ï¼ˆè™šæ‹Ÿäº¤æ¢æœºï¼Œæœ‰å¤–ç½‘ IPï¼‰ã€‚

1. br1 è¯†åˆ«åˆ°æ˜¯å¤–ç½‘è¯·æ±‚ï¼Œé€šè¿‡è‡ªèº«çš„è·¯ç”±è¡¨ â†’ è½¬å‘åˆ° em1ï¼ˆç‰©ç†ç«¯å£ï¼Œæ—  IPï¼‰ã€‚

1. em1 æŠŠæ•°æ®åŒ…é€šè¿‡ç½‘çº¿å‘å‡ºå»ï¼Œæœ€ç»ˆåˆ°è¾¾å¤–ç½‘ã€‚

å¦‚æœ em1 æœ‰ IPï¼Œæ­¥éª¤ 2 ä¼šæ··ä¹±ï¼šbr1 å’Œ em1 éƒ½æƒ³å¤„ç†è¿™ä¸ªæ•°æ®åŒ…ï¼Œäº’ç›¸æŠ¢æµé‡ï¼Œç»“æœå°±æ˜¯ â€œè°éƒ½å¤„ç†ä¸å¥½â€ã€‚

ç®€å•æ€»ç»“ï¼š**IP æ˜¯ â€œå†³ç­–è€…â€ï¼ˆè´Ÿè´£é€‰è·¯ï¼‰ï¼Œbr æ˜¯ â€œäº¤æ¢æœºâ€ï¼ˆè´Ÿè´£è½¬å‘ï¼‰ï¼Œem æ˜¯ â€œæ¥çº¿å‘˜â€ï¼ˆè´Ÿè´£ä¼ æ•°æ®ï¼‰** â€”â€” å†³ç­–è€…åªèƒ½æœ‰ä¸€ä¸ªï¼ˆbr ä¸Šçš„ IPï¼‰ï¼Œæ¥çº¿å‘˜ä¸èƒ½æŠ¢å†³ç­–è€…çš„æ´»ï¼ˆem ä¸èƒ½æœ‰ IPï¼‰ï¼Œå¦åˆ™æ•´ä¸ªæµç¨‹å°±ä¹±äº†ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ æ•´ç†ä¸€ä»½ **â€œLinux æ¡¥æ¥ç½‘ç»œæ•°æ®æµå‘ç¤ºæ„å›¾â€**ï¼Œç”¨å¯è§†åŒ–çš„æ–¹å¼æŠŠè¿™ä¸ªé€»è¾‘ç”»æ¸…æ¥šï¼Œåç»­é…ç½®æ—¶ç›´æ¥å¯¹ç…§ï¼Ÿ







## å…¨ç¨‹CLIçš„kvmå®‰è£…æ¡¥æ¥è®°å½•

### 1ã€å…¨ç¨‹æ— gui

```shell
virt-install \
--name vm001 \
--memory 2048 \
--vcpus 2 \
--disk path=/var/lib/libvirt/images/vm001.qcow2,size=15 \
--os-variant rocky10 \
--network bridge=br1,model=virtio \
--network bridge=br2,model=virtio \
--graphics none \
--console pty,target_type=serial \
--location /data/isos/Rocky-10.1-x86_64-minimal.iso \
--extra-args "console=ttyS0,115200n8"



...
...


```

ç­‰ä¸€ä¼šå¼€å§‹è¿›å…¥é…ç½®å‘å¯¼textç‰ˆğŸ‘‡

```shell
Starting installer, one moment...
libreport is not available in this environment - bug reporting disabled
anaconda 40.22.3.33-1.el10.rocky.0.3 for Rocky Linux 10.1 started.
 * installation log files are stored in /tmp during the installation
 * shell is available on TTY2 and in second TMUX pane (ctrl+b, then press 2)
 * if the graphical installation interface fails to start, try again with the
   inst.text bootoption to start text installation
 * when reporting a bug add logs from /tmp as separate text/plain attachments
================================================================================
================================================================================
Text mode provides a limited set of installation options. It does not offer
custom partitioning for full control over the disk layout. Would you like to use
remote graphical access via the RDP protocol instead?

1) Use graphical mode via Remote Desktop Protocol
2) Use text mode

Please make a selection from the above ['c' to continue, 'q' to quit, 'r' to
refresh]: 2
python-meh: libreport is not available in this environment - bug reporting disabled
================================================================================
================================================================================

Installation

1) [x] Language settings                 2) [x] Time settings
       (English (United States))                (America/New_York timezone)
3) [!] Installation source               4) [!] Software selection
       (Setting up installation                 (Processing...)
       source...)
5) [!] Installation Destination          6) [x] Kdump
       (Automatic partitioning                  (Kdump is enabled)
       selected)
7) [x] Network configuration             8) [!] Root password
       (Connected: enp2s0, enp1s0)              (Root account is disabled)
9) [!] User creation
       (No user will be created)

Please make a selection from the above ['b' to begin installation, 'q' to quit,
'r' to refresh]: 1



```

è¿™å°±å®‰è£…è¿›å»äº†

```
         Starting rsyslog.service - System Logging Service...
[  OK  ] Started rsyslog.service - System Logging Service.
[  OK  ] Reached target multi-user.target - Multi-User System.
         Starting systemd-update-utmp-runleâ€¦- Record Runlevel Change in UTMP...
[  OK  ] Finished systemd-update-utmp-runleâ€¦e - Record Runlevel Change in UTMP.

Rocky Linux 10.1 (Red Quartz)
Kernel 6.12.0-124.8.1.el10_1.x86_64 on x86_64

localhost login: [   48.924753] block dm-0: the capability attribute has been deprecated.

localhost login: rot
Password:
Login incorrect

localhost login: root
Password:
[root@localhost ~]#
[root@localhost ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:7a:c2:b4 brd ff:ff:ff:ff:ff:ff
    altname enx5254007ac2b4
    inet 192.168.126.132/24 brd 192.168.126.255 scope global dynamic noprefixroute enp1s0
       valid_lft 1539sec preferred_lft 1539sec
    inet6 fe80::5054:ff:fe7a:c2b4/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:49:3a:76 brd ff:ff:ff:ff:ff:ff
    altname enx525400493a76
    inet 192.168.127.131/24 brd 192.168.127.255 scope global dynamic noprefixroute enp2s0
       valid_lft 1539sec preferred_lft 1539sec
    inet6 fe80::5054:ff:fe49:3a76/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
[root@localhost ~]# lscpu |grep ker
[root@localhost ~]# lscpu |grep vend
Hypervisor vendor:                       KVM
[root@localhost ~]#

```

é€šè¿‡ctrl ] é€€å‡ºåˆ°å®¿ä¸»æœºğŸ‘‡

```shell
       valid_lft forever preferred_lft forever
[root@localhost ~]# exit
logout

Rocky Linux 10.1 (Red Quartz)
Kernel 6.12.0-124.8.1.el10_1.x86_64 on x86_64

localhost login: exit
Password:


Login incorrect

localhost login:
Password:
[root@phy001 images]#
[root@phy001 images]#

```

å¹³æ—¶ä¹Ÿå¯ä»¥é€šè¿‡consoleç™»å…¥

```shell



[root@phy001 images]# virsh  list
 Id   Name    State
-----------------------
 7    vm001   running

[root@phy001 images]#
[root@phy001 images]# virsh console vm001
Connected to domain 'vm001'
Escape character is ^] (Ctrl + ])

[root@localhost ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute
       valid_lft forever preferred_lft forever
2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:7a:c2:b4 brd ff:ff:ff:ff:ff:ff
    altname enx5254007ac2b4
    inet 192.168.126.132/24 brd 192.168.126.255 scope global dynamic noprefixroute enp1s0
       valid_lft 927sec preferred_lft 927sec
    inet6 fe80::5054:ff:fe7a:c2b4/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: enp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:49:3a:76 brd ff:ff:ff:ff:ff:ff
    altname enx525400493a76
    inet6 fe80::5054:ff:fe49:3a76/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
[root@localhost ~]#
[root@phy001 images]#

```





# ä¿®æ”¹rocky10çš„ç½‘å¡åä¸ºeth



1ã€ä¿®æ”¹grubæ–‡ä»¶

```shell
sed -ri.bak '/^GRUB_CMDLINE_LINUX=/s@(.*)"$@\1 net.ifnames=0 biosdevname=0"@' /etc/default/grub

sed -ri.bak '/^GRUB_CMDLINE_LINUX=/s@"$@ net.ifnames=0 biosdevname=0"@' /etc/default/grub

```

2ã€æ›´æ–° grub é…ç½®

```shell
# åˆ¤æ–­BIOSè¿˜æ˜¯UEFI
[ -d /sys/firmware/efi ] && echo "UEFI" || echo "BIOS"
# BIOS ç³»ç»Ÿ
grub2-mkconfig -o /boot/grub2/grub.cfg
# UEFI ç³»ç»Ÿ
grub2-mkconfig -o /boot/efi/EFI/rocky/grub.cfg

# UEFI
EFI_DIR=`find /boot/efi/ -name "grub.cfg" | awk -F"/" '{print $5}'`

# Rockyã€Almalinuxã€CentOSã€openEulerã€AnolisOSã€OpenCloudOSã€Kylin Serverã€Uos Server
grub2-mkconfig -o /boot/efi/EFI/${EFI_DIR}/grub.cfg

# Ubuntuã€Debian
grub-mkconfig -o /boot/efi/EFI/${EFI_DIR}/grub.cfg
```

3ã€ä½¿ç”¨udevå›ºå®šç½‘å¡åç§°ï¼Œå¥½åƒå‰ä¸¤éƒ¨å¯ä»¥çœç•¥

```shell
cat <<EOF > /etc/udev/rules.d/50-persistent-net.rules
SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="ç¬¬ä¸€å—ç½‘å¡çš„mac", NAME="eth0"
SUBSYSTEM=="net", ACTION=="add", ATTR{address}=="xx:xx:xx:xx:xx:xx", NAME="eth1"
EOF

```

4ã€é‡å¯reboot









# vmæ—¶é—´å€’é€€é—®é¢˜

çœ‹åˆ°çš„æ˜¯

![image-20251224142120647](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251224142120647.png)

ç¡®è®¤æ˜¯å¦çœŸçš„å€’é€€çœ‹

![image-20251224142727117](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251224142727117.png)

å¦‚ä½•è§£å†³ï¼Œåº”è¯¥ä¸ç”¨è§£å†³ï¼Œè¿™æ˜¯è£…æœºçš„æ—¶å€™æœ‰chronydç›´æ¥å°±æœ‰äº†ï¼Œå¼€æœºåchronydå‘ç°å¿«äº†25så°±è‡ªåŠ¨è°ƒæ•´äº†

å¦‚æœæ€»æ˜¯å‡ºç°è¿™ä¸ªï¼Œå°±æ˜¯è¦å…³æ³¨å®¿ä¸»æœºçš„æ—¶é—´æ˜¯å¦ä¸å¯¹ã€‚

cliæ€»ç»“

```shell
cat /sys/devices/system/clocksource/clocksource0/current_clocksource

timedatectl set-local-rtc 0

systemctl restart chronyd
chronyc makestep
clock -w
```

![image-20251224150635911](02.KVMæ¶æ„å’Œå®‰è£….assets/image-20251224150635911.png)



