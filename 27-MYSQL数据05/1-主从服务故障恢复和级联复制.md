# 第1节. 主从服务故障恢复和级联复制

# 半途做主从

一半业务刚起步也不会做什么主从，就单机，随着业务体量起来才会考虑架构的事情。所以需要处理主从复制的时候主节点上已经有很多数据的情况。

思路就是：先将主节点的数据备份-还原到从节点--其实如果是VM直接克隆出来一台就行了连mysqldump都不需要，再开启主从复制，复制的位置就是show master logs的位置。



## 实验一下

1、弄一个干净的mariadb服务

![image-20230807154933945](1-主从服务故障恢复和级联复制.assets/image-20230807154933945.png)



然后这里报错，就是文件夹的权限问题

![image-20230807155538276](1-主从服务故障恢复和级联复制.assets/image-20230807155538276.png)

binlog就有了

![image-20230807155608622](1-主从服务故障恢复和级联复制.assets/image-20230807155608622.png)



```








```

2、制造一些数据，代表单节点的数据起来了--我认为因该要做这个

![image-20230807173219240](1-主从服务故障恢复和级联复制.assets/image-20230807173219240.png)

![image-20230807174240624](1-主从服务故障恢复和级联复制.assets/image-20230807174240624.png)

![image-20230807174307863](1-主从服务故障恢复和级联复制.assets/image-20230807174307863.png)

![image-20230807172556118](1-主从服务故障恢复和级联复制.assets/image-20230807172556118.png)



```
然后备份，还原一下，这里就不偷懒用VM克隆，实际工作中反而是克隆直接，不过具体情况具体看咯，两种方法都得会。


主节点的账号要不要复制过去给从节点，要！主从复制本身从节点上不用有账号库，但是从节点万一成为了主节点，此时其他的从节点就会和这个提升上来的从节点上同步数据，此时该节点就需要有同步用的账号库了。这就是考虑问题的时间跨度要有，所以当面临一个不擅长的问题，就需要有这个时间跨度的意识去拉自己一把。

所以做主从的时候，就是先创建账号，再备份还原过去，这样账号就一起还原到从节点了。
```



3、有了一些数据了，也先于主从复制创建了账号。现在还是备份使用mysqldump

![image-20230807175924141](1-主从服务故障恢复和级联复制.assets/image-20230807175924141.png)

