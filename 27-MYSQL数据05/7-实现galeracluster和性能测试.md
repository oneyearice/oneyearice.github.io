# ç¬¬7èŠ‚. å®ç°galaraclusterå’Œæ€§èƒ½æµ‹è¯•

![image-20230919135007319](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919135007319.png)

<img src="7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919135102822.png" alt="image-20230919135102822" style="zoom:50%;" />



è€ç‰ˆæœ¬çš„å®‰è£…å°±æ˜¯uyum install MariaDB-Galera-serverï¼Œè€ç‰ˆæœ¬çš„æ–¹æ³•è¿™é‡Œä¸ç®¡äº†ï¼Œç›´æ¥é›†æˆåˆ°æ–°ç‰ˆé‡Œçš„ã€‚



ç„¶åå°±æ˜¯çœ‹é…ç½®æ–‡ä»¶ï¼Œåœ¨/etc/my.cnfé‡Œæ˜ç¡®è¯´äº†include

<img src="7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919135910659.png" alt="image-20230919135910659" style="zoom:50%;" /> 

galeraclusterçš„é…ç½®å°±åœ¨è¿™é‡Œ

![image-20230919140028596](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919140028596.png)



### wsrep_provider=

![image-20230919141456692](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141456692.png)

å…¶ä¸­wsrep_provider=è¦å¡«å†™ä¸€ä¸ªå«åšlibgalera_smm.soçš„åº“æ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶æ˜¯å®‰è£…mariadbè‡ªå¸¦å®‰è£…çš„ï¼Œ

![image-20230919141059885](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141059885.png)



![image-20230919141116807](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141116807.png)

![image-20230919141140225](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141140225.png)

è€Œä¸”å°±æ˜¯mariadbçš„yumæºå®‰è£…çš„@mariadbå¯è§ã€‚

ğŸ‘‡è¿™ä¸ªæºå°±æ˜¯æŒ‰å®˜ç½‘çš„yumæºå¤åˆ¶è¿‡æ¥å°±è¡Œå•¦ï¼Œè¯¦æƒ…å°†å‰æ–‡mysqlå®‰è£…å§ã€‚

![image-20230919141214764](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141214764.png)

å¥½äº†ï¼ŒåŸºæœ¬é›¶ä»¶éƒ½ä¸ç¼ºäº†ã€‚



### wsrep_cluster_address=

![image-20230919141428096](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141428096.png)

ä¸‰ä¸ªèŠ‚ç‚¹çš„å„è‡ªåœ°å€

**binlog_format=row**ï¼Œå°±æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¸€èˆ¬é»˜è®¤æ–°ç‰ˆéƒ½æ˜¯MIXEDï¼Œè¿™é‡Œå–æ¶ˆæ³¨é‡Šç”¨ROWå§ï¼Œå¿˜è®°äº†ï¼Œçœ‹å‰æ–‡ğŸ‘‡

![image-20230919141620982](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919141620982.png)



default_storage_engine=InooDBè‚¯å®šæ˜¯InnoDBäº†ï¼ŒMyISAMéƒ½ä¸æ”¯æŒï¼Œå®˜æ–¹å°±æ˜¯è¯´ä»…ä»…å®éªŒç¯å¢ƒå§æˆ‘çœ‹åˆ°å¥½åƒã€‚

innodb_autoinc_lock_mode=2è¿™ä¸ªä¸ç®¡é»˜è®¤å°±å¥½

**å…¶å®å°±æ˜¯æ”¹wsrep_providerå’Œwsrep_cluster_addressä»¥åŠbinlog_format=rowã€‚**



### å…·ä½“é…ç½®é€‰é¡¹ğŸ‘‡

https://mariadb.com/kb/en/configuring-mariadb-galera-cluster/

![image-20230919143040906](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919143040906.png)

## å®é™…éœ€è¦çš„æ“ä½œ

```bash
vim /etc/my.cnf.d/server.cnf
[galera]
wsrep_on=ON  # 10.1.1å¤šäº†ä¸ªå¼€å…³
wsrep_provider=/usr/lib64/galera/libgalera_smm.so wsrep_cluster_address="gcomm://192.168.126.129,192.168.126.130,192.168.126.131"
binlog_format=row  
```

è¿™ä¸ªgcommæ˜¯åè®®ï¼Œå°±å¥½æ¯”ftp://è¿˜æ¯”https://ä¸€æ ·ï¼Œgcommæ˜¯glaeraClusterå†…éƒ¨é€šè®¯çš„åè®®ã€‚

![image-20230919143202776](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919143202776.png)

ğŸ‘†å°±æ”¹è¿™ä¹ˆå¤šï¼Œå…¶ä»–ä¸åŠ¨

ä¼˜åŒ–è®¾ç½®

```bash
wsrep_cluster_name = 'mycluster'  # é»˜è®¤my_wsrep_cluster
wsrep_node_name = 'node1'  # æœ¬æœºå™¨çš„åç§°ï¼Œè¿™é‡Œæš‚æ—¶ä¸åŠ 
wsrep_node_address = '192.168.126.xâ€™  # å½“å‰æœºå™¨çš„IPï¼Œä¸ç”¨å†™ï¼Œè¿™é‡Œåªæ˜¯å¼ºè°ƒå†™å‡ºï¼Œå®é™…ä¸å†™
```



é€šè¿‡scpå¤åˆ¶åˆ°å…¶ä»–2ä¸ªèŠ‚ç‚¹

![image-20230919143732435](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919143732435.png)



## å¯åŠ¨æ³¨æ„ç‚¹

* ä¸‰å°ä¸æ˜¯ä¸€æ ·çš„æ–¹æ³•å¯åŠ¨ï¼›

* é›†ç¾¤å­˜åœ¨/ä¸å­˜åœ¨ï¼Œå¯åŠ¨æ–¹å¼ä¹Ÿæ˜¯ä¸åŒçš„ã€‚

  

1ã€åŸæ¥æ²¡æœ‰clusterçš„å¯åŠ¨æ–¹æ³•å’ŒåŸæ¥æœ‰clusteré›†ç¾¤çš„å¯åŠ¨æ–¹æ³•æ˜¯ä¸åŒï¼

![image-20230919145150254](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919145150254.png)





![image-20230919145527141](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919145527141.png)





2ã€é¦–æ¬¡å¯åŠ¨ï¼Œå…¶ä»–èŠ‚ç‚¹ï¼Œsystemctl restart mariadbå°±è¡Œ



æœ¬å®éªŒæ˜¯åˆå§‹åŒ–é›†ç¾¤ï¼Œå¼€å§‹å¯åŠ¨

```bash
ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¥åˆå§‹åŒ–é›†ç¾¤
galera_new_cluster

å…¶ä»–èŠ‚ç‚¹å°±
systemctl restart mariadb
```



![image-20230919150244962](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919150244962.png)

è¿™é‡Œæˆ‘å°±ç”¨192.168.126.129ï¼Œè¿™é‡Œçš„masterä¸»æœºåï¼Œä¸è¦åœ¨æ„ï¼Œä¸ç”¨çº ç»“ï¼Œè¿™æ˜¯ä»¥å‰å®éªŒ ä¸»ä»èµ·çš„åå­—ï¼Œè¿™é‡Œå¤šä¸»ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ—¢æ˜¯masterä¹Ÿæ˜¯slaveã€‚



å…¶ä»–èŠ‚ç‚¹é‡å¯æŠ¥é”™

![image-20230919150841898](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919150841898.png)



è€Œä¸”åˆå§‹åŒ–é›†ç¾¤çš„nodeï¼Œç›´æ¥é‡å¯ä¹Ÿä¼šæŠ¥é”™

![image-20230919150932693](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919150932693.png)



æ­¤æ—¶å¤„ç†æ–¹æ³•ï¼Œåœ¨æ²¡æœ‰å¤´ç»ªçš„æƒ…å†µä¸‹ï¼Œä¿ºæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦è¿™ä¸ªé›†ç¾¤ï¼Œæ‰€ä»¥æ³¨é‡Šæ‰/etc/my.cnf.d/serveré‡Œçš„galeræ¨¡å—é…ç½®ï¼Œé‡å¯mariadbã€‚

ç„¶åå†é‡æ–°èµ°ä¸€éå°±è¡Œäº†ã€‚æ³¨æ„é‡æ–°å¯åŠ¨å°±ç”¨galera_recoveryæ¥å¯åŠ¨é›†ç¾¤



![image-20230919152257276](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919152257276.png)

![image-20230919152357434](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919152357434.png)

ç„¶åè«åå…¶å¦™å†æ•²ä¸€éå°±OKäº†ï¼Ÿ

![image-20230919152154647](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919152154647.png)



ç„¶åå»é‡å¯å…¶ä»–èŠ‚ç‚¹çš„æœåŠ¡ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æˆåŠŸï¼Œ![image-20230919152516094](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919152516094.png)

ä¸è¡Œ

æ’é”™

![image-20230919152942842](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919152942842.png)

ä¹‹å‰çš„é…ç½®æ³¨é‡Šæ‰



æ²¡ç”¨ï¼Œé‡æ–°åšå§ï¼ŒæŠŠmariadb removeæ‰é‡å¼„ï¼Ÿ

é‡æ–°rm -rf /var/lib/mysql/*   åå¤3æ¬¡åå€’æ˜¯æˆåŠŸäº†

![image-20230919164358450](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919164358450.png)

mbçš„æ€ä¹ˆå¼„éƒ½OKäº†ç°åœ¨ï¼ï¼

åº”è¯¥å°±æ˜¯/var/lib/mysql/ä¸‹è¦å¹²å‡€ï¼Œ

### ç„¶åæœ‰ä¸ªæ˜ç¡®çš„æ•…éšœç‚¹å¤„ç†æ–¹å¼å°±æ˜¯

![image-20230919165029327](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919165029327.png)

ğŸ‘†è¿™ä¸ªæ–‡ä»¶è¦ä¹ˆåˆ æ‰ï¼Œè¦ä¹ˆä¿®æ”¹safe_to_bootstra:1å°±å¯ä»¥å¯åŠ¨æœåŠ¡æˆåŠŸã€‚



### é”™è¯¯-2

![image-20230919165422809](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919165422809.png)

è¿™æ˜¯cliç”¨é”™äº†ï¼Œé‡å¯ä¸èƒ½è¿™ä¹ˆå¹²ï¼Œ

![image-20230919165938323](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919165938323.png)

å¥½åƒæ‰€æœ‰çš„node éƒ½stop mariadbå°±èµ·ä¸æ¥äº†ï¼Œå› ä¸ºå¯èƒ½æ²¡æœ‰gcommçš„é€šä¿¡æ–¹äº†

![image-20230919170223216](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919170223216.png)

æˆ‘çš„ç†è§£ï¼Œå°±æ˜¯é›†ç¾¤é‡Œå¿…é¡»æœ‰ä¸€ä¸ªæ´»ç€æ‰èƒ½é‡å¯æˆåŠŸï¼Œæµ‹è¯•ä¸‹



ç°åœ¨3ä¸ªnodeéƒ½æŒ‚äº†ï¼Œå¦‚ä½•èµ·æ¥äº†ï¼Œç®€å•ï¼Œ

![image-20230919170253505](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919170253505.png)

è¿™æ ·å¤„ç†å°±è¡Œäº†

éšä¾¿æ‰¾ä¸€å°nodeï¼Œä¸€èˆ¬æ˜¯æœ€ä¼˜çš„å§

![image-20230919170359736](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919170359736.png)

æœç„¶å°±å¥½äº†ï¼Œæ‰€ä»¥å‰é¢çš„é…ç½®OKå°±æ˜¯è¿™é‡Œçš„å¤„ç†æ‰‹æ³•è¦æ³¨æ„ï¼Œè¿™é‡Œä½ å¯ä»¥ç†è§£ä¸ºæ˜¯æŠ€æœ¯ç»†èŠ‚ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºäº§å“ä¸å‚»ç“œåŒ–ã€‚



æ­¤æ—¶ç†è®ºä¸Šå¦å¤–2ä¸ªnodeç›´æ¥restartå°±è¡Œäº†

![image-20230919170516424](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919170516424.png)



æœ¬æ¥åˆ›å»ºé›†ç¾¤çš„é‚£ä¸€å°tmçš„ç«Ÿç„¶èµ·ä¸æ¥

![image-20230919170555058](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919170555058.png)

åˆ¤æ–­å¤±è¯¯ï¼Œæ²¡äº‹ï¼Œè€æ–¹æ³•ï¼Œç‹—å±å•Šï¼Œsafe_to_bootstrap=1è¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹the most advanced nodeæœ€ä¼˜èŠ‚ç‚¹ä¹Ÿå°±æ˜¯æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹çš„æ“ä½œï¼Œå°±æ˜¯ç¡®å®šåè¦æ•²galera_recoveryçš„ï¼Œå‰é¢å·²ç»æœ‰ä¸€å°nodeåˆå§‹åŒ–äº†clusterï¼Œæ­¤æ—¶å…¶ä»–åªèƒ½æ˜¯åŠ å…¥äº†ï¼Œæ‰€ä»¥æ“ä½œå°±æ˜¯systemctl restart mariadbï¼Œé€šè¿‡æŠ¥é”™æ—¥å¿—å¯è§

![image-20230919171357131](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919171357131.png)

è¯´æ˜æ˜¯SSLè¯ä¹¦é—®é¢˜ï¼Œå…³æ‰ssl

![image-20230919171423222](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919171423222.png)

é‡å¯å°±å¥½äº†

![image-20230919171445213](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919171445213.png)





## æ€»ç»“

1ã€åˆå§‹åŒ–cluster

2ã€é‡å¯cluster

æ“ä½œè¦å°å¿ƒ



### galera_recoveré‡å¯clusterï¼ŒæŠ¥é”™æ²¡å…³ç³»ï¼Œé›†ç¾¤ä¸å—å½±å“ğŸ‘‡

![image-20230919171725860](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919171725860.png)





## æ€»ç»“2ï¼šé‡å¯é›†ç¾¤

![image-20230919172031212](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172031212.png)

ä¸Šå›¾ğŸ‘†å°±å‘Šè¯‰ä½ äº†ï¼Œå¦‚æœnodesåŠç¾¤é‡Œçš„èŠ‚ç‚¹å…¨éƒ¨éƒ½stopäº†ï¼Œæ­¤æ—¶å°±éœ€è¦æœ‰ä¸€ä¸ªnodeå»åšbootstrappedåˆ›å»ºé›†ç¾¤ï¼Œå¦‚æœåªæ˜¯ç®€å•çš„started normallyå°±æ˜¯systemctl start mariadbå°±ä¼šæ‰¾wsrep_cluster_addressé‡Œçš„IPåœ°å€å»åšgcommåè®®è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªnodesæ˜¯èµ·æ¥çš„ï¼Œé‚£ä¹ˆå°±ä¼šå¯åŠ¨æœåŠ¡å¤±è´¥ï¼Œè¿™å¾ˆå…³é”®ã€‚



## æµ‹è¯•ä¸‹ï¼š

å½“å‰é›†ç¾¤OK

![image-20230919172348760](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172348760.png)

### åœæ‰3å°ä¸­çš„2å°nodeï¼Œå°è¯•å°†ä¸¤å°stopçš„start

![image-20230919172438926](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172438926.png)

æ²¡é—®é¢˜ï¼Œå¤„ç†æ–¹å¼OK

![image-20230919172549768](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172549768.png)

### é›†ç¾¤é‡Œçš„æ‰€æœ‰nodeså…¨éƒ¨åœæ‰ï¼Œè¿™é‡Œå°±æ˜¯3å°å’¯

æ­¤æ—¶å°±éœ€è¦æ¢å¤é›†ç¾¤ï¼Œ

1ã€galera_recovery

![image-20230919172736925](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172736925.png)

æŒ‰ä¸Šæ–‡çš„è¯´æ˜ï¼Œå°±æ˜¯è¦ä¿®æ”¹

![image-20230919172843149](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172843149.png)



è¿˜æ˜¯èµ·ä¸æ¥

![image-20230919173002141](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173002141.png)





![image-20230919172952742](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919172952742.png)

å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°äººå®¶è®©ä½ æ‰¾æœ€ä¼˜çš„nodeï¼Œä½•ä¸ºæœ€ä¼˜ï¼Œå°±æ˜¯seqno

![image-20230919173039811](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173039811.png)



![image-20230919173056930](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173056930.png)

![image-20230919173113533](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173113533.png)



æ‰¾åˆ°äº†ï¼Œå»84è¿™å°æ•²

galera_recovery

![image-20230919173145345](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173145345.png)

ä¸è¡Œå•Šï¼Œæ“ï¼

ä¸è¿‡é€šè¿‡ä¸Šé¢çš„æ“ä½œå·²ç»çŸ¥é“äº† ä¸æ˜¯æ¢å¤è€Œæ˜¯åˆ›å»ºï¼Œç”¨galera_new_clusterå°±å¯ä»¥äº†

![image-20230919173306841](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173306841.png)

è€Œä¸”é›†ç¾¤IDä¹Ÿä¸ä¼šå˜

![image-20230919173341787](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173341787.png)

å‰©ä¸‹ä¸¤å°nodeå°±ç®€å•äº†ï¼Œé‡å¯æœåŠ¡å°±è¡Œäº†

![image-20230919173420275](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919173420275.png)



åˆ°æ­¤ä¸ä¸ºæ­¤ï¼ŒåŸºæœ¬çš„å¤„ç†æ–¹æ³•å°±æœ‰äº†ã€‚é‡ç‚¹çœ‹æ€»ç»“å°±è¡Œï¼Œç„¶åä¹‹å‰ä¸è¡Œçš„åŸå› å°±æ˜¯â‘ sslæ²¡æœ‰å¼„å¥½ï¼Œä¹‹å‰å®éªŒé—ç•™çš„ï¼Œåªé…ç½®äº†2ä¸ªnodeçš„sslï¼Œè¿™é‡Œæ¶‰åŠ3ä¸ªå‘¢ï¼Œä¸è¿‡æœ‰ä¸€æ¬¡sslæ²¡å…³ä¹ŸOKï¼Œä¸è¿‡é€šè¿‡ä¸Šæ–‡çš„æŠ¥é”™å¯è§ç¡®å®æœ‰é—®é¢˜çš„ï¼›â‘¡å°±æ˜¯é›†ç¾¤çš„å¯åŠ¨å’Œé‡å¯æœ‰è®²ç©¶çš„ï¼Œé‡å¯æœ‰é—®é¢˜è¿˜æ˜¯ç”¨çš„åˆå§‹åŒ–åˆ›å»ºçš„å‘½ä»¤æ¥è§£å†³é—®é¢˜çš„ã€‚



### ç»§ç»­çœ‹é›†ç¾¤çš„æ•°æ®è¯»å†™å¤„ç†



è¯´æ˜ï¼šhostnameæ— æ‰€è°“master slaveï¼Œè¿™ä»…ä»…æ˜¯ä¹‹å‰å®éªŒçš„é—ç•™ï¼Œè¿™é‡Œæ˜¯å¤šä¸»ï¼Œéƒ½æ˜¯masterã€‚

å¯¼å…¥ä¸€ä¸ªsqlè„šæœ¬ï¼Œä¼šåˆ›å»ºæ–°åº“å’Œè¡¨ï¼Œè¿™æ˜¯åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåšçš„ã€‚

![image-20230919174143167](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919174143167.png)

ç„¶åå…¶ä»–æ‰€æœ‰nodesä¹Ÿå°±è‡ªåŠ¨åŒæ­¥äº†ğŸ‘‡

![image-20230919174352331](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919174352331.png)

è¡¨åŒæ­¥è‡ªç„¶ä¹ŸOK

![image-20230919174507277](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919174507277.png)

![image-20230919174538275](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919174538275.png)



## å˜é‡æŸ¥çœ‹

### SHOW VARIABLES LIKE 'wsrep_%\G'; 



æœ‰å½“å‰è‡ªå·±çš„IPä¿¡æ¯ğŸ‘‡

![image-20230919174753051](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919174753051.png)



æœ‰/etc/my.cnf.d/server.confé‡Œé…ç½®çš„ä¿¡æ¯ğŸ‘‡

![image-20230919174917759](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919174917759.png)





### SHOW STATUS LIKE 'wsrep_%';   # çŠ¶æ€å˜é‡

![image-20230919175111726](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919175111726.png)

![image-20230919175129421](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919175129421.png)



### SHOW STATUS LIKE 'wsrep_cluster_size';   

![image-20230919175214090](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919175214090.png)

æŸ¥çœ‹é›†ç¾¤nodesæ•°ğŸ‘†



![image-20230919175319080](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919175319080.png)





## æ·»åŠ æ–°æˆå‘˜node

![image-20230919180533521](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919180533521.png)

ä¸è¿‡äººå®¶å®˜æ–¹è¯´äº†ï¼Œthe first node has x.x.x.xï¼Œæ‰èƒ½åŠ å…¥x.x.x.xï¼Œå‘µå‘µ~ã€‚ğŸ‘‡

![image-20230919180903800](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919180903800.png)

å…¶å®å°±æ˜¯æ¯å°nodeéƒ½è¡¥ä¸€ä¸ªIPï¼Œç„¶åä¸€ä¸ªä¸ªé‡å¯å°±è¡Œäº†

![image-20230919181220875](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919181220875.png)

åªè¦clusteré‡Œæœ‰ä¸€ä¸ªæ´»ç€ï¼Œå°±èƒ½é‡å¯æœåŠ¡OKï¼Œé™¤éåŒæ—¶downäº†

![image-20230919181251335](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919181251335.png)

äººå®¶è¯´çš„å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œæ‰€æœ‰nodeséƒ½downäº†ï¼Œæ‰éœ€è¦é‡æ–°åˆå§‹åŒ–(è¿™ä¸ªæˆ‘èµ°æˆåŠŸäº†ï¼‰ï¼Œæˆ–è€…æ²¡æœ‰èµ°æˆåŠŸçš„galera_recoveryï¼›



ç„¶åæ–°åŠ å…¥çš„nodeï¼Œä¹Ÿä¼šå¾ˆå¿«åŒæ­¥dbçš„

![image-20230919181437863](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919181437863.png)





### å»ºè¡¨ä¹Ÿä¸ä¼šå†²çªï¼Œå› ä¸ºæœ‰wsrepæœºåˆ¶å•Š

![image-20230919181837269](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919181837269.png)

åªä¼šæœ‰ä¸€ä¸ªæˆåŠŸğŸ‘‡

![../_images/certificationbasedreplication.png](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/certificationbasedreplication.png)



## ç„¶åçœ‹çœ‹å¤§é‡æ•°æ®å†™å…¥çš„ä¸€ä¸ªé€Ÿåº¦ï¼Œæ˜¯æ˜æ˜¾æ¯”ä¸»ä»æ…¢å¾ˆå¤šçš„ï¼Œå› ä¸ºğŸ‘†

ä¸‹ç­å…³æœº

ç®—äº†æ˜å¤©ç»§ç»­å¼„å§ï¼Œç”±äºæœºå™¨å…³æœºäº†ï¼Œä¹‹å‰å°±æ˜¯ä¸´æ—¶åšå®éªŒï¼Œæ‰€ä»¥mysqlæœåŠ¡éƒ½åœäº†ï¼Œè¿™é‡Œæ­£å¥½é‡æ¼”ä¸€æ¬¡clusterçš„å¯åŠ¨

![image-20230919192042082](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919192042082.png)

å¯è§ğŸ‘†æ‰€æœ‰æœåŠ¡éƒ½æ²¡èµ·æ¥

éšä¾¿é€‰ä¸€å°åˆå§‹åŒ–é›†ç¾¤

æŸ¥çœ‹seqnoè™šæ‹Ÿå·ï¼ŒğŸ‘‡ä¸‹å›¾æ³¨æ„å“¦ï¼Œ135çš„seqnoæœ€ä¼˜ç§€ï¼Œæ‰€ä»¥safe_to_bootstrap:1å°±æ˜¯1ï¼Œå…¶ä»–éƒ½æ˜¯0ï¼Œè¿™æ˜¯ç³»ç»Ÿç»™é»˜è®¤è®¾ç½®å¥½çš„ï¼Œç„¶åæœ‰ä¸ªnode3çš„1æ˜¯æˆ‘æ”¹çš„ï¼æˆ‘ä¹‹å‰å‡†å¤‡ç”¨node3åˆå§‹åŒ–æ–°å»ºçš„ï¼Œæ‰€ä»¥çœ‹åˆ°çš„æ˜¯1ã€‚

![image-20230919192410975](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919192410975.png)

node2æœ€ä¼˜ç§€ï¼Œå°è¯•ä¸åˆå§‹åŒ–ï¼Œé‡å¯çš„ä¸“ç”¨cliè¯•è¯•

![image-20230919192638961](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919192638961.png)

èµ·ä¸æ¥å•Š~

ç›´æ¥newå§å“ˆå“ˆ

![image-20230919192752265](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919192752265.png)

![image-20230919192801825](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919192801825.png)

ç„¶åå…¶ä»–node éƒ½systemctl start mariadbå°±è¡Œäº†

![image-20230919192911714](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919192911714.png)



åŒæ—¶åˆ›å»ºçš„cliçš„æ²¡é—®é¢˜ğŸ‘‡

![image-20230919193127367](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919193127367.png)



### æµ‹è¯•å¼€å§‹



![image-20230919193544970](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919193544970.png)



![image-20230919193647977](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919193647977.png)



ç„¶åå°±çœ‹çœ‹æ•°æ®çš„å¢é•¿

![image-20230919194040967](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919194040967.png)

å‘ç°è¿™ä¸ªé€Ÿåº¦æ¯”ç®€å•çš„ä¸»ä»è¿˜è¦æ…¢å¾ˆå¤šï¼Œç„¶åå…¶å®å¯ä»¥åšæˆäº‹åŠ¡ï¼Œäº‹åŠ¡å°±æ˜¯ä¸€èµ·æäº¤ï¼Œä¼šå¿«ä¸€ç‚¹ã€‚

åƒè¿™ç§å°±å¥½æ¯”å¤§é‡ç”¨æˆ·çš„å†™å’¯ï¼Œæ‰€ä»¥å…·ä½“ç”¨çš„æ—¶å€™è¿˜å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦ä¼˜åŒ–å§åº”è¯¥ï¼å¥½åƒä»–ä»¬ä¸šåŠ¡å®é™…ä¹Ÿä¸è¿™ä¹ˆç©ã€‚



### è¿˜å‘ç°ä¸€ä¸ªç°è±¡ğŸ‘‡

å°±æ˜¯galera clusteré»˜è®¤å°±ç»™ä½ åšäº†tableçš„æ’å…¥çš„è‡ªåŠ¨é—´éš”ï¼Œä»¥å‰æ˜¯<img src="7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919195153835.png" alt="image-20230919195153835" style="zoom:33%;" />è¿™ä¹ˆé…ç½®çš„ã€‚

![image-20230919195117332](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919195117332.png)



**ğŸ‘‡12åˆ†é’Ÿç»ˆäºç»“æŸäº†ï¼š**

![image-20230919195714518](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919195714518.png)



è¯•è¯• äº‹åŠ¡çš„æ–¹å¼ï¼Œç†è®ºä¸Šä¼šå¿«ä¸€äº›

![image-20230919195955669](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919195955669.png)

è¿™TMä¹Ÿå¤ªå¤¸å¼ äº†ï¼Œä¸å¯¹å§

ç¬¬äºŒåè¿è¡Œäº‹åŠ¡ï¼Œä¸€æ ·æ˜¯6ç§’ç§ï¼Œä¸€å…±æ’å…¥äº†3æ¬¡ï¼Œæ¯æ¬¡99999è¡Œï¼Œ300000-3=299997è¡Œï¼Œå¯¹çš„ğŸ‘‡

![image-20230919200224539](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919200224539.png)

å†æ¬¡ä¸è·‘äº‹åŠ¡çœ‹çœ‹



ç»“è®ºï¼ŒgaleraClusteré›†ç¾¤ï¼Œå¤§æ•°æ®å¹¶å‘å†™å…¥ï¼Œä½¿ç”¨äº‹åŠ¡å°±å¾ˆå¿«ï¼ä¸ä½¿ç”¨äº‹åŠ¡å°±ç°å¸¸æ…¢ï¼







## å¤åˆ¶çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

å…¶å®ä»¥ä¸‹è¿™æ®µæ–‡å­—ç®—ä¸å¾—ä»€ä¹ˆé—®é¢˜å’Œæ–¹æ¡ˆï¼ŒèŠèƒœäºæ— ï¼Œçœ‹çœ‹å§ğŸ‘‡



(1)æ•°æ®æŸåæˆ–ä¸¢å¤±

Masterï¼š MHA + semi repl

Slaveï¼šé‡æ–°å¤åˆ¶



(2)æ··åˆä½¿ç”¨å­˜å‚¨å¼•æ“

MyISAMï¼šä¸æ”¯æŒäº‹åŠ¡ 

InnoDBï¼š æ”¯æŒäº‹åŠ¡



(3)ä¸æƒŸä¸€çš„server id 

 é‡æ–°å¤åˆ¶



(2)å¤åˆ¶å»¶è¿Ÿï¼š

éœ€è¦é¢å¤–çš„ç›‘æ§å·¥å…·çš„è¾…åŠ©

ä¸€ä»å¤šä¸»ï¼šmariadb10ç‰ˆåæ”¯æŒ 

å¤šçº¿ç¨‹å¤åˆ¶ï¼šå¯¹å¤šä¸ªæ•°æ®åº“å¤åˆ¶ï¼Œå¥½åƒæ˜¯é«˜ç‰ˆæœ¬çš„ç‰¹æ€§ã€‚



## TiDbæ¦‚è¿°

**ä¸»ä»ã€å¤šä¸»ï¼Œå¯¹äºå†™æ“ä½œï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨ä¸€å°ä¸Šæ“ä½œçš„ï¼Œæ‰€ä»¥mysqlè¿™ç§HAï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æœ‰ç“¶é¢ˆçš„ã€‚**

**è€Œæ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯TiDbåˆ†å¸ƒå¼æ•°æ®åº“**ã€‚

![image-20230919200851709](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919200851709.png)



RDBMSå…³ç³»å‹æ•°æ®çš„ æ•°æ®ä¸€è‡´æ€§ACIDç‰¹æ€§ï¼›NoSQLæ€§èƒ½å¥½ä½†æ˜¯æ²¡æœ‰ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼›TiDbç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ï¼Œåˆå«åšNewSQL

æ‰€ä»¥DBåˆ†ä¸ºäº†ï¼šRDBMSã€NoSQLã€NewSQL

<img src="7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919201306845.png" alt="image-20230919201306845" style="zoom:50%;" />





æ®è¯´ï¼šmysqlçš„ä¸šåŠ¡è¿åˆ°TiDbï¼ŒåŸºæœ¬ä¸Šä¸ç”¨æ”¹åŠ¨ï¼Œç›´æ¥æ¬è¿‡å»å°±èƒ½ç”¨ï¼Œä¸ç”¨æ”¹ä»£ç ã€‚



### TiDBçš„æ ¸å¿ƒç‰¹ç‚¹

1 é«˜åº¦å…¼å®¹ MySQL	å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯ä» MySQL è½»æ¾è¿ç§»è‡³ TiDBï¼Œåˆ†åº“åˆ†
è¡¨åçš„ MySQL é›†ç¾¤äº¦å¯é€šè¿‡ TiDB å·¥å…·è¿›è¡Œå®æ—¶è¿ç§»
2 æ°´å¹³å¼¹æ€§æ‰©å±•	é€šè¿‡ç®€å•åœ°å¢åŠ æ–°èŠ‚ç‚¹å³å¯å®ç° TiDB çš„æ°´å¹³æ‰©å±•ï¼ŒæŒ‰éœ€æ‰©å±•ååæˆ–å­˜å‚¨ï¼Œè½» æ¾åº”å¯¹é«˜å¹¶å‘ã€æµ·é‡æ•°æ®åœºæ™¯ã€‚
3 **åˆ†å¸ƒå¼äº‹åŠ¡**	TiDB 100% æ”¯æŒæ ‡å‡†çš„ ACID äº‹åŠ¡
4 çœŸæ­£é‡‘èçº§é«˜å¯ç”¨	ç›¸æ¯”äºä¼ ç»Ÿä¸»ä» (M-S) å¤åˆ¶æ–¹æ¡ˆï¼ŒåŸºäº Raft çš„å¤šæ•°æ´¾é€‰ä¸¾åè®®å¯ä»¥æ **ä¾›é‡‘èçº§çš„ 100% æ•°æ®å¼ºä¸€è‡´æ€§ä¿è¯**ï¼Œä¸”åœ¨ä¸ä¸¢å¤±å¤§å¤šæ•°å‰¯æœ¬çš„å‰æä¸‹ï¼Œå¯ä»¥å®ç°æ•…éšœçš„è‡ªåŠ¨ æ¢å¤ (auto-failover)ï¼Œæ— éœ€äººå·¥ä»‹å…¥ã€‚
5 ä¸€ç«™å¼ HTAP è§£å†³æ–¹æ¡ˆ	TiDB ä½œä¸ºå…¸å‹çš„ OLTP è¡Œå­˜æ•°æ®åº“ï¼ŒåŒæ—¶å…¼å…·å¼ºå¤§çš„ OLAP æ€§èƒ½ï¼Œ  é…åˆ TiSparkï¼Œå¯æä¾›ä¸€ç«™å¼ HTAPè§£å†³æ–¹æ¡ˆï¼Œä¸€ä»½å­˜å‚¨åŒæ—¶å¤„ç†OLTP & OLAP(OLAPã€OLTP  çš„ä»‹ç»å’Œæ¯”è¾ƒ )æ— éœ€ä¼ ç»Ÿç¹ççš„ ETL è¿‡ç¨‹ã€‚
6 äº‘åŸç”Ÿ SQL æ•°æ®åº“	TiDB æ˜¯ä¸ºäº‘è€Œè®¾è®¡çš„æ•°æ®åº“ï¼ŒåŒ Kubernetes ï¼ˆååˆ†é’Ÿå¸¦ä½ ç†è§£ Kubernetesæ ¸å¿ƒæ¦‚å¿µ ï¼‰æ·±åº¦è€¦åˆï¼Œæ”¯æŒå…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ï¼Œä½¿éƒ¨ç½²ã€é…ç½®å’Œç»´æŠ¤å˜å¾—å åˆ†ç®€å•ã€‚	TiDB çš„è®¾è®¡ç›®æ ‡æ˜¯ 100% çš„ OLTP åœºæ™¯å’Œ 80% çš„ OLAP åœºæ™¯ï¼Œæ›´å¤æ‚çš„ OLAP  åˆ†æå¯ä»¥é€šè¿‡ TiSpark é¡¹ç›®æ¥å®Œæˆã€‚ TiDB å¯¹ä¸šåŠ¡æ²¡æœ‰ä»»ä½•ä¾µå…¥æ€§ï¼Œèƒ½ä¼˜é›…çš„æ›¿æ¢ä¼ ç»Ÿçš„æ•°æ® åº“ä¸­é—´ä»¶ã€æ•°æ®åº“åˆ†åº“åˆ†è¡¨ç­‰ Sharding æ–¹æ¡ˆã€‚åŒæ—¶å®ƒä¹Ÿè®©å¼€å‘è¿ç»´äººå‘˜ä¸ç”¨å…³æ³¨æ•°æ®åº“ Scale  çš„ç»†èŠ‚é—®é¢˜ï¼Œä¸“æ³¨äºä¸šåŠ¡å¼€å‘ï¼Œæå¤§çš„æå‡ç ”å‘çš„ç”Ÿäº§åŠ›.





**æ•°æ®åº“çš„æ•´ç†å·®ä¸å¤šäº†å°±**
ä¸‹é¢ä»‹ç»ä»¥ä¸‹å‹åŠ›æµ‹è¯•



# æ€§èƒ½è¡¡é‡æŒ‡æ ‡



**æ•°æ®åº“æœåŠ¡è¡¡é‡æŒ‡æ ‡**

QPS:	query per second   # **æŸ¥è¯¢æ€§èƒ½**ï¼š æ¯ç§’å¤„ç†çš„æŸ¥è¯¢æ¬¡æ•°ï¼Œç®€å•çš„å•è¡¨selectå’Œå¤šè¡¨joinå¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—æ˜¯æˆªç„¶ä¸åŒï¼æ‰€ä»¥å‹åŠ›æµ‹è¯•çš„æ—¶å€™æ˜¯è¦äº‹å…ˆå®šä¹‰selectæŸ¥è¯¢è§„åˆ™--æ¶‰åŠå“ªäº›æŸ¥è¯¢æ–¹æ³•ã€‚

TPS:	transaction per second  # äº‹åŠ¡çš„å¤„ç†ï¼Œä¸»è¦æŒ‡çš„å°±æ˜¯**æ•°æ®çš„ä¿®æ”¹æ€§èƒ½**äº†ï¼Œæ¶‰åŠå¢åˆ æ”¹ã€‚



**å‹åŠ›æµ‹è¯•å·¥å…·**
mysqlslap  # ç³»ç»Ÿè‡ªå¸¦ï¼Œæ— éœ€å®‰è£…
Sysbenchï¼šåŠŸèƒ½å¼ºå¤§ https://github.com/akopytov/sysbench
tpcc-mysql
MySQL Benchmark Suite
MySQL super-smack
MyBench



### mysqlslapä½¿ç”¨

è¯¥å·¥å…·æ¥æºäºMariaDB-clientè½¯ä»¶ğŸ‘‡

<img src="7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919202805799.png" alt="image-20230919202805799" style="zoom:50%;" /> 



![image-20230919202945144](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919202945144.png)

![image-20230919204046401](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204046401.png)

![image-20230919204208689](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204208689.png)

æ³¨æ„ï¼šè™½ç„¶è¿™ä¸ªå·¥å…·æµ‹è¯•å®Œæˆåä¸ä¼šåœ¨DBä¸­ç•™ç—•ï¼Œä½†æ˜¯binlogè‚¯å®šä¼šå¤§é‡è¢«å®ƒä¿®æ”¹çš„ï¼Œæ‰€ä»¥æµ‹è¯•çš„æ—¶å€™binlogè¦ä¹ˆå…³é—­ï¼Œè¦ä¹ˆå•ç‹¬å­˜æ”¾ã€‚

binlogé™¤äº†åœ¨/etc/my.cndé‡Œå®šä¹‰ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°/etc/my.cnf.d/server.confé‡Œä¸€æ ·çš„ï¼ŒğŸ‘‡æ¶‰åŠé›†ç¾¤galeraé‡Œå®šä¹‰äº†binglogçš„æ ¼å¼rowï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥log-binå¼€å¯ä¹Ÿæ”¾åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œã€‚

<img src="7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919203412460.png" alt="image-20230919203412460" style="zoom:44%;" />



binlogæ˜¯å¦å¯ç”¨ï¼Œæœ€å¥½è¿˜æ˜¯çœ‹å˜é‡ï¼Œè€Œä¸æ˜¯ll /var/lib/mysql/å»çœ‹ç›¸å…³æ–‡ä»¶æœ‰æ²¡æœ‰å¯¹å§ï¼Œä½ è¿™æ ·è¿˜å¾—å»å…ˆçœ‹çœ‹cnfäººå®¶é…ç½®åœ¨å“ªé‡Œäº†ã€‚

![image-20230919204001405](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204001405.png)





![image-20230919204226654](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204226654.png)

![image-20230919204240003](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204240003.png)





![image-20230919204606178](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204606178.png)

ç”Ÿäº§äº†å¤§é‡çš„binlog

![image-20230919204636782](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919204636782.png)



å¦‚æœè¦åœbinlogï¼Œset å˜é‡è¿™ç§æŒºä¸æ‰ï¼Œå› ä¸ºæ˜¯åŸºäºä½ å½“å‰cliäº¤äº’è¿›å»çš„sessionçš„ï¼Œè€Œå‹åŠ›æµ‹è¯•æ˜¯å¤šsessionå¹¶å‘çš„ï¼Œå®Œå…¨æ²¡æœ‰ä¸€ç‚¹æ•ˆæœï¼Œå› ä¸ºsessionå®Œå…¨æ’ä¸åˆ°ä¸€èµ·å»ï¼Œå“ˆå“ˆã€‚è€Œä¸”sql_log_binæ˜¯sessionçº§åˆ«çš„å˜é‡ï¼Œæ²¡æœ‰å…¨å±€çš„ã€‚çœŸçš„æ˜¯sessionçš„ï¼Œçœ‹çœ‹å®˜æ–¹

![image-20230919205427595](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919205427595.png)

![image-20230919205437537](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919205437537.png)

å†è¯•è¯•

![image-20230919205545717](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919205545717.png)

æœç„¶ğŸ‘†ï¼Œæ— æ³•å®ç°ï¼šå…³é—­å…¨å±€binlogçš„æ•ˆæœï¼Œåªèƒ½å»cnfæ–‡ä»¶äº†ã€‚



ç­‰ç­‰ğŸ‘‡è¿™TMä»€ä¹ˆå›äº‹ï¼š

![image-20230919205645119](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919205645119.png)

é—®ğŸ‘†binlogåŸºäºæœ¬ä¼šè¯åˆ°åº•æ˜¯å…³äº†è¿˜æ˜¯æ²¡å…³ï¼Ÿ



![image-20230919205820257](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919205820257.png)

![image-20230919210011549](7-å®ç°galeraclusterå’Œæ€§èƒ½æµ‹è¯•.assets/image-20230919210011549.png)

ç¡®å®å…³äº†



