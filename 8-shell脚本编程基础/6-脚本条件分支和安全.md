# 第6节. 脚本条件分支和安全

 

type xxx一般可见就是build in 这种内部命令或者外部命令或者alias，现在忽然发现type if不一样的显示

```
[17:19:51 root@host1 ~]#type echo
echo is a shell builtin
[17:19:59 root@host1 ~]#type help
help is a shell builtin
[17:20:07 root@host1 ~]#type ls
ls is aliased to `ls --color=auto'
[17:20:09 root@host1 ~]#type cp
cp is aliased to `cp -i'
[17:20:10 root@host1 ~]#type date
date is /usr/bin/date
[17:20:13 root@host1 ~]#type if
if is a shell keyword    👈不能独立作为命令，是shell的关键字
[17:20:15 root@host1 ~]#

```

![image-20220206172222148](6-脚本条件分支和安全.assets/image-20220206172222148.png) 

老王说得好，世界上最远的距离就是，一个在if下，另一个在else里。

## if的shell格式

<img src="6-脚本条件分支和安全.assets/clip_image001.png" alt="img" style="zoom:67%;" /> 

 

![img](6-脚本条件分支和安全.assets/clip_image003.jpg)

有个问题啊，上面的exit没有意义。下面的都是一样效果

<img src="6-脚本条件分支和安全.assets/clip_image005.jpg" alt="img" style="zoom:67%;" /> 

![img](6-脚本条件分支和安全.assets/clip_image006.png)

 

例子：ping一个主机通就算了，不通看下是否处于维护状态(维护的机器一般规范的话是放到一个文件里记着的)，如果不在维护 则认为机器是down的。

![img](6-脚本条件分支和安全.assets/clip_image007.png)

## if不适合的情况

![img](6-脚本条件分支和安全.assets/clip_image009.jpg)

此时就需要case

![img](6-脚本条件分支和安全.assets/clip_image010.png)

👆上图注意关键字：变量引用。变量引用和变量是两码事，变量引用是要加$的，就是说case 和read 不同，read后面是直接写NAME就表示变量了，而case得写$NAME，引用一下。

### 注意：PAT1)是通配符，不是正则！



![img](6-脚本条件分支和安全.assets/clip_image012.jpg)

![img](6-脚本条件分支和安全.assets/clip_image014.jpg)

变量引用和变量是两码事

![img](6-脚本条件分支和安全.assets/clip_image016.jpg)

![img](6-脚本条件分支和安全.assets/clip_image018.jpg)

if开头，fi结尾，case开头esac结尾。

![img](6-脚本条件分支和安全.assets/clip_image019.png)

![img](6-脚本条件分支和安全.assets/clip_image021.jpg)

![img](6-脚本条件分支和安全.assets/clip_image023.jpg)



## 下面是一些补充

<img src="6-脚本条件分支和安全.assets/clip_image025.jpg" alt="img" style="zoom:67%;" />

上图的小括号是什么鬼？！，上图还差一个小括号没讲，小括号的优先级最高。

 各种符号的优先级见👆上图：

1、命令行里先拆成单词，

2、然后看单词里有没有别名

![img](6-脚本条件分支和安全.assets/clip_image027.jpg)

![img](6-脚本条件分支和安全.assets/clip_image029.jpg)

![img](6-脚本条件分支和安全.assets/clip_image031.jpg)

![img](6-脚本条件分支和安全.assets/clip_image033.jpg)

![img](6-脚本条件分支和安全.assets/clip_image035.jpg)

 

![img](6-脚本条件分支和安全.assets/clip_image037.jpg)

![img](6-脚本条件分支和安全.assets/clip_image039.jpg)

profile是配置文件的意思

bashrc是bash和rc，bash是shell类型，rc是run config，run bash运行的时候的对应的配置文件。run command

 

![img](6-脚本条件分支和安全.assets/clip_image041.jpg)

![img](6-脚本条件分支和安全.assets/clip_image042.png)

![img](6-脚本条件分支和安全.assets/clip_image043.png)

![img](6-脚本条件分支和安全.assets/clip_image044.png)

1、加执行权限

2、bash xxx

3、cat xxx | bash   这种有点问题

4、source xxx

![img](6-脚本条件分支和安全.assets/clip_image045.png)

![img](6-脚本条件分支和安全.assets/clip_image047.jpg)

![img](6-脚本条件分支和安全.assets/clip_image049.jpg)

 

sleep观察source和bash的区别

![img](6-脚本条件分支和安全.assets/clip_image051.jpg)

![img](6-脚本条件分支和安全.assets/clip_image052.png)

![img](6-脚本条件分支和安全.assets/clip_image054.jpg)

而bash

![img](6-脚本条件分支和安全.assets/clip_image055.png)

![img](6-脚本条件分支和安全.assets/clip_image057.jpg)

bash会开启子进程，一般运行脚本都会开启子进程。否则可能会影响当前变量的值。

 

 

![img](6-脚本条件分支和安全.assets/clip_image059.jpg)

![img](6-脚本条件分支和安全.assets/clip_image061.jpg)

**所以一般脚本不用source。而一般配置config文件就是要用source，因为配置文件就是希望改变当前环境的。**

 

 

![img](6-脚本条件分支和安全.assets/clip_image063.jpg)

![img](6-脚本条件分支和安全.assets/clip_image064.png)

![img](6-脚本条件分支和安全.assets/clip_image066.jpg)

 

![img](6-脚本条件分支和安全.assets/clip_image068.jpg)

 

![img](6-脚本条件分支和安全.assets/clip_image070.jpg)

![img](6-脚本条件分支和安全.assets/clip_image072.jpg)

![img](6-脚本条件分支和安全.assets/clip_image074.jpg)

 

![img](6-脚本条件分支和安全.assets/clip_image076.jpg)

![img](6-脚本条件分支和安全.assets/clip_image078.jpg)

 

![img](6-脚本条件分支和安全.assets/clip_image080.jpg)

插入题外话

**关闭****VIM后，屏幕唉显示之前的VIM里的内容：**

在.vimrc文件里加上配置语句：

在.vimrc中设置set t_ti= t_te=

方法二

![img](6-脚本条件分支和安全.assets/clip_image082.jpg)

![img](6-脚本条件分支和安全.assets/clip_image084.jpg)

回到原题

![img](6-脚本条件分支和安全.assets/clip_image086.jpg)

![img](6-脚本条件分支和安全.assets/clip_image088.jpg)

![img](6-脚本条件分支和安全.assets/clip_image090.jpg)

![img](6-脚本条件分支和安全.assets/clip_image092.jpg)

![img](6-脚本条件分支和安全.assets/clip_image094.jpg)

![img](6-脚本条件分支和安全.assets/clip_image095.png)

其他补充

![img](6-脚本条件分支和安全.assets/clip_image097.jpg)

同理

![img](6-脚本条件分支和安全.assets/clip_image099.jpg)

![img](6-脚本条件分支和安全.assets/clip_image101.jpg)

![img](6-脚本条件分支和安全.assets/clip_image103.jpg)

![img](6-脚本条件分支和安全.assets/clip_image105.jpg)

问题来了，如果上面的脚本写成如下错误

![img](6-脚本条件分支和安全.assets/clip_image107.jpg)

变量写错，$DIR为空，直接就灾难性的把根删了。

如何避免

![img](6-脚本条件分支和安全.assets/clip_image109.jpg)

 

 

还有一个

![img](6-脚本条件分支和安全.assets/clip_image111.jpg)

![img](6-脚本条件分支和安全.assets/clip_image113.jpg)

说明脚本也是在子进程里跑的。

![img](6-脚本条件分支和安全.assets/clip_image115.jpg)

虽然出错了，但是还是继续执行了

![img](6-脚本条件分支和安全.assets/clip_image117.jpg)

处理方法如下

![img](6-脚本条件分支和安全.assets/clip_image119.jpg)

 

 

 

 

![img](6-脚本条件分支和安全.assets/clip_image121.jpg)

整一个这个还是不错的。

![img](6-脚本条件分支和安全.assets/clip_image123.jpg)

 
