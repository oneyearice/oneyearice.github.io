# ç¬¬4èŠ‚. nginxå®ç°webæœåŠ¡å™¨01



# nginxçš„httpçš„è¯­å¥å—é…ç½®

## ä¸»è¦æ˜¯[ngx_http_core_module](https://nginx.org/en/docs/http/ngx_http_core_module.html)è¿™ä¸ªæ¨¡å—

![image-20231101133651770](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101133651770.png)



MIMEå‚è€ƒæ–‡æ¡£ï¼š

https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types



![image-20231101134517371](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101134517371.png)

ä¸å†™includeï¼Œå°±å†™typeåŒæ ·æ”¾åˆ°httpè¯­å¥å—ä¸‹



default_typeæ˜¯æœ‰é»˜è®¤å€¼çš„

![image-20231101135939525](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101135939525.png)



ä½†æ˜¯é€šå¸¸yumå’Œç¼–è¯‘éƒ½ä¼šç»™ä½ æ”¹æˆ

![image-20231101140109966](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101140109966.png)

è¿™ä¸ªï¼Œè¿™ä¸ªå°±æ˜¯é™¤äº†æ˜ç¡®çš„ç±»å‹ä»¥ä¸ºï¼Œæµè§ˆå™¨ä¸èƒ½è¯†åˆ«äº†å°±ï¼Œæ­¤æ—¶ç»Ÿç»Ÿæç¤ºä¸‹è½½ã€‚

![image-20231101141351088](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101141351088.png)

### æµ‹è¯•ä¸‹default_type application/octet-streamçš„æ•ˆæœ

![image-20231101142417793](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101142417793.png)



![image-20231101142328223](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101142328223.png)

å¦‚æœæ˜¯æ— ç—•æ¨¡å¼çš„æµè§ˆå™¨ï¼Œä¼šç›´æ¥å¼¹ å¦å­˜ä¸º çš„å¯¹è¯æ¡†ï¼Œä¹Ÿæ˜¯ä¸‹è½½çš„åŠ¨ä½œã€‚



é€šè¿‡curl çœ‹çœ‹å¤´éƒ¨

![image-20231101142643657](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101142643657.png)

curl ä¸åŠ -I è²Œä¼¼è¿˜æ˜¯ç›´æ¥ä»¥æ–‡æœ¬æ‰“å¼€äº†å°±

![image-20231101142729917](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101142729917.png)

æ³¨é‡Šæ‰ä½¿å…¶ä½¿ç”¨é»˜è®¤çš„text/plainæ ¼å¼

![image-20231101142956470](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101142956470.png)

![image-20231101143006157](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101143006157.png)



**çœ‹ä¸‹phpæ–‡ä»¶çš„è¯†åˆ«**

![image-20231101143337930](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101143337930.png)

é»˜è®¤å°±æ˜¯ä¸æ”¯æŒçš„

å†™ä¸€ä¸ªphpæ–‡ä»¶æ¥å®éªŒ

![image-20231101143448439](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101143448439.png)

ç”±äºä¸æ”¯æŒ.phpæ‰€ä»¥æ‰“å¼€è¯¥URLé»˜è®¤å°±æ˜¯ä¸‹è½½è¯¥æ–‡ä»¶çš„ï¼Œå¯¹æ¯”ä¹‹å‰apacheçš„æ•ˆæœï¼Œæˆ‘æœ‰ä¸¤ä¸ªapacheâ‘ ä¸ªyumå®‰è£…â‘¡ä¸€ä¸ªç¼–è¯‘å®‰è£…ï¼Œå…¶å®ä¸ç®¡æ˜¯yumè¿˜æ˜¯ç¼–è¯‘éƒ½ä¸æ”¯æŒphpæ–‡ä»¶çš„æµè§ˆå™¨ç›´æ¥æ‰“å¼€ï¼Œåªä¸è¿‡yumå®‰è£…çš„apacheï¼Œåæ¥åˆyumå®‰è£…äº†phpï¼Œäºæ˜¯

![image-20231101145039676](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101145039676.png)

è¿™å°±æ‰¾åˆ°äº†cliçš„å‡ºå¤„å•¦ï¼Œæ­£å¼å› ä¸ºyum install phpæ‰æœ‰äº†httpdé…ç½®æ–‡ä»¶é‡Œçš„å“ªä¸ªphp.confä¸”æ”¾åœ¨äº†conf.dä¸‹ï¼Œæ‰æœ‰äº†httpdæµè§ˆå™¨æ‰“å¼€äº†phpæ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œä»¥æ­¤ç±»æ¨ç°åœ¨nginxä¹Ÿè¦è¿™ä¹ˆæä¸€ä¸‹ã€‚

![image-20231101145204626](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101145204626.png)



![image-20231101154824667](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101154824667.png)

ä½†æ˜¯æˆ‘ç°åœ¨çš„nginxæ˜¯ç¼–è¯‘å®‰è£…çš„ï¼Œæ‰€ä»¥æˆ‘éœ€è¦å°è¯•è’‹è¿™ä¸ªphp.confå¤åˆ¶åˆ°ç¼–è¯‘çš„è·¯å¾„ä¸‹

![image-20231101155629430](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101155629430.png)

æ²¡ç”¨phpé‡Œçš„ngnixå…³é”®å­—çš„æ–‡ä»¶é‡Œéƒ½æ²¡æœ‰text/html .phpä¹‹ç±»çš„å­—çœ¼ï¼Œç®€å•ç½‘é€Ÿæœäº†ä¸‹nginxå¯¹phpçš„æ”¯æŒä¸æƒ³apacheä¸€æ ·ç®€å•ã€‚å…·ä½“æ“ä½œå‚è§ä»¥ä¸‹æ•™ç¨‹ğŸ‘‡

https://blog.51cto.com/928004321/1744675

https://www.php.cn/faq/476519.html



### tcp_nodelay on; å¯ä¼˜åŒ–æŠ¥æ–‡ç¡®è®¤é¢‘æ¬¡ï¼Œæé«˜ä¼ è¾“æ•ˆç‡

![image-20231101164742749](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101164742749.png)



æ®è¯´æ˜¯å½“ æ•°æ®æŠ¥æ–‡æ¯”è¾ƒå¤§çš„æ—¶å€™æ‹†åŒ…ä¼ è¾“äº†å°±ï¼Œæ­¤æ—¶å°±ä¸€ä¸‹å‘å¥½å‡ ä¸ªåŒ…ï¼Œç„¶åå†ç¡®è®¤ä¸€æ¬¡å°±æ¯”è¾ƒåˆç†äº†ã€‚

å…¶å®æ•°æ®æŠ¥æ–‡å°çš„æ—¶å€™ä¸æ¶‰åŠæ‹†åŒ…ï¼ŒåŒæ ·ä¹Ÿèƒ½æé«˜æ•ˆç‡ï¼Œåªæ˜¯æ•°æ®é‡å°ï¼Œèµ„æºæ¶ˆè€—å°ï¼Œç³»ç»Ÿä¹Ÿå¥½ç¡¬ä»¶ä¹Ÿç½¢èƒ½å¯¹ä»˜å¾—äº†ï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™èµ„æºæ¶ˆè€—å¤§äº†ï¼Œæ­¤æ—¶å°±ä¼šä»å„ä¸ªæ–¹é¢ä¼˜åŒ–ï¼Œæ‰éœ€è¦tcp_nodely onå¤šåŒ…ç¡®è®¤ä¸€æ¬¡ã€‚



### tcp_nopush on;  å¯ä¼˜åŒ–æŠ¥æ–‡åˆå¹¶æé«˜ï¼Œæé«˜ä¼ è¾“æ•ˆç‡



### ![image-20231101165302878](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101165302878.png)





![image-20231101165729757](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101165729757.png)

é»˜è®¤æ˜¯offä¸æ˜¾ç¤ºçš„

![image-20231101170035018](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101170035018.png)

ä¹Ÿå¯ä»¥åˆ©ç”¨"include conf.d/*.conf"å»å•å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ç†è§£å°±æ˜¯includeæ˜¯åœ¨è¿™ä¸ªè¯­å¥å—ä¹Ÿå°±æ˜¯è¿™ä¸ªç¼©è¿›å±‚çº§ä¸‹çš„ï¼Œæ‰€ä»¥æ–°å»ºçš„xxx.confé‡Œçš„å†…å®¹ä¹Ÿåªåæ˜ åˆ°è¿™ä¸ªè¯­å¥å—å±‚çº§ä¸‹çš„ã€‚

![image-20231101171212860](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101171212860.png)

åªæ˜¯ä¸ªæ˜¾ç¤ºè€Œå·²ã€‚



### server_tokens on|off|build|string;

![image-20231101171341677](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101171341677.png)

stringæ˜¯å•†ä¸šç‰ˆçš„nginxæ‰æ”¯æŒçš„ã€‚

![image-20231101172519258](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101172519258.png)

buildå‚æ•°å°±ä¸æ˜¯ç®€å•ä¿®æ”¹äº†çš„ï¼Œ

![image-20231101172714900](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101172714900.png)

![image-20231101172748320](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101172748320.png)

![image-20231101172802960](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101172802960.png)

æ‰€ä»¥buildæ˜¯ç¼–è¯‘çš„æ—¶å€™ï¼Œé€šè¿‡--build=xx.xxx.v1001ï¼Œç„¶åé…ç½®æ–‡ä»¶é‡Œå†™server_tokens build;æ‰ä¼šæœ‰æ•ˆæœçš„ã€‚ 

æˆ–è€…ä¿®æ”¹æºç æ–‡ä»¶é‡Œçš„å…³é”®å­—æ®µï¼›server_tokens onæˆ–è€…offéƒ½èƒ½æ”¹ï¼Œæ”¹çš„åœ°æ–¹ä¸åŒğŸ‘‡

![image-20231101175953946](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101175953946.png)

server_tokens on;ä¿®æ”¹ğŸ‘‡

![image-20231101175749099](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101175749099.png)

æ”¹æˆï¼š

![image-20231101181415647](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101181415647.png)

server_tokens off;ä¿®æ”¹ğŸ‘‡

![image-20231101180159940](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101180159940.png)

æ”¹æˆï¼š

![image-20231101181506260](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101181506260.png)



å½“ç„¶æ”¹å®Œè¿˜éœ€è¦é‡æ–°ç¼–è¯‘äº†

é‚£ä¹ˆå°±é‡æ–°å˜ä¸€ä¸‹çœ‹çœ‹

ç¼–è¯‘ä¹‹å‰çœ‹ä¸‹äºŒè¿›åˆ¶ä¸»ç¨‹åºçš„å“ˆå¸Œå€¼

![image-20231101180854787](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101180854787.png)

æ‹…å¿ƒè½¯è¿æ¥çš„å“ˆå¸Œï¼Œç¡®è®¤ä¸‹ï¼Œä¸æ˜¯å“¦ï¼Œå°±æ˜¯æºæ–‡ä»¶çš„å“ˆå¸Œ

![image-20231101180931154](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101180931154.png)

å¼€å§‹ç¼–è¯‘ï¼Œctrl+rè°ƒå‡ºå†å²å‘½ä»¤å›è½¦å°±è¡ŒğŸ‘‡

![image-20231101181009188](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101181009188.png)

![image-20231101181651972](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101181651972.png)



![image-20231101181745430](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101181745430.png)



é‚£ä¸ªæ­¤æ—¶ä¹‹å‰çš„nginxæœåŠ¡è¿˜åœ¨ï¼Œä¸ä¼šåœï¼Œå› ä¸ºä½ ç”¨çš„ä¹‹å‰çš„nginxäºŒè¿›åˆ¶å¯åŠ¨çš„æœåŠ¡ï¼Œä½ é‡æ–°ç¼–è¯‘å…¶å®ä¹Ÿå°±æ˜¯å¯¹è¿™ä¸ªäºŒè¿›åˆ¶è¿›è¡Œå˜åŒ–å§ï¼Œæ‰€ä»¥ä¹‹å‰å·²ç»å¯åŠ¨äº†çš„æœåŠ¡ä¸å—å½±å“ï¼ŒæœåŠ¡ç¨‹åºç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚



æ­¤æ—¶æƒ³ç”¨nginx -s reloadçœ‹åˆ°æ•ˆæœæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¿®æ”¹çš„/apps/nginx/sbin/nginxäºŒè¿›åˆ¶ç¨‹åºé‡Œçš„ä¸œè¥¿ï¼Œä¸æ˜¯é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦é‡å¯æœåŠ¡åæ‰èƒ½çœ‹åˆ°æ•ˆæœ



![image-20231101182807915](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101182807915.png)



ç„¶åä¿®æ”¹server_tokenä¸ºonï¼Œreloadé…ç½®æ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ğŸ‘‡

![image-20231101183245161](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231101183245161.png)





## serveråœ¨å¾ˆå¤šæ¨¡å—é‡Œéƒ½æœ‰

![image-20231102092239228](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231102092239228.png)

ä¸‹é¢æ¢³ç†coreæ¨¡å—é‡Œçš„server

serverå°±æ˜¯è™šæ‹Ÿä¸»æœº

![image-20231102092826522](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231102092826522.png)

![image-20231102093458093](4-nginxå®ç°webæœåŠ¡å™¨01.assets/image-20231102093458093.png)



listen PORT|address[:port]|unix:/PATH/TO/SOCKET_FILE

listenå¯ä»¥å†™portã€ip+portã€unixå¥—æ¥å­—çš„è·¯å¾„ã€‚ä½†æ˜¯å†™unix socketå°±åªèƒ½æœ¬æœºè®¿é—®äº†ã€‚

default_serverï¼šé»˜è®¤è™šæ‹Ÿä¸»æœºï¼Œå°±æ˜¯æ²¡æœ‰å‘½ä¸­çš„ç»Ÿç»Ÿç”¨è¿™ä¸ªè™šæ‹Ÿä¸»æœºæ¥å“åº”ï¼Œè¿™é‡Œåœ¨apacheé‡Œæ˜¯ä¸ç”¨è®¾ç½®ï¼Œæ‹æœ€å‰é¢çš„virtualHostå°±æ˜¯é»˜è®¤çš„ã€‚
