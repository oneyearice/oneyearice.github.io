# ç¬¬3èŠ‚ Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„



### docker åˆ é™¤åçš„ä¸€äº›æƒ…å†µ

docker åˆ é™¤ç‰¹å®šçš„å®¹å™¨ä¸¤ç§æ–¹æ³•

```shell
docker rm `docker ps -aq`    # è¿™ä¸ªå…¶å®ä¸åŠ -fä¹Ÿå¯ä»¥ï¼Œå¤§ä¸äº†UPçš„æŠ¥é”™ï¼Œå°±æ˜¯ä¸å¤ªå®‰å…¨æ„Ÿè§‰
docker rm `docker ps -f status=exited -q`  #  è¿™ç§ä¹Ÿok
docker container prune  # å®˜æ–¹å°è£…å¥½çš„cli
docker container prune -f  # åŒä¸Šï¼Œåªä¸è¿‡æ˜¯ä¸ç”¨å›ç­”y/n
```

![image-20240419102451765](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419102451765.png)

æ”¹åè¿è¡Œä¸­çš„ä¸€æ ·æ”¹



æµ‹ä¸€ä¸‹

```
docker rm `docker ps -aq` 
```

![image-20240419103029255](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419103029255.png)

é€€å‡ºçŠ¶æ€æ˜¯å¤¹åœ¨ä¸¤ç»„UPä¹‹é—´çš„ï¼Œ

æ²¡é—®é¢˜å•Šï¼Œè¿˜æ˜¯é‚£å¥è¯docker rm $(docker ps -aq)  å°±æ˜¯ä¸èƒ½åˆ é™¤UPçš„ï¼Œè‡ªç„¶å°±ä¼šæŠŠé€€å‡ºçš„åˆ æ‰

![image-20240419103155782](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419103155782.png)



**container = image + dataï¼Œcontaineråœæ­¢imageå±‚å°±åˆ äº†ï¼Œåªç•™ä¸‹dataï¼Œç®€å•æ¥è®²æ˜¯è¿™æ ·ï¼Œç»†ç©¶å°±æ˜¯imageä¸æ˜¯å¤åˆ¶è€Œæ˜¯å…±ç”¨è¿‡æ¥çš„ï¼Œmegedå°±æ˜¯imageå±‚çš„ä¸œè¥¿**

å®¹å™¨åœæ­¢æ—¶ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±çš„ï¼Œé‚£ä¹ˆdockers stopåé‡Šæ”¾çš„ç©ºé—´æ˜¯ä»€ä¹ˆï¼Œè‚¯å®šä¸æ˜¯imageå¯¹å§ï¼Œimageä¹Ÿä¸æ˜¯è¯´å¤åˆ¶ä¸€ä»½ï¼Œå¯èƒ½æ˜¯éš”ç¦»çš„namespaceè¿™äº›éš”ç¦»ç¨‹åºéšç€å®¹å™¨èµ·æ¥ä¸€ä¸ªå°±è¦åšä¸€äº›éš”ç¦»ä»£ç ï¼Ÿ  # è¯´æ³•ä¸å¯¹ï¼Œstopå è½å·®ç©ºé—´å¤§å°åœ¨4220KBï¼Œ[ç­”æ¡ˆè§ä¸‹æ–‡](#1) 

![image-20240419104941827](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419104941827.png)



![image-20240419111851254](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419111851254.png)

m53.txåœ¨å®¹å™¨å¤–é¢ä¹Ÿæ˜¯çœ‹å¾—åˆ°çš„ğŸ‘‡

![image-20240419113219782](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419113219782.png)

diffå°±æ˜¯æ–°å¢åŠ çš„æ–‡ä»¶ã€‚



<span id=1>ä¸‹å›¾å°±æ˜¯å®¹å™¨stopåé‡Šæ”¾çš„ç©ºé—´</span>ğŸ‘‡mergedçœ‹ç€åƒimageå¤åˆ¶è¿‡æ¥ä¸€ä»½ï¼Œä½†å…¶å®ç©ºé—´åªæœ‰4228KBè¿œè¿œä¸æ˜¯IMAGEçš„4.26MB

![image-20240419113647734](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419113647734.png)



æ—¥å¿—ä¹Ÿæ˜¯è½åœ¨å¤–é¢çš„ï¼Œä¹Ÿä¸ä¼šåˆ çš„

![image-20240419112540427](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419112540427.png)

å…¶å®å®¹å™¨é‡Œçš„æ•°æ®éƒ½æ˜¯åœ¨/var/lib/docker/overlay2ç›®å½•ä¸‹çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šéšç€å®¹å™¨stopå°±æ²¡äº†ã€‚



æœ‰ç©ºçœ‹çœ‹è¿™ä¸ªï¼Œå¯ä»¥å›è¿‡å¤´æ¥çœ‹ï¼Œ

https://zhuanlan.zhihu.com/p/374924046

é“¾æ¥é‡Œçš„æˆªå›¾ğŸ‘‡

<img src="2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419155437678.png" alt="image-20240419155437678" style="zoom:40%;" />





![image-20240419161755149](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419161755149.png)

çœ‹åˆ†å±‚overlay2é‡Œç¡®å®å˜å°äº†å•Šï¼Œ

![image-20240419162101027](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419162101027.png)

ä½†æ˜¯docker ps -sçœ‹åˆ°çš„å˜å¤§äº†ï¼Œå¯èƒ½åŸå› å¦‚ä¸‹ğŸ‘‡

![image-20240419171403863](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419171403863.png)

### å®¹å™¨æ•°æ®æ˜¯å¦æŒä¹…ï¼Ÿ

æ³¨æ„å®¹å™¨çš„æ•°æ®ä¼šéšç€å®¹å™¨åˆ é™¤è€Œåˆ é™¤çš„ï¼Œä¸Šé¢æ˜¯è¯´å®¹å™¨çš„æ•°æ®ä¸ä¼šéšç€å®¹å™¨çš„stopè€Œæ¶ˆå¤±ï¼›è¯´ç™½å°±æ˜¯overlay2ç›®å½•é‡Œçš„ä¸œè¥¿ï¼Œdocker rmæ‰å°±æ²¡äº†ï¼Œstopè¿˜åœ¨çš„ã€‚å¦‚æœmysql å®¹å™¨ï¼Œè‚¯å®šä¸èƒ½è¿™æ ·ï¼Œå°±è¦åšæŒä¹…åŒ–ã€‚

![image-20240419173043942](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419173043942.png)

ä¸Šå›¾çš„ç›®å½•åªè¦é€€å‡ºæ¥ï¼Œè¿™ä¸ªç›®å½•å°±æ²¡äº†

![image-20240419173239929](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419173239929.png)





### æµ‹çš„ç©

æ‰€æœ‰imageså’Œå®¹å™¨éƒ½åˆ æ‰ï¼Œæ­¤æ—¶overlay2é‡Œæ˜¯ç©ºçš„

![image-20240419174725277](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419174725277.png)



ç„¶åpullä¸€ä¸ªbusyboxçœ‹çœ‹

![image-20240419175004406](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419175004406.png)

diffé‡Œçš„ä¸œè¥¿4220KBå­—èŠ‚ğŸ‘†

runèµ·æ¥åï¼Œå¤šäº†ä¸¤ä¸ªåˆ†å±‚ç›®å½•

![image-20240419175249512](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419175249512.png)

ç„¶åç©ºé—´å¤§å°ï¼Œrunèµ·æ¥çš„ç©ºé—´å ç”¨ä¸»è¦åœ¨mergedç›®å½•ï¼Œçœ‹èµ·æ¥å°±æ˜¯ç­‰äºimageé‡Œçš„diffç›®å½•å¤§å°ï¼›æ‰€ä»¥è¿™ä¸ªå®¹å™¨é‡Œçš„mergedç›®å½•å°±æ˜¯ä»imageé‡Œçš„diffæ‹¿æ¥çš„ï¼Œæ‰€ä»¥å°±æ˜¯å¤åˆ¶äº†ä¸€ä»½imageçš„å…¨é‡äº†åŸºæœ¬ä¸Š

![image-20240419182451327](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419182451327.png)

container = image + data ï¼Œå®¹å™¨èµ·æ¥å°±æ˜¯å¤åˆ¶äº†ä¸€ä»½imageè¿™è¯æ²¡æ¯›ç—…ï¼Œå¯èƒ½å¤šä¸ªå®¹å™¨åŸºäºä¸€ä¸ªimageå­˜åœ¨å…±ç”¨ï¼Œè¿™ä¸ªåé¢å†æµ‹è¯•ï¼Œè‡³å°‘ç¬¬ä¸€ä¸ªå®¹å™¨çœ‹æ¥å°±æ˜¯å¤šäº†merged4220KBï¼Œç„¶åç­‰äºimageçš„diff4220KBï¼Œä¹ŸåŸºæœ¬ç­‰äºdocker images çœ‹åˆ°çš„imageå¤§å°4.26MB=4260KBã€‚

![image-20240419183112612](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419183112612.png)

diffç›®å½•æ˜¯å’Œè°çš„diffä¸åŒï¼Œåº”è¯¥æ˜¯å®¹å™¨èµ·æ¥åå’Œimageä¹‹é—´çš„ä¸åŒã€‚



ç„¶åå†stopæ‰çœ‹çœ‹ç©ºé—´å ç”¨ï¼Œstopæ‰mergedç›®å½•å°±æ²¡äº†ã€‚

![image-20240419182636512](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419182636512.png)





UnionFSåˆ°åº•æ˜¯æ€ä¹ˆä¸ªå…±ç”¨æ¥ç€ï¼Œç»™ä¸ªæ•ˆæœçœ‹çœ‹å•Šï¼Œæˆ‘è‡ªå·±çœ‹çš„ä¹Ÿæ²¡çœ‹å‡ºæ¥ğŸ‘‡

container = image + dataï¼Œå°±æ˜¯å¤åˆ¶ä¸€ä»½imageçš„ã€‚

![image-20240419183717996](2.Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240419183717996.png)

æ‰€è°“UnionFSè”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ç§å¤ç”¨çš„æƒ…å†µåº”è¯¥ä¸»è¦æ˜¯imageä¹‹é—´çš„è”åˆå¤ç”¨ï¼Œå®¹å™¨æ–¹é¢å¦‚å›¾æ‰€è§å°±æ˜¯runä¸€ä¸ªå°±å¤åˆ¶ä¸€ä»½imageäº†ï¼Œåœ¨è¿™ä¸ªç‚¹ä¸Šæ˜¯ä¸å­˜åœ¨å¤ç”¨çš„ã€‚





### å®¹å™¨çš„æš‚åœvsåœæ­¢

![image-20240422135819930](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422135819930.png)



### kill å®¹å™¨å‘é€ä¿¡å·

![image-20240422141250144](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422141250144.png)

**docker kill ID  # åœæ­¢å®¹å™¨**

![image-20240422141802188](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422141802188.png)

**docker kill -s 1 ID   # åŠ è½½é…ç½®æ–‡ä»¶**

å¦‚ä½•éªŒè¯ç¡®å®åŠ è½½äº†é…ç½®æ–‡ä»¶å‘¢--é€šè¿‡topæŸ¥çœ‹æ¯”å¦‚nginxçš„workè¿›ç¨‹ï¼Œå› ä¸ºåŠ è½½é…ç½®æ–‡ä»¶masterè¿›ç¨‹ä¸ä¼šé‡å¯ï¼Œä½†æ˜¯workerè¿›ç¨‹ä¼šé‡å¯

![image-20240422142427581](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422142427581.png)

ç±»ä¼¼nginx -s reloadç”¨æ³•ï¼Œnginx -s reloadä¹Ÿç­‰ä»·äºkill -1 $(pgrep nginx |head -1) ä¸€èˆ¬ç¬¬ä¸€ä¸ªå°±æ˜¯nginxçš„masterï¼Œkill -1å°±æ˜¯ç­‰ä»·äºreloadé…ç½®æ–‡ä»¶ã€‚httpdä¸€æ ·ï¼Œè¿™é‡Œçš„docker -s 1ä¹Ÿæ˜¯ä¸€æ ·ã€‚



docker attach

execè¿›å»å†é€€å‡ºæ¥ï¼Œå¹¶ä¸ä¼šå¯¼è‡´å®¹å™¨é€€å‡º

![image-20240422143924565](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422143924565.png)

æ­¤æ—¶å†å¤åˆ¶ä¸€ä¸ªçª—å£ï¼Œä¸€æ ·å¯ä»¥exec -itè¿›å»ï¼Œä½†æ˜¯ä¸¤ä¸ªexec è¿›å»çš„shellæ˜¯ç‹¬ç«‹çš„ï¼Œ

ç°åœ¨é€šè¿‡attachå¯ä»¥å®ç°screen -x çš„ ä¸¤ä¸ªäººå…±äº«shellçš„æ•ˆæœ

![image-20240422145400860](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422145400860.png)

ä¸Šå›¾ç”±äºalpineæ˜¯â‘ æ²¡æœ‰é€€å‡º-itè¿›å»çš„â‘¡ä¸”é»˜è®¤cliæ˜¯/bin/shï¼Œæ‰€ä»¥attachå°±æˆåŠŸæŒ‚ä¸Šå»äº†ï¼Œç„¶åçª—å£æ—¶ä¸€ä¸ªttyï¼Œå…±äº«çš„è¯•å›¾ã€‚

å››ä¸ªçª—å£ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯å¤åˆ¶4ä¸ªçª—å£å‡ºæ¥ç„¶åğŸ‘‡

![image-20240422145901506](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422145901506.png)

attachç”¨æ³•
1ã€å·çª¥åˆ«äººå½“å‰æ­£åœ¨å¹²ä»€ä¹ˆï¼ŒåŠä½ è€—å­ä¸ºæ±

2ã€ä»å®‰å…¨è€ƒè™‘ï¼Œæ€ä¹ˆç¦æ­¢åˆ«äººè¿›æ¥ï¼Œåˆ«run -itå°±è¡Œäº†ï¼Œè€Œæ˜¯ç”¨startåï¼Œexec -itè¿›å»ã€‚

![image-20240422153728303](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422153728303.png)



### è¿›å…¥å®¹å™¨é€šè¿‡exec -it sh

ä¸€èˆ¬æ˜¯è¦è·Ÿä¸€ä¸ªcliçš„ï¼Œexec ä¸ä¸€å®šéƒ½éœ€è¦è¿›å»ï¼Œç›´æ¥æ‰§è¡Œä¸€æ¡cliå°±å‡ºæ¥ä¹Ÿè¡ŒğŸ‘‡

![image-20240422154408006](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422154408006.png)

bashä¸€èˆ¬å¯èƒ½æ²¡æœ‰ï¼Œshä¸€èˆ¬æ˜¯æœ‰çš„

execèƒ½å¤Ÿæ‰§è¡Œçš„cliéƒ½æ˜¯å®¹å™¨é‡Œçš„æœ‰çš„ï¼Œæœ‰ä»€ä¹ˆç”¨ä»€ä¹ˆ

![image-20240422154630838](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422154630838.png)

è¿™æ ·å°±å¯ä»¥è¿›å…¥å®¹å™¨ï¼Œè¿›ä¸€æ­¥æ’æŸ¥é—®é¢˜ï¼Œæ²¡runæ˜¯è¿›ä¸å»çš„ã€‚æ‰€ä»¥docker run [-d] èƒ½å¤Ÿupçš„éƒ½æ˜¯å®¹å™¨é‡Œæ˜¯å‰å°cliæŒ‚ç€çš„ï¼Œç„¶åå®¹å™¨æ²¡æœ‰å‰å°cliçš„éƒ½æ˜¯runå®Œå°±exited--ä¹Ÿå°±æ˜¯runä¸èµ·æ¥çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æ³•exec -it shè¿›å»çš„ã€‚  **# ç®€è€Œè¨€ä¹‹ï¼Œexecèƒ½è¿›å»çš„éƒ½æ˜¯å®¹å™¨é‡Œæœ‰å‰å°è¿è¡Œè¿›ç¨‹çš„**ã€‚



### å®¹å™¨çš„ç«¯å£é—®é¢˜

åˆ«äººå®¹å™¨æ—¶ä¸€ä¸ªnginxï¼Œ80ç«¯å£ä¹Ÿæ˜¯å®¹å™¨é‡Œçš„ipçš„80.

![image-20240422160802677](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422160802677.png)

éšä¾¿ç§ç§runçš„å‚æ•°

![image-20240422160838038](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422160838038.png)

å®¹å™¨é‡Œçš„IPå‡ºæ¥éƒ½æ˜¯èµ°çš„SNATï¼Œä¸æ˜¯è¯´172.17.0.2è½¬æˆ172.17.0.1çš„SNATå“¦ï¼Œè€Œæ˜¯å®¹å™¨é‡Œå‡ºæ¥èµ°çš„æ˜¯ç‰©ç†ç½‘å¡çš„IPçš„SNATã€‚

![image-20240422161228785](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422161228785.png)

![image-20240422162213735](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422162213735.png)

![image-20240422162228190](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422162228190.png)

è¿™ä¸ªcliæ¯”è¾ƒé€‚åˆå®¹å™¨é‡ŒæŸ¥çœ‹æœ¬åœ°IPğŸ‘†

è¿™ä¸ª172.17.0.2ï¼Œæœ¬åœ°å®¿ä¸»æœºä¸Šæ˜¯å¯ä»¥è®¿é—®çš„ï¼Œå› ä¸ºè·¯ç”±å™¨æ˜¯æœ¬åœ°æŒ‡å‘docker0çš„ã€‚

![image-20240422162939630](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422162939630.png)



**æš´éœ²ç«¯å£**

```shell 
docker run -P --name web01 -d nginx  # å°†å®¹å™¨é‡Œæ‰€æœ‰çš„ç«¯å£éƒ½æš´éœ²åˆ°å®¿ä¸»çš„éšæœºç«¯å£
docker run -p 80 --name web03 -d nginx  # ä»…å°†å®¹å™¨çš„80æ˜ å°„åˆ°å®¿ä¸»çš„éšæœºç«¯å£
docker run -p 80:80 --name web02 -d nginx  # ä»…å°†å®¹å™¨é‡Œçš„80æ˜ å°„åˆ°å®¿ä¸»çš„80
docker run -p 192.168.126.130:80:80 -d nginx # å®¿ä¸»IP:å®¿ä¸»PORT:å®¹å™¨PORT
docker run -p 192.168.126.130::80 -d nginx # å®¿ä¸»IP:éšæœºç«¯å£:å®¹å™¨ç«¯å£
docker run -p 192.168.126.130:8080:80/udp --name web03 -d nginx  # udp
docker run -p 8080:80/tcp -p 8443:443/tcp -p 53:53/udp -d --name nginx  #â˜…å¤šç«¯å£
```

![image-20240422183438981](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422183438981.png)

---

![image-20240422172208751](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422172208751.png)

å°pæŒ‡å®šï¼Œå¤§Péšæœº

![image-20240422172953828](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422172953828.png)

æµ‹è¯•å°±OKäº†

![image-20240422173124733](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422173124733.png)

ç„¶åçœ‹æ—¥å¿—

![image-20240422173556936](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422173556936.png)

**docker port web01æŸ¥çœ‹ç«¯å£æš´éœ²**

![image-20240422173818835](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422173818835.png)

**å›ºå®šå®¿ä¸»çš„æ˜ å°„ç«¯å£**ï¼Œå‰ææ˜¯å¤–é¢çš„ç«¯å£æ²¡æœ‰è¢«å ç”¨ï¼Œé‡Œé¢çš„ç«¯å£ä½ å¾—çŸ¥é“

é‡Œé¢çš„ç«¯å£inpsectå¯è§

<img src="3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422175415465.png" alt="image-20240422175415465" style="zoom:50%;" /> 

å¤–é¢ss -tlnup ç¡®è®¤æ²¡è¢«å ç”¨å°±è¡Œäº†

![image-20240422175643541](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422175643541.png)

æµ‹è¯•OK

![image-20240422175720670](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422175720670.png)



![image-20240422175744826](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240422175744826.png)





```shell
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=wordpress -e MYSQL_USER=wordpress -e MYSQL_PASSWORD=123456 --name mysql -d --restart=always mariadb:11.3.2
# -e æ˜¯ä¼ é€’å˜é‡è¿›å®¹å™¨ï¼Œå‰æä¹Ÿæ˜¯å®¹å™¨é‡Œæ”¯æŒçš„å˜é‡å¯ä»¥ä¼ ä¸€äº›å€¼æ‰è¡Œã€‚

docker run -d -p 8080:80 --name wordpress -v /data/wordpress:/var/www/html --restart=always wordpress:php8.2.apache

```

**å¯åŠ¨db**

![image-20240423112704524](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423112704524.png)

æ­¤æ—¶å¦ä¸€å°æœºå™¨å°±å¯ä»¥è¿äº†

![image-20240423114811427](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423114811427.png)

è´¦å·ä¹Ÿæœ‰äº†ï¼š

![image-20240423114930766](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423114930766.png)





**å¯åŠ¨wordpressçš„å‰ç«¯å®¹å™¨ï¼š**

![image-20240423113302696](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423113302696.png)

æ‰€ä»¥æ­¤æ—¶é¡µé¢èµ°ä¸€æ³¢

![image-20240423115106854](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423115106854.png)



![image-20240423115532506](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423115532506.png)

å…³äºæ•°æ®åº“ä¸»æœºä¸èƒ½å¡«é»˜è®¤çš„localhostï¼Œå› ä¸ºè¿™æ˜¯åœ¨å®¹å™¨é‡Œé¢ï¼ŒlocalhostæŒ‡çš„æ˜¯å®¹å™¨é‡Œé¢çš„æœ¬åœ°ï¼Œå¤–é¢å®¿ä¸»ä¹Ÿå¥½ï¼Œå…¶ä»–å®¹å™¨ä¹Ÿå¥½é’ˆå¯¹localhostçœ‹åˆ°çš„åˆæ˜¯å„è‡ªçš„æœ¬åœ°ã€‚



å¯ä»¥å†™å®¹å™¨çš„ipï¼Œä½†æ˜¯ä¸å¥½ï¼Œå› ä¸ºè¯¥ipä¼šå˜ï¼›æ‰€ä»¥è¦å†™å®¿ä¸»çš„IPå’Œæš´éœ²å‡ºæ¥çš„ç«¯å£ã€‚

å¦‚æœä¸€ä¸å°å¿ƒé…æˆäº†å®¹å™¨é‡Œçš„ip

![image-20240423143049376](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423143049376.png)

ä¸‹å›¾æ˜¯é…ç½®äº†172.17.0.2å

![image-20240423143803240](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423143803240.png)

è¿”å›é‡é…æœª192.168.126.130å‘ç°ä¸è¡Œï¼Œéœ€è¦è¿›å…¥wordpresså®¹å™¨é‡Œåˆ é™¤å¯¹åº”çš„é…ç½®æ–‡ä»¶

![image-20240423183134596](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423183134596.png)

![image-20240423183433878](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423183433878.png)

è¿™æ–‡ä»¶é‡Œçš„IPæ”¹æ”¹å°±è¡Œäº†ï¼Œå¹²è„†ç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å†é‡æ–°å»é¡µé¢é…ç½®å°±å¯ä»¥äº†

![image-20240423183645760](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423183645760.png)

è¿™ä¸ªç»†èŠ‚ï¼šå›¾ä¸­wordpressé»˜è®¤ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªç°è‰²çš„ï¼Œä½†æ˜¯å…¶å®åªæ˜¯æç¤ºè€Œå·²

![image-20240423183749625](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423183749625.png)



<img src="3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184013035.png" alt="image-20240423184013035" style="zoom:40%;" />





<img src="3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184047969.png" alt="image-20240423184047969" style="zoom:33%;" />





è¿™å°±OKäº†

![image-20240423184103644](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184103644.png)





### å®¹å™¨å¦‚ä½•ä¿®æ”¹ç›‘å¬æš´éœ²ç«¯å£

![image-20240423184232505](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184232505.png)



![image-20240423184501462](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184501462.png)

ç›´æ¥è¿›å»æ”¹äº†

![image-20240423184652869](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184652869.png)

ç„¶åé‡å¯å®¹å™¨ï¼Œå°è¯•å‘é€SIGHUPä¿¡å·è¯•å›¾é‡è½½é…ç½®ï¼Œä½†æ˜¯æœªæˆåŠŸğŸ‘‡

![image-20240423184801813](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423184801813.png)

restart -s 1ä¹Ÿä¸è¡Œ

![image-20240423185013803](3-Dockerå®¹å™¨ç®¡ç†å’Œç«¯å£æ˜ å°„.assets/image-20240423185013803.png)

è¿›å»åˆšæ‰çš„é…ç½®æ–‡ä»¶å‘ç°ç«¯å£æ²¡æ”¹è¿‡æ¥ï¼Œçœ‹æ¥è¦å…ˆstop å®¹å™¨å†æ”¹äº†

å†æ¬¡å°è¯•docker stop xxxï¼Œç„¶åvimä¿®æ”¹æœª90909ï¼Œç„¶ådocker start xxxè¿˜æ˜¯ä¸è¡Œï¼Œéœ€è¦åœæ­¢dockerå¼•æ“



å°è¯•ä¸Šå›¾æ“ä½œå…ˆåœæ­¢dockerï¼Œå‘ç°é…ç½®æ–‡ä»¶å¯ä»¥æ”¹è¿‡æ¥äº†ï¼Œä½†æ˜¯ç”±äºå®¹å™¨æ—¶restart alwaysäº†ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œéœ€è¦é‡å¯å®¹å™¨ï¼Œä¸‹é¢cliå¯ä»¥å®ç°ä¸åˆ é™¤å®¹å™¨ï¼Œä¿®æ”¹æš´éœ²ç«¯å£çš„éœ€æ±‚

```shell
systemctl stop docker
systemctl stop docker.socket  # è¿™ä¸ªä¸éœ€è¦
docker stop xxx  # è¿™ä¸ªä¸é…ï¼šåé¢éœ€è¦é‡å¯å®¹å™¨ï¼šé…ç½®çš„è¯ï¼šåé¢éœ€è¦å¯åŠ¨å®¹å™¨ï¼Œå“ˆå“ˆå“ˆ~
vim /var/lib/docker/containers/xxx..xxxaad092/hostconfig.json  # ä¿®æ”¹æš´éœ²ç«¯å£
systemctl start docker  # å¯åŠ¨æœåŠ¡åï¼Œè¿˜å¾—æ‰‹åŠ¨é‡å¯å®¹å™¨ï¼Œå¦åˆ™å®¹å™¨ä¹‹å‰æ²¡æœ‰åœå¯èƒ½å°±ä¿æŒäº†ä¹‹å‰çš„çŠ¶æ€ä¿¡æ¯ç„¶å
docker restart 9472a68122b9	  # å‘ç°å¿…é¡»restartï¼Œå®¹å™¨è·ŸéšdockeræœåŠ¡èµ·æ¥å¥½åƒä¸è¡Œæœ‰ç‚¹å¥‡æ€ªã€‚ä¸å¥‡æ€ªï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åœï¼Œç›´æ¥è¢«æœåŠ¡é‡å¯äº†
```



