# ç¬¬5èŠ‚. linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†



## ä¿®æ”¹ç½‘å¡å-æ–¹æ³•1-ç½‘å¡é©±åŠ¨æ¨¡å—

ç ”ç©¶ä¸‹ä¸ºä»€ä¹ˆæ˜¯eth1ï¼Œæ€ä¹ˆæ”¹ï¼Œè¿™æ˜¯centos6çš„ï¼š

![image-20220315091523380](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315091523380.png)

![image-20220315092958594](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315092958594.png) 

![image-20220315093035859](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093035859.png)

å¯è§eth0å·²ç»è¢«æŸä¸ªmacå ç”¨ï¼Œæ‰€ä»¥ç°åœ¨çœ‹åˆ°çš„å°±æ˜¯eth1äº†ã€‚

åˆ é™¤å¹¶ä¿®æ”¹

![image-20220315093143457](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093143457.png)

ä¿®æ”¹åï¼Œé‡å¯ç½‘ç»œæœåŠ¡æ˜¯ä¸è¡Œçš„

![image-20220315093236310](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093236310.png)

è¦ä¿®æ”¹eth1è¿™ä¸ªåç§°ï¼Œéœ€è¦å¸è½½ç½‘å¡é©±åŠ¨ï¼Œå¹¶é‡æ–°åŠ è½½é©±åŠ¨ã€‚

mii-tool æŸ¥çœ‹

![image-20220315093339559](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093339559.png) 

æŸ¥çœ‹ç½‘å¡é©±åŠ¨

![image-20220315093551952](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093551952.png) 



![image-20220315093644515](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093644515.png) 

ğŸ‘‡æ‰¾åˆ°äº†é©±åŠ¨æ¨¡å—

![image-20220315093717338](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093717338.png) 



lsmod æ˜¯æ‰¾åˆ°åŠ è½½çš„æ‰€æœ‰é©±åŠ¨æ¨¡å—

![image-20220315093808609](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315093808609.png) 

å¸è½½æ¨¡å—ç”¨rmmodæˆ–è€…modprobe -r

![image-20220315094152620](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315094152620.png) 

ç½‘å¡æ¨¡å—å¸äº†ä¹Ÿå°±æ˜¯ç½‘å¡é©±åŠ¨å¸äº†ã€‚

æ­¤æ—¶ç½‘å¡å°±è‡ªç„¶çœ‹ä¸è§äº†

![image-20220315094228945](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315094228945.png) 



ç„¶åå†é‡æ–°åŠ è½½æ¨¡å—(é©±åŠ¨)ï¼š

![image-20220315094330745](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315094330745.png) 

æ­¤æ—¶å°±æ”¹ä¸ºeth0äº†

![image-20220315094357316](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315094357316.png) 



## æ–¹æ³•2-ipå­å‘½ä»¤

ip å­å‘½ä»¤ï¼Œåœ¨centos6ä¸Štabä¸å‡ºæ¥ï¼Œcentos7å¯ä»¥

![image-20220315095018759](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315095018759.png) 

centos6è¦é¢å¤–å®‰è£…è½¯ä»¶åŒ…æ‰èƒ½æ”¯æŒtabé”®è¡¥å…¨





## ç½‘å¡é…ç½®

1ã€setup è¿›å»é€‰-é€‰-é€‰ ç­‰ä»·äºsystem-config-network-tui  # è¿™ä¸¤ç§æ–¹æ³•å°±æ˜¯ç®—äº†ï¼Œè€Œä¸”åœ¨centos7é‡Œsetupé‡Œä¹Ÿæ²¡æœ‰ç½‘ç»œé…ç½®é€‰é¡¹äº†ã€‚

2ã€é‡ç‚¹çœ‹å‘½ä»¤å’Œé…ç½®æ–‡ä»¶



![image-20220315095711283](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315095711283.png) 

ifconfigè¿‡æ—¶äº†ï¼Œæ“¦

ä¸»è¦æ˜¯å› ä¸ºnet-toolsè¿™ä¸ªå·¥å…·åŒ…è¿‡æ—¶äº†ï¼Œæ‰€ä»¥åŒ…é‡Œçš„å¾ˆå¤šæ¯”å¦‚ifconfigã€netstatéƒ½è¿‡æ—¶äº†ã€‚

![image-20220315095807943](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315095807943.png) 

![image-20220315095918949](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315095918949.png) 



![image-20220315100004582](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100004582.png) 



æ¨èä½ ç”¨iprouteè¿™ä¸ªåŒ…

![image-20220315100230039](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100230039.png)







ifconfigç›´æ¥å›è½¦çœ‹çš„æ˜¯æ¿€æ´»çŠ¶æ€çš„ç½‘å¡

ç¦ç”¨å’Œæ¿€æ´»

![image-20220315100631020](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100631020.png) 

ifconfig eth1 down ç¦ç”¨eth1ç½‘å¡

ifconfig å°±çœ‹ä¸åˆ°eht1ï¼Œifconfig -a å¯ä»¥çœ‹åˆ°eth1ä½†æ˜¯IPæ²¡äº†ï¼Œip aå°±çœ‹çš„æ›´æ¸…é™¤

![image-20220315100750969](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100750969.png)

ifconfig eth1 upå¯ç”¨

![image-20220315100818973](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100818973.png)



ç¦ç”¨ç½‘å¡è¿˜å¯ä»¥ifdown eth1

![image-20220315100908111](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100908111.png) 

ä¸è¿‡è¿™ç§downå’Œåˆšæ‰çš„ifconfig eth1 downåˆä¸åŒäº†

![image-20220315100943876](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315100943876.png)

è¿™ä¸ªifdown åï¼Œifconfigç¡®å®å¯ä»¥çœ‹åˆ°çš„ï¼Œä½†æ˜¯æ²¡æœ‰åœ°å€ã€‚

è¿™ä¸ªifdownå±äºç½‘ç»œå±‚çš„downï¼ŒIPæ²¡äº†ä½†æ˜¯æ•°æ®é“¾è·¯å±‚æ˜¯é€šç€çš„ã€‚

å¯¹æ¯”ifconfigå±äºæ•°æ®é“¾è·¯å±‚çš„downã€‚

æ‰€ä»¥ip açœ‹å°±ä¼šå‘ç°æ˜¯UPçš„ï¼Œæ‰€ä»¥ip açœ‹çš„å°±æ˜¯L2é“¾è·¯å±‚å’¯ã€‚

![image-20220315101114368](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315101114368.png)

```shell
1ã€ifdown\ifupæ˜¯L3å±‚çš„up\downï¼Œ è¿™ä¸ªifdownåip açœ‹è¿˜æ˜¯UPçš„

2ã€ifconfig down\ifconfig upæ˜¯L2å±‚çš„up\downï¼Œè¿™ä¸ªifconfig downåip açœ‹å°±æ˜¯DOWNçš„

3ã€ip açœ‹çš„æ˜¯L2çš„up\down

4ã€è¿˜ä¸€ç§æ˜¯ç‰©ç†å±‚çš„downï¼Œå°±æ˜¯æ‹”ç½‘çº¿äº†
```







![image-20220315104251818](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315104251818.png)

ifup è¦èµ·æ¥è¿˜éœ€è¦ä¾èµ–ä¸€äº›ç½‘ç»œé…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥ip aè¿˜æ˜¯çœ‹ä¸åˆ°åœ°å€

![image-20220315104343790](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315104343790.png)

æ²¡å…³ç³»ï¼Œåœ¨centos6ä¸Šç”¨service NetworkManager restartå°±å¯ä»¥äº†ã€‚

![image-20220315104435149](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315104435149.png)





æŠŠç½‘çº¿çš„æ¼”ç¤º

![image-20220315104548951](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315104548951.png) 

è¿™å°±ç±»ä¼¼æ‹”ç½‘çº¿äº†

1ã€ifconfigçœ‹å°±æ²¡æœ‰åœ°å€äº†

![image-20220315104719668](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315104719668.png) 



2ã€ip açœ‹å°±æ˜¯down

![image-20220315104752991](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315104752991.png) 

æ­¤æ—¶ä¸Šå›¾ğŸ‘†å°±èƒ½åˆ¤æ–­æ˜¯ç½‘çº¿æ‹”äº†ï¼Œè€Œä¸æ˜¯å…¶ä»–çš„ï¼Œå› ä¸ºæœ‰å…³é”®è¯NO-CARRIERã€‚

å¯¹æ¯”ifconfig eth1 downçš„æè¿°ä¿¡æ¯

<img src="5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315105913650.png" alt="image-20220315105913650" style="zoom:50%;" /> 





## é…åœ°å€-ä¸´æ—¶

![image-20220315110417795](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315110417795.png) 



## æ¸…åœ°å€-ä¸´æ—¶

![image-20220315110512788](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315110512788.png)



## å¢åŠ åœ°å€-ä¸´æ—¶

å°±æ˜¯huaweié‡Œçš„subåœ°å€å’¯ï¼Œæˆ–è€…æ˜¯æ€ç§‘çš„second ipã€‚è¿˜ä¸€ç§æ˜¯å­æ¥å£ï¼Œå­æ¥å£åœ¨linuxé‡Œæ˜¯ä¸€ç§åˆ«å

```
ifconfig eth1:123 1.1.1.1/24
ifconfig eth1:321 2.2.2.2/24
```

ifconfigå¯è§

![image-20220315110838635](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315110838635.png) 

è¿™é‡Œä¸æ¶‰åŠå­æ¥å£çš„vlan idå°è£…è§£å°è£…ï¼Œç›´æ¥å°±èƒ½å’Œå¤–ç•ŒåŒæ ·çš„IPè¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥æˆ‘æ„Ÿè§‰æ›´åƒæ˜¯second ipè€Œä¸æ˜¯å­æ¥å£ã€‚



### åˆ é™¤linuxçš„å­æ¥å£

ifconfig eth1:123 down

![image-20220315111409880](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315111409880.png)

è¿™ä¸ªdownæ‰å°±æ˜¯åˆ é™¤å­æ¥å£äº†ï¼Œè¿™é‡Œå°±ç§°ä¹‹ä¸ºlinuxçš„å­æ¥å£å’¯ï¼Œè™½ç„¶å®ƒæ²¡æœ‰vlançš„æ¦‚å¿µã€‚

![image-20220315111524070](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315111524070.png) 





![image-20220315111627465](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315111627465.png)



## æ··æ‚æ¨¡å¼

æŠ“åŒ…çš„æ—¶å€™å°±ç”¨çš„æ··æ‚æ¨¡å¼

æ··æ‚--ä¸ç®¡è¿™ä¸ªæ•°æ®æ˜¯å¦ç»™æˆ‘çš„ï¼Œæˆ‘éƒ½æ”¶ã€‚

https://cloud.tencent.com/developer/article/1439013

VMwareWorkstationçš„è¯æœ‰æ—¶å€™éœ€è¦æ‰‹åŠ¨ä¿®æ”¹centosçš„æ¥å£ä¸ºæ··æ‚ï¼ŒåŸè§†é¢‘ä¸­æˆ‘æ²¡æœ‰æ‰¾åˆ°å½“æ—¶è€å¸ˆçš„æ“ä½œï¼Œä¸è¿‡ç†è§£åä¹Ÿèƒ½è‡ªå·±è®¾è®¡ä¸€ä¸ªåœºæ™¯ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»…ä»…æç¤ºä¸‹ã€‚

![image-20220315140731029](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315140731029.png)





## mii-tool å·¥å…·

![image-20220315121037577](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315121037577.png)

ä¸Šå›¾è¯´æ˜

capabilities æ˜¯æ”¯æŒçš„èƒ½åŠ›æ¯”å¦‚FDå°±æ˜¯full duplexï¼›HDå°±æ˜¯hafl duplex

ç¬¬ä¸€è¡Œå°±æ˜¯åå•†åçš„å½“å‰å·¥ä½œæ¨¡å¼æ˜¯åƒå…†å…¨åŒå·¥



## ethtool å·¥å…·

![image-20220315121215498](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315121215498.png)

ç½‘çº¿8æ ¹çº¿ï¼Œå¦‚æœæ–­äº†ä¸€æ ¹è¿æ°”å¥½ï¼Œè¿˜èƒ½ç”¨å°±æ˜¯100Mï¼ŒğŸ‘†è¿™é‡Œå°±å¯ä»¥æ£€æŸ¥åˆ°ã€‚



ehtoolå¯ä»¥ä¿®æ”¹ç½‘å¡å·¥ä½œæ¨¡å¼ï¼Œä¸€èˆ¬ä¸æ”¹

![image-20220315121747573](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315121747573.png)



CMDçš„grep

![image-20220315122205793](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315122205793.png) 

ä¾‹å­ï¼ŒæŸ¥çœ‹å¤šå°‘äººè¿åˆ°æˆ‘çš„VNCä¸Š

![image-20220315122317321](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315122317321.png)

![image-20220315122337240](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315122337240.png)

ç¬¬ä¸‰åˆ—å°±æ˜¯client IPåœ°å€



### å¸¸è§æœåŠ¡ç«¯å£

cat /etc/services

![image-20220315122952986](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315122952986.png)



![image-20220315135033610](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315135033610.png)

ä¸€èˆ¬å®¢æˆ·ç«¯ç”µè„‘ä¸ä¼šä½¿ç”¨1W6+ä¸ªç«¯å£ï¼Œä½†æ˜¯å¦‚æœä½ è¿™å°linuxæˆ–å•¥ç³»ç»Ÿçš„ç”µè„‘æ˜¯ä½œä¸ºä»£ç†ä¸Šç½‘ï¼Œæ¯”å¦‚SNATï¼Œé‚£ä¹ˆ1W6+ä¹Ÿä¸æ˜¯æ²¡æœ‰å¯èƒ½ï¼Œå› ä¸º1å°å†…ç½‘çš„PCå¤§æ¦‚10è¿æ¥ï¼Œ1000å°PCå¯¹å§ï¼Œå†åŠ ä¸Šæ‰‹æœºï¼Œè¿˜æ˜¯æœ‰å¯èƒ½è®©ä½ çš„è¿™å°NATæœåŠ¡å™¨çš„ç«¯å£è¶…å‡º1w6+è¿™ä¸ªé»˜è®¤å€¼çš„ã€‚

![image-20220315135820194](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315135820194.png)

å¦‚æœè¦å½“ä»£ç†ï¼Œè¿™ä¸ªç«¯å£å°±è¦è°ƒå¤§ğŸ‘†



## TCPçš„åºåˆ—å·é—®é¢˜æ•´ç†

æ•°æ®åŒ…çš„åºåˆ—å·ï¼Œå¹¶é0ï¼Œ0æ˜¯ç›¸å¯¹ç¼–å·ï¼Œåº”è¯¥æ˜¯åˆå§‹ISNï¼Œå¥½ä¹…ä¸ç¢°äº†æœ‰ç‚¹å¿˜äº†éƒ½ï¼Œè€Œæ˜¯ä¸‹é¢çš„97fa6e02

å†CISCOçš„å®‰å…¨æ–¹å‘é‡ŒASAçš„é‡Œé¢æœ‰ä¸€ä¸ªSNã€ISNçš„åˆ©ç”¨ã€‚ç„¶ålinuxçš„twå†…æ ¸å‚æ•°



è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬å‡ºç°åœ¨ç½‘å§ã€å…¬å¸è¿™ç§NATç¯å¢ƒ

https://blog.csdn.net/enweitech/article/details/79261439

æ–‡ç« è®²çš„å¤ªç»†ï¼Œç®€å•çš„æ•…éšœå¤„ç†å°±æ˜¯

```
â€œä¹‹å‰çš„å¶å°”æ‰“ä¸å¼€æ˜¯å› ä¸ºå¼€å¯äº†ä¸€ä¸ªtcpç›¸å…³çš„å†…æ ¸å‚æ•°, åŠå…¬ç½‘éƒ½æ˜¯natå‡ºå»çš„, æ•°æ®åŒ…æ—¶é—´æˆ³çš„æŠ–åŠ¨ä¼šå¯¼è‡´æœåŠ¡å™¨æŠŠè¯·æ±‚ç»™ä¸¢å¼ƒ, è¿ç§»ä¹‹åçš„ oaå•ç‚¹ç™»å½•, è™šå®ç½‘ç­‰æˆ‘éƒ½æŠŠè¯¥å‚æ•°å…³é—­äº†, oa.sm.xxx è¿™ä¸ªä¸åœ¨è¿ç§»çš„æœºå™¨ä¸­, åˆšåˆšä¿®æ”¹è¿‡äº†, åç»­åœ¨è§‚å¯Ÿä¸€ä¸‹â€   -- è¿™ä¸ªæ˜¯æ¡ˆä¾‹ï¼Œå‘µå‘µã€‚
```

https://ppabc.cn/1363.html

![image-20220316111650130](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220316111650130.png) 

è¿™ä¸ªç¯‡é’ˆå¯¹æ€§å¼ºï¼Œè¯´çš„æ˜¯æ—¶é—´æˆ³ã€‚



## tcpdumpçš„ä¸¾ä¾‹-æ•´ç†ç¨å

<img src="5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315153047080.png" alt="image-20220315153047080" style="zoom:80%;" />  

![image-20220315152819339](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315152819339.png)

ä¸Šå›¾ğŸ‘†æ˜¯dropåçš„ä¸€ä¸ªæŠ“åŒ…ç»“æœï¼Œ[S]æ˜¯ä¸æ–­çš„SYNåŒ…ï¼Œæ˜¯é‡ä¼ æœºåˆ¶å¯¼è‡´çš„ã€‚

å…¶å®æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä¸€èˆ¬å°±æ˜¯æŠ“ä¸ªç«¯å£ç„¶å|grep å“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯æ²¡æƒ³åˆ°ï¼Œå“ˆå“ˆ



![image-20220315153635512](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315153635512.png)

![image-20220315154709605](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315154709605.png) 

|å‰å¯¼ç +å¼€å§‹ç¬¦|DA|SA|TYPLE/LENGTH|DATA|FCS|   ä¸€å…±72Bçš„æœ€å°å€¼ã€‚

ping é»˜è®¤å°±æ˜¯64ä¹Ÿå³æ˜¯æ²¡æœ‰ç®—å¼€å¤´çš„8Bã€‚

é™„ä¸Šä¹‹å‰çš„ä¸€ä¸ªåˆ†ç‰‡è§£æå›¾

![PINGåŒ…åˆ†ç‰‡çš„è®¡ç®—](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/PINGåŒ…åˆ†ç‰‡çš„è®¡ç®—.png)





## TCPè¶…æ—¶é‡ä¼ 

![image-20220315152643847](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315152643847.png)





## TCPçš„æ‹¥å¡æ§åˆ¶

å››ä¸ªæœºåˆ¶

æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ ã€å¿«é€Ÿæ¢å¤

![image-20220315153411212](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315153411212.png) 

![image-20220315153354410](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315153354410.png)







## å¹¶å‘ping-é¦–æ¨æ–¹æ³•

![image-20220315155919075](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315155919075.png)

```
seq 1 255 |xargs -i -P 0 bash -c 'ping -w 2 192.168.25.{} &> /dev/null && echo 192.168.25.{} icmp allowed'
```

è¿˜æœ‰awkçš„å¹¶å‘pingï¼Œæƒ³ä¸èµ·æ¥äº†ï¼Œæ²¡å½±å“äº†ã€‚

![image-20220315162214235](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315162214235.png)

è¿™ä¸ªä¹Ÿå¿«

```
ls --hide=proc | xargs -i -P 0 find /{} -name "sshd"
```





## awkçš„ä¸¾ä¾‹

![image-20220315160320544](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315160320544.png)

```
tcpdump -i eth0 -tnn dst port 443 -c 100 |awk -F "." '{print $1"."$2"."$3"."$4}'|sort|uniq -c|sort -rn|head -n20
```

![image-20220315160345007](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315160345007.png)

æˆ‘ä¹‹å‰è¯´è¿‡awkå’Œxargsä¸€æ ·å¿«ï¼Œpingçš„å¤„ç†ä¸Šæˆ‘æ€ä¹ˆä¸è®°å¾—æœ‰åšè¿‡å‘¢ï¼Œè‚¯å®šæ˜¯æœ‰è¿‡çš„ï¼Œç°åœ¨æƒ³æ¥æ˜¯å†™ä¸ªforå¾ªç¯awkè°ƒç”¨ç³»ç»Ÿå‘½ä»¤ï¼Œä½†æœ‰è¿™ä¹ˆå¤æ‚å—ï¼Œå½“ç„¶å…¶å®ä¸å¤æ‚ï¼Œæˆ‘æ˜¯è¯´ä¹‹å‰çš„awkå®ç°æ‰¹é‡ping æ˜¯æ€ä¹ˆå¼„çš„ï¼Ÿ



è¿˜æœ‰å¥½å¤šå·¥å…·ç±»çš„ä½¿ç”¨iperf ã€curlã€F12ç­‰ç­‰ï¼Œè¿™äº›è®¡ç®—äº†ï¼Œä¸æ”¾åˆ°è¿™é‡Œäº†ã€‚





## å¹¿æ’­çš„æƒ…å†µ

![image-20220315171023241](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315171023241.png)

ğŸ‘†ping 255å¹¿æ’­åªæœ‰ä¸€ä¸ª37.2å“åº”ï¼Œå› ä¸ºlinuxé»˜è®¤æ˜¯ä¸å“åº”å¹¿æ’­pingçš„ï¼Œéœ€è¦å¼€å¯

![image-20220315171142718](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315171142718.png) 

1å°±æ˜¯å¿½ç•¥ï¼Œå°±æ˜¯ä¸å›åº”ï¼Œæ”¹ä¸º0

![image-20220315171210639](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315171210639.png)

centos7ä¸Šä¸€æ ·

![image-20220315171234057](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315171234057.png)

![image-20220315171258071](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315171258071.png)

ä»é»˜è®¤çš„TTLä¸Šå¯ä»¥åˆ¤æ–­37.2çš„ttlæ˜¯128ï¼Œæ˜¯å°windowsæœºå™¨ï¼›37.7å’Œ37.6æ˜¯linuxæœºå™¨ã€‚



## loopback

ç•¥ï¼Œæ³¨æ„ä¸‹å›¾

![image-20220315171942724](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315171942724.png)

è®¤ä¸ºæ”¹æˆ6.6.6.6/24 ï¼Œè¿™æ ·è¿™ä¸ªæ®µéƒ½å¤„äºloopï¼Œå¹¶ä¸æ˜¯è¯´å¿…é¡»æ˜¯127ã€‚



![image-20220315172633721](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315172633721.png)

è¿™é‡Œä¹Ÿå¯ä»¥å†™IPåœ°å€ï¼Œä¸ä¸€å®šå†™lo





## ç½‘å¡é…ç½®æ–‡ä»¶

![image-20220315174506017](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315174506017.png) 



nameå°†æ¥å°±è¡¨ç°ä¸ºGUIå›¾å½¢ç•Œé¢é‡Œçš„eth0

![image-20220315174438843](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315174438843.png) 

 

æ”¹çš„ç©ä¸‹ï¼Œ

![image-20220315174646633](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315174646633.png) 

BOOTPROTO=noneä¹Ÿè¡Œéƒ½æ˜¯é™æ€æ‰‹åŠ¨é…ç½®ï¼ŒBOOTPROTO=dhcpå°±æ˜¯åŠ¨æ€

1ã€æ³¨æ„ä¸€æ—¦å†™äº†dhcpï¼Œåä¹°æ‰‹åŠ¨é…ç½®çš„IPåœ°å€ï¼ŒDNSå°±ä¼šè¢«è¦†ç›–äº†ï¼›

2ã€æ–‡ä»¶å…¶å®å°±æ˜¯è„šæœ¬ç”¨çš„ï¼Œå‰é¢å…¶å®å°±æ˜¯å˜é‡ï¼Œå˜é‡æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œç„¶å=å·¦å³ä¸èƒ½å¸¦ç©ºæ ¼ï¼›

è¿™å—ä¹¦ä¸Šè®²çš„æ›´å…¨ï¼Œæ‰€è°“å…¨å…¶å®ä¹Ÿå°±æ˜¯ä¸‹å‘æ˜ç»†å’Œä¸‹å‘é»˜è®¤çš„ä¸€äº›ä¼˜å…ˆçº§é—®é¢˜ã€‚

è¿˜èƒ½ç²¾ç®€æˆå¦‚ä¸‹3è¡Œï¼Œå†è¡¥ä¸€ä¸ªGWå’ŒDNS1

![image-20220315175527530](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315175527530.png) 

æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œä¸€èˆ¬ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œæœ‰æ—¶å€™ä¼šç«‹å³ç”Ÿæ•ˆï¼Œé‚£æ˜¯å› ä¸ºNetworkManageræœåŠ¡ï¼Œä¸è¿‡è¿™ä¸ªæœåŠ¡ä¸æ˜¯æ—¶åˆ»éƒ½èƒ½ç«‹å³å‘ç°ä½ ä¿®æ”¹äº†æ–‡ä»¶ç„¶åä½¿ä¹‹ç”Ÿæ•ˆçš„ã€‚è€Œä¸”è¿™ä¸ªæœåŠ¡ä¸€èˆ¬ä¹Ÿä¸ç”¨éƒ½æ˜¯å…³æ‰çš„ã€‚æœ€å°åŒ–å®‰è£…å¥½åƒä¹Ÿæ˜¯æ²¡æœ‰çš„ã€‚è¯´åäº†ï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬åªç”¨networkï¼Œä½†æ˜¯rocky-linuxå’Œcentos7æœ€å°åŒ–å®‰è£…åå¥½åƒrocky-linuxæ˜¯æ²¡æœ‰networkæœåŠ¡åªæœ‰NetworkManagerï¼Œç„¶åcentos7æ˜¯networkfailçš„NetworkManageræ˜¯activeçš„ã€‚å¥½å¥‡æ€ª~æ²¡äº‹åœç”¨ç¦ç”¨NetworkManageråå°±å¯ä»¥å¯ç”¨networkæœåŠ¡äº†ã€‚

![image-20220315181200508](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315181200508.png)

çœ‹æ¥rocky-linuxä¸å–œæ¬¢è¿™ä¸ªã€‚centos8ä¸€æ ·ï¼Œ







![image-20220315174557612](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315174557612.png)





## linuxå¼€å¯è·¯ç”±åŠŸèƒ½

æ³¨æ„ä¸´æ—¶ä¿®æ”¹æ˜¯ç”¨çš„echoï¼Œvimæ˜¯ä¸èƒ½ç¼–è¾‘å†…å­˜é‡Œçš„æ–‡ä»¶çš„

![image-20220315181957775](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315181957775.png) 

vimæ˜¯æ”¹ç£ç›˜æ–‡ä»¶çš„ï¼Œä¸èƒ½æ”¹å†…å­˜çš„æ•°æ®ã€‚





## mtrçš„ä½¿ç”¨

mtrå¯ä»¥é€‰æ‹©icmp tcp udpçš„ï¼Œè¿™ç‚¹è¦çŸ¥é“ï¼Œç„¶åæˆ‘çš„å¤„ç†ï¼Œæ˜¯é€šè¿‡crontabå»å¼„ï¼Œå¤§æ¦‚å¦‚ä¸‹

![image-20220316112602876](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220316112602876.png) 

![image-20220316113000334](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220316113000334.png)

åŸºæœ¬ä¸Šå¦‚æœcurlçš„æ•ˆæœä¸è¡Œï¼Œå°±è‡ªåŠ¨è§¦å‘mtrå¾—åˆ°æŠ¥å‘Šï¼Œä¸è¿‡with os.popenè¿™ç§é˜»å¡çš„æ–¹å¼ï¼Œåœ¨ç½‘ç»œè´¨é‡ä¸å¥½çš„æ¸…è‹¦ä¸‹ï¼Œä¼šé€ æˆcpuè´Ÿè½½é«˜çš„ï¼Œå› ä¸ºå¤ªå¤šçš„é˜»å¡ç­‰ç€è¿è¡Œäº†ã€‚ç½‘ç»œå¥½å°±ä¸å­˜åœ¨äº†ï¼Œ30sä¸åˆ°å°±mtrå®Œäº†ï¼Œæˆ–è€…éƒ½ä¸ä¼šè§¦å‘mtrã€‚

![image-20220316112933789](5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220316112933789.png)





## frrå¯ä»¥å¼„ä¸€ä¸‹

<img src="5-linuxçš„ç½‘ç»œå’Œè·¯ç”±é…ç½®ç®¡ç†.assets/image-20220315182934167.png" alt="image-20220315182934167" style="zoom:80%;" /> 

frræ›¿ä»£quaggaäº†å¥½åƒ



vyosã€ledã€openwrtã€strongswanã€openswanã€routerosã€

vyosçš„ipsec vpn--policeçš„ï¼Œå­˜åœ¨æ”¯æŒä¸Šé™çš„é—®é¢˜ï¼Œæœªå°è¯•è§£å†³ã€æœªå‡çº§æµ‹è¯•æ˜¯å¦å¾—ä»¥æ”¹å–„ï¼Œå…¶ä»–åŠŸèƒ½OKï¼Œç”±äºæ²¡æœ‰å¤§å¹¶å‘ï¼Œæ€§èƒ½æœªå¾—åˆ°æµ‹è¯•ã€‚



openwrté‡Œçš„strongswanåœ¨æ—è·¯æ¨¡å¼ä¸‹ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯æˆ‘çš„TP-LINKç‰©ç†ç½‘å¡é—®é¢˜è¿˜æ˜¯æ—è·¯çš„é—®é¢˜ï¼Œåæ­£éš§é“å­˜åœ¨ä¸¢åŒ…ï¼Œæ¸¸æˆæ—¶å­˜åœ¨æ–­çº¿é‡è¿çš„æƒ…å†µï¼Œæ•ˆæœä¸å¥½ï¼Œæœªå°è¯•ç»§ç»­æ”¹è¿›ã€‚



softher vpnè¿™ä¸ªä¸å¤šè¯´ï¼Œemmï¼ŒçœŸå¿ƒä¸é”™ï¼Œä¸€é”®æå®šIPSECã€openvpnã€pptpã€l2tpã€‚å…¶å®è¿œç¨‹åŠå…¬ï¼Œè¿˜æ˜¯è¦è€ƒè™‘æˆæƒã€é™é€Ÿçš„é—®é¢˜ï¼Œå¦‚æ­¤è¡ç”Ÿå‡ºçš„IPé™æ€åˆ†é…ï¼Œç­‰å°±ä¸æ˜¯ç®€å•ä½¿ç”¨softehteræ¥å®ç°ï¼Œä»è¿™ä¸ªè§’åº¦è¿˜ä¸å¦‚è‡ªå·±ä½¿ç”¨å¼€æºæ¥å¼„ï¼Œé¡¶å¤šå†™ä¸€ä¸ªè„šæœ¬æ¥åšç»Ÿä¸€çš„å¤šåè®®è´¦å·å¼€é€šã€‚å…¶ä¸­openvpnå°±æ˜¯è¦ä½¿ç”¨radiuså’Œmysqlæˆ–è€…ldapä¹‹ç±»å»åšã€‚



å…¶ä»–è¿˜æœ‰ä»€ä¹ˆclashã€å‘æ—¥è‘µã€vâ…¡rayæ˜¯å§ï¼Œå“ˆå“ˆã€‚emmæœ‰æ—¶é—´éƒ½è¦æ•´ç†å‡ºæ¥ã€‚è¿™äº›ä¸œè¥¿å¯ä¸æ˜¯ä»…ä»…é‚£ä¸ªä½œç”¨ï¼Œå¯ä»¥ç”¨æ¥åšè¿œç¨‹åŠå…¬ï¼Œè€Œä¸”å®¢æˆ·ç«¯è½¯ä»¶æ•ˆæœå¥½ï¼Œopenvpnå˜›è¿˜ä¸å¿…clashçš„èŠ‚ç‚¹æµ‹è¯•æ•ˆæœï¼Œåˆ‡æ¢æ–¹ä¾¿ï¼Œå¦‚æœå…¬å¸4ä¸ªå‡ºå£ï¼Œç»Ÿä¸€åˆ°clashå°±å¾ˆä¸é”™ï¼Œéœ€è¦è€ƒè™‘çš„æ—¶clashä»–åé¢è¦è‡ªå·±ææˆé™æ€IPï¼Œç„¶åç”¨æˆ·æˆæƒå•¦--æœ€å¥½æ˜¯è´¦å·å¯†ç è€Œä¸æ˜¯profileé…ç½®æ–‡ä»¶è¿™ç§ä¸å¤ªå¥½ç®¡ç†çš„ã€‚ä¸œè¥¿ç”¨æ¥åšè¿œç¨‹åŠå…¬ç¡®å®å¯ä»¥ç ”ç©¶ä¸‹çš„ã€‚è®©æŠ€æœ¯æ›´å¥½çš„æœåŠ¡æ­£è§„éœ€æ±‚æ˜¯æˆ‘ä»¬è¦è€ƒè™‘çš„ã€‚



ä¸è¿‡è¿™é‡Œå»ºè®®å¤§å®¶å…ˆä»æé«˜æ”¶å…¥å·¦æ‰‹ï¼Œè€Œä¸æ˜¯å¤§é‡ç ”ç©¶è¿™å—ï¼Œæ©ä¸šåŠ¡éœ€æ±‚çš„æ»¡è¶³ï¼Œå®Œæˆå°±å¥½ï¼Œå®Œç¾ä¸å¥½ã€‚70ä¸ªå®Œæˆè¿œè¿œå¤§äº40ä¸ªå®Œç¾ã€‚





