# ç¬¬2èŠ‚. nginxå®ç°fastcgiåå‘ä»£ç†



# æ¦‚è¿°

ç”¨æˆ·è¿˜æ˜¯è®¿é—®é¡µé¢ï¼Œè¿˜æ˜¯httpè¯·æ±‚ï¼Œä¸è¿‡è¯·æ±‚çš„å†…å®¹å˜æˆäº†phpæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºä»£ç äº†ï¼Œæ˜¯åŠ¨æ€èµ„æºã€‚

![image-20240220140451626](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220140451626.png)

ç°åœ¨nginxåä»£æ”¶åˆ°è¿™ä¸ªphpçš„httpè¯·æ±‚ï¼Œæœ¬èº«æ˜¯å¤„ç†ä¸äº†çš„ï¼Œéœ€è¦é€šè¿‡fastcgiåè®®æŠŠphpè¯·æ±‚å‘é€ç»™åç«¯çš„phpæœåŠ¡å™¨ï¼Œç±»ä¼¼fpm-phpæœåŠ¡å™¨ï¼Œé»˜è®¤ç›‘å¬9000ç«¯å£ã€‚



è¿™ç§å°±æ˜¯å¼‚æ„äº†ğŸ‘‡

<img src="2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220140322768.png" alt="image-20240220140322768" style="zoom:33%;" />





æ­å»ºä¸€ä¸ªfastcgiçš„real server

1ã€ç‰©ç†ä¸Šå¯ä»¥å°†åä»£nginxå’Œreal serveræ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼›

2ã€ä¹Ÿå¯ä»¥åˆ†å¼€æ”¾ã€‚



# å®éªŒï¼šåä»£+real serveræ”¾åœ¨ä¸€å°æœºå™¨ä¸Š



å…ˆæä¸€ä¸ªfastcgiçš„æœåŠ¡å™¨ï¼š

![image-20240220141640646](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141640646.png)



![image-20240220141716757](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141716757.png)

æ˜¯epelæºé‡Œçš„

![image-20240220141845092](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141845092.png)



![image-20240220141906346](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141906346.png)



![image-20240220141922449](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141922449.png)

**éœ€è¦å®‰è£…php-fpmä½œä¸ºfastcgiçš„æœåŠ¡å™¨ï¼Œè¿˜éœ€è¦å®‰è£…php-mysqlç”¨æ¥è¿æ¥æ•°æ®åº“ã€‚**

ä¸è¿‡ç°åœ¨å¥½åƒå«php-mysqlndäº†ï¼Œè£…ä¹‹

![image-20240220142826383](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220142826383.png)





ç›‘å¬çš„ç«¯å£æ²¡å†™ï¼Œè€Œæ˜¯socketæ–‡ä»¶ï¼Œè¿˜ä¸æ˜¯tcp/ipç«¯å£ã€‚ä¸è¿‡ç”±äºåä»£å’Œfastcgi serverä¹Ÿå°±æ˜¯php-fpmåœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼Œè¿˜æƒ³ä¸ç”¨æ”¹ï¼Œå°±ç”¨socketæ–‡ä»¶è¿˜ä¸é”™ã€‚

![image-20240220143900756](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220143900756.png)

ç„¶ålisten.allowed_cliants å°±æ˜¯127æœ¬åœ°æ¥è¿æ¥ã€‚

éœ€è¦ä¿®æ”¹çš„æ˜¯user = apache æ”¹ä¸ºuser = nginxï¼Œå› ä¸ºphp-fpmè¿™é‡Œé…åˆçš„æ˜¯nginxä¸æ˜¯apacheã€‚

è¦ç”¨nginxä½œä¸ºæœåŠ¡çš„å¯åŠ¨è´¦æˆ·ï¼Œä¹Ÿä¼šå¼€å¯ç±»ä¼¼httpdçš„workerè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ã€‚è¿™é‡Œnginxå°±æ˜¯workè¿›ç¨‹çš„ç”¨æˆ·èº«ä»½ã€‚

ä¸æ”¹å°±ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚nginxä¼ ä¸€ä¸ªæ–‡ä»¶è¿‡æ¥ï¼Œphpç”¨å…¶ä»–çš„è´¦å·ï¼Œå¯èƒ½å°±ä¼šå­˜åœ¨æƒé™ä¸å¤Ÿçš„æƒ…å†µã€‚

![image-20240220145028937](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220145028937.png)

ä¿®æ”¹user å’Œ group ä¸ºnginx

![image-20240220145136534](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220145136534.png)



é‡å¯æœåŠ¡åï¼Œworkè¿›ç¨‹çš„ç”¨æˆ·å°±æ˜¯nginxäº†ï¼Œå½“ç„¶masterè¿›ç¨‹è¿˜çš„æ˜¯root

![image-20240220145219418](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220145219418.png)



ç”±äºæ˜¯socketæ–‡ä»¶ï¼Œæ‰€ä»¥ss -tlnup å°±æ²¡å¿…è¦çœ‹ç›‘å¬ç«¯å£äº†

ç„¶åphpç¨‹åºæ”¾åœ¨å“ªï¼Ÿnginxçš„ç«™ç‚¹rootè·¯å¾„ï¼Ÿå¾€ä¸‹çœ‹ï¼Œå¯ä»¥ä¸åœ¨ä¸€èµ·çš„

![image-20240220151215703](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151215703.png)

ç”±äºä¸Šå›¾çš„è™šæ‹Ÿä¸»æœºæ²¡æœ‰é…ç½®rootï¼Œæ‰€ä»¥æŠ¥é”™

![image-20240220151238805](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151238805.png)



è¡¥ä¸Šroot

![image-20240220151315349](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151315349.png)

ok

![image-20240220151332761](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151332761.png)

å°†phpç¨‹åºæ”¾åˆ°åˆ«çš„åœ°æ–¹ï¼Œ

![image-20240220171159818](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220171159818.png)

ä¸‹é¢è¦è®©nginxæ”¶åˆ°httpè¯·æ±‚è®¿é—®phpç¨‹åºçš„æŠ¥æ–‡åï¼Œnginxè¦çŸ¥é“å»æ‰¾php-fpmæœåŠ¡ï¼Œç„¶åè¯¥æœåŠ¡(ä»socketæ–‡ä»¶æˆ–è€…9000ç«¯å£æ”¶åˆ°å)è¿˜å¾—çŸ¥é“å»å“ªæ‰¾phpç¨‹åºï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾çš„è·¯å¾„ã€‚



1ã€é¦–å…ˆnginxåä»£ä¸Šè¦æœ‰fastcgiæ¨¡å—ï¼šngx_http_fastcgi_module

2ã€ç„¶åè¦é…ç½®fastcgiæœåŠ¡å™¨çš„åœ°å€ï¼šfastcgi_pass addressï¼›fastcgiå’Œåä»£åœ¨ä¸€èµ·å°±æŒ‡å‘æœ¬æœºï¼Œä¸è¿‡æ˜¯127.0.0.1è¿˜æ˜¯æœ¬æœºçš„IPåœ°å€éœ€è¦æ˜ç¡®ä¸€ä¸‹ã€‚

3ã€æŒ‡å®šç±»ä¼¼index.htmlçš„phpèµ„æºï¼Œä¸€èˆ¬å°±æ˜¯index.phpï¼ŒæŒ‡å®šcliä¸ºï¼šfastcgi_index index.php;

4ã€fastcgiå’Œnginxä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œéœ€è¦ç”¨ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯å›ºå®šæ ¼å¼çš„ï¼Œå¼•ç”¨å°±è¡Œï¼šfastcgi_param parameter value [if_not_empty];   æ‰€ä»¥çœ‹çœ‹fastcgi_paramså‚æ•°ğŸ‘‡ï¼Œç›´æ¥å¼•ç”¨å°±è¡Œï¼š

![image-20240220180724576](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220180724576.png)

å‚æ•°çš„ä½¿ç”¨æ˜¯éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå¼•ç”¨è¿™ä¸ªæ–‡ä»¶çš„ï¼Œå…·ä½“å°±æ˜¯locationé‡Œé…ç½® include fastcgi_params;

![image-20240220181437433](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220181437433.png)



fastcgi_paramsé‡Œå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹ä¸Šé¢ä¹Ÿè®²äº†ã€‚

![image-20240220181614116](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220181614116.png)

ç„¶åfastcgi_paramçœ‹èµ·æ¥å°±æ˜¯è‡ªå·±å®šä¹‰çš„ä¸€äº›å…¶ä»–å‚æ•°å’¯ï¼Œæ¯”å¦‚

![image-20240220181859443](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220181859443.png)

SCRIPT_FAILENAMEè„šæœ¬æ–‡ä»¶åï¼Œ$document_rootå°±æ˜¯ root /xx/xxå®šä¹‰çš„æ ¹è·¯å¾„ï¼›è€Œfastcgi_script_nameå°±æ˜¯è„šæœ¬åç§°ã€‚

ä¸Šå›¾ä¹Ÿå†™æ˜äº†ï¼Œåªæœ‰è®¿é—® ~* \.php$çš„è¯·æ±‚æ‰å‘é€åˆ°fastcgi_paramå‚æ•°æŒ‡å®šçš„è·¯å¾„/data/phpä¸‹çš„$fastcgi_script_nameè¿™ä¸ªæ–‡ä»¶ã€‚



å…³äº$fastcgi_script_nameå…·ä½“æ˜¯å•¥ï¼Œå¯ä»¥åœ¨logä¸­é…ç½®ä¸Šï¼Œç„¶åå»logé‡ŒæŸ¥çœ‹

![image-20240221094301028](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221094301028.png)

ä¸Šå›¾ğŸ‘†fastcgi_pass unix:xxxxæ˜¯å› ä¸ºphp-fpmé…ç½®æ–‡ä»¶é‡Œä¹Ÿæ˜¯è¿™æ ·å†™çš„

<img src="2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221095848859.png" alt="image-20240221095848859" style="zoom:33%;" />

å¦‚æœä¸Šå›¾å†™æˆlisten = 127.0.0.1:9000é‚£ä¹ˆnginxçš„é…ç½®locationé‡Œä¸€æ ·è¦å†™æˆfastcgi_pass 127.0.0.1:9000;

logé‡Œé…ç½®è¿™ä¸ª$fastcgi_script_nameå˜é‡

![image-20240221094530021](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221094530021.png)





![image-20240221094645223](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221094645223.png)

![image-20240221094701140](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221094701140.png)

å¯è§fastcgi_script_nameä¸ºphp.indexï¼Œå…¶å®å°±æ˜¯ç”¨æˆ·è®¿é—®çš„phpç¨‹åºçš„åç§°ï¼Œé€šå¸¸å°±æ˜¯urlæœ€åä¸€ä¸ªå­—æ®µã€‚

<img src="2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221100347295.png" alt="image-20240221100347295" style="zoom:33%;" />



![image-20240221095102077](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221095102077.png)



![image-20240221095253791](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221095253791.png)





# nginx+wordpress

wordpressæ˜¯phpå†™çš„ï¼Œæ‰€ä»¥nginxä¹Ÿæ˜¯ç”¨fastcgiå»å¯¹æ¥çš„ï¼Œå…¶å®wordpresså°±ç›¸å½“äºä¸€ä¸ªfastcgiæœåŠ¡å™¨äº†ã€‚

![image-20240221115020121](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221115020121.png)

![image-20240221115051046](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221115051046.png)





### æå®šdb

![image-20240221134032774](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221134032774.png)

å®‰è£…è¿™ä¸ªğŸ‘†ï¼Œå¯åŠ¨dbæœåŠ¡åï¼Œåˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ä»¥åŠæˆæƒğŸ‘‡

![image-20240221134617586](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221134617586.png)

ç¡®è®¤ä¸‹

![image-20240221134746128](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221134746128.png)

ä¸Šå›¾/16å†™é”™äº†ï¼Œæ”¹æˆ192.168.%

![image-20240221140024635](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221140024635.png)

åœ¨è¿œç«¯ä¸€å°æœºå™¨ä¸Šæµ‹è¯•è”é€šæ€§ï¼ŒokğŸ‘‡

![image-20240221140054153](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221140054153.png)



wordpressæ•°æ®åº“å‡†å¥½äº†ï¼Œæ¥ä¸‹æ¥å¼„wordpressç¨‹åº



### æå®šwordpressç¨‹åº



ç›´æ¥githubæ‹‰åˆ°è‡ªå·±è§„åˆ’çš„ç›®å½•é‡Œå°±è¡Œ

https://github.com/WordPress/WordPress.git

![image-20240221140753723](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221140753723.png)

ä¸è¿‡wordpressçš„ç‰ˆæœ¬ä¹Ÿè¦phpçš„ç‰ˆæœ¬é€‚é…çš„ã€‚

githubä¸Šä¹Ÿæåˆ°äº†æ¨èçš„ç‰ˆæœ¬

![image-20240221141142507](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221141142507.png)

phpæ˜¯7.4ä»¥ä¸Šï¼Œmysqlæ˜¯8.0ä»¥ä¸Š

![image-20240221141906357](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221141906357.png)

æˆ‘ç”¨çš„mariadb-serverç›´æ¥yumçš„ï¼Œmariadbçš„ç‰ˆæœ¬å’Œmysqlæœ‰ä¸€ä¸ªå¹³è¡Œåˆ†å‰ç‚¹æ˜¯5.5å§ï¼Œåé¢mysqlåˆç»è¿‡äº†å‡ ä¸ª5.xçš„å°ç‰ˆæœ¬å°±ç›´æ¥è·³åˆ°äº†8ï¼Œè€Œmariadbåˆ™æ˜¯è·³åˆ°äº†10å¥½åƒã€‚

![image-20240221142354787](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221142354787.png)

æ‰€ä»¥ä¸€èˆ¬æ¥è®²ï¼Œè¿™é‡Œå¯ä»¥è®¤ä¸ºmariadb10.11æ»¡è¶³äº†wordpressçš„dbè¦æ±‚--mysql8.0ä»¥ä¸Šçš„è¿™ä¸ªè¦æ±‚ã€‚



åˆ©ç”¨æ¨¡æ¿åˆ›å»ºwordpressé…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹

![image-20240221142918242](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221142918242.png)

![image-20240221143149035](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221143149035.png)

ç„¶åæ³¨æ„ä¸‹wordpressæ–‡ä»¶å¤¹çš„æƒé™ï¼Œæ¯”å¦‚æŸäº›æ–‡ä»¶å¤¹çš„ä¸Šä¼ æƒé™wp-contentè¿™ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯æ¥æ”¶ä¸Šä¼ çš„ã€‚è€Œæƒé™æ˜¯å¼€ç»™nginxè¿™ä¸ªç”¨æˆ·çš„ï¼Œå› ä¸ºä¹‹å‰é’ˆå¯¹fastcgiæœåŠ¡ä¹Ÿå°±æ˜¯php-fpmå·²ç»ä¿®æ”¹ä¸ºnginxäº†

![image-20240221143533460](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221143533460.png)

ç•¥å¾®æ”¹ä¸€ä¸‹phpçš„è®¿é—®è·¯å¾„

![image-20240221144135845](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221144135845.png)

æ³¨æ„ä¸Šå›¾çº¢æ¡†é‡Œå†™é”™äº†ï¼Œå¤§å°å†™ä¸å¯¹

ä¿®æ”¹ä¸ºroot /data/php/WordPress;

é‡å¯nginxåï¼Œå‘ç°è®¿é—®æœ‰ç‚¹é—®é¢˜ï¼ŒğŸ‘‡æ˜¯ç©ºç™½é¡µï¼Œè€Œä¸”æ˜¯302é‡å®šå‘

![image-20240221145213156](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221145213156.png)





é‡æ–°git cloneä¸ä¿®æ”¹wp-config.phpå°±æ˜¯è¿™æ ·ğŸ‘‡

æµè§ˆå™¨é‡Œè¾“å…¥http://www.site1.com/index.phpï¼Œå°±ä¼šè·³åˆ°

![image-20240221153937488](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221153937488.png)

ä¸è¿‡å›¾ç‰‡ä¹‹ç±»çš„ä¸å¯¹ï¼Œå°±æ˜¯ä¸€äº›é™æ€é¡µé¢åŒ…è£¹cssï¼Œå›¾ç‰‡ä¹‹ç±»çš„ï¼Œå¥½åƒæ²¡æ˜¾ç¤ºå‡ºæ¥ã€‚

ä¸€ä¸‹å°±æ˜¯é™¤äº†.phpä»¥å¤–çš„æ–‡ä»¶ï¼Œåº”è¯¥éƒ½å±äºé™æ€æ–‡ä»¶

![image-20240221155438103](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221155438103.png)



ä¿®æ”¹wp-config.phpç»§ç»­ç©ºç™½é¡µï¼Œç»§ç»­ç ”ç©¶ä¸‹



æ‰“å¼€wp-confi.phpé‡Œçš„debugçœ‹åˆ°502

![image-20240221163435665](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221163435665.png)

ä¹Ÿå»çœ‹çœ‹é”™è¯¯æ—¥å¿—

![image-20240221163405131](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221163405131.png)

çœ‹åˆ°too big headerï¼Œå¢åŠ buffer

![image-20240221163829560](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221163829560.png)

å†æ¬¡è®¿é—®ï¼Œå‘ç°åŸæ¥æ˜¯å­˜åœ¨å¤§é‡æŠ¥é”™å¯¼è‡´bufferä¸å¤Ÿç”¨ğŸ‘‡

![image-20240221163803662](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221163803662.png)



ç½‘ä¸Šè¯´

https://stackoverflow.com/questions/70040287/php7-4-preg-replace-compilation-failed-unrecognised-compile-time-option-bi

![image-20240221164151250](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221164151250.png)



![image-20240221165056229](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221165056229.png)

ç„¶åæˆ‘çš„æ˜¯rockylinux

![image-20240221165128441](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221165128441.png)

æ²¡æœ‰libpcre2ï¼Œä½†æ˜¯æœ‰pcre2

![image-20240221165200392](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221165200392.png)

äºæ˜¯æœæ–­yumä¹‹

![image-20240221165259814](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221165259814.png)

å†è®°å¾—é‡å¯php-fpm

![image-20240221165322044](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221165322044.png)

æ­¤æ—¶å†æ¬¡æµè§ˆå™¨è®¿é—®http://www.site1.com/index.phpå°±å¥½å•¦

![image-20240221165446395](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221165446395.png)

å½“ç„¶æ˜¯å­˜åœ¨302è·³è½¬çš„ã€‚

![image-20240221170048256](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221170048256.png)

![image-20240221171446017](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221171446017.png)



### è¿™é‡Œå¯ä»¥ç®€å•åšä¸€ä¸ªåŠ¨é™åˆ†ç¦»

![image-20240221171833366](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221171833366.png)

æ”¹ä¹‹

![image-20240221172147460](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221172147460.png)

è¿™æ ·xx.phpçš„è¿˜æ˜¯èµ°locationå» /data/php/WordPress/ä¸‹æ‰¾

è€Œä¸æ˜¯xx.phpçš„å°±å»/data/site1/wordpressStatics/ä¸‹æ‰¾

![image-20240221172459300](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221172459300.png)

å†æ¬¡è®¿é—®http://www.site1.com/index.phpçœ‹çœ‹

æ²¡å¾—é—®é¢˜ğŸ‘‡

![image-20240221172557802](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221172557802.png)



ç„¶åä¼˜åŒ–æˆè®¿é—®http://www.site1.comç›´æ¥å°±æ˜¯ä¸Šå›¾çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯è¯´index è®¾ç½®ä¸ºindex.phpäº†ã€‚

å®‰æ’~å…·ä½“é…ç½®å¦‚ä¸‹

![image-20240221174632675](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221174632675.png)

![image-20240221174647172](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221174647172.png)

å°è¯•åœ¨rootä¸‹æ–°å»ºä¸€ä¸ªindex.htmlçœ‹çœ‹ï¼Œå› ä¸ºindex index.php index.htmlæ˜¯ä»å·¦åˆ°å³å…ˆæ‰¾å…ˆå¾—ã€‚

![image-20240221174831165](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221174831165.png)



![image-20240221174927665](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221174927665.png)

å¥½äº†

![image-20240221175031801](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221175031801.png)

è¿™æ ·å°±å®ç°äº†è¾“å…¥http://www.site1.comï¼Œæ³¨æ„ä¸Šå›¾æˆ‘è¾“å…¥çš„æ—¶å€™æœ€åæ˜¯æ²¡æœ‰/çš„ï¼Œæ˜¯nginxè‡ªå·±302è¡¥äº†ä¸€ä¸ª/![image-20240221175204504](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221175204504.png)



æ‰€ä»¥indexçš„phpæ–‡ä»¶è¦æœ‰ï¼Œæ‰èƒ½è·³åˆ°location çš„phpé‡Œ

![image-20240221175356803](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221175356803.png)



![image-20240221180120202](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180120202.png)

![image-20240221180143203](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180143203.png)

![image-20240221180148051](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180148051.png)

ç»§ç»­æ’é”™å§ï¼Œå“ˆå“ˆ



çœ‹å›¾æ˜¯http://site1.com/wp-admin/çš„403ï¼Œæˆ‘åŸºæœ¬å°±è®¤ä¸ºæ˜¯æ”¹è·¯å¾„ä¸‹æ²¡æœ‰index.phpå’Œinde.html

è¿˜æ˜¯å› ä¸ºæˆ‘åšäº†åŠ¨é™åˆ†ç¦»ï¼Œæ‰€ä»¥è¿™ä¸ªURLèµ°çš„æ˜¯ä¸‹å›¾çš„æ¡†æ¡†é‡Œçš„è·¯å¾„

![image-20240221180433715](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180433715.png)

è€Œè¯¥è·¯å¾„ä¸‹æ˜¯æ²¡æœ‰indexæ–‡ä»¶çš„ï¼Œè¡¥ä¸€ä¸ªå°±è¡Œäº†ï¼Œå¦‚æœåšæŒè¦åŠ¨é™åˆ†ç¦»çš„è¯ã€‚ å…¶å®å¦‚æœä¸åšåŠ¨é™åˆ†ç¦»ä¹Ÿæ²¡è¿™ä¹ˆäº›æ¯›ç—…ã€‚

![image-20240221180449088](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180449088.png)



![image-20240221180619652](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180619652.png)

å†æ¬¡ç™»å…¥å°±OKå•¦ğŸ‘‡ï¼Œä¸Šå›¾çš„echo åªæ˜¯æ»¡è¶³ä¸€ä¸‹è®©ä»–æœ‰ä¸ªè·³è½¬åˆ°locationé‡Œã€‚è€Œlocationé‡Œçš„root /data/php/WordPress/ä¸‹çš„wp-adminä¸‹æ˜¯æœ‰å„ç§phpæ–‡ä»¶çš„ï¼Œå…³é”®æ˜¯æœ‰index.php

![image-20240221180613373](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180613373.png)



![image-20240221180818301](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221180818301.png)









![image-20240221181506989](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221181506989.png)







åˆ›å»ºæ–‡ç« ï¼Œä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™æŠ¥é”™

![image-20240221181845566](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221181845566.png)



çœ‹error log

![image-20240221182014407](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182014407.png)

æ‰€ä»¥ä½ è®¤ä¸ºåˆ°åº•æ˜¯å“ªä¸ªrootå‘¢ï¼Ÿå“ˆå“ˆï¼Œä¸Šå›¾æ˜¯referrerä»http://www.site1.com/wp-admin/post.php?post=8&action=eidtè·³è¿‡æ¥çš„ï¼Œå§‘ä¸”è®¤ä¸ºåœ¨ä¸‹é¢çš„rooté‡Œé¢å§

![image-20240221182044739](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182044739.png)

æ‰€ä»¥å»/data/php/WordPress/wp-admin/çœ‹çœ‹





![image-20240221182532365](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182532365.png)

å…¶å®æƒ³æƒ³ä¹ŸçŸ¥é“ï¼Œè¿™äº›å¤šå±‚çº§çš„æ–‡ä»¶å¤¹ï¼Œè‚¯å®šä¸ç”¨æ‰‹åŠ¨åˆ›å»ºçš„å˜›ï¼Œå°±æ˜¯åŠ¨é™åˆ†ç¦»åä¸€äº›ç¨‹åºæ²¡æœ‰ç”Ÿæ•ˆå¯¼è‡´çš„ã€‚



è¿™é‡Œæ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼Œç„¶åæ¥ç€æŠ¥é”™å˜äº†



![image-20240221182515920](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182515920.png)

![image-20240221182715501](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182715501.png)

ç»§ç»­æŠ¥é”™ï¼Œå¯èƒ½æ˜¯phpç¨‹åºæ²¡æœ‰æ‰“èµalt attributeï¼Œæˆ‘çŒœæ˜¯åŠ¨é™åˆ†ç¦»åä¸€äº›ç¨‹åºæ²¡æœ‰è¿è¡Œèµ·æ¥ã€‚

![image-20240221182701481](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182701481.png)

å¾—ï¼Œæˆ‘ä¸å¼„åŠ¨é™åˆ†ç¦»äº†ï¼Œåˆèµ·æ¥ç®—äº†



![image-20240221182806635](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182806635.png)



æœç„¶å¥½å•¦

![image-20240221182845560](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240221182845560.png)

å…¶å®å¾ˆå¥½ç†è§£ï¼Œä½ å¼ºè¡Œåšçš„åŠ¨é™åˆ†ç¦»ï¼Œäººå®¶ä¸€äº›phpæ²¡æœ‰åŠæ³•èµ·ä½œç”¨äº†ã€‚













