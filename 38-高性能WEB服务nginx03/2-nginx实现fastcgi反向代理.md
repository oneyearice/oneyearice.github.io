# ç¬¬2èŠ‚. nginxå®ç°fastcgiåå‘ä»£ç†



# æ¦‚è¿°

ç”¨æˆ·è¿˜æ˜¯è®¿é—®é¡µé¢ï¼Œè¿˜æ˜¯httpè¯·æ±‚ï¼Œä¸è¿‡è¯·æ±‚çš„å†…å®¹å˜æˆäº†phpæ–‡ä»¶ã€‚

![image-20240220140451626](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220140451626.png)

ç°åœ¨nginxåä»£æ”¶åˆ°è¿™ä¸ªphpçš„httpè¯·æ±‚ï¼Œæœ¬èº«æ˜¯å¤„ç†ä¸äº†çš„ï¼Œéœ€è¦é€šè¿‡fastcgiåè®®æŠŠphpè¯·æ±‚å‘é€ç»™åç«¯çš„phpæœåŠ¡å™¨ï¼Œç±»ä¼¼fpm-phpæœåŠ¡å™¨ï¼Œé»˜è®¤ç›‘å¬9000ç«¯å£ã€‚



è¿™ç§å°±æ˜¯å¼‚æ„äº†ğŸ‘‡

<img src="2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220140322768.png" alt="image-20240220140322768" style="zoom:33%;" />





æ­å»ºä¸€ä¸ªfastcgiçš„real server

1ã€ç‰©ç†ä¸Šå¯ä»¥å°†åä»£nginxå’Œreal serveræ”¾åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼›

2ã€ä¹Ÿå¯ä»¥åˆ†å¼€æ”¾ã€‚



# å®éªŒï¼šåä»£+real serveræ”¾åœ¨ä¸€å°æœºå™¨ä¸Š



å…ˆæä¸€ä¸ªfastcgiçš„æœåŠ¡å™¨ï¼š

![image-20240220141640646](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141640646.png)



![image-20240220141716757](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141716757.png)

ä¹Ÿæ˜¯epelæºé‡Œçš„

![image-20240220141845092](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141845092.png)



![image-20240220141906346](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141906346.png)



![image-20240220141922449](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220141922449.png)

**éœ€è¦å®‰è£…php-fpmä½œä¸ºfastcgiçš„æœåŠ¡å™¨ï¼Œè¿˜éœ€è¦å®‰è£…php-mysqlç”¨æ¥è¿æ¥æ•°æ®åº“ã€‚**

ä¸è¿‡ç°åœ¨å¥½åƒå«php-mysqlndäº†ï¼Œè£…ä¹‹

![image-20240220142826383](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220142826383.png)





ç›‘å¬çš„ç«¯å£æ²¡å†™ï¼Œè€Œæ˜¯ç›‘å¬ç”¨çš„æ˜¯socketè¿˜ä¸æ˜¯tcp/ipç«¯å£ã€‚ä¸è¿‡ç”±äºåä»£å’Œfastcgi serverä¹Ÿå°±æ˜¯php-fpmåœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼Œè¿˜æƒ³ä¸ç”¨æ”¹ï¼Œå°±ç”¨socketæ–‡ä»¶è¿˜ä¸é”™ã€‚

![image-20240220143900756](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220143900756.png)

ç„¶ålisten.allowed_cliants å°±æ˜¯127æœ¬åœ°æ¥è¿æ¥ã€‚

éœ€è¦ä¿®æ”¹çš„æ˜¯user = apache æ”¹ä¸ºuser = nginxï¼Œå› ä¸ºphp-fpmè¿™é‡Œé…åˆçš„æ˜¯nginxä¸æ˜¯apacheã€‚

è¦ç”¨nginxä½œä¸ºæœåŠ¡çš„å¯åŠ¨è´¦æˆ·ï¼Œä¹Ÿä¼šå¼€å¯ç±»ä¼¼httpdçš„workerè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ã€‚è¿™é‡Œnginxå°±æ˜¯workè¿›ç¨‹çš„ç”¨æˆ·èº«ä»½ã€‚

ä¸æ”¹å°±ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ¯”å¦‚nginxä¼ ä¸€ä¸ªæ–‡ä»¶è¿‡æ¥ï¼Œphpç”¨å…¶ä»–çš„è´¦å·ï¼Œå¯èƒ½å°±ä¼šå­˜åœ¨æƒé™ä¸å¤Ÿçš„æƒ…å†µã€‚

![image-20240220145028937](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220145028937.png)

ä¿®æ”¹user å’Œ group ä¸ºnginx

![image-20240220145136534](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220145136534.png)



é‡å¯æœåŠ¡åï¼Œworkè¿›ç¨‹çš„ç”¨æˆ·å°±æ˜¯nginxäº†ï¼Œå½“ç„¶masterè¿›ç¨‹è¿˜çš„æ˜¯root

![image-20240220145219418](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220145219418.png)



ç”±äºæ˜¯socketæ–‡ä»¶ï¼Œæ‰€ä»¥ss -tlnup å°±æ²¡å¿…è¦çœ‹ç›‘å¬ç«¯å£äº†

ç„¶åphpç¨‹åºæ”¾åœ¨å“ªï¼Ÿnginxçš„ç«™ç‚¹rootè·¯å¾„ï¼Ÿå¾€ä¸‹çœ‹ï¼Œå¯ä»¥ä¸åœ¨ä¸€èµ·çš„

![image-20240220151215703](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151215703.png)

ç”±äºä¸Šå›¾çš„è™šæ‹Ÿä¸»æœºæ²¡æœ‰é…ç½®rootï¼Œæ‰€ä»¥æŠ¥é”™

![image-20240220151238805](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151238805.png)



è¡¥ä¸Šroot

![image-20240220151315349](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151315349.png)

ok

![image-20240220151332761](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220151332761.png)

å°†phpç¨‹åºæ”¾åˆ°åˆ«çš„åœ°æ–¹ï¼Œ

![image-20240220171159818](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220171159818.png)

ä¸‹é¢è¦è®©nginxæ”¶åˆ°httpè¯·æ±‚è®¿é—®phpç¨‹åºçš„æŠ¥æ–‡åï¼Œnginxè¦çŸ¥é“å»æ‰¾php-fpmæœåŠ¡ï¼Œç„¶åè¯¥æœåŠ¡(ä»socketæ–‡ä»¶æˆ–è€…9000ç«¯å£æ”¶åˆ°å)è¿˜å¾—çŸ¥é“å»å“ªæ‰¾phpç¨‹åºï¼Œä¹Ÿå°±æ˜¯ä¸Šå›¾çš„è·¯å¾„ã€‚



1ã€é¦–å…ˆnginxåä»£ä¸Šè¦æœ‰fastcgiæ¨¡å—ï¼šngx_http_fastcgi_module

2ã€ç„¶åè¦é…ç½®fastcgiæœåŠ¡å™¨çš„åœ°å€ï¼šfastcgi_pass addressï¼›fastcgiå’Œåä»£åœ¨ä¸€èµ·å°±æŒ‡å‘æœ¬æœºï¼Œä¸è¿‡æ˜¯127.0.0.1è¿˜æ˜¯æœ¬æœºçš„IPåœ°å€éœ€è¦æ˜ç¡®ä¸€ä¸‹ã€‚

3ã€æŒ‡å®šç±»ä¼¼index.htmlçš„phpèµ„æºï¼Œä¸€èˆ¬å°±æ˜¯index.phpï¼ŒæŒ‡å®šcliä¸ºï¼šfastcgi_index index.php;

4ã€fastcgiå’Œnginxä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œéœ€è¦ç”¨ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯å›ºå®šæ ¼å¼çš„ï¼Œå¼•ç”¨å°±è¡Œï¼šfastcgi_param parameter value [if_not_empty];   æ‰€ä»¥çœ‹çœ‹fastcgi_paramså‚æ•°ğŸ‘‡ï¼Œç›´æ¥å¼•ç”¨å°±è¡Œï¼š

![image-20240220180724576](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220180724576.png)

å‚æ•°çš„ä½¿ç”¨æ˜¯éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå¼•ç”¨è¿™ä¸ªæ–‡ä»¶çš„ï¼Œå…·ä½“å°±æ˜¯locationé‡Œé…ç½® include fastcgi_params;

![image-20240220181437433](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220181437433.png)



fastcgi_paramsé‡Œå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹ä¸Šé¢ä¹Ÿè®²äº†ã€‚

![image-20240220181614116](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220181614116.png)

ç„¶åfastcgi_paramçœ‹èµ·æ¥å°±æ˜¯è‡ªå·±å®šä¹‰çš„ä¸€äº›å…¶ä»–å‚æ•°å’¯ï¼Œæ¯”å¦‚

![image-20240220181859443](2-nginxå®ç°fastcgiåå‘ä»£ç†.assets/image-20240220181859443.png)

SCRIPT_FAILENAMEè„šæœ¬æ–‡ä»¶åï¼Œ$document_rootå°±æ˜¯ root /xx/xxå®šä¹‰çš„æ ¹è·¯å¾„ï¼›è€Œfastcgi_script_nameå°±æ˜¯è„šæœ¬åç§°ã€‚

ä¸Šå›¾ä¹Ÿå†™æ˜äº†ï¼Œåªæœ‰è®¿é—® ~* \.php$çš„è¯·æ±‚æ‰å‘é€åˆ°fastcgi_paramå‚æ•°æŒ‡å®šçš„è·¯å¾„/data/phpä¸‹çš„$fastcgi_script_nameè¿™ä¸ªæ–‡ä»¶ã€‚



















