# 5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.md



# åŒä¸»æ¨¡å‹

ä¸¤å°èŠ‚ç‚¹ä¸æµªè´¹

å…¶å®å°±æ˜¯å¤šä¸šåŠ¡çš„A/Aäº†ï¼Œå°±å¥½æ¯”ECMPå…¶å®æ˜¯å¤šç”¨æˆ·çš„é“¾è·¯è´Ÿè½½åˆ†æ‹…å’¯ã€‚



1ã€ä¸»é…ç½®æ–‡ä»¶ä¸å˜

![image-20241219112829817](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219112829817.png)



![image-20241219112848815](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219112848815.png)



2ã€å­é…ç½®æ–‡ä»¶è·Ÿç€ä¸šåŠ¡èµ°ä¹Ÿå°±æ˜¯ä¸€ä¸ªç«™ç‚¹ä¸€ä¸ªå­é…ç½®æ–‡ä»¶ä¸€ä¸ªVIP

![image-20241219112944043](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219112944043.png)

ä¸Šå›¾æ”¹ä¸ºnopreempté™ä½å›åˆ‡å¯¼è‡´é—ªæ–­ã€‚



![image-20241219112924805](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219112924805.png)



å†åšç¬¬äºŒä¸ªç«™ç‚¹çš„å­é…ç½®æ–‡ä»¶

![image-20241219113748631](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219113748631.png)



![image-20241219113822596](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219113822596.png)



é‡å¯keepalivedæœåŠ¡å

è®©192.168.126.100è½åœ¨ka001ä¸Šï¼Œè®©192.168.126.102è½åœ¨ka002ä¸ŠğŸ‘‡

![image-20241219113847054](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219113847054.png)



![image-20241219113855724](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219113855724.png)





# åŒæ­¥ç»„

ASAé‡Œçš„failoveré‡Œæœ‰ä¸ªç«¯å£ç»„ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚



VIP è¦èƒ½ç¥¨ï¼ŒDIPä¹Ÿè¦èƒ½é£˜

![image-20241219135954335](5.Keepalivedå¤šä¸»æ¨¡å¼å’Œå®ç°LVS.assets/image-20241219135954335.png)



```bash
vrrp_sync_group VG_1 {
	group {  # æˆä¸ºä¸€ä¸ªgroupåï¼Œè¦é£˜å°±ä¸€å—é£˜äº†ã€‚
		VI_1 # name of vrrp_instance (below)
		VI_2 # One of each moveable IP
	}
	vrrp_instance VI_1 {
		eth0
		vip
	}
	vrrp_instance VI_2 {
		eth1
		dip
	}
}
```







# keepaliveå†…åµŒLVSè§„åˆ™

LVSå•ç‚¹é—®é¢˜ï¼Œå’Œå¥åº·æ£€æµ‹é—®é¢˜

lvs ä»¥å‰è¦ç”¨ipvsadminå·¥å…·æ¥ ç¼–è¾‘è½¬å‘è§„åˆ™ã€‚

```bash
ipvsadmin -A -t vip:80 -s rr; ipvsadmin -a -t vip:80 -r rip1:80 -m|g|i ï¼ˆnat|gatway|tunnelï¼‰ 
```

keepalivedé‡Œå†…ç½®çš„lvsï¼Œæ— éœ€å†ä¾èµ–ipvsadminæ¥åˆ›å»ºè§„åˆ™ï¼Œç›´æ¥ç”¨keepaliveçš„é…ç½®æ–‡ä»¶å°±è¡Œã€‚ä¸è¿‡å¯ä»¥ç”¨ipvadminæ¥çœ‹çœ‹å·²ç»åˆ›å»ºçš„è§„åˆ™ã€‚



keepaliveå†…åµŒlvsè§„åˆ™ï¼Œå¿…ç„¶ä¿æŒlvsçš„å¯¹å¤–IPå’ŒVRRPé‡Œçš„VIPä¸€è‡´

VRRPçš„VIPæ”¶åˆ°ç”¨æˆ·è¯·æ±‚ï¼Œç„¶åå°±åŒ¹é…virtual_server IP port è¯­å¥å—ï¼Œæ¥è°ƒåº¦åˆ°åç«¯å®ä¾‹ã€‚



