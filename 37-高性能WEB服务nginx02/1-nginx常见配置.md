# ç¬¬1èŠ‚. nginxå¸¸è§é…ç½®



## å¯¹å®¢æˆ·ç«¯è¿›è¡Œé™åˆ¶

### ä¸‹è½½é™é€Ÿ



å‡†å¤‡ä¸‹è½½çš„èµ„æº

![image-20240117150403381](1-nginxå¸¸è§é…ç½®.assets/image-20240117150403381.png)

ä¸‹è½½é€Ÿåº¦

![image-20240117150513176](1-nginxå¸¸è§é…ç½®.assets/image-20240117150513176.png)

é™é€ŸæˆåŠŸğŸ‘‡

![image-20240117164800136](1-nginxå¸¸è§é…ç½®.assets/image-20240117164800136.png)







### é™åˆ¶method

```
limit_except method ... { ... }ï¼Œä»…ç”¨äºlocation
é™åˆ¶å®¢æˆ·ç«¯ä½¿ç”¨é™¤äº†æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•ä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•
method:GET, HEAD, POST, PUT, DELETEï¼ŒMKCOL, COPY, MOVE,  OPTIONS, PROPFIND, PROPPATCH, LOCK, UNLOCK, PATCH
limit_except GET {
	allow 192.168.1.0/24;
	deny all;
}
é™¤äº†GETå’ŒHEAD ä¹‹å¤–å…¶å®ƒæ–¹æ³•ä»…å…è®¸192.168.1.0/24ç½‘æ®µä¸»æœºä½¿ç”¨

```



![image-20240117172113121](1-nginxå¸¸è§é…ç½®.assets/image-20240117172113121.png)

![image-20240117172203447](1-nginxå¸¸è§é…ç½®.assets/image-20240117172203447.png)

è¿™é‡Œçš„Not Allowedåº”è¯¥ä¸æ˜¯æ²¡æœ‰æ”¾è¡Œï¼Œè€Œæ˜¯ç½‘ç«™ä¸æ”¯æŒçš„æ„æ€ï¼Œè¯æ˜å¦‚ä¸‹ğŸ‘‡

é…ç½®

![image-20240117183840413](1-nginxå¸¸è§é…ç½®.assets/image-20240117183840413.png)

ç¿»è¯‘ï¼šé™åˆ¶æ‰€æœ‰ï¼Œé™¤äº†GETå’ŒOPTIONSä»¥åŠGETæ”¾äº†å°±å¸¦äº†HEADï¼ŒIPæ–¹é¢å…¨éƒ¨åŒ…å«ã€‚

![image-20240117183951126](1-nginxå¸¸è§é…ç½®.assets/image-20240117183951126.png)

è¿™æ‰æ˜¯æ²¡æœ‰æ”¾è¡Œçš„æŠ¥é”™ğŸ‘‡

![image-20240117184015696](1-nginxå¸¸è§é…ç½®.assets/image-20240117184015696.png)

è€Œè¿™ä¸ªä¸æ˜¯æ²¡æœ‰æ”¾è¡Œï¼Œè€Œæ˜¯ç½‘ç«™ä¸æ”¯æŒçš„ç°è±¡ğŸ‘‡

![image-20240117184102196](1-nginxå¸¸è§é…ç½®.assets/image-20240117184102196.png)



### æ–‡ä»¶æ“ä½œä¼˜åŒ–çš„é…ç½®

**aio on | off | threads[=pool];**

â€‹	æ˜¯å¦å¯ç”¨å¼‚æ­¥ioï¼Œé»˜è®¤off

**directio size | off;**

â€‹	å½“æ–‡ä»¶å¤§äºç­‰äºç»™å®šå¤§å°æ—¶ï¼ŒåŒæ­¥(ç›´æ¥)å†™ç£ç›˜ï¼Œè€Œéå†™ç¼“å­˜ï¼Œé»˜è®¤off

```
location /video/ {
	sendfile	on;
	aio			on;
	directio	8m;
}
```



**open_file_cache off;**

**open_file_cache max=N [inactive=time];**

â€‹	nginxå¯ä»¥ä½¿ç”¨ç¼“å­˜æ¥åŠ å¿«æ–‡ä»¶è®¿é—®é€Ÿåº¦ï¼Œå¯ä»¥ç¼“å­˜ä»¥ä¸‹ä¸‰ç§ä¿¡æ¯ï¼š

â€‹	â‘ æ–‡ä»¶å…ƒæ•°æ®ï¼šæ–‡ä»¶æè¿°ç¬¦ã€æ–‡ä»¶å¤§å°å’Œæœ€è¿‘ä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´

â€‹	â‘¡æ‰“å¼€çš„ç›®å½•ç»“æ„

â€‹	â‘¢æ²¡æœ‰æ‰¾åˆ°çš„æˆ–è€…æ²¡æœ‰æƒé™è®¿é—®çš„æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯

â€‹	max=Nï¼šå¯ç¼“å­˜çš„ç¼“å­˜é¡¹ä¸Šé™ï¼Œè¾¾åˆ°ä¸Šé™åä¼šä½¿ç”¨LRUç®—æ³•æ¥ç®¡ç†

â€‹	inactive=timeï¼šç¼“å­˜é¡¹çš„éæ´»åŠ¨æ—¶é•¿ï¼Œåœ¨æ­¤å¤„æŒ‡å®šçš„æ—¶é•¿å†…æœªå‘½ä¸­çš„æˆ–å‘½ä¸­æ¬¡æ•°å°‘äºopen_file_cahce_min_usersæŒ‡ä»¤æ‰€æŒ‡å®šçš„æ¬¡æ•°çš„ç¼“å­˜é¡¹å³ä¸ºéæ´»åŠ¨é¡¹ï¼Œå°†è¢«åˆ é™¤ã€‚

è¿™é‡Œé¢å°±ä½“ç°äº†ç¼“å­˜çš„ä¸€ä¸ªä½¿ç”¨é€»è¾‘ï¼šâ‘ ç¼“å­˜çš„ç©ºé—´å¤šå°‘èƒ½å­˜å¤šå°‘æ•°æ®é‡æ•°æ®é‡æ˜¯æ¡æ•°æ¥å®šä¹‰çš„å—ï¼Ÿâ‘¡å­˜å¤šä¹…ï¼Œä¸ç”¨å°±åˆ ï¼Œä¸ç”¨çš„æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Œç”¨çš„å°‘å°±åˆ ï¼Œç”¨çš„å°‘çš„æ ‡å‡†æ˜¯ä»€ä¹ˆã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªæŒ‡å®šæ—¶é—´ã€‚æ‰€ä»¥ä¸Šé¢çš„é€»è¾‘å°±æ˜¯ç­”æ¡ˆäº†ã€‚



**open_file_cache_min_uses number;**

â€‹	open_file_cacheæŒ‡ä»¤çš„inactiveå‚æ•°æŒ‡å®šçš„æ—¶é•¿å†…ï¼Œè‡³å°‘è¢«å‘½ä¸­æ­¤å¤„æŒ‡å®šçš„æ¬¡æ•°æ–¹å¯è¢«å½’ç±»ä¸ºæ´»åŠ¨é¡¹ã€‚é»˜è®¤ä¸º1ï¼Œ1å°±æ˜¯ç­‰ä»·äºLRUç®—æ³•äº†--åªè¦å‘½ä¸­ä¸€æ¬¡å°±å°†ä¼˜å…ˆçº§æä¸ºæœ€é«˜ã€‚å¯ä»¥æ”¹å¤§ç‚¹ã€‚



**open_file_cache_errors on | off**ï¼Œæ˜¯å¦ç¼“å­˜æŸ¥æ‰¾æ—¶å‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶ä¸€ç±»çš„ä¿¡æ¯ï¼Œé»˜è®¤off

â€‹	ç”¨æˆ·ç»å¸¸è®¿é—®é”™è¯¯çš„é¡µé¢ï¼Œå¯ä»¥å¼€å¯è¿™ä¸ªé€‰é¡¹



**open_file_cache_valid time**ï¼Œç¼“å­˜é¡¹æœ‰æ•ˆæ€§çš„æ£€æŸ¥é¢‘ç‡ï¼Œé»˜è®¤å€¼60s

â€‹	æ£€æŸ¥åˆ°äº†éæ´»åŠ¨é¡¹ï¼Œå°±ä¼šåˆ é™¤äº†ã€‚



### ngx_http_access_module ç±»ä¼¼acl

è¯¥æ¨¡å—ï¼Œå¯å®ç°åŸºäºipçš„è®¿é—®æ§åˆ¶åŠŸèƒ½

allow address | CIDR | unix: | all;

deny address | CIDR | unix: | all;

â€‹	 ä¸Šä¸‹æ–‡æ‰€å±ï¼šhttpï¼Œserverï¼Œlocationï¼Œlimit_execpt

â€‹	è‡ªä¸Šè€Œä¸‹æ£€æŸ¥ï¼Œä¸€æ—¦åŒ¹é…ï¼Œå°†ç”Ÿæ•ˆï¼Œæ¡ä»¶ä¸¥æ ¼çš„ç½®å‰ã€‚



ç¤ºä¾‹ï¼š

```
location /about {  # è¿™ç©æ„ä¼š301é‡å®šå‘ä¸º/about/ç„¶åèµ°rootæ‹¼æ¥ï¼Œå°±æ˜¯
	root /data/nginx/html/pc;   # æ‹¼æ¥ä¸º/data/nginx/html/pc/about/index.html
	index index.html;
	deny 192.168.1.1;
	allow 192.168.1.0/24;
	allow 10.1.1.0/16;
	allow 2001:0db8::/32;
	deny all;
}
```

![image-20240118103756729](1-nginxå¸¸è§é…ç½®.assets/image-20240118103756729.png)

è°ƒæ•´ä¸€ä¸‹é¡ºåº

![image-20240118103834111](1-nginxå¸¸è§é…ç½®.assets/image-20240118103834111.png)



### ngx_http_auth_basic_module

è¯¥æ¨¡å—åŸºäºç”¨æˆ·è®¿é—®æ§åˆ¶ï¼Œä½¿ç”¨basicæœºåˆ¶è¿›è¡Œç”¨æˆ·è®¤è¯

auth_basic string | off

auth_basic_user_file file;

â€‹	location /admin/ {

â€‹		auth_basic "Admin Area";     # æç¤ºè¯­å¥ï¼Œå¼¹å‡ºå¯¹è¯æ¡†é‡Œçš„ä¿¡æ¯

â€‹		auth_basic_user_file /etc/nginx/.ngxpasswd;        # ä½ çœ‹ï¼Œå’Œhttpdä¸€æ ·ï¼Œå¯†ç éƒ½æ˜¯ç”¨.xxxéšè—æ–‡ä»¶æ¥åšä¸€èˆ¬

}

ç”¨æˆ·å£ä»¤æ–‡ä»¶ï¼š

1ã€æ˜æ–‡æ–‡æœ¬ï¼šæ ¼å¼name:passswd:comment

2ã€åŠ å¯†æ–‡æœ¬ï¼šç”±htpasswdå‘½ä»¤å®ç°

â€‹		httpd-toolsæ‰€æä¾›



å¥½åƒå’Œhttpdä¹Ÿå°±æ˜¯apacheä¸€æ ·ï¼Ÿè‚¯å®šä¸€æ ·äº†ï¼Œéƒ½æ˜¯ä¸€ä¸ªå·¥å…·httpd-toolsæä¾›çš„

![image-20240118111154983](1-nginxå¸¸è§é…ç½®.assets/image-20240118111154983.png)



![image-20240118111415509](1-nginxå¸¸è§é…ç½®.assets/image-20240118111415509.png)

æŒ‰è¿™èµ°ä¸€éå’¯ğŸ‘†



![image-20240118111745835](1-nginxå¸¸è§é…ç½®.assets/image-20240118111745835.png)

æˆ–è€…è¿™æ ·æ›´ç®€å•

![image-20240118112244323](1-nginxå¸¸è§é…ç½®.assets/image-20240118112244323.png)



æ³¨æ„-c åªæœ‰é¦–æ¬¡æ‰èƒ½åŠ å“¦

![image-20240118112323831](1-nginxå¸¸è§é…ç½®.assets/image-20240118112323831.png)

ä»¥åå°±è¿™ä¹ˆé…ç½®ğŸ‘‡

![image-20240118112403537](1-nginxå¸¸è§é…ç½®.assets/image-20240118112403537.png)

é…ç½®ä»¥ä¸‹ä½¿ç”¨è¯¥ç”¨æˆ·å¯†ç 

![image-20240118112928596](1-nginxå¸¸è§é…ç½®.assets/image-20240118112928596.png)

å»æ‰index test.htmlæ‰ä¼šä½¿è®¤è¯ç”Ÿæ•ˆğŸ‘‡ ä¸å¯¹ï¼Œä¸å¯¹ï¼Œä¸å»æ‰ä¹Ÿå¯ä»¥çš„ï¼Œè¿™é‡Œå®éªŒæ•ˆæœç”Ÿæ•ˆå¯èƒ½æ…¢äº†

![image-20240118114702350](1-nginxå¸¸è§é…ç½®.assets/image-20240118114702350.png)





![image-20240118115933695](1-nginxå¸¸è§é…ç½®.assets/image-20240118115933695.png)





![image-20240118133653704](1-nginxå¸¸è§é…ç½®.assets/image-20240118133653704.png)



è¦æ³¨æ„è¿™ä¸ªbasicè®¤è¯çš„å¯†ç ï¼Œæ˜¯æ˜æ–‡çš„ï¼ŒæŠ“åŒ…å¯è§

æŠ“è¿™ä¸ªå£çš„æŠ¥æ–‡

![image-20240118134111599](1-nginxå¸¸è§é…ç½®.assets/image-20240118134111599.png)

![image-20240118134234807](1-nginxå¸¸è§é…ç½®.assets/image-20240118134234807.png)

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦é‡‡ç”¨httpsçš„åŸå› 



### apacheé‚£ä¼šè®²è¿‡statusç»Ÿè®¡é¡µé¢ï¼ŒnginxåŒæ ·ä¹Ÿæœ‰



![image-20240118141004245](1-nginxå¸¸è§é…ç½®.assets/image-20240118141004245.png)

è¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œå°±æ˜¯å°†æ¥å¯ä»¥curl xx/xxx/statusï¼Œå°±èƒ½å¿«æ·åœ°è·å¾—å„ä¸ªæŒ‡æ ‡ï¼Œè”åŠ¨æŠ¥è­¦äº†ã€‚

```
location /nginx_status {
	stub_status;
	allow 127.0.0.1;
	allow 172.16.0.0/16;  # è‡ªå·±ä¿®æ”¹æˆæ‰€éœ€è¦åœ°ç™½åå•
	deny all;
}
```

![image-20240118143637173](1-nginxå¸¸è§é…ç½®.assets/image-20240118143637173.png)



![image-20240118143734204](1-nginxå¸¸è§é…ç½®.assets/image-20240118143734204.png)



abæ‰“ä¸€ä¸‹

![image-20240118144850694](1-nginxå¸¸è§é…ç½®.assets/image-20240118144850694.png)



æ³¨æ„ï¼šç¬¬äºŒè¡Œå‚æ•°åœ°å€¼ä¹Ÿå°±æ˜¯2ã€3ä¸¤è¡Œ æ˜¯ç´¯è®¡åœ°å€¼

æœ€åä¸€è¡Œæ˜¯å½“å‰çš„å€¼ã€‚





### ç¬¬ä¸‰æ–¹æ’ä»¶-echo

echoå°±æ˜¯å˜é‡ æ˜¾ç¤ºå‡ºæ¥æ¯”è¾ƒæ–¹ä¾¿å¯èƒ½ã€‚

![image-20240118174400274](1-nginxå¸¸è§é…ç½®.assets/image-20240118174400274.png)

è¿™æ˜¯æ²¡æœ‰echoåŠŸèƒ½çš„ï¼Œéœ€è¦å®‰è£…æ’ä»¶

https://github.com/openresty/echo-nginx-module

![image-20240118181306590](1-nginxå¸¸è§é…ç½®.assets/image-20240118181306590.png)



ç„¶åä¸‹è½½nginxæºç 

https://nginx.org/en/download.html

ç„¶åç¼–è¯‘çš„æ—¶å€™ï¼ŒæŠŠechoæ’ä»¶åŠ è¿›å»

![image-20240118183113715](1-nginxå¸¸è§é…ç½®.assets/image-20240118183113715.png)



![image-20240118182856859](1-nginxå¸¸è§é…ç½®.assets/image-20240118182856859.png)



okğŸ‘‡

![image-20240118183408407](1-nginxå¸¸è§é…ç½®.assets/image-20240118183408407.png)

å›¾ä¸­erroråªæ˜¯æ‘¸ç²‘ç²‘çš„ç€è‰²

ç„¶åmake -j 4 && make installæŠ¥é”™ğŸ‘‡

![image-20240119093506284](1-nginxå¸¸è§é…ç½®.assets/image-20240119093506284.png)

å¤„ç†æ–¹æ³•

![image-20240119093616854](1-nginxå¸¸è§é…ç½®.assets/image-20240119093616854.png)

å®Œæ•´çš„ç¼–è¯‘é€‰é¡¹å¦‚ä¸‹ğŸ‘‡

```
./configure \
--with-cc-opt='-fPIE -fPIC' \
--with-ld-opt='-pie' \
--prefix=/apps/nginx \
--user=nginx --group=nginx \
--with-http_ssl_module \
--with-http_v2_module \
--with-http_realip_module \
--with-http_stub_status_module \
--with-http_gzip_static_module \
--with-http_perl_module \
--with-pcre \
--with-stream \
--with-stream_ssl_module \
--with-stream_realip_module \
--add-module=/usr/local/src/echo-nginx-module

make -j 4 && make install

```

![image-20240119094102949](1-nginxå¸¸è§é…ç½®.assets/image-20240119094102949.png)



åˆ›å»ºæµ‹è¯•é…ç½®æ–‡ä»¶

![image-20240119100352179](1-nginxå¸¸è§é…ç½®.assets/image-20240119100352179.png)



![image-20240119100404330](1-nginxå¸¸è§é…ç½®.assets/image-20240119100404330.png)

çœ‹ä¸Šå›¾ä¸è¡Œå“¦ğŸ‘†ï¼Œnginx -tçœ‹åˆ°çš„æ˜¯nginx.conf test OKï¼Œå…¶å®æ²¡æœ‰æ£€æµ‹test.confçš„ï¼Œå› ä¸ºä¸»é…ç½®æ–‡ä»¶é‡Œæ²¡æœ‰æŒ‡å®šinclud xxx

åŠ ä¸€ä¸‹

![image-20240119155746463](1-nginxå¸¸è§é…ç½®.assets/image-20240119155746463.png)



![image-20240119174905216](1-nginxå¸¸è§é…ç½®.assets/image-20240119174905216.png)

è¿™å°±æ˜¯æ•ˆæœäº†ï¼Œç„¶åæµè§ˆå™¨æ˜¯ç”±äºmime.typesåº”è¯¥æ²¡æœ‰è¯†åˆ«æ‰€ä»¥å°±ç»Ÿä¸€ä¸‹è½½

![image-20240119174948167](1-nginxå¸¸è§é…ç½®.assets/image-20240119174948167.png)

ä¸‹è½½ä¸‹æ¥æ‰“å¼€å°±æ˜¯

![image-20240119175018672](1-nginxå¸¸è§é…ç½®.assets/image-20240119175018672.png)

ä¼˜åŒ–ä¸‹æŒ‡ä¸€ä¸‹default_typeä¸ºtext/html;ğŸ‘‡

![image-20240119175108511](1-nginxå¸¸è§é…ç½®.assets/image-20240119175108511.png)

okï¼Œå¦‚æœæ³¨é‡Šæ‰echoï¼Œå°±æ˜¯index.htmlå†…å®¹äº†

![image-20240119175154033](1-nginxå¸¸è§é…ç½®.assets/image-20240119175154033.png)



ç®€åŒ–é…ç½®ğŸ‘‡

![image-20240119175347006](1-nginxå¸¸è§é…ç½®.assets/image-20240119175347006.png)

å¦‚æœç”¨echoï¼Œå…¶å®ä¸å¿…è¦æŒ‡rootçš„ä»€ä¹ˆæ–‡ä»¶ä¹Ÿæ— éœ€å­˜åœ¨çš„ã€‚



åŒæ ·echoæ’ä»¶å¯ä»¥æ‰“å°å˜é‡

![image-20240122094417340](1-nginxå¸¸è§é…ç½®.assets/image-20240122094417340.png)

![image-20240122101657095](1-nginxå¸¸è§é…ç½®.assets/image-20240122101657095.png)

è§£é‡Šä¸Šå›¾ğŸ‘‡

![image-20240122101641024](1-nginxå¸¸è§é…ç½®.assets/image-20240122101641024.png)

