# ç¬¬5èŠ‚. nginxåå‘ä»£ç†å®ç°



# é˜²ç›—é“¾

ç›—é“¾å°±æ˜¯ä¸€ä¸ªç½‘ç«™è°ƒç”¨å¦ä¸€ä¸ªç½‘ç«™çš„èµ„æº



**æ„å»ºç›—é“¾**

site1ç«™ç‚¹ç›—é“¾site2ç«™ç‚¹é‡Œçš„ä¸€å¼ å›¾ç‰‡

![image-20240206111138310](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206111138310.png)

è¿™æ˜¯ä¸¤ä¸ªä¹‹å‰åšçš„ç«™ç‚¹ğŸ‘†å°±åˆ©ç”¨è¿™ä¸ªç°æˆçš„åšå®éªŒ

![image-20240206111350203](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206111350203.png)

è¿™å°±å®ç°äº†ç›—é“¾ï¼Œ

![image-20240206112043970](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206112043970.png)

å¾ˆæ˜æ˜¾å­˜åœ¨ä¸¤ä¸ªé—®é¢˜â‘ ä¹±ç â‘¡å›¾ç‰‡ä¸èƒ½ç¼©æ”¾äº†ï¼Œ

![image-20240206112800647](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206112800647.png)

![image-20240206113334211](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206113334211.png)

è¿™æ˜¯site1å’Œsite2 log åˆåœ¨ä¸€èµ·å’¯ï¼Œç›—é“¾è¡Œä¸ºå…¶å®æ˜¯ï¼Œç«™åœ¨è¢«ç›—æ–¹çš„è§’åº¦å»é˜²æ­¢ï¼Œæ‰€ä»¥logæ‹†å¼€æ¥ï¼Œå»å¼€è¢«ç›—ç«™ç‚¹site2çš„log

![image-20240206114652752](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206114652752.png)

å¯ä»¥çœ‹åˆ°çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥é˜²æ­¢ç›—é“¾è¡Œäº†çš„



**é˜²æ­¢ç›—é“¾çš„è§£æ”¾æ–¹æ³•ï¼šngx_http_referer_moduleæ¨¡å—æ¥å¼„**

å¤§ä½“æ„æ€å°±æ˜¯å…ˆå®šä¹‰å‡ºå“ªäº›æ˜¯åˆæ³•çš„refererï¼Œæ¯”å¦‚ç™¾åº¦è¿‡æ¥çš„refererè¯´æ˜ä½ å¹¿å‘Šè´¹æ²¡ç™½å‡ºã€‚

ä¸¤ä¸ªå‚æ•°

**valid_referers none|blocked|server_names|string ...;**      # ç”¨æ¥å®šä¹‰åˆæ³•refererçš„å€¼çš„

**none**ï¼šå°±æ˜¯refererä¸ºç©º åˆ¤æ–­ä¸ºåˆæ³•ã€‚ä¸€èˆ¬ç›´æ¥è®¿é—®æŸä¸ªç½‘ç«™refereréƒ½æ˜¯ç©ºçš„ã€‚è‡ªç„¶è¦å†™noneçš„ã€‚

![image-20240206120416349](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206120416349.png)

noneåœ¨æµè§ˆå™¨é‡ŒF12æ˜¯çœ‹ä¸åˆ°çš„å§



![image-20240206120747913](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206120747913.png)



![image-20240206120557421](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206120557421.png)





**blocked**ï¼šå°±æ˜¯refereré‡Œå†™çš„ä¸œè¥¿ä¸æ˜¯å¸¸è§„çš„uriï¼Œè¿™ä¸ªæ²¡è§è¿‡è¿˜



**server_names**ï¼šæœ¬ç½‘ç«™å†…éƒ¨è·³è½¬çš„ï¼Œå°±ä¼šåœ¨refereré‡Œå¸¦ä¸Šè‡ªå·±çš„ä¸»æœºåï¼Œéƒ½æ˜¯è‡ªå®¶äººå•Šã€‚



**arbitrary_string**ï¼šä»»æ„å­—ç¬¦ä¸²ï¼Œç”¨é€šé…ç¬¦çš„æ–¹å¼ã€‚

![image-20240206135745293](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206135745293.png)



**regular_expression** ï¼šä¹Ÿæ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œç”¨regexæ¥åšäº†ï¼Œæ ¼å¼å°±æ˜¯~å¼€å¤´ä»£è¡¨regexã€‚

â€‹																		ä¾‹å¦‚ï¼š        ~.*\.site1\.com





é…ç½®é˜²ç›—é“¾è‚¯å®šåœ¨è¢«ç›—ç«™ç‚¹ä¸Šé…ç½®äº†ğŸ‘‡

```
    valid_referers none block server_names
    *.site2.com site2.* ~\.site2\.
    ~\.google\. ~\.baidu\.;

    if  ($invalid_referer)  {
         return 403 "Forbidden Access";
    }

```

![image-20240206142530884](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206142530884.png)







![image-20240206142854980](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206142854980.png)



![image-20240206143005932](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206143005932.png)



ç„¶åå¦‚æœæ˜¯ä»baiduè·³è¿‡æ¥çš„å°±ä¸ç¦æ­¢è®¿é—®ï¼Œå› ä¸ºåæœ‰å…«ä¹å°±æ˜¯å¹¿å‘Šçš„é’±å•¦ğŸ‘‡

æµ‹è¯•ï¼šä¿®æ”¹site1ä¸ºbaidu

![image-20240206154826262](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206154826262.png)

ä¿®æ”¹æœ¬åœ°hostsæ–‡ä»¶

C:\Windows\System32\drivers\etc      ä¸‹ğŸ‘‡

![image-20240206154608745](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206154608745.png)



ä¸Šå›¾é…ç½®æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºhttp://www.baidu.com/daolian.htmlæ˜¯80è·³443çš„ä¹Ÿå°±æ˜¯è·³åˆ°https://www.site1.comçš„ï¼Œ

![image-20240206155119867](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206155119867.png)

ç„¶åå°±ä¼šå»è®¿é—®https://www.site1.com/daolian.html

ç„¶åå›¾ç‰‡çš„è®¿é—®é‡Œå°±æœ‰

![image-20240206155206461](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206155206461.png)

è¿™æ ·å°±ä¸æ˜¯ä»www.baidu.comè·³è¿‡å»çš„äº†ï¼Œ

æµ‹è¯•çš„è¯å€’ä¸ç”¨æ”¹é…ç½®æ–‡ä»¶ï¼Œç›´æ¥è®¿é—®https://www.baidu.com/daolian.html

è¿™æ ·å°±å¯ä»¥äº†ï¼Œ

![image-20240206155336952](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206155336952.png)



å½“ç„¶è¿™é‡Œsslä¸å®‰å…¨çš„åŸå› ä¹Ÿå¾ˆç®€å•å•Šï¼Œå°±æ˜¯åŸŸåå’Œsslé‡Œçš„ å¤‡ç”¨åç§°ä¸€è‡´ã€‚

![image-20240206155712189](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206155712189.png)





![image-20240206155541825](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206155541825.png)



å¦‚æœå°±è¦å®ç°http://www.baidu.com/daolian.htmlèƒ½å¤Ÿæ‰“å¼€å‘¢

å¯ä»¥ï¼Œå•ç‹¬å†™baiduå°±è¡Œäº†

![image-20240206163545898](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206163545898.png)

![image-20240206163735200](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206163735200.png)









# å¼€å§‹å­¦ä¹ nginxçš„åå‘ä»£ç†å’¯

æ­£å‘ä»£ç†åé¢ä¹Ÿè¦å­¦ä¹ ï¼Œåº”ç”¨åœ¨æ¯”å¦‚æ‰‹æœºçš„sslæŠ¥æ–‡æŠ“åŒ…è¦æŠ“åˆ°å†…å®¹çš„ï¼Œåšsslè§£å¯†çš„ã€‚åè¯è¿™é‡Œè®°ä¸€ä¸‹~



æ®è¯´nginxçš„åä»£è¿˜å¯ä»¥åšå¥åº·æ€§æ£€æŸ¥ï¼Œè¿™ç‚¹æ¯”LVSå¼ºï¼ŒLVSå¥½åƒæ²¡æœ‰å¥åº·æ€§æ£€æŸ¥ï¼Œæ®è¯´å“¦ã€‚

è€Œä¸”nginxå¯ä»¥åšåº”ç”¨å±‚å’ŒTCPå±‚çš„åä»£ï¼Œä¸è¿‡é€Ÿåº¦æ²¡æœ‰LVSå¿«æ®è¯´ã€‚LVSå¥½åƒå·¥ä½œåœ¨å†…æ ¸å±‚çš„ï¼Ÿ

![image-20240206181246911](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206181246911.png)





![image-20240206181536254](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206181536254.png)





![image-20240206181729908](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206181729908.png)







**æ¨¡å—æ”¯æŒ**

![image-20240206181940090](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240206181940090.png)

1ã€proxyã€fastcgiã€uwsgiè¿™äº›éƒ½æ˜¯httpç±»çš„ï¼Œæ‰€ä»¥åå­—éƒ½æ˜¯ngx_httpå¼€å¤´çš„ã€‚

â€‹		1.1 ã€ proxyå°±æ˜¯nginxå¯¹æ¥httpåŸæœ¬åè®®ã€fastcgiå°±æ˜¯nginxå¯¹æ¥phpåè®®ã€uwsgiæ˜¯nginxå¯¹æ¥pythonåè®®

â€‹				1p.1.1ã€ç¼–å†™åŠ¨æ€é¡µé¢ï¼Œå¯ä»¥ç”¨PHPã€pythonã€javaã€

â€‹							å¯¹äºjavaï¼Œå¦‚æœåç«¯æ˜¯ä¸€ä¸ªtomcatç±»ä¼¼çš„ï¼Œè¿™ä¸ªå°±ç”¨ngx_http_proxy_moduleæ¥æ”¯æŒäº†ã€‚



æ‰€ä»¥ï¼š

â€‹		å‰åç«¯æ˜¯java-tomcatä¹‹ç±»ï¼Œå°±ç”¨ngx_http_proxy_moduleäº†

â€‹		å‰åç«¯æ˜¯pythonï¼Œæ¯”å¦‚jangoï¼Œå°±ç”¨ngx_http_uwsgi_modueläº†

â€‹		å‰åç«¯æ˜¯phpï¼Œå°±ç”¨ngx_http_fastcgi_moduleäº†





ngx_stream_proxy_moduleå°±æ˜¯tcpçš„åä»£ï¼Œä¸çŸ¥é“æ˜¯å¦æ”¯æŒudpå“¦/

<img src="5-nginxåå‘ä»£ç†å®ç°.assets/image-20240207103211257.png" alt="image-20240207103211257" style="zoom:50%;" />





### åå‘ä»£ç†åˆ†ä¸ºåŒæ„å’Œå¼‚æ„

![image-20240207143426767](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240207143426767.png)

å¼‚æ„ã€åŒæ„ï¼Œå°±æ˜¯clientè¯·æ±‚çš„åè®®å’Œnginxèº«åçš„åè®®æ˜¯å¦ä¸€æ ·ã€‚

ç”¨æˆ·è¯·æ±‚ï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨çš„80/443ï¼Œä¹Ÿå¯èƒ½æ˜¯mysqlçš„å®¢æˆ·ç«¯3306ã€‚



### ä¸€ä¸ªåº”ç”¨åœºæ™¯

å°±æ˜¯ç¨‹åºå‘˜è¿˜æ˜¯å–œæ¬¢æŠŠipåœ°å€å†™æ­»åœ¨ä»£ç é‡Œï¼Œæ‰€ä»¥å°±è®©ä»–ä»¬å†™æˆnginxçš„åä»£IPï¼Œç„¶ååé¢çš„DBä¹Ÿå¥½æœåŠ¡ä¹Ÿç½¢è¿™äº›IPå¯ä»¥å˜åŠ¨çš„ï¼Œåä»£IPç›¸å¯¹å›ºå®šå”¯ä¸€åŒºåˆ†ç«¯å£å°±è¡Œäº†ï¼Œé™¤äº†è¿™ä¸ªç‚¹ï¼Œè¿˜æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯ä»£ç é‡Œå¯èƒ½éƒ½æ˜¯ä¹Ÿç»™nginxçš„IPç„¶åç«¯å£åŒºåˆ†å°±è¡Œäº†ï¼Œå³ä½¿nginxåä»£IPå¤šä¸ªä¹Ÿæ˜¯ç»Ÿä¸€åœ¨nginxä¸Šçš„ç›¸å¯¹é›†ä¸­ä¾¿äºç®¡ç†çš„ã€‚





### ä¸€ä¸ªç®€å•æ¶æ„

![image-20240207145934769](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240207145934769.png)

å¾ˆæ­£å¸¸çš„ä¸€ä¸ªæ“ä½œï¼šå°±æ˜¯imageå’Œç½‘ç«™ï¼Œä¹Ÿå°±æ˜¯http://images.xxx.comå’Œhttp://www.xxx.comåˆ†å¼€æ¥éƒ¨ç½²çš„ã€‚

ä¸Šå›¾çš„http://images.xxx.comå°†æ¥å°±åªæ”¾é™æ€å›¾ç‰‡ï¼Œé™æ€èµ„æºã€‚å¾ˆå¤šç½‘ç«™éƒ½æ˜¯è¿™ä¹ˆéƒ¨ç½²çš„ã€‚è¿™æ ·ä¹Ÿæ˜¯å°±æ˜¯ä¸åŒèµ„æºåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œä¹Ÿèƒ½å®ç°å¹¶è¡Œä¸‹è½½çš„æ•ˆæœ--å› ä¸ºä¸€ä¸ªæµè§ˆå™¨å‘åŒä¸€ä¸ªåŸŸåå‘èµ·è¯·æ±‚æœ€å¤šæ”¯æŒ5ã€6ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç½‘ç«™é‡Œæ”¾5ã€6ä¸ªèµ„æºé¡¶å¤šå†å¤šä¹Ÿå°±æ˜¯è¦äºŒæ¬¡è¯·æ±‚ä¸‹è½½äº†ã€‚è€Œæ‹†æˆå¤šä¸ªç½‘ç«™å°±å¹¶å‘æ•ˆæœå¥½ã€‚è€Œä¸”æˆ‘è®¤ä¸ºæ‹†æˆå¤šä¸ªé’ˆå¯¹å¤šä¸ªç”¨æˆ·ä¹Ÿæ˜¯å¹¶å‘æ•ˆæœæ›´å¥½å§åº”è¯¥ã€‚



ä¸Šå›¾æ¶æ„è¯´æ˜ï¼š

1ã€ç”¨æˆ·è®¿é—®åŸŸåæ¯”å¦‚http://www.xxx.comé‡Œé¢æ¶‰åŠçš„å›¾ç‰‡å°±æ˜¯å…¶ä»–ç«™ç‚¹URLäº†ã€‚ç½‘ç«™åŸŸåå°±è§£æåˆ°å·¦è¾¹çš„FWçš„å…¬ç½‘IPï¼Œå›¾ç‰‡åŸŸåå°±è§£æåˆ°å³è¾¹çš„FWIPï¼Œè¿™é‡Œæ˜¾ç„¶ä¸æ˜¯æœ€ä½³å®è·µï¼Œæœ€ä½³å®è·µæ˜¯CDNçš„åŠ¨é™åˆ†ç¦»ã€‚

2ã€ç„¶åFWåšDNATæ˜ å°„åˆ°åé¢çš„VIPï¼Œè¿™ä¸ªé‡Œçš„VIPå¯ä»¥æ˜¯LVSæ¥åšï¼Œç„¶åLVSåšTCP/UDPçš„åä»£ï¼Œç„¶åHTTPçš„å°±èµ°TCPåä»£åˆ°nginxï¼Œå†ç”±nginxè¿›è¡Œåä»£ã€‚è¿™æ ·æ— éå°±æ˜¯å››å±‚çš„æµé‡ä¼šèµ°å†…æ ¸LVSå¿«ä¸€ç‚¹ï¼Œä½†æ˜¯å…¶å®HTTPå°±ä¼šå¤šäº†ä¸€å±‚LVSï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å°†LVSå’ŒNGINXå¹¶æ’åšæˆä¸€ä¸ªå±‚çº§çš„ï¼ŒLVSç»™TCP/UDPæœåŠ¡ï¼Œè€Œnginxçµ¦HTTPæœåŠ¡ã€‚

3ã€fwçš„haï¼Œfwè‡ªèº«è§£å†³ï¼Œæ¯”å¦‚HSRPï¼Œæ¯”å¦‚juniperçš„nsrpã€‚

4ã€lvså’Œnginxçš„haå°±æ˜¯ä¾é é€šç”¨åè®®keepaliveã€‚

5ã€åä»£(lvs/nginx)æ¥æ”¶vipè¿›æ¥çš„æµé‡è´Ÿè½½åˆ†æ‹…åˆ°èº«åå†…ç½‘çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚webç½‘ç«™è¿™ç§åŠ¨æ€èµ„æºç«™ç‚¹æ¯”å¦‚imageè¿™ç§é™æ€èµ„æºç«™ç‚¹ã€‚

6ã€æœåŠ¡å™¨æœ¬èº«è¿˜ä¼šå»åé¢æ‰¾DBï¼ŒDBè¿˜éœ€è¦åšé›†ç¾¤ï¼Œè¿™æ ·å¯å®ç°HAï¼›æˆ–è€…ç”¨è¯»å†™åˆ†ç¦»ï¼Œå¦‚æœæ˜¯è¯»å†™åˆ†ç¦»å°±æ˜¯å‰ç½®è°ƒåº¦å™¨ï¼Œè€Œè°ƒåº¦å™¨ä¹Ÿè¦HAï¼ŒåŒæ ·è¯»å†™åˆ†ç¦»è°ƒåº¦å™¨2ä¸ªä¹Ÿéœ€è¦ç”¨keepaliveåšHAçš„ã€‚

keepaliveæ˜¯ä¸€ä¸ªé€šç”¨çš„ä¸œè¥¿ï¼Œå®ç°æµ®åŠ¨IPéƒ½å¯ä»¥ç”¨ã€‚

7ã€é™æ€é¡µé¢å¯ä»¥ç”¨NFSæœåŠ¡å™¨æŒ‚ä¸€ä¸‹å°±è¡Œäº†ã€‚ç„¶åç”¨rsysnc+I notifyæ¥å®ç°å®æ—¶å¤‡ä»½ã€‚https://cloud.tencent.com/developer/article/1373541



## å…·ä½“å®ç°

### ngx_http_proxy_moduleæ¨¡å—åä»£

![image-20240218102112657](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218102112657.png)

![image-20240218102147096](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218102147096.png)

åšåä»£åœ¨192.168.126.132ä¸Šé…ç½®ğŸ‘‡

![image-20240218103732705](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218103732705.png)

![image-20240218103747833](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218103747833.png)



![image-20240218104148390](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218104148390.png)





åä»£å¯¹äºç”¨æˆ·æ¥è®²ï¼Œæ˜¯çœ‹ä¸åˆ°çœŸå®çš„server IPçš„ï¼›



åç«¯æœåŠ¡å™¨è®¤ä¸ºæ˜¯è°åœ¨è®¿é—®å‘¢

![image-20240218104738410](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218104738410.png)

è°ƒåº¦å™¨ä¹Ÿå°±æ˜¯åä»£nginxä¸Šè‚¯å®šæ˜¯å¯ä»¥çœ‹åˆ°çœŸå®çš„ç”¨æˆ·IPçš„ğŸ‘‡

![image-20240218104331671](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218104331671.png)





çœ‹ä¸‹telnet www.site1.com 80çš„æ•ˆæœï¼šåªæœ‰192.168.126.130ä¸Šä¹Ÿå°±æ˜¯è°ƒåº¦å™¨ä¸Šç”±TCPè¿æ¥

![image-20240218105059322](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218105059322.png)

åç«¯server192.168.126.132ä¸Šæ˜¯æ²¡æœ‰çš„

![image-20240218105156975](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218105156975.png)

åŸå› å°±æ˜¯ï¼Œnginxçš„åä»£å†™çš„çš„httpè€Œä¸æ˜¯telnetï¼Œäººå®¶æ˜¯çœ‹åè®®çš„ã€‚



telnetæµ‹è¯•httpçš„æ–¹å¼ğŸ‘‡ï¼Œå¯è§è¯·æ±‚åæ²¡æœ‰æ–­ï¼Œåº”è¯¥èƒ½è¯´æ˜åä»£å’Œåç«¯éƒ½æ”¯æŒé•¿è¿æ¥å§ã€‚

![image-20240218105823517](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218105823517.png)

åä»£ä¸Šçš„logğŸ‘‡

![image-20240218105850708](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218105850708.png)

serverä¸Šçš„logğŸ‘‡

![image-20240218105902323](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218105902323.png)



### é’ˆå¯¹ç‰¹å®šçš„æ–‡ä»¶å¤¹(uri)è¿›è¡Œåä»£è°ƒåº¦-åŠ¨é™åˆ†ç¦»

![image-20240218111709627](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218111709627.png)

ç›¸å½“äºåŠ¨é™åˆ†ç¦»äº†ğŸ‘†åªè¦æ˜¯å›¾ç‰‡åç¼€çš„å°±è°ƒåº¦åˆ°192.168.126.132ä¸Šï¼Œåªè¦æ˜¯apiè·¯å¾„çš„å°±è°ƒåº¦åˆ°133ä¸Š

![image-20240218112142419](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218112142419.png)

æä¸ªå›¾ç‰‡ğŸ‘†

![image-20240218114135307](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218114135307.png)

ğŸ‘†133çš„é¡µé¢å†…å®¹ï¼Œä½†æ˜¯åä»£é‡Œå†™çš„æ˜¯

<img src="5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218114316114.png" alt="image-20240218114316114" style="zoom:33%;" />ä¼šå¯¼è‡´è®¿é—®http://192.168.126.133/apiï¼Œè€Œè¯¥æ–‡ä»¶æ˜¯ä¸å­˜åœ¨çš„ã€‚

æ‰€ä»¥åˆ›å»ºæ‰€éœ€çš„æ–‡ä»¶å¤¹apiï¼Œ

![image-20240218114958355](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218114958355.png)

![image-20240218115006036](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218115006036.png)



æˆ–è€…apiå¹²è„†å°±æ˜¯ä¸ªæ–‡ä»¶ä¹Ÿè¡Œ

![image-20240218114814804](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218114814804.png)

![image-20240218114823593](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218114823593.png)è®¿é—®å›¾ç‰‡çš„å°±ä¼šè°ƒåº¦åˆ°192.168.126.132ä¸ŠğŸ‘‡

![image-20240218114110538](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218114110538.png)



æ³¨æ„

![image-20240218115841873](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218115841873.png)

å¦‚æœå†™æˆ

```
location /api {
	proxy_pass http://192.168.126.133/    # å®é™…è®¿é—®çš„å°±æ˜¯http://192.168.126.133/index.htmläº†ï¼Œæ­¤ä¹ƒæ›¿æ¢ã€‚
}
location /api {
	proxy_pass http://192.168.126.133    # å®é™…è®¿é—®çš„å°±æ˜¯http://192.168.126.133/apiï¼›æˆ–è€…æ˜¯http://192.168.126.133/api/index.html æ­¤ä¹ƒå‡­å€Ÿ
}
location /api {
	proxy_pass http://192.168.126.133/index.html    # å®é™…è®¿é—®çš„å°±æ˜¯http://192.168.126.133/index.htmlã€‚æ­¤ä¹ƒæ›¿æ¢
}


```

![image-20240218122624548](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218122624548.png)



![image-20240218122654785](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218122654785.png)

ä¿®æ”¹åç«¯æœåŠ¡ç›‘å¬çš„ç«¯å£

![image-20240218122849702](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218122849702.png)

å¥½äº†ğŸ‘‡

<img src="5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218122827516.png" alt="image-20240218122827516" style="zoom:50%;" />



å¦‚æœserveré‚£è¾¹ç”¨iptables dropï¼Œæ²¡æœ‰å“åº”ä¼šå¯¼è‡´tcpä¸‰æ¬¡æ¡æ‰‹éƒ½å¤±è´¥ï¼Œè€Œä¸”æ˜¯æ²¡æœ‰å›åº”ï¼Œè¿™æ ·clientç«¯çœ‹åˆ°çš„å°±æ˜¯504æŠ¥é”™ã€‚

![image-20240218124206324](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218124206324.png)

æ‰€ä»¥502å’Œ504çš„åŒºåˆ«ï¼š502serverå¯èƒ½æ²¡æœ‰ç›‘å¬å€’æ˜¯ä¼šæ˜ç¡®å‘Šè¯‰ä½ ä¸€ä¸ªä¿¡æ¯çš„ï¼Œ504å°±æ˜¯è¶…æ—¶äº†ã€‚





![image-20240218142139356](5-nginxåå‘ä»£ç†å®ç°.assets/image-20240218142139356.png)







ä»¥ä¸Šå°±æ˜¯å®ç°äº†åˆå§‹çš„è°ƒåº¦ï¼Œä½†æ˜¯è°ƒåº¦è¿˜è¦æ¶‰åŠ å¥åº·æ£€æŸ¥å’Œå¾€å¥åº·çš„serverä¸Šè°ƒåº¦çš„åŠŸæ•ˆã€‚





