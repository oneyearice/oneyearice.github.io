# ç¬¬3èŠ‚. nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°



# å‹ç¼©

apacheä¹Ÿæ”¯æŒå‹ç¼©

![image-20240125144151279](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125144151279.png)

------------------

![image-20240125143945781](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125143945781.png)

è¿™æ˜¯ğŸ‘†httpdçš„å‹ç¼©ç¯‡ç« 



nginx -tæŸ¥çœ‹ç¼–è¯‘çš„é…ç½®é€‰é¡¹

![image-20240125145453478](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125145453478.png)

é…ç½®å‚æ•°å¦‚ä¸‹ï¼š

gzip on|off  å¼€å…³

gzip_comp_level level     å‹ç¼©æ¯”ä¿®æ”¹ 1åˆ°9ï¼Œ9 æœ€é«˜å‹ç¼©æ¯”ï¼Œ9ä¹Ÿæ˜¯æœ€è€—CPUçš„

è™½ç„¶æ˜¯1-9ï¼Œä½†æ˜¯å‹ç¼©çš„æ•ˆæœä¹Ÿä¸ä¼šå·®å¤ªå¤š

gzip_disable regex ...     åŒ¹é…å®¢æˆ·ç«¯æµè§ˆå™¨ç±»å‹å°±ä¸æ‰§è¡Œå‹ç¼©ï¼Œæ¯”å¦‚gzip_disable "MSIE[1-6]\\.";

gzip_min_length length   å‹ç¼©çš„èµ·ç‚¹ï¼Œä»€ä¹ˆæ ·çš„å¤§å°æ‰å¼€å§‹å‹ç¼©ï¼Œæ¯”å¦‚ï¼100kçš„æ‰å¼€å§‹å‹ç¼©ï¼Œ100Byteså°±åˆ«å‹äº†ï¼Œå‹äº†ä¹Ÿæ²¡å•¥æ•ˆæœã€‚



gzip_http_version 1.0|1.1  æ˜¯æ”¯æŒçš„httpç‰ˆæœ¬

<img src="3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125151438624.png" alt="image-20240125151438624" style="zoom:50%;" />



gzip_buffers number szie   å‹ç¼©çš„æ—¶å€™å¯ç”¨å¤šå¤§çš„ç¼“å†²åŒº

gzip_types mime-type ... é’ˆå¯¹ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œé»˜è®¤åŒ…å«text/htmlçš„æ ¼å¼æ”¯æŒï¼Œä¸è¦å†™ï¼Œå†™äº†åè€ŒæŠ¥é”™ã€‚



gzip_vary on|off   å¦‚æœå¯ç”¨å‹ç¼©äº†ï¼Œæ˜¯å¦åœ¨å“åº”æŠ¥æ–‡é¦–éƒ¨æ’å…¥"Varyï¼šAccept-Encoding"

è§£é‡Šï¼šğŸ‘‡å°±æ˜¯è¯´serverè¦æ’å…¥è¿™ä¸ªæ ‡è®°ï¼Œä»£ç†é‚£è¾¹å°±ä¼šå­˜å‚¨ä¸¤ä¸ªç‰ˆæœ¬çš„webé¡µï¼Œä¸€ä¸ªå‹ç¼©ä¸€ä¸ªä¸å‹ç¼©ï¼Œä»¥æ­¤æ¥å“åº”æ”¯æŒå’Œä¸æ”¯æŒå‹ç¼©çš„clientæµè§ˆå™¨ã€‚å½“ç„¶c-serç›´è¿çš„è¯å°±çœ‹clienté‚£è¾¹æµè§ˆå™¨æ˜¯å¦æ”¯æŒå‹ç¼©äº†æ”¯æŒ-serverå°±å‘é€ç»è¿‡gzipå‹ç¼©çš„é¡µé¢ç‰ˆæœ¬ã€‚

<img src="3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125160601264.png" alt="image-20240125160601264" style="zoom:50%;" />



gzip_proxied off|expied|no-cache|no-store|private|no_last_modified|no_etag|auth|any ...;

nginxåšåä»£çš„æ—¶å€™ï¼Œåç«¯æœåŠ¡å™¨å°†å“åº”æŠ¥æ–‡å‘ç»™nginxï¼Œnginxå†å›ç»™ç”¨æˆ·çš„æ—¶å€™ï¼Œæ˜¯å¦å¯ç”¨å‹ç¼©ï¼Œå°±é è¿™ä¸ªå‚æ•°æ¥åšçš„ã€‚

off  å°±æ˜¯nginxè¿”ç»™clientçš„æ—¶å€™ä¸å‹ç¼©

expied|no-cache|no-store|private|no_last_modified|no_etag|auth|any ...   åç«¯æœåŠ¡å™¨å“åº”æŠ¥æ–‡ä¸­å¸¦æœ‰Cache-Controlå­—æ®µï¼Œç„¶åè¿™ä¸ªå­—æ®µé‡Œçš„å€¼ å†™çš„æ˜¯è¿™äº›çš„æ—¶å€™ï¼Œå°±å¯ç”¨å‹ç¼©ã€‚

<img src="3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125163350082.png" alt="image-20240125163350082" style="zoom:50%;" />



é…ç½®ä¸‹

åŒæ ·ï¼Œå¯ä»¥äº†è§£ä¸‹gzipçš„é€‚é…æ¨¡å—

![image-20240125163747665](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125163747665.png)

gzip çš„æ€»å¼€å…³ é»˜è®¤å°±æ˜¯offçš„ã€‚å…¶ä»–çš„å°±æ˜¯onåçš„ä¸€äº›é€‰é¡¹



![image-20240125164139869](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125164139869.png)



è§‚å¯Ÿè¿™ä¸ªå¤§æ–‡ä»¶ï¼Œçœ‹ä¸‹å‹ç¼©çš„æ•ˆæœ

![image-20240125164525089](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125164525089.png)

curlå¯ä»¥çœ‹åˆ°Content-Lenthå¤§å°å°±æ˜¯æ–‡ä»¶çš„å¤§å°ğŸ‘‡ğŸ‘†

![image-20240125164704005](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125164704005.png)

æ—¢æ˜¯curlå¸¦ä¸Šå‹ç¼©åŠŸèƒ½ï¼Œä¹Ÿæ²¡æœ‰ï¼Œå› ä¸ºserveré‚£è¾¹æ²¡æœ‰å¼€å¯

![image-20240125165131369](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125165131369.png)



ç„¶åserverå¼€å¯å‹ç¼©åŠŸèƒ½

![image-20240125164039972](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125164039972.png)

ç„¶åcurlçœ‹å‹ç¼©è¦å¯ç”¨å‹ç¼©åŠŸèƒ½çš„ï¼Œä¸å¯ç”¨æ˜¯æ²¡æ•ˆæœçš„

![image-20240125164917874](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125164917874.png)

curlå¸¦ä¸Šå‹ç¼©é€‰é¡¹ï¼Œåº”è¯¥æ˜¯æˆåŠŸäº†ï¼Œåªæ˜¯ä¸å†æ˜¾ç¤ºContent-Lengthäº†ã€‚

![image-20240125165242206](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125165242206.png)

![image-20240125170959291](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125170959291.png)



æ‰€ä»¥è¯´å‹ç¼©æ¯”å·®ä¸å¤šå°±è¡Œäº†ğŸ‘‡

![image-20240125171611395](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240125171611395.png)



### SSLè¯ä¹¦ï¼ŒåŠ å¯†

ä¹‹å‰httpdä¹Ÿå¼„è¿‡ï¼Œè‡ªç­¾åè¯ä¹¦è¿˜æŒºæœ‰æ„æ€çš„ï¼Œå®ç°äº†clientçš„å®‰å…¨è®¿é—®çš„å…³é”®ç‚¹ã€‚



ç„¶åè´­ä¹°è¯ä¹¦è¿™å—çš„æƒ…å†µ

é˜¿é‡Œäº‘ä¸Šæœ‰å…¨å¥—çš„è´­ä¹°ç”³è¯·æµç¨‹ï¼Œå¯ä»¥å­¦ä¹ ä¸‹ï¼Œä½†æ˜¯ä¹°ä¸ä¸€å®šï¼Œéœ€è¦çœ‹å“ªé‡Œæ€§ä»·æ¯”é«˜ã€‚

apacheåšsslï¼Œserverä¸Šæ˜¯é…ç½®3ä¸ªæ–‡ä»¶ï¼šcaè¯ä¹¦ã€æœåŠ¡å™¨è¯ä¹¦ã€æœåŠ¡å™¨ç§é’¥

nginxåšsslï¼ŒæœåŠ¡å™¨è¯ä¹¦ã€æœåŠ¡å™¨ç§é’¥



å®ç°sslæ˜¯ç”¨çš„ngx_http_ssl_moduleæ¨¡å—

**â‘ ssl on|offï¼Œ   sslå¼€å…³ï¼Œä¸æ¨èï¼Œå»ºè®®ä½¿ç”¨listenæŒ‡ä»¤ï¼Œå’Œhttpdä¸€æ · listen 443 ssl**

![image-20240126180128632](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240126180128632.png)

httpdå°±æ˜¯listen 443 https ï¼Œä¸æ˜¯ä¸€ä¸ªæ„æ€å˜›ã€‚



**â‘¡ssl_certificate_file** å’Œ **ssl_certificate_key file**

æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶ï¼›ä»ä¾›åº”å•†è´­ä¹°åä¼šå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶ï¼Œä¸€ä¸ªç§é’¥key



**â‘¢ssl_protocols**

æ”¯æŒçš„sslåŠ å¯†åè®®ï¼Œé»˜è®¤å°±è¡Œäº†

**â‘£ssl_session_cache **

åŠ é€ŸæœåŠ¡å™¨å“åº”é€Ÿåº¦çš„å§åº”è¯¥æ˜¯ï¼Œ

![image-20240126181350636](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240126181350636.png)



**â‘¤ssl_session_timeout **

å®¢æˆ·ç«¯é“¾æ¥å¯ä»¥å¤ç”¨ssl session cacheä¸­ç¼“å­˜çš„æœ‰æ•ˆæ—¶é•¿ï¼Œé»˜è®¤5m

![image-20240126181858915](3-nginxçš„å‹ç¼©å’ŒhttpsåŠ å¯†å®ç°.assets/image-20240126181858915.png)





## ä¸‹é¢å¼€å§‹å®éªŒ

è¿˜æ˜¯ä½¿ç”¨è‡ªç­¾åè¯ä¹¦å’¯



