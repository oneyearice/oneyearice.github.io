# ç¬¬2èŠ‚. ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†

## /etc/shaowå­—æ®µè¯´æ˜

```shell
useradd -r ming
[09:19:15 root@localhost ~]#echo cisco | passwd --stdin ming
Changing password for user ming.
passwd: all authentication tokens updated successfully.
```

```
ming:$6$AUsIFTgTuY/hWn8Y$0PgiuhWLxBGeGRtbd/Niz5R1EsMRvV3gdSRT45jnXMyZisgBzcCybETswhJzuuUQeIPkO/gMzo3rKyXvRAE6h.:19008::::::

---ä¸Šé¢æ˜¯rocke-linuxå¤åˆ¶è¿‡æ¥çš„---ä¸‹é¢æ˜¯centos-----

ming:$6$nfkcZ5x7$Le5WQnLSUiJbw2tdXiilhvVZFGy69iuzKQq2XoA84jrHtrOp8fwQgMyunGIt1wQimPf37xdUL7B6rCOvpSaDE0:19008:0:99999:7:::
[root@centos7 ~]#

```

![image-20220116091008275](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116091008275.png)

![image-20220116092105230](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116092105230.png)

è¿™äº›å­—æ®µçš„å¸®åŠ©ä¿¡æ¯å¯é€šè¿‡man 5 shadowè·å¾—



```
$6	ï¼šè¡¨ç¤ºsha512
$1	ï¼šè¡¨ç¤ºmd5
```

```
ä½ æ”¹å£ä»¤çš„æ—¶é—´è·ç¦»1970-1-1å·çš„æ—¶é—´

date of last password change
           The date of the last password change, expressed as the number of days since Jan 1, 1970 00:00 UTC.

[09:25:26 root@localhost ~]#echo `date +%s`/86400 |bc
19008
è¿™å°±æ˜¯ä¸Šå›¾mingç”¨æˆ·çš„19008çš„ç”±æ¥
```

```
 minimum password age
 ç”¨æˆ·å¿…é¡»ç­‰å¤šä¹…æ‰èƒ½ä¿®æ”¹å£ä»¤ï¼Œ0å°±æ˜¯å¯ä»¥ç«‹å³ä¿®æ”¹å¯†ç ï¼Œä»¥å¤©ä¸ºå•ä½ï¼Œcentos7é‡Œé»˜è®¤æ˜¯0ï¼Œrocke-linuxé»˜è®¤ä¸ºç©º
 
 maximum password age
 ç”¨æˆ·ä¸æ”¹å¯†ç ï¼Œå¯†ç å¤šä¹…åˆ°æœŸï¼Œä»¥å¤©ä¸ºå•ä½ï¼Œcentos7é»˜è®¤99999ï¼Œrocke-linuxé»˜è®¤ä¸ºç©º
 
 password warning period
 ä¸Šé¢çš„æœ€å¤§å¯†ç æ—¶é—´æ„å‘³ç€è¿‡æœŸï¼Œè€Œè¿‡æœŸå‰æå‰7å¤©ä¼šæé†’ä½ ä¿®æ”¹å¯†ç 
 
 
```

[root@centos7 ~]# date -s "+5 day"
Fri Jan 21 09:40:55 CST 2022
[root@centos7 ~]# date

![image-20220116094319266](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116094319266-16422974002191.png) 

ç„¶åå†å°†æœ¬åœ°æ—¶é—´å»¶å10å¤©ï¼Œæ­¤æ—¶åœ¨ç”¨mingç™»å…¥çœ‹çœ‹

[root@centos7 ~]# date -s "+5 day"
Wed Jan 26 09:44:25 CST 2022
[root@centos7 ~]# date -s "+5 day"
Mon Jan 31 09:45:03 CST 2022
[root@centos7 ~]#

![image-20220116094649234](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116094649234.png)  

```
password inactivity period
å›´ç»•ç€å¯†ç è¿‡æœŸæ—¶é—´--maximum password ageï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´Xå¤©å°±ç¦ç”¨è¯¥è´¦å·ï¼Œè¿™ä¸ªXå°±æ˜¯password inactivity periodçš„æ„æ€ã€‚
```

ming:$6$nfkcZ5x7$Le5WQnLSUiJbw2tdXiilhvVZFGy69iuzKQq2XoA84jrHtrOp8fwQgMyunGIt1wQimPf37xdUL7B6rCOvpSaDE0:19008:0:10:7:<font color=red>5</font>::

![image-20220116095656784](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116095656784.png) 

```
account expiration date
è´¦æˆ·æœ‰æ•ˆæœŸï¼Œå‰é¢éƒ½æ˜¯é’ˆå¯¹å¯†ç è¿‡æœŸçš„ï¼Œè¿™ä¸ªå‚æ•°æ˜¯é’ˆå¯¹è´¦å·çš„
```

![image-20220116100022262](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116100022262.png) 

æ³¨æ„è¿™é‡Œå’Œå‰ä¸€å¼ å›¾çš„åŒºåˆ«ï¼Œå·²ç»ä¸å†è¯´authenticationçš„äº‹äº†ï¼Œç›´æ¥è¯´çš„äº‹è´¦å·æŒ‚äº†ã€‚



## /etc/groupå’Œ/etc/gshadow

```
dbus:x:81:
polkitd:x:998:
ssh_keys:x:997:
sshd:x:74:
postdrop:x:90:
postfix:x:89:
user1:x:1000:
ming:x:1001:
[root@centos7 ~]# cat /etc/group

```

```
systemd-journal:!::
systemd-network:!::
dbus:!::
polkitd:!::
ssh_keys:!::
sshd:!::
postdrop:!::
postfix:!::
user1:!::
ming:!::
[root@centos7 ~]# cat /etc/gshadow

```

ç»„è®¾ç½®å£ä»¤æ˜¯ç»™æ™®é€šç”¨æˆ·åŠ ç»„çš„æƒé™ï¼Œ

é™„åŠ ç»„æ˜¾ç¤ºåœ¨/etc/groupé‡Œçš„è¡Œæœ€åä¸€ä¸ªå­—æ®µ

```
ming:x:1001:user1

user1ç”¨æˆ·å°±åŠ å…¥è¿›äº†mingè¿™ä¸ªç»„ï¼Œmingå°±æ˜¯user1çš„é™„åŠ ç»„
```

```
/etc/gshadow  å­˜æ”¾ç»„å£ä»¤çš„æ–‡ä»¶
ming:!!::user1,user2,user3

!!ç»„å¯†ç ç¦ç”¨çš„ï¼Œä¸èƒ½é€šè¿‡ç»„å£ä»¤æ¥å¾€é‡ŒåŠ æˆå‘˜ï¼Œåªèƒ½æ˜¯rootç®¡ç†äº†
::é‡Œæ”¾çš„æ˜¯ç®¡ç†å‘˜è´¦å·ï¼Œæ¯ä¸ªç»„å¯ä»¥è®¾ç½®ç®¡ç†å‘˜,ç”¨æ¥æ·»åŠ åˆ é™¤ç»„æˆå‘˜ï¼Œé»˜è®¤ä¸ºç©ºå°±åªæœ‰rootç®¡ç†
user1,user2,user3å°±æ˜¯å’Œ/etc/groupä¸€æ ·ï¼ŒåŠ å…¥è¯¥ç»„çš„æˆå‘˜å°±ç½—åˆ—åœ¨è¿™é‡Œ
```

## éšæœºå£ä»¤çš„äº§ç”Ÿ

```shell
[root@centos7 ~]# openssl rand -base64 9
rvgumQ+4U67t
[root@centos7 ~]# openssl rand -base64 9
328culZ3wpV1


```

```shell
[root@centos7 ~]# yum -y install expect
æŸ¥çœ‹manæ‰‹å†Œï¼š
FLAGS
       The -l flag defines the length of the password.  The default is 9.  The following example  creates  a  20  character
       password.

            mkpasswd -l 20

       The  -d  flag  defines  the minimum number of digits that must be in the password.  The default is 2.  The following
       example creates a password with at least 3 digits.

            mkpasswd -d 3

       The -c flag defines the minimum number of lowercase alphabetic characters that must be in the password.  The default
       is 2.

       The -C flag defines the minimum number of uppercase alphabetic characters that must be in the password.  The default
       is 2.

EXAMPLE
       The following example creates a 15-character password that contains at least 3 digits and 5 uppercase characters.

            mkpasswd -l 15 -d 3 -C 5
```

```
[root@centos7 ~]# mkpasswd -l 15 -d 3 -C 5
\Dpbel2VZa8Dv9W
[root@centos7 ~]# mkpasswd -l 15 -d 3 -C 5
m0hsZaXZ*O1Dap9
[root@centos7 ~]# mkpasswd -l 15 -d 3 -C 5
zBfuS0evQP6x1H/

```

```
C:\Users\MingYi>net accounts
å¼ºåˆ¶ç”¨æˆ·åœ¨æ—¶é—´åˆ°æœŸä¹‹åå¤šä¹…å¿…é¡»æ³¨é”€?:     ä»ä¸
å¯†ç æœ€çŸ­ä½¿ç”¨æœŸé™(å¤©):                   0
å¯†ç æœ€é•¿ä½¿ç”¨æœŸé™(å¤©):                  42
å¯†ç é•¿åº¦æœ€å°å€¼:                        0
ä¿æŒçš„å¯†ç å†å²è®°å½•é•¿åº¦:               None
é”å®šé˜ˆå€¼:                            ä»ä¸
é”å®šæŒç»­æ—¶é—´(åˆ†):                      30
é”å®šè§‚æµ‹çª—å£(åˆ†):                      30
è®¡ç®—æœºè§’è‰²:                    WORKSTATION
å‘½ä»¤æˆåŠŸå®Œæˆã€‚
```

![image-20220116123018266](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116123018266.png) 

```
æ­£è¦æ”¹è¿™ä¸ªæ—¶é—´ï¼Œä¸æ¨èä¸Šæ–‡çš„ç›´æ¥ä¿®æ”¹/etc/shadowï¼Œè€Œæ˜¯ç”¨å‘½ä»¤å»æ”¹
[12:33:30 root@localhost ~]#chage ming
Changing the aging information for ming
Enter the new value, or press ENTER for the default

        Minimum Password Age [-1]: 2
        Maximum Password Age [-1]: 33
        Last Password Change (YYYY-MM-DD) [2022-01-16]:
        Password Expiration Warning [-1]: 7
        Password Inactive [-1]:
        Account Expiration Date (YYYY-MM-DD) [-1]: 2023-01-16
[12:34:26 root@localhost ~]#

è¿™é‡Œrockety-linuxè¿˜å¼„å‡ºä¸ª-1å‡ºæ¥ï¼Œå‘µå‘µï¼Œåæ­£ä¼°è®¡ä¹Ÿæ˜¯ä¸é™åˆ¶çš„æ„æ€
[12:36:06 root@localhost ~]#getent shadow ming
ming:$6$AUsIFTgTuY/hWn8Y$0PgiuhWLxBGeGRtbd/Niz5R1EsMRvV3gdSRT45jnXMyZisgBzcCybETswhJzuuUQeIPkO/gMzo3rKyXvRAE6h.:19008:2:33:7::19373:
[12:36:13 root@localhost ~]#
[12:36:26 root@localhost ~]#getent passwd ming
ming:x:992:988::/home/ming:/bin/bash
[12:36:34 root@localhost ~]#
[12:36:36 root@localhost ~]#getent group ming
ming:x:988:
[12:36:48 root@localhost ~]#getent gshadow ming
ming:!::
[12:36:53 root@localhost ~]#
[12:36:54 root@localhost ~]#getent passwd ming root
ming:x:992:988::/home/ming:/bin/bash
root:x:0:0:root:/root:/bin/bash
[12:37:02 root@localhost ~]#

```

```
vipwå’Œvigr ç¼–è¾‘passwdå’Œgroupçš„æ¨èå‘½ä»¤
pwckå’Œgrpck  æ£€æŸ¥passwdå’Œgroupçš„å‘½ä»¤


[12:38:19 root@localhost ~]#pwck
[user 'cockpit-ws': directory '/nonexisting' does not exist
user 'cockpit-wsinstance': directory '/nonexisting' does not exist
user 'ming': directory '/home/ming' does not exist
pwck: no changes
[12:39:02 root@localhost ~]#grpck
[12:39:11 root@localhost ~]#ll /home/
total 0

```

## groupadd åˆ›å»ºç»„

```
åˆ›å»ºç»„
[13:39:41 root@localhost ~]#groupadd admins

[13:39:50 root@localhost ~]#getent  group admins
admins:x:1000:
[13:40:00 root@localhost ~]#

åˆ›å»ºç³»ç»Ÿç»„
[13:40:46 root@localhost ~]#groupadd -r mysql
[13:40:50 root@localhost ~]#
[13:40:52 root@localhost ~]#getent group mysql
mysql:x:987:
[13:40:55 root@localhost ~]#

ä¿®æ”¹ç»„å
[13:42:45 root@localhost ~]#getent group admins
admins:x:1000:
[13:42:50 root@localhost ~]#groupmod -n mgmt admins
[13:42:56 root@localhost ~]#getent group mgmt
mgmt:x:1000:

åˆ é™¤ç»„
[13:44:06 root@localhost ~]#getent group mgmt
mgmt:x:1000:
[13:44:08 root@localhost ~]#getent group mysql
mysql:x:987:
[13:44:10 root@localhost ~]#groupdel mgmt
[13:44:18 root@localhost ~]#groupdel mysql
[13:44:20 root@localhost ~]#getent group mysql
[13:44:23 root@localhost ~]#getent group mgmt

åˆ ä¸æ‰ç»„çš„åŸå› 
[13:49:33 root@localhost ~]#groupdel ming
groupdel: cannot remove the primary group of user 'ming'
æ˜¯å› ä¸ºæœ‰ç”¨æˆ·å°†mingä½œä¸ºä¸»ç»„ï¼Œè¿™ä¸ªç”¨æˆ·å°±æ˜¯mingè‡ªå·±ã€‚æ˜¯useraddåˆ›å»ºmingçš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆçš„ä¸»ç»„ã€‚
[13:49:43 root@localhost ~]#useradd ming2
[13:51:05 root@localhost ~]#getent group ming2
ming2:x:1000:
[13:51:23 root@localhost ~]#groupdel ming2
groupdel: cannot remove the primary group of user 'ming2'
[13:51:32 root@localhost ~]#userdel ming2
[13:51:39 root@localhost ~]#getent group ming2
[13:51:45 root@localhost ~]#ll /home/
total 0
drwx------. 2 1000 1000 62 Jan 16 13:51 ming2
userdel åˆ é™¤ç”¨æˆ·è¿å¸¦ç»„ï¼Œä½†ä¸ä¼šè¿å¸¦å®¶ç›®å½•ï¼Œæ‰€ä»¥å…³äºåˆ›å»ºç”¨æˆ·å’Œåˆ é™¤ç”¨æˆ·çš„æ—¶å€™è¦æ³¨æ„å®¶ç›®å½•æ˜¯å¦è¿å¸¦ç”Ÿæˆå’Œåˆ é™¤

man useradd

-r, --system
           Create a system account.

           System users will be created with no aging information in /etc/shadow, and their numeric identifiers are chosen
           in the SYS_UID_MIN-SYS_UID_MAX range, defined in /etc/login.defs, instead of UID_MIN-UID_MAX (and their GID
           counterparts for the creation of groups).

           Note that useradd will not create a home directory for such a user, regardless of the default setting in
           /etc/login.defs (CREATE_HOME). You have to specify the -m options if you want a home directory for a system
           account to be created.


```

**man userdel**

```



       -f, --force
           This option forces the removal of the user account, even if the user is still logged in. It also forces userdel
           to remove the user's home directory and mail spool, even if another user uses the same home directory or if the
           mail spool is not owned by the specified user. If USERGROUPS_ENAB is defined to yes in /etc/login.defs and if a
           group exists with the same name as the deleted user, then this group will be removed, even if it is still the
           primary group of another user.

           Note: This option is dangerous and may leave your system in an inconsistent state.

       -h, --help
           Display help message and exit.

       -r, --remove
           Files in the user's home directory will be removed along with the home directory itself and the user's mail
           spool. Files located in other file systems will have to be searched for and deleted manually.

           The mail spool is defined by the MAIL_DIR variable in the login.defs file.

```

```
[14:01:12 root@localhost ~]#useradd ming2
useradd: warning: the home directory already exists.
Not copying any file from skel directory into it.
Creating mailbox file: File exists
[14:01:18 root@localhost ~]#
[14:01:18 root@localhost ~]#
[14:01:18 root@localhost ~]#getent passwd ming2
ming2:x:1000:1000::/home/ming2:/bin/bash
[14:01:22 root@localhost ~]#
[14:01:23 root@localhost ~]#ll /home/
total 0
drwx------. 2 ming2 ming2 62 Jan 16 13:51 ming2
[14:01:25 root@localhost ~]#
[14:01:26 root@localhost ~]#userdel -r ming2
[14:01:30 root@localhost ~]#ll /home/
total 0
[14:01:32 root@localhost ~]#getent passwd ming2
[14:01:39 root@localhost ~]#getent group ming2
[14:01:43 root@localhost ~]#

```

## ç”¨æˆ·åˆ›å»ºç®¡ç†

```
[14:03:53 root@localhost ~]#rpm -q --scripts postfix
preinstall scriptlet (using /bin/sh):
# Add user and groups if necessary
/usr/sbin/groupadd -g 90 -r postdrop 2>/dev/null
/usr/sbin/groupadd -g 89 -r postfix 2>/dev/null
/usr/sbin/groupadd -g 12 -r mail 2>/dev/null
/usr/sbin/useradd -d /var/spool/postfix -s /sbin/nologin -g postfix -G mail -M -r -u 89 postfix 2>/dev/null

-------------------------
-g 90  gid
-r æŒ‡å®šä¸ºç³»ç»Ÿç»„

```

<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117194619550.png" alt="image-20220117194619550" style="zoom:67%;" /> <img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117194644837.png" alt="image-20220117194644837" style="zoom:67%;" /> 







**useraddçš„é€‰é¡¹å­¦ä¹ **

```
/usr/sbin/useradd -d /var/spool/postfix -s /sbin/nologin -g postfix -G mail -M -r -u 89 postfix 2>/dev/null
```

-u 89  ï¼š æŒ‡å®šç”¨æˆ·UIDä¸º89

-s  : æŒ‡å®šshellç±»å‹

-o ï¼š å¿½ç•¥uidå”¯ä¸€æ€§çš„æ£€æŸ¥

```
[14:12:58 root@localhost ~]#getent passwd root
root:x:0:0:root:/root:/bin/bash
[14:13:09 root@localhost ~]#useradd -u 0 ming3
useradd: UID 0 is not unique
[14:13:20 root@localhost ~]#getent passwd ming3
[14:13:36 root@localhost ~]#useradd -u 0 -o ming3
[14:13:42 root@localhost ~]#getent passwd ming3
ming3:x:0:1000::/home/ming3:/bin/bash
[14:13:43 root@localhost ~]#getent passwd root
root:x:0:0:root:/root:/bin/bash
[14:14:47 root@localhost ~]#id root
uid=0(root) gid=0(root) groups=0(root)
[14:14:49 root@localhost ~]#id ming3
uid=0(root) gid=0(root) groups=0(root)
[14:14:51 root@localhost ~]#
```

åˆ›å»ºç³»ç»ŸæœåŠ¡ï¼Œ

```
[14:18:18 root@localhost ~]#useradd -r -s /sbin/nologin mysql
[14:18:26 root@localhost ~]#getent passwd mysql
mysql:x:991:987::/home/mysql:/sbin/nologin
```

é»˜è®¤è¡Œä¸ºæ˜¯useraddä¸æŒ‡å®šä¸»ç»„ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»ºå’Œç”¨æˆ·ååŒåçš„ä¸»ç»„

```
[14:21:35 root@localhost ~]#useradd alice
[14:21:48 root@localhost ~]#id alice
uid=1000(alice) gid=1000(alice) groups=1000(alice)

```

é€šè¿‡-gæŒ‡å®šä¸»ç»„ï¼Œå°±ä¸ä¼šè‡ªåŠ¨åˆ›å»ºä¸»ç»„äº†ï¼ŒæŒ‡å®šçš„ä¸»è¦äº‹å…ˆå­˜åœ¨

[14:22:33 root@localhost ~]#useradd tom -g alice
[14:22:58 root@localhost ~]#id tom
uid=1001(tom) gid=1000(alice) groups=1000(alice)

-G æ˜¯é™„åŠ ç»„

```
[14:24:10 root@localhost ~]#groupadd g1
[14:24:13 root@localhost ~]#groupadd g2
[14:24:21 root@localhost ~]#groupadd g3
[14:24:23 root@localhost ~]#
[14:24:24 root@localhost ~]#useradd jack -g alice -G g1,g2
[14:24:44 root@localhost ~]#id jack
uid=1002(jack) gid=1000(alice) groups=1000(alice),1001(g1),1002(g2)
[14:26:44 root@localhost ~]#getent group | grep jack
g1:x:1001:jack
g2:x:1002:jack
[14:26:49 root@localhost ~]#getent gshadow | grep jack
g1:!::jack
g2:!::jack
[14:26:55 root@localhost ~]#
```

-N ä¸åˆ›å»ºåŒåçš„ä¸»ç»„ï¼Œä¹Ÿä¸æŒ‡å®šï¼Œå°±é»˜è®¤åˆ›å»ºä¸€ä¸ªusers

```shell
[14:28:06 root@localhost ~]#useradd rose -N
[14:28:15 root@localhost ~]#id rose
uid=1003(rose) gid=100(users) groups=100(users)
[14:28:18 root@localhost ~]#
```

çœ‹ä¸‹windowsçš„åˆ›å»ºç”¨æˆ·çš„é»˜è®¤è¡Œä¸ºï¼Œé»˜è®¤å°±æ˜¯å’Œlinuxçš„useradd -Nä¸€æ ·çš„ï¼Œéƒ½æ˜¯å°†æ–°å»ºç”¨æˆ·æ”¾åˆ°usersç»„ä¸‹é¢ã€‚

```cmd
C:\WINDOWS\system32>net user test001 passwd001 /add
å‘½ä»¤æˆåŠŸå®Œæˆã€‚


C:\WINDOWS\system32>net user

\\DESKTOP-5T7A4A1 çš„ç”¨æˆ·å¸æˆ·

-------------------------------------------------------------------------------
___VMware_Conv_SA___     admin                    Administrator
ciscoacvpnuser           DefaultAccount           Guest
MingYi                   named                    test001
WDAGUtilityAccount
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

C:\WINDOWS\system32>net localgroup users
åˆ«å     users
æ³¨é‡Š     é˜²æ­¢ç”¨æˆ·è¿›è¡Œæœ‰æ„æˆ–æ— æ„çš„ç³»ç»ŸèŒƒå›´çš„æ›´æ”¹ï¼Œä½†æ˜¯å¯ä»¥è¿è¡Œå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åº

æˆå‘˜

-------------------------------------------------------------------------------
NT AUTHORITY\Authenticated Users
NT AUTHORITY\INTERACTIVE
test001
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

C:\WINDOWS\system32>net user

\\DESKTOP-5T7A4A1 çš„ç”¨æˆ·å¸æˆ·

-------------------------------------------------------------------------------
___VMware_Conv_SA___     admin                    Administrator
ciscoacvpnuser           DefaultAccount           Guest
MingYi                   named                    test001
WDAGUtilityAccount
å‘½ä»¤æˆåŠŸå®Œæˆã€‚


C:\WINDOWS\system32>net user test001 /del
å‘½ä»¤æˆåŠŸå®Œæˆã€‚


C:\WINDOWS\system32>net user

\\DESKTOP-5T7A4A1 çš„ç”¨æˆ·å¸æˆ·

-------------------------------------------------------------------------------
___VMware_Conv_SA___     admin                    Administrator
ciscoacvpnuser           DefaultAccount           Guest
MingYi                   named                    WDAGUtilityAccount
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

```

## å…³äºå®¶ç›®å½•

### ä¸å¸¦å®¶ç›®å½•çš„æ–¹å¼ï¼Œuseradd -r -s /sbin/nologin mysql

```
[14:35:33 root@localhost ~]#getent passwd | tail -5
mysql:x:991:987::/home/mysql:/sbin/nologin
alice:x:1000:1000::/home/alice:/bin/bash
tom:x:1001:1000::/home/tom:/bin/bash
jack:x:1002:1000::/home/jack:/bin/bash
rose:x:1003:100::/home/rose:/bin/bash
[14:35:38 root@localhost ~]#ll /home/
total 0
drwx------. 2 alice alice 62 Jan 16 14:21 alice
drwx------. 2 jack  alice 62 Jan 16 14:24 jack
drwx------. 2 rose  users 62 Jan 16 14:28 rose
drwx------. 2 tom   alice 62 Jan 16 14:22 tom
[14:35:43 root@localhost ~]#

```

### æŒ‡å®šåˆ›å»ºå®¶ç›®å½•

```
[14:43:13 root@localhost ~]#useradd -d /data/jerryhome jerry
[14:43:18 root@localhost ~]#ll /data/jerryhome/ -d
drwx------. 2 jerry jerry 62 Jan 16 14:43 /data/jerryhome/
[14:43:29 root@localhost ~]#id jerry
uid=1004(jerry) gid=1004(jerry) groups=1004(jerry)
[14:43:32 root@localhost ~]#

```

### æœ‰ä¸ªå¥‡æ€ªçš„è¡Œä¸ºï¼Œå°±æ˜¯åˆ›å»ºç”¨æˆ·çš„æ—¶å€™æŒ‡å®šå®¶ç›®å½•ï¼Œä½†æ˜¯å¹¶ä¸åˆ›å»º

```
[14:46:22 root@localhost ~]#useradd -d /data/xiaohong -M xiaohong
[14:46:36 root@localhost ~]#id xiaohong
uid=1005(xiaohong) gid=1005(xiaohong) groups=1005(xiaohong)
[14:46:38 root@localhost ~]#ll /data/xiao*
ls: cannot access '/data/xiao*': No such file or directory
```

### è¿˜æœ‰ä¸ä¹‹ç›¸åçš„æ€è·¯ï¼Œuseradd -ræ˜¯ç³»ç»Ÿç”¨æˆ·ä¸ä¼šåˆ›å»ºå®¶ç›®å½•ï¼Œ-må°±æ˜¯ä¼šåˆ›å»ºäº†

```
[14:47:50 root@localhost ~]#useradd -r zhangsan
[14:48:09 root@localhost ~]#id zhangsan
uid=990(zhangsan) gid=986(zhangsan) groups=986(zhangsan)
[14:48:10 root@localhost ~]#ll /home/
total 0
drwx------. 2 alice alice 62 Jan 16 14:21 alice
drwx------. 2 jack  alice 62 Jan 16 14:24 jack
drwx------. 2 rose  users 62 Jan 16 14:28 rose
drwx------. 2 tom   alice 62 Jan 16 14:22 tom
[14:48:14 root@localhost ~]#
[14:48:14 root@localhost ~]#useradd -r lisi -m
[14:48:33 root@localhost ~]#ll /home/lisi/ -d
drwx------. 2 lisi lisi 62 Jan 16 14:48 /home/lisi/
[14:48:38 root@localhost ~]#
[14:49:16 root@localhost ~]#useradd -r -m -d /data/ada ada
[14:49:20 root@localhost ~]#ll /data/ada -d
drwx------. 2 ada ada 62 Jan 16 14:49 /data/ada
[14:49:24 root@localhost ~]#id ada
uid=988(ada) gid=988(ada) groups=988(ada)
[14:49:26 root@localhost ~]#

```

### -c   : æè¿°ä¿¡æ¯ï¼Œæœ‰ç‚¹ç”¨çš„ï¼Œè®²ç©¶äººå£«çš„ä¸“ç”¨

```
[14:51:48 root@localhost ~]#useradd -c "sbZhuanYong" sb001
[14:52:21 root@localhost ~]#getent passwd sb001
sb001:x:1006:1006:sbZhuanYong:/home/sb001:/bin/bash
[14:52:26 root@localhost ~]#

```

å¦‚æœæ˜¯centoså¯ä»¥yum -y install fingerç„¶åæŸ¥çœ‹ç”¨æˆ·æè¿°ä¿¡æ¯ï¼Œrokey-linuxå¥½åƒyumä¸äº†fingerï¼Œyumæºrockyçš„é‡Œé¢è²Œä¼¼æ²¡æœ‰finger çš„rpmåŒ…ã€‚

```shell
[root@centos7 ~]# useradd -c 'dalaozhuanyong' dalao001
[root@centos7 ~]# getent passwd dalao001
dalao001:x:1002:1002:dalaozhuanyong:/home/dalao001:/bin/bash
[root@centos7 ~]#
[root@centos7 ~]# finger dalao001
Login: dalao001                         Name: dalaozhuanyong
Directory: /home/dalao001               Shell: /bin/bash
Never logged in.
No mail.
No Plan.
[root@centos7 ~]#

[root@centos7 ~]# chfn dalao001
Changing finger information for dalao001.
Name [dalaozhuanyong]:
Office []: !wgame
Office Phone []: 110
Home Phone []: 110

Finger information changed.
[root@centos7 ~]# finger dalao001
Login: dalao001                         Name: dalaozhuanyong
Directory: /home/dalao001               Shell: /bin/bash
Office: !wgame, 110                     Home Phone: 110
Never logged in.
No mail.
No Plan.
[root@centos7 ~]# getent passwd dalao001
dalao001:x:1002:1002:dalaozhuanyong,!wgame,110,110:/home/dalao001:/bin/bash
[root@centos7 ~]#

```

æ‰€ä»¥äººå®¶postfixçš„å®‰è£…åæˆ–è€…å‰ï¼Œè·‘çš„è„šæœ¬é‡Œçš„useraddå°±èƒ½ç†è§£äº†

```
[root@centos7 ~]# rpm -q --scripts postfix
preinstall scriptlet (using /bin/sh):
# Add user and groups if necessary
/usr/sbin/groupadd -g 90 -r postdrop 2>/dev/null
/usr/sbin/groupadd -g 89 -r postfix 2>/dev/null
/usr/sbin/groupadd -g 12 -r mail 2>/dev/null
/usr/sbin/useradd -d /var/spool/postfix -s /sbin/nologin -g postfix -G mail -M -r -u 89 postfix 2>/dev/null

```

```
[15:08:55 root@localhost yum.repos.d]#yum -y remove postfix

[15:10:09 root@localhost yum.repos.d]#groupadd -r postfix
[15:11:58 root@localhost yum.repos.d]#groupadd postfix-1
[15:12:02 root@localhost yum.repos.d]#
[15:12:03 root@localhost yum.repos.d]#getent group postfix
postfix:x:984:
[15:12:09 root@localhost yum.repos.d]#getent group postfix-1
postfix-1:x:1007:
[15:12:12 root@localhost yum.repos.d]#
[15:12:16 root@localhost yum.repos.d]#id postfix
id: â€˜postfixâ€™: no such user
[15:12:19 root@localhost yum.repos.d]#/usr/sbin/useradd -d /var/spool/postfix -s /sbin/nologin -g postfix -G mail -M -r -u 89 postfix
[15:12:23 root@localhost yum.repos.d]#id postfix
uid=89(postfix) gid=984(postfix) groups=984(postfix),12(mail)
[15:12:28 root@localhost yum.repos.d]#ll /home/pos*
ls: cannot access '/home/pos*': No such file or directory
[15:12:33 root@localhost yum.repos.d]#ll /var/spool/pos*
ls: cannot access '/var/spool/pos*': No such file or directory
[15:12:43 root@localhost yum.repos.d]#

```

å…¶å®-Mæ²¡æœ‰æ„ä¹‰ï¼Œå°±æ˜¯ä¿é™©ï¼Œ-ræœ¬èº«å°±ä¸ä¼šåˆ›å»ºå®¶ç›®å½•ã€‚

æ³¨æ„ä¸‹ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯éœ€è¦userdel -r åŠ ä¸åŠ réƒ½è¦å»ç¡®è®¤ä¸‹å®¶ç›®å½•æ˜¯å¦çœŸçš„åˆ é™¤ï¼Œå› ä¸ºæˆ‘æ“ä½œæ—¶å€™å‘ç°æœ‰æ—¶å€™ä¸åŠ -rï¼Œå¥½åƒä¹Ÿæ˜¯æŠŠå®¶ç›®å½•åˆ äº†ã€‚è¿™ä¸ªæ˜¯åœ¨rockey-linuxä¸Šæ“ä½œçš„ã€‚

## é»˜è®¤useraddçš„è¡Œä¸ºæœ‰æ–‡ä»¶å®šä¹‰çš„

```
[15:25:22 root@localhost ~]#cat /etc/default/useradd
# useradd defaults file
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes

[15:25:27 root@localhost ~]#getent group users
users:x:100:
[15:26:08 root@localhost ~]#

```

GROUP = 100 é»˜è®¤useradd -N ä¸åˆ›å»ºä¸»ç»„çš„æ—¶å€™ï¼Œè‡ªåŠ¨åŠ åˆ°usersä¸»ç»„é‡Œï¼Œè¿™ä¸ªè¡Œä¸ºå°±æ˜¯GROUP=100è®¾ç½®çš„ã€‚

INACTIVE=-1 é»˜è®¤ç”¨**å¯†ç **è¿‡æœŸå æ˜¯å¦ç»™å®½é™æœŸï¼Œé»˜è®¤æ˜¯æ°¸è¿œå®½é™ã€‚

HOME=/home é»˜è®¤å®¶ç›®å½•åœ¨å“ª

CREATE_MAIL_SPOOL=yes  é»˜è®¤ç”¨æˆ·åˆ›å»ºçš„æ—¶å€™åˆ›å»ºå®ƒçš„é‚®ç®±ï¼Œ

```
[15:26:08 root@localhost ~]#ll /var/spool/mail/
total 0
-rw-rw----. 1 alice    mail 0 Jan 16 14:21 alice
-rw-rw----. 1 jack     mail 0 Jan 16 14:24 jack
-rw-rw----. 1 jerry    mail 0 Jan 16 14:43 jerry
-rw-rw----. 1 rose     mail 0 Jan 16 14:28 rose
-rw-rw----. 1 sb001    mail 0 Jan 16 14:52 sb001
-rw-rw----. 1 tom      mail 0 Jan 16 14:22 tom
-rw-rw----. 1 xiaohong mail 0 Jan 16 14:46 xiaohong

```

SKEL=/etc/skel   é»˜è®¤åˆ›å»ºå®¶ç›®å½•é‡Œçš„éšè—æ–‡ä»¶çš„ç”±æ¥

```
[15:33:50 root@localhost ~]#ls -a /etc/skel/
.  ..  .bash_logout  .bash_profile  .bashrc
[15:33:53 root@localhost ~]#

```

æ‰€ä»¥å¦‚æœéœ€è¦åˆ›å»ºç”¨æˆ·ï¼Œç”Ÿæˆçš„å®¶ç›®å½•é‡Œè‡ªåŠ¨å¸¦ä¸Šä»€ä¹ˆæ–‡ä»¶ï¼Œå°±æœ‰åŠæ³•äº†

```shell
[15:36:42 root@localhost ~]#ls -a /etc/skel
.  ..  .bash_logout  .bash_profile  .bashrc
[15:36:51 root@localhost ~]#
[15:37:01 root@localhost ~]#ls -a /home/
alice/ jack/  lisi/  rose/  sb001/ tom/
[15:37:01 root@localhost ~]#ls -a /home/alice/
.  ..  .bash_logout  .bash_profile  .bashrc
[15:37:13 root@localhost ~]#touch /etc/skel/.vimrc
[15:37:22 root@localhost ~]#ls -a /etc/skel/
.  ..  .bash_logout  .bash_profile  .bashrc  .vimrc
[15:37:32 root@localhost ~]#useradd test-1
[15:37:43 root@localhost ~]#ls -a /home/test-1/
.  ..  .bash_logout  .bash_profile  .bashrc  .vimrc
[15:37:49 root@localhost ~]#

```

## è¿˜æœ‰ä¸ªé»˜è®¤è¡Œä¸ºæ–‡ä»¶

```shell
[15:43:09 root@localhost ~]#cat /etc/login.defs  | grep -Ev "^#|^$"
MAIL_DIR        /var/spool/mail
UMASK           022
HOME_MODE       0700
PASS_MAX_DAYS   99999	# å£ä»¤æœ€å¤§æœ‰æ•ˆæœŸ
PASS_MIN_DAYS   0	# å£ä»¤ä¿®æ”¹æ— éœ€ç­‰å¾…ç›´æ¥æ”¹
PASS_MIN_LEN    5	# å£ä»¤æœ€çŸ­5ä¸ª
PASS_WARN_AGE   7
UID_MIN                  1000	# é»˜è®¤æ™®é€šç”¨æˆ·UIDä»1000å¼€å§‹ï¼Œå°±æ˜¯è¿™é‡Œè®¾ç½®çš„
UID_MAX                 60000	# è¿™é‡Œçš„1000å’Œ60000éƒ½æ˜¯è‡ªåŠ¨çš„èŒƒå›´ï¼Œæ‰‹åŠ¨é™¤å¤–
SYS_UID_MIN               201	# ç³»ç»ŸUIDè‡ªåŠ¨èŒƒå›´
SYS_UID_MAX               999	# ç³»ç»ŸUIDè‡ªåŠ¨èŒƒå›´
GID_MIN                  1000
GID_MAX                 60000
SYS_GID_MIN               201
SYS_GID_MAX               999
CREATE_HOME     yes
USERGROUPS_ENAB yes
ENCRYPT_METHOD SHA512	# é»˜è®¤çš„å“ˆå¸Œç®—æ³•ï¼Œ/etc/passwdé‡Œçš„$6
[15:43:16 root@localhost ~]#
```

root ä¸å—ä¸Šè¿°é…ç½®çš„é™åˆ¶

## æ‰€ä»¥é»˜è®¤æ–°å»ºç”¨æˆ·çš„ç›¸å…³æ–‡ä»¶å¦‚ä¸‹

```shell
[15:51:36 root@localhost ~]#ll /etc/default/useradd -d
-rw-r--r--. 1 root root 119 Aug 19 03:04 /etc/default/useradd
[15:51:40 root@localhost ~]#ll /etc/skel -d
drwxr-xr-x. 2 root root 76 Jan 16 15:37 /etc/skel
[15:51:44 root@localhost ~]#ll /etc/login.defs -d
-rw-r--r--. 1 root root 2512 Aug 19 03:04 /etc/login.defs
```

**/etc/default/useraddä¹Ÿå¯ä»¥ç”¨useradd -DæŸ¥çœ‹**

```
[15:53:09 root@localhost ~]#useradd -D
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes
[15:54:10 root@localhost ~]#cat /etc/default/useradd
# useradd defaults file
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes

1ã€ç›´æ¥ä¿®æ”¹æ–‡ä»¶
2ã€é€šè¿‡useraddä¿®æ”¹
	useradd -D -s SHELLç±»å‹
	useradd -D -b BASE_DIR/home
	useradd -D -g GROUPé»˜è®¤useradd -Næ‰€å¸¦çš„ç»„
	
[15:54:10 root@localhost ~]#cat /etc/default/useradd
# useradd defaults file
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes

[15:54:22 root@localhost ~]#useradd -D -g 1000
[16:01:36 root@localhost ~]#cat /etc/default/useradd
# useradd defaults file
GROUP=1000
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes

[16:01:37 root@localhost ~]#

```

## æ‰¹é‡æ“ä½œ



```
newusers  # passwdæ ¼å¼æ–‡ä»¶ æ‰¹é‡åˆ›å»ºç”¨æˆ·
chpasswd  # æ‰¹é‡ä¿®æ”¹ç”¨æˆ·å£ä»¤
```

```
å°†/etc/passwdæ–‡ä»¶é‡Œçš„æ ¼å¼å¤åˆ¶å‡ºæ¥ï¼Œæ”¾å…¥å•ä¸ªæ–‡ä»¶ï¼Œç„¶ååˆ°åˆ«çš„æœºå™¨ä¸Šnewusers xxxå³å¯åˆ›å»º
user1:x:1008:1009::/home/user1:/bin/bash
user2:x:1009:1010::/home/user2:/bin/bash
user3:x:1010:1011::/home/user3:/bin/bash
user4:x:1011:1012::/home/user4:/sbin/nologin
[13:58:02 root@localhost ~]#getent passwd

-----çœ‹ä¸‹ğŸ‘‡åˆ›å»ºçš„å…·ä½“è¿‡ç¨‹----------
[root@centos7 ~]# cat addusers
user1:x:1008:1009::/home/user1:/bin/bash
user2:x:1009:1010::/home/user2:/bin/bash
user3:x:1010:1011::/home/user3:/bin/bash
user4:x:1011:1012::/home/user4:/sbin/nologin


[root@centos7 ~]# newusers addusers
newusers: line 5: invalid line
newusers: line 6: invalid line
newusers: error detected, changes ignored
[root@centos7 ~]# cat addusers -n
     1  user1:x:1008:1009::/home/user1:/bin/bash
     2  user2:x:1009:1010::/home/user2:/bin/bash
     3  user3:x:1010:1011::/home/user3:/bin/bash
     4  user4:x:1011:1012::/home/user4:/sbin/nologin
     5
     6
[root@centos7 ~]#
---------ğŸ‘†å¯æƒœæŠ¥é”™é¸Ÿ------------
åˆ æ‰å¤šä½™çš„ç©ºè¡Œåï¼Œå°è¯•ğŸ‘‡-----------
[root@centos7 ~]# cat addusers
user1:x:1008:1009::/home/user1:/bin/bash
user2:x:1009:1010::/home/user2:/bin/bash
user3:x:1010:1011::/home/user3:/bin/bash
user4:x:1011:1012::/home/user4:/sbin/nologin
[root@centos7 ~]#
[root@centos7 ~]# newusers addusers
[root@centos7 ~]# getent passwd |grep user*
user1:x:1000:1000::/home/user1:/bin/bash
user2:x:1009:1010::/home/user2:/bin/bash
user3:x:1010:1011::/home/user3:/bin/bash
user4:x:1011:1012::/home/user4:/sbin/nologin
[root@centos7 ~]#
-------------ç„¶åå†æ‰¹é‡æ”¹å£ä»¤æ–¹æ³•1ğŸ‘‡--------------
[root@centos7 ~]# chpasswd
user1:cisco				# ctrl då®‰å…¨é€€å‡ºæ‰èƒ½ç”Ÿæ•ˆ
[root@centos7 ~]# getent shadow user1
user1:$6$dR6ZP/lQ5aA$V6xJwgibZELgZh2NKOVDSez8CTzw6h05NX.n/Ft4ZpGtlVNfNEpkpTFRdZqkSQWKKgeZ/BxKgfSm2BRcFaMgo0:19029:0:99999:7:::
[root@centos7 ~]# chpasswd
user1:huawei
^C						# ä¸èƒ½ctrl cå¼ºåˆ¶é€€å‡º
[root@centos7 ~]# getent shadow user1
user1:$6$dR6ZP/lQ5aA$V6xJwgibZELgZh2NKOVDSez8CTzw6h05NX.n/Ft4ZpGtlVNfNEpkpTFRdZqkSQWKKgeZ/BxKgfSm2BRcFaMgo0:19029:0:99999:7:::
[root@centos7 ~]#
------ğŸ‘†æ³¨æ„æ²¡æˆªå›¾å°±æ˜¯æ–¹ä¾¿åé¢æœç´¢ï¼Œä½†æ˜¯è¦å°å¿ƒå¤±çœŸä¸¢ä¸œè¥¿ï¼Œè¿™é‡Œæ˜¯ctrl Cå¼ºåˆ¶é€€å‡ºï¼Œæ‰€ä»¥æ²¡æ”¹æˆåŠŸï¼Œå¾ˆå¤šè¿™ç§äº¤äº’å¼çš„é…ç½®éƒ½éœ€è¦ctrl +d é€€å‡ºã€‚---------
----éäº¤äº’å¼é…ç½®æ–¹å¼ğŸ‘‡------
[root@centos7 ~]# echo user1:lianxiang |chpasswd
[root@centos7 ~]# getent shadow user1
user1:$6$A55IfCFmc$aJPxuWvGRvpTzNocXonzz/gEZTEjV7y3qcHSWEPvxZg1IfA0EUrXMMBpOsw9DXodx4KQ1yCa8SZCTiQtvDYu50:19029:0:99999:7:::
[root@centos7 ~]#
---------æ‰¹é‡æ”¹çš„æ–¹æ³•ğŸ‘‡---æ”¹å£ä»¤1----------
[root@centos7 ~]# vi p.set
[root@centos7 ~]# cat p.set
user1:centos
user2:cisco
user3:huawei
[root@centos7 ~]# cat p.set |chpasswd
[root@centos7 ~]# getent shadow user1
user1:$6$PFoqG/41wd3x$PDCFFjFD84xNc2t4je5119lP.ifsTyspYRGnbP4Bx0QpP/9XRd4s9vUFICbEdoDv3pOd7y/7PBLuBsE6EXhwu/:19029:0:99999:7:::
[root@centos7 ~]# getent shadow user2
user2:$6$0ilWD/oW7CN$IdC6Gz0.eJKdPBWuGx4KJR00GBrjoxE8KWtCp9lurmP1TaCQGcUra5.VscBTQZ5Um0lKYZO.qb6/fNyYiey0s1:19029:0:99999:7:::
[root@centos7 ~]# getent shadow user3
user3:$6$Uv41MY/y9$Q1251b9f9CPX5/sQ1aDhITVsl9pbKEXJspkV4uib/ugaCAlMfg9/Xy4WJBdyq56SJF4k5YuIc0muouxLpi61T0:19029:0:99999:7:::
[root@centos7 ~]# 

```

## æŸ¥çœ‹id

```
[root@centos7 ~]# id user1
uid=1000(user1) gid=1000(user1) groups=1000(user1)
[root@centos7 ~]# id -u user1
1000
[root@centos7 ~]# id -g user1
1000
[root@centos7 ~]# id -G user1
1000
[root@centos7 ~]# id -n user1
id: cannot print only names or real IDs in default format
[root@centos7 ~]# id -ng user1
user1
[root@centos7 ~]# id -ngG user1
id: cannot print "only" of more than one choice
[root@centos7 ~]# id -nG user1
user1

```



## usermodä¿®æ”¹ç”¨æˆ·

![image-20220116160257756](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220116160257756.png) 

```shell
[16:04:46 root@localhost ~]#id jack
uid=1002(jack) gid=1000(alice) groups=1000(alice),1001(g1),1002(g2)
[16:04:48 root@localhost ~]#usermod -g sb001 jack  # ä¿®æ”¹ä¸»ç»„
[16:04:56 root@localhost ~]#id jack
uid=1002(jack) gid=1006(sb001) groups=1006(sb001),1001(g1),1002(g2)
[16:04:58 root@localhost ~]#usermod -G root jack  # -Gé™„åŠ ç»„è¦æ³¨æ„æ˜¯è¦†ç›–æ€§æ“ä½œ
[16:05:11 root@localhost ~]#id jack
uid=1002(jack) gid=1006(sb001) groups=1006(sb001),0(root)
[16:05:13 root@localhost ~]#

éœ€è¦ç”¨åˆ°-aG,-aåªèƒ½é…åˆGç”¨ï¼Œå› ä¸ºå…¶ä»–å±æ€§ä¸å­˜åœ¨å¤šä¸ªå€¼ã€‚
[16:05:11 root@localhost ~]#id jack
uid=1002(jack) gid=1006(sb001) groups=1006(sb001),0(root)

[16:06:01 root@localhost ~]#usermod -aG g1,g2,g3 jack
[16:06:12 root@localhost ~]#id jack
uid=1002(jack) gid=1006(sb001) 
groups=1006(sb001),1001(g1),1002(g2),1003(g3),0(root)

```

## ç©ºå£ä»¤ç™»å…¥æ–¹æ³•

å…³è”ç”¨æˆ·é”å®šï¼Œå°±æ˜¯ä¸éœ€è¦è¾“å…¥å¯†ç è¿›è¡Œç™»å…¥

```
ä¿®æ”¹/etc/shadowé‡Œçš„ä¸¤ä¸ª!!ï¼Œæ²¡è®¾ç½®å¯†ç ï¼Œå°±æ˜¯ä¸¤ä¸ª!!
[11:38:54 root@localhost ~]#cat /etc/shadow |grep lisi
lisi:!!:19008::::::
[11:38:59 root@localhost ~]#vi /etc/shadow
][11:39:14 root@localhost ~]#cat /etc/shadow |grep lisi
lisi::19008::::::
```

![image-20220117113952962](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117113952962.png) 

```
ä¿®æ”¹/etc/passwdé‡Œçš„xæ‹¿æ‰ï¼Œæ•ˆæœä¸€æ ·ï¼Œæ— éœ€å¯†ç ï¼Œxå°±æ˜¯å ä½ï¼Œè¡¨ç¤ºå¯†ç æ”¾åœ¨äº†/etc/shadowé‡Œã€‚
[11:47:43 root@localhost ~]#cat /etc/passwd |grep sb001
sb001:x:1006:1006:sbZhuanYong:/home/sb001:/bin/bash
[11:47:44 root@localhost ~]#vi /etc/passwd
[11:48:00 root@localhost ~]#cat /etc/passwd |grep sb001
sb001::1006:1006:sbZhuanYong:/home/sb001:/bin/bash

æ³¨æ„è¿™ä¸ªåœ¨rocky-linuxé‡Œæ²¡æœ‰ç”¨äº†ï¼Œåœ¨centos7é‡Œå¯ä»¥çš„ã€‚

```

## é”å®šç”¨æˆ·

```
[root@centos7 ~]# useradd test
[root@centos7 ~]# getent passwd test
test:x:1003:1003::/home/test:/bin/bash
[root@centos7 ~]# getent shadow test
test:!!:19029:0:99999:7:::						# æ–°åˆ›å»ºçš„ç”¨æˆ·æ˜¯è¢«é”å®šçš„
[root@centos7 ~]# getent group test
test:x:1003:
[root@centos7 ~]# getent gshadow test
test:!::
-------â†“--------è®¾ç½®å¯†ç åçš„å˜åŒ–------â†“---------
[root@centos7 ~]# echo cisco |passwd --stdin test
Changing password for user test.
passwd: all authentication tokens updated successfully.
[root@centos7 ~]# getent passwd test
test:x:1003:1003::/home/test:/bin/bash
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:::
[root@centos7 ~]# getent group test
test:x:1003:
[root@centos7 ~]# getent gshadow test
test:!::

-------ğŸ‘‡------åŠ é”åçš„å˜åŒ–----------
[root@centos7 ~]# usermod -L test
[root@centos7 ~]# getent passwd test
test:x:1003:1003::/home/test:/bin/bash
[root@centos7 ~]# getent shadow test
test:!$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:::		      # é”æ˜¯åŠ åœ¨shadowé‡Œ
[root@centos7 ~]# getent group test
test:x:1003:
[root@centos7 ~]# getent gshadow test
test:!::								#gshadowè¿™é‡Œä¸€ç›´éƒ½æ˜¯è¿™æ ·çš„
[root@centos7 ~]#

------ğŸ‘‡----è§£é”------
[root@centos7 ~]# usermod -U test
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:::
[root@centos7 ~]#

-------ğŸ‘‡å¦‚æœæ˜¯ç©ºå£ä»¤æ˜¯ä¸ç»™ä½ è§£é”çš„----
[root@centos7 ~]# useradd ceshi
[root@centos7 ~]# getent passwd ceshi
ceshi:x:1004:1004::/home/ceshi:/bin/bash
[root@centos7 ~]# getent shadow ceshi
ceshi:!!:19029:0:99999:7:::
[root@centos7 ~]# usermod -U ceshi
usermod: unlocking the user's password would result in a passwordless account.
You should set a password with usermod -p to unlock this user's password.

è‡³äºä¸¤ä¸ªï¼ï¼å’Œä¸€ä¸ªï¼æ²¡å•¥åŒºåˆ«ï¼Œä¸€æ¥éƒ½æ˜¯é”å®šã€‚äºŒæ¥åªè¦æ²¡æœ‰è®¾ç½®å¯†ç éƒ½ä¸èƒ½-Uè§£é” ä¸è¿‡å¯ä»¥viè¿›å»è§£é”ã€‚
å½“ç„¶è¿™ä¸ª!å¯ä»¥åŠ åœ¨passwdé‡Œçš„--é€šè¿‡viæ‰‹åŠ¨åŠ ï¼Œusermod -L -Uéƒ½æ˜¯é’ˆå¯¹shadowæ“ä½œï¼Œè€Œä¸”è¦æ¯”åŠ åœ¨shadowé‡Œä¼˜å…ˆã€‚

```

## ä¿®æ”¹è´¦å·æœ‰æ•ˆæœŸ

> chageæ¯”å®ƒå¥½

å°±æ˜¯shadowæ–‡ä»¶é‡Œå•è¡Œï¼Œå€’æ•°ç¬¬äºŒä¸ªå­—æ®µ--è´¦å·æœ‰æ•ˆæœŸï¼Œå€’æ•°ç¬¬ä¸€å­—æ®µä¿ç•™å­—æ®µã€‚

```
[root@centos7 ~]# getent shadow test
test:!$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:::
[root@centos7 ~]# usermod -U test

[root@centos7 ~]# usermod -e  2023-12-12 test
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7::19703:


```

## è®¾ç½®å¯†ç å®½é™æœŸ

> chageæ¯”å®ƒå¥½

åœ¨æœ€å¤§è¶…æ—¶æ—¶é—´åˆ°æœŸåï¼Œä½ è¿˜èƒ½ç”¨å‡ å¤©

```
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7::19703:

[root@centos7 ~]# usermod -f 3 test
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:3:19703:
[root@centos7 ~]#

```

## æ”¹æ—¶é—´è¿˜æ˜¯ç”¨chage

```
äº¤äº’å¼å’Œéäº¤äº’æ˜¯éƒ½æœ‰
[root@centos7 ~]# chage test
Changing the aging information for test
Enter the new value, or press ENTER for the default

        Minimum Password Age [0]:
        Maximum Password Age [99999]:
        Last Password Change (YYYY-MM-DD) [2022-02-06]:
        Password Expiration Warning [7]:
        Password Inactive [3]:
        Account Expiration Date (YYYY-MM-DD) [2023-12-12]:
[root@centos7 ~]#


[root@centos7 ~]# chage -h
Usage: chage [options] LOGIN

Options:
  -d, --lastday LAST_DAY        set date of last password change to LAST_DAY
  -E, --expiredate EXPIRE_DATE  set account expiration date to EXPIRE_DATE
  -h, --help                    display this help message and exit
  -I, --inactive INACTIVE       set password inactive after expiration
                                to INACTIVE
  -l, --list                    show account aging information
  -m, --mindays MIN_DAYS        set minimum number of days before password
                                change to MIN_DAYS
  -M, --maxdays MAX_DAYS        set maximum number of days before password
                                change to MAX_DAYS
  -R, --root CHROOT_DIR         directory to chroot into
  -W, --warndays WARN_DAYS      set expiration warning days to WARN_DAYS

[root@centos7 ~]#


------æ³¨æ„-Eé€‰é¡¹æ—¶é—´æ ¼å¼æœ‰ç‚¹å‘---------ğŸ‘‡--äººå·¥å†™æˆYYYY-MM-DD-----

[root@centos7 ~]# chage -E 10 test
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:3:10:
[root@centos7 ~]# chage -E 2022-12-12 test
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:3:19338:
[root@centos7 ~]# chage -I 2 test
[root@centos7 ~]# getent shadow test
test:$6$QexkrOWQ$3e85TAtRmiYEMioZOU8QJ7qaD0xCP2lW4Dposctg7evJMRZy3kseNQXD.C21lKtXtqFnzGEhCnbiFq7yI4c5H.:19029:0:99999:7:2:19338:
[root@centos7 ~]#

```



## userdelåˆ é™¤ç”¨æˆ·

```shell
[root@centos7 ~]# ll /home/
total 0
drwx------. 2 ceshi    ceshi    83 Feb  6 12:08 ceshi
drwx------. 2 dalao001 dalao001 62 Feb  5 14:54 dalao001
drwx------. 2 ming     ming     83 Jan 26 09:44 ming
drwx------. 2 test     test     83 Feb  6 12:08 test
drwx------. 2      998      996 62 Feb  5 15:20 test001
drwx------. 2 user1    user1    96 Jan 10 14:16 user1
[root@centos7 ~]#
[root@centos7 ~]#
[root@centos7 ~]# ll /var/spool/mail/
total 0
-rw-rw----. 1 ceshi    mail 0 Feb  6 12:06 ceshi
-rw-rw----. 1 dalao001 mail 0 Feb  5 14:54 dalao001
-rw-rw----. 1 ming     mail 0 Jan 16 09:28 ming
-rw-rw----. 1 test     mail 0 Feb  6 11:57 test
-rw-rw----. 1 user1    mail 0 Jan 10 11:12 user1
[root@centos7 ~]#
[root@centos7 ~]# userdel test
[root@centos7 ~]# ll /home/test -d
drwx------. 2 1003 1003 83 Feb  6 12:08 /home/test
[root@centos7 ~]# ll /var/spool/mail/test -d
-rw-rw----. 1 1003 mail 0 Feb  6 11:57 /var/spool/mail/test   # é™¤äº†å®¶ç›®å½•ï¼Œé‚®ç®±ä¹Ÿè¦æ³¨æ„æ˜¯å¦åˆ é™¤
[root@centos7 ~]#


------ä¸è¦ä»¥ä¸ºé‡æ–°åˆ›å»ºtestç”¨æˆ·èƒ½ç»§ç»­å…³è”ä¹‹å‰æ²¡æœ‰åˆ é™¤çš„å®¶ç›®å½•å’Œé‚®ç®±---é‚£æ˜¯ä¸å¯èƒ½çš„ğŸ‘‡----
[root@centos7 ~]# useradd test
useradd: warning: the home directory already exists.
Not copying any file from skel directory into it.
Creating mailbox file: File exists
[root@centos7 ~]#
[root@centos7 ~]#
[root@centos7 ~]# ll /var/spool/mail/test  -d
-rw-rw----. 1 1003 mail 0 Feb  6 11:57 /var/spool/mail/test
[root@centos7 ~]# ll /home/test -d
drwx------. 2 1003 1003 83 Feb  6 12:08 /home/test
[root@centos7 ~]# userdel -r test
userdel: /var/spool/mail/test not owned by test, not removing
userdel: /home/test not owned by test, not removing

[root@centos7 ~]# ll /var/spool/mail/test -d
-rw-rw----. 1 1003 mail 0 Feb  6 11:57 /var/spool/mail/test
[root@centos7 ~]# ll /home/test
test/    test001/
[root@centos7 ~]# ll /home/test -d
drwx------. 2 1003 1003 83 Feb  6 12:08 /home/test
[root@centos7 ~]# userdel -r test
userdel: user 'test' does not exist

-----é€‰é¡¹ -r ----ğŸ‘‡èƒ½å¤Ÿåˆ é™¤ç”¨æˆ·å®¶ç›®å½•å’Œé‚®ç®±-------
[root@centos7 ~]# useradd test2
[root@centos7 ~]# ll /home/test2 -d
drwx------. 2 test2 test2 62 Feb  6 13:36 /home/test2
[root@centos7 ~]# ll /var/spool/mail/test2 -d
-rw-rw----. 1 test2 mail 0 Feb  6 13:36 /var/spool/mail/test2
[root@centos7 ~]# userdel -r test2
[root@centos7 ~]# ll /home/test2 -d
ls: cannot access /home/test2: No such file or directory
[root@centos7 ~]# ll /var/spool/mail/test2 -d
ls: cannot access /var/spool/mail/test2: No such file or directory
[root@centos7 ~]#

é™„åŠ ï¼Œgroupå¦‚æœæ˜¯ç»„é‡Œæ²¡æœ‰å…¶ä»–äººï¼Œuserdel ä¹Ÿä¼šåˆ é™¤ç»„çš„ã€‚
æ‰€ä»¥è¿™é‡Œuserdelï¼Œè¦æ³¨æ„ ç»„ã€å®¶ç›®å½•ã€é‚®ç®± ä¿¡æ¯æ˜¯å¦æœ‰å˜åŒ–ã€‚useræ²¡äº†ï¼Œgroupã€å®¶ç›®å½•ã€é‚®ç®±å¦‚æœåœ¨ï¼Œé‚£ä¹ˆè¿™äº›æ–‡ä»¶çš„å±æ€§é‡Œçš„user idéƒ½ä¼šå˜æˆè¯¥ç”¨æˆ·çš„uid--æ•°å­—ï¼Œè€Œä¸å†æ˜¯åŸæ¥çš„ç”¨æˆ·åã€‚è€Œä¸”1005ä¹Ÿåªæ˜¯ä¸ªç©ºæ•°å­—ï¼Œå¹¶æ²¡æœ‰ä»»ä½•ç”¨æˆ·ä¸å…¶å¯¹åº”ã€‚

```

## PATHå†…å®¹éšç”¨æˆ·è€Œå˜

```
å˜é‡å˜é‡ï¼Œå®ƒæ˜¯å˜çš„ï¼Œrootå’Œuser1çš„PATHå˜é‡çš„å†…å®¹æ˜¯ä¸ä¸€æ ·
[root@centos7 ~]# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin

[user1@centos7 ~]$ echo $PATH
/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/user1/.local/bin:/home/user1/bin
[user1@centos7 ~]$

```

### su åˆ‡æ¢

```
su - user1  # è¿™ç§åˆ‡æ¢ç”¨æˆ·ç¯å¢ƒä¸€å¹¶åˆ‡æ¢
su 			# åŸåœ°åˆ‡æ¢ï¼Œpwdçš„æ‰€åœ¨è·¯å¾„éƒ½ä¸å˜

------------å®Œå…¨åˆ‡æ¢ğŸ‘‡----------------
[root@centos7 data]# pwd
/data
[root@centos7 data]# su - user1
Last login: Sun Feb  6 16:10:51 CST 2022 on pts/0
[user1@centos7 ~]$ pwd
/home/user1
[user1@centos7 ~]$ echo $PATH
/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/user1/.local/bin:/home/user1/bin
[user1@centos7 ~]$
--------------åŸåœ°åˆ‡æ¢ğŸ‘‡-pwdå’Œ$pathéƒ½ä¸å˜çš„--------------
[root@centos7 data]# su user1
[user1@centos7 data]$ pwd
/data
[user1@centos7 data]$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
[user1@centos7 data]$

--------æ¢ä¸ªç”¨æˆ·æ‰§è¡Œå‘½ä»¤ï¼Œæœ¬èº«ä¸åˆ‡æ¢è¿‡å»----ğŸ‘‡--------------

[user1@centos7 data]$ su root -c "getent shadow root"
Password:
root:$6$Kih8C.5/adh8TNjx$wNC09CUb7KsECwLH1LFfAagv8N47OAEqSMHLlOuU.vB24ZzU/H5p6DLpNV31zLKlJioqNmXkIkQEaAUf0H74Z0::0:99999:7:::
[user1@centos7 data]$

suæ´»su - ç›´æ¥å›è½¦å°±æ˜¯åˆ‡rootï¼Œrootå‚æ•°é»˜è®¤å°±æœ‰
root åˆ‡æ¢ æ™®é€šç”¨æˆ· æ— éœ€å¯†ç 
æ™®é€šç”¨æˆ· åˆ‡æ¢ root éœ€è¦å¯†ç 

```

## ubuntué»˜è®¤ä¸è®©rootç™»å…¥çš„æƒ…å†µ

![image-20220117163110055](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117163110055.png) 

ubuntué»˜è®¤rootç­‰ä¸äº†ï¼Œsu åˆ‡æ¢è¦å¯†ç ï¼Œä½†æ˜¯æ²¡è®¾ç½®è¿‡rootå¯†ç é»˜è®¤å°±

rootçš„å£ä»¤æƒ…å†µï¼Œä½ érootç”¨æˆ·ä¹Ÿçœ‹ä¸å…¨

![image-20220117163224300](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117163224300.png) 

è¿™ä¸ªæ—¶å€™å°±çš„ä½¿ç”¨sudoå‘½ä»¤å’¯

sudo -i æç¤ºå‡ºå…¥çš„æ˜¯å½“å‰æ™®é€šç”¨æˆ·çš„å£ä»¤---ğŸ‘‡--

![image-20220117163325168](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117163325168.png) 

ä¸æ˜¯æ¯ä¸ªè´¦å·éƒ½èƒ½sudo åˆ‡æ¢åˆ°rootçš„ï¼Œä¹‹æ‰€ä»¥å¯ä»¥æ˜¯å› ä¸ºç³»ç»Ÿå®‰è£…çš„æ—¶å€™æˆäºˆäº†wangè´¦å·å¯ä»¥åˆ‡æ¢ã€‚

![image-20220117170132337](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117170132337.png) 

æ‰€ä»¥ubuntuè¿™é‡Œçš„ï¼å»æ‰ï¼Œrootå°±ç›´æ¥æ— å£ä»¤ç™»å…¥äº†

----è€Œä¸”ä¸Šé¢çŸ¥è¯†è¿è¡Œäº†rootæœ¬åœ°ç™»å…¥ğŸ‘†-----è¿œç¨‹rootè¿˜æ˜¯æ— æ³•ç™»å…¥ubuntu--------

-----ğŸ‘‡ä¸€èˆ¬åªæœ‰ç³»ç»Ÿå®‰è£…æ—¶è®¾ç½®çš„é»˜è®¤ç¬¬ä¸€ä¸ªè´¦æˆ·æ‰èƒ½sudo -i åˆ‡æˆrootç”¨æˆ·------

<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117181018684.png" alt="image-20220117181018684" style="zoom:67%;" /> 

![image-20220117180920482](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117180920482.png) 

![image-20220117180936698](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117180936698.png) 

![image-20220117180650355](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117180650355.png) 

## passwdçš„æœ‰ç”¨é€‰é¡¹

<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117183121230.png" alt="image-20220117183121230" style="zoom: 67%;" /> 

```
[root@centos7 data]# type passwd  # å¤–éƒ¨å‘½ä»¤ï¼Œå°±æ˜¯ç”¨--helpå»æŸ¥çœ‹å¸®åŠ©ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥man
passwd is hashed (/usr/bin/passwd)
[root@centos7 data]# passwd --help
Usage: passwd [OPTION...] <accountName>
  -k, --keep-tokens       keep non-expired authentication tokens
  -d, --delete            delete the password for the named account (root only)
  -l, --lock              lock the password for the named account (root only)
  -u, --unlock            unlock the password for the named account (root only)
  -e, --expire            expire the password for the named account (root only)
  -f, --force             force operation
  -x, --maximum=DAYS      maximum password lifetime (root only)
  -n, --minimum=DAYS      minimum password lifetime (root only)
  -w, --warning=DAYS      number of days warning users receives before password expiration (root only)
  -i, --inactive=DAYS     number of days after password expiration when an account becomes disabled (root only)
  -S, --status            report password status on the named account (root only)
  --stdin                 read new tokens from stdin (root only)

Help options:
  -?, --help              Show this help message
  --usage                 Display brief usage message

```

-d ï¼š åˆ é™¤å¯†ç 

-l : 	è¿™ä¸ªå’Œusermode -Lä¸€æ ·

-u:	è¿™ä¸ªå’Œusermode -Uä¸€æ ·

-e:	ğŸ‘ˆè¿™ä¸ªå¥½ï¼Œå…¸å‹åº”ç”¨æŒ‰ç†ï¼Œå¼ºåˆ¶ç”¨æˆ·é¦–æ¬¡ç™»å…¥ä¿®æ”¹å¯†ç çš„ã€‚

-n   -x    -w è¿™äº›å’Œchageä»¥åŠusermodå·®ä¸å¤šï¼Œéƒ½å¯ä»¥æ”¹ï¼Œæ¨èchageæˆ–è€…passwdã€‚



## æ”¹å£ä»¤çš„æ–¹æ³•2

```shell
echo cisco | passwd --stdin user1 &> /dev/null
```

è¿™ä¸ªpasswdæ€ä¹ˆæ‰¹é‡å•Šï¼Ÿå¯†ç å’Œç”¨æˆ·éƒ½æ˜¯å˜é‡ï¼Œå¯†ç å¯ä»¥æ”¾åˆ°æ–‡ä»¶é‡Œï¼Œcat file |é‡å®šå‘ç»™passwdï¼Œé—®é¢˜æ—¶ç”¨æˆ·æ€ä¹ˆå¼„å‘¢ï¼Ÿå¥½åƒæ²¡æœ‰chpasswdæ–¹é¢å‘¢~æ³¨æ„æ­¤å¤„åˆ’é‡ç‚¹æ•²é»‘æ¿ğŸ‘‰å‘¢å­—å¸¦å°¾éŸ³~ã€‚å…¶ä»–æŠ€æœ¯é—®é¢˜å¿½ç•¥å³å¯~

```shell
[root@centos7 data]# vi change_passwd.sh
[root@centos7 data]#
[root@centos7 data]# . change_passwd.sh  # è¿™é‡Œä¹Ÿæ˜¯ä¸ªç‚¹ï¼Œæ”¾åˆ°åé¢ï¼Œå°±æ˜¯è„šæœ¬æ‰§è¡Œçš„Nç§æ–¹æ³•
Changing password for user user1.
passwd: all authentication tokens updated successfully.
Changing password for user user2.
passwd: all authentication tokens updated successfully.
Changing password for user user3.
passwd: all authentication tokens updated successfully.
[root@centos7 data]#
[root@centos7 data]# cat change_passwd.sh
#!/bin/bash

echo cisco |passwd --stdin user1
echo huawei |passwd --stdin user2
echo juniper |passwd --stdin user3
[root@centos7 data]#
--------ğŸ‘‡ä¼˜åŒ–è¾“å‡º-----------
[root@centos7 data]# . change_passwd.sh
[root@centos7 data]#
[root@centos7 data]# cat change_passwd.sh
#!/bin/bash

echo cisco |passwd --stdin user1 > /dev/null
echo huawei |passwd --stdin user2 > /dev/null
echo juniper |passwd --stdin user3 > /dev/null
[root@centos7 data]#

```

## ä¿®æ”¹shellç±»å‹

```
[root@centos7 data]# getent passwd user1
user1:x:1000:1000::/home/user1:/bin/bash
[root@centos7 data]# chsh -s /sbin/nologin user1  
Changing shell for user1.
chsh: Warning: "/sbin/nologin" is not listed in /etc/shells.
Shell changed.
[root@centos7 data]# getent passwd user1
user1:x:1000:1000::/home/user1:/sbin/nologin
[root@centos7 data]# cat /etc/shells
/bin/sh
/bin/bash
/usr/bin/sh
/usr/bin/bash
[root@centos7 data]#
-------- ç­‰ä»·äºusermod -s ---------
[root@centos7 data]# getent passwd user2
user2:x:1009:1010::/home/user2:/bin/bash
[root@centos7 data]# usermod -s /sbin/nolgin user2
[root@centos7 data]# getent passwd user2
user2:x:1009:1010::/home/user2:/sbin/nolgin
[root@centos7 data]#

```

## ç»„æ“ä½œè¡¥å……



<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117194846948.png" alt="image-20220117194846948" style="zoom:67%;" /> 

## é™„åŠ ç»„çš„æ“ä½œ

```
[root@centos7 data]# id user1
uid=1000(user1) gid=1000(user1) groups=1000(user1)
[root@centos7 data]# usermod -G g11,g12 user1
usermod: group 'g11' does not exist
usermod: group 'g12' does not exist

[root@centos7 data]# groupadd g11
[root@centos7 data]# groupadd g12
[root@centos7 data]# usermod -G g11,g12 user1
[root@centos7 data]# id user1
uid=1000(user1) gid=1000(user1) groups=1000(user1),1013(g11),1014(g12)
[root@centos7 data]#
-------------åˆ é™¤é™„åŠ ç»„ğŸ‘‡-----------
[root@centos7 data]# usermod -G "" user1
[root@centos7 data]# id user1
uid=1000(user1) gid=1000(user1) groups=1000(user1)
[root@centos7 data]#

```

## æŸ¥çœ‹ç»„ä¿¡æ¯çš„å…¶ä»–æ–¹æ³•

```
[root@centos7 data]# usermod -G g11,g12 user1
[root@centos7 data]# groups user1
user1 : user1 g11 g12
[root@centos7 data]#

```

<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117195352707.png" alt="image-20220117195352707" style="zoom:67%;" /> 

```
[root@centos7 data]# gpasswd --help
Usage: gpasswd [option] GROUP

Options:
  -a, --add USER                add USER to GROUP
  -d, --delete USER             remove USER from GROUP
  -h, --help                    display this help message and exit
  -Q, --root CHROOT_DIR         directory to chroot into
  -r, --delete-password         remove the GROUP's password
  -R, --restrict                restrict access to GROUP to its members
  -M, --members USER,...        set the list of members of GROUP
  -A, --administrators ADMIN,...
                                set the list of administrators for GROUP
Except for the -A and -M options, the options cannot be combined.
[root@centos7 data]# gpasswd -a user1 root
Adding user user1 to group root
[root@centos7 data]# id user1
uid=1000(user1) gid=1000(user1) groups=1000(user1),0(root),1013(g11),1014(g12)
[root@centos7 data]#

```

<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117195644739.png" alt="image-20220117195644739" style="zoom:67%;" /> 

æœ‰æ—¶å€™å‘ç°ç›´æ¥å›¾ç‰‡æ›´å¥½çœ‹ä¸€äº›ï¼Œè¦ä¸è¿˜æ˜¯æ”¾å¼ƒcliå¤åˆ¶äº†ï¼Œç›´æ¥å›¾ç‰‡å§ï¼Œè¡¥å……å…³é”®å­—å°±å¥½ã€‚

## ç»™ç»„è®¾ç½®å£ä»¤

![image-20220117195831322](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117195831322.png)

æŸä¸ªæ™®é€šç”¨æˆ·è¦åŠ å…¥æŸä¸ªç»„ï¼Œå°±ç”¨åˆ°äº†ç»„å¯†ç 

```
id user1
su - user1
touch file1
ll file1
å¸Œæœ›åˆ›å»ºçš„æ–‡ä»¶ä¸»ç»„æ—¶g12ï¼Œå¯ä¿®æ”¹user1çš„ä¸»ç»„ä¸ºg12ï¼Œ
newgrp g12 user1

```

![image-20220117205054899](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117205054899.png)

-------ğŸ‘† ä¸Šå›¾çš„newgrpæ—¶<font color=red>ä¸´æ—¶</font>æœ‰æ•ˆçš„ï¼Œexitåå°±é€€å‡ºæ¥ä¸´æ—¶çš„ä¸»ç»„äº†ï¼ŒğŸ‘‡è§ä¸‹å›¾------

rootä¸€æ ·å¯ä»¥

![image-20220117205502338](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117205502338.png)

æ°¸ä¹…çš„ä¿®æ”¹å°±ç”¨usermod -g





## ä¸€äº›æ“ä½œæ’æŸ¥è¸©å‘è®°å½•

<img src="2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117202228827.png" alt="image-20220117202228827" style="zoom:67%;" /> 



å› ä¸ºuser3åˆ›å»ºä¹‹å‰å°±æœ‰åŒåçš„å®¶ç›®å½•ï¼Œæ‰€ä»¥å¸¦æ¥ä¸€äº›é—®é¢˜ï¼šè¿™ä¹Ÿæ˜¯su user3ä¸ºä»€ä¹ˆæ˜¾ç¤º<font color=red>-bash-4.2$</font> çš„åŸå› 

![image-20220117203845483](2-ç”¨æˆ·å’Œç»„çš„æƒé™ç®¡ç†.assets/image-20220117203845483.png) 



## æŸ¥çœ‹é™„åŠ ç»„


[root@centos7 ~]# id ming
uid=1001(ming) gid=1001(ming) groups=1001(ming)
[root@centos7 ~]#
[root@centos7 ~]#
[root@centos7 ~]# groupmems --help
Usage: groupmems [options] [action]

Options:
  -g, --group groupname         change groupname instead of the user's group
                                (root only)
  -R, --root CHROOT_DIR         directory to chroot into

Actions:
  -a, --add username            add username to the members of the group
  -d, --delete username         remove username from the members of the group
  -h, --help                    display this help message and exit
  -p, --purge                   purge all members from the group
  -l, --list                    list the members of the group
[root@centos7 ~]# groupmems -l -g ming
[root@centos7 ~]# groupadd g1
[root@centos7 ~]# groupadd g2
[root@centos7 ~]# groupadd g3
[root@centos7 ~]# usermod -G ming g1,g2,g3
usermod: user 'g1,g2,g3' does not exist
[root@centos7 ~]# usermod -G ming g1 g2 g3

[root@centos7 ~]# usermod -G g1,g2,g3 ming    	  # æ³¨æ„æ¬¡åº
[root@centos7 ~]# id ming
uid=1001(ming) gid=1001(ming) groups=1001(ming),1015(g1),1016(g2),1017(g3)
[root@centos7 ~]# groupmes -l -g ming
-bash: groupmes: command not found
[root@centos7 ~]# groupmems -l -g ming
[root@centos7 ~]# groupmems -l -g g1  			# è¿™æ˜¯ä»¥æŸä¸ªç»„ä¸ºçº¿ç´¢çœ‹è°æŠŠå®ƒä½œä¸ºé™„åŠ ç»„äº†
ming
[root@centos7 ~]# groupmems -l -g g2
ming
[root@centos7 ~]# groupmems -l -g g3
ming
[root@centos7 ~]#

