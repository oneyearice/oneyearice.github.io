# ç¬¬5èŠ‚ Dockeré…ç½®ä¼˜åŒ–





docker å·¥ä½œæ˜¯åŸºäºé•œåƒï¼Œè€Œé•œåƒå­˜å‚¨çš„é©±åŠ¨ï¼Œé€šè¿‡docker infoå¯è§æ˜¯overlay2ã€‚

<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401113801442.png" alt="image-20240401113801442" style="zoom:50%;" />



![image-20240401114202132](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401114202132.png)



è¿™äº›å­˜å‚¨å¼•æ“ä¸ç®¡æ˜¯é‚£ç§ï¼Œéƒ½æ˜¯è”åˆæ–‡ä»¶ç³»ç»Ÿ

![image-20240401114700537](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401114700537.png)

æ¯”å¦‚ext4 xfsçš„æ–‡ä»¶ç³»ç»Ÿï¼Œç£ç›˜æŒ‚è½½åˆ°ç›®å½•ï¼Œæ˜¯ä¸å¯ä»¥é‡å¤æŒ‚è½½çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç›®å½•ä½ ä¸¤ä¸ªç¡¬ç›˜æŒ‚è½½çš„æ—¶å€™ï¼Œå‰é¢ä¸€ä¸ªå°±è¢«é¡¶æ‰äº†ã€‚

è€Œdockerçš„è”åˆæ–‡ä»¶ç³»ç»Ÿæ—¶å¯ä»¥æŠŠå¤šä¸ªè®¾å¤‡(æ‰€è°“è®¾å¤‡å°±æ˜¯ç¡¬ç›˜ã€åˆ†åŒºã€lvmè¿™äº›)æŒ‚è½½åˆ°ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå…¶æ•ˆæœå°±æ˜¯è¿™ä¸ªç›®å½•ä¸‹æ—¢å¯ä»¥çœ‹åˆ°è®¾å¤‡1ä¸Šçš„æ•°æ®ï¼Œä¹Ÿèƒ½çœ‹åˆ°è®¾å¤‡2ä¸Šçš„æ•°æ®ã€‚

â€‹		ä¸ºä»€ä¹ˆå¯ä»¥é‡‡ç”¨è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå°±æ˜¯å› ä¸ºdockerçš„imageæ˜¯å¤šå±‚é•œåƒã€‚

![image-20240401115713714](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401115713714.png)

imageæ˜¯ä¸€å±‚å±‚æ„å»ºå‡ºæ¥çš„

å®¹å™¨ç”Ÿæˆï¼Œæ˜¯å¤åˆ¶ä¸€ä»½é•œåƒï¼Œå¹¶åœ¨å…¶ä¸Šåˆæ·»åŠ äº†ä¸€å±‚writableå¯è¯»å¯å†™å±‚ï¼Œè¿™å±‚å°±ç”¨æ¥å­˜æ”¾å®¹å™¨è‡ªå·±çš„æ•°æ®--æ¯”å¦‚LOGã€‚

docker stop xxx ï¼Œå°±æ˜¯æŠŠå¤åˆ¶è¿‡æ¥çš„imageå±‚åˆ äº†ï¼Œå…¶ä¸Šçš„å®¹å™¨å­æ·±æ·±çš„writableå±‚è¿˜åœ¨çš„ã€‚

![image-20240401120512888](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401120512888.png)



å®¹å™¨å¯åŠ¨çš„æ—¶å€™å…¶å®æ˜¯å¯ä»¥ä¿®æ”¹å­˜å‚¨é©±åŠ¨çš„

![image-20240401133623870](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401133623870.png)

ä¸è¿‡ï¼Œæƒ³æ¥ä¸€èˆ¬æ˜¯ä¸ä¼šå»æ”¹çš„ã€‚ç¡®è®¤æ˜¯overlay2å°±è¡Œäº†ã€‚ä¸‡ä¸€ä¸æ˜¯å°±æ¢dockerç‰ˆæœ¬~

æŸ¥çœ‹æ”¯æŒçš„æ–‡ä»¶ç³»ç»ŸğŸ‘‡æ³¨æ„aufsæ˜¯aufsï¼Œautofsæ˜¯autofsï¼Œä¸è¦çæ

![image-20240401134116982](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401134116982.png)



# dockerä¼˜åŒ–

## ä¸‹è½½æºï¼Œå…¶å®åº”è¯¥ç§æœ‰åº“ä½œç¼“å­˜æ¥å¼„æ¯”å¦‚nexus

å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„ä¸ªäººé•œåƒåŠ é€Ÿåœ°å€

![image-20240401135538590](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401135538590.png)



![image-20240401140127212](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401140127212.png)



å…¶å®æœ€å¥½æ˜¯ç”¨ç§æœ‰ç¼“å­˜åº“æ¯”å¦‚nexushttps://cloud.tencent.com/developer/article/1764866



### socketé€šä¿¡-docker-clientå’Œserverä¹‹é—´çš„é€šä¿¡

![image-20240401142344030](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401142344030.png)

é»˜è®¤èµ°çš„æœ¬åœ°socketæ–‡ä»¶ï¼Œæ— æ³•æ”¯æŒè¿œç«¯çš„è°ƒç”¨ã€‚

é…ç½®æ–¹æ³•ğŸ‘‡ä¸‹å›¾ç»¿æ¡†æ¡†ï¼›ä½†æ˜¯ç”¨çš„ä¸å¤ªå¤šã€‚ä¸€èˆ¬å°±æ˜¯æœ¬åœ°è¿æ¥ã€‚

![image-20240401142523157](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401142523157.png)

è¯¥é…ç½®æ–‡ä»¶ç±»ä¼¼clié‡Œçš„-Hé€‰é¡¹ï¼Œæ—¢æœ‰socketæ–‡ä»¶ä¹Ÿæœ‰tcpï¼Œå¯èƒ½å°±æ˜¯å†™ä¸¤ä¸ª-Hå’¯

![image-20240401143339943](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401143339943.png)

è¿˜å¯ä»¥æ”¹serviceæ–‡ä»¶

![image-20240401143508966](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401143508966.png)



**å…ˆé€šè¿‡ä¿®æ”¹daemon.jsonå»è¯•ä¸‹**

![image-20240401165325655](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401165325655.png)

ä½†æ˜¯æŠ¥é”™äº†ğŸ‘†



**æ¢ä¸ªæ€è·¯ï¼Œå»serviceæ–‡ä»¶é‡Œæ”¹æ”¹**

![image-20240401170558409](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401170558409.png)

ç„¶åæŠŠdaemon.jsoné‡Œçš„hostsé‚£è¡Œåˆ äº†ï¼Œä¿®æ”¹ä¸º

<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402171915073.png" alt="image-20240402171915073" style="zoom:50%;" />

å†reload å’Œ restart

![image-20240401172813797](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401172813797.png)

æ­¤æ—¶tcpå’Œsocketæ–‡ä»¶éƒ½å¥½äº†

![image-20240401172847800](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401172847800.png)



![image-20240401173610011](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240401173610011.png)





æ­¤æ—¶å°±å¯ä»¥è¿œç«¯client è°ƒç”¨ server äº†ï¼Œä¹Ÿå°±æ˜¯docker cli è¿æ¥ docker serverå¼•èµ·å è°ƒç”¨å‘½ä»¤äº†

![image-20240402173332905](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402173332905.png)

ç„¶åè¿œç¨‹è·‘ä¸€ä¸ªnginxçœ‹çœ‹ï¼Œæ­¤æ—¶å®¹å™¨éƒ½æ˜¯é€€å‡ºçš„

![image-20240402173559934](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402173559934.png)

å»è¿œç«¯windowsçš„cmdé‡Œæ‰§è¡Œè¿œç¨‹cliï¼Œrunä¸€ä¸ªnginx

![image-20240402173718678](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402173718678.png)

ç„¶åå»serverçœ‹ä¸‹docker ps

![image-20240402173933777](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402173933777.png)

è¿™å°±å®ç°äº†è¿œç¨‹æ‰§è¡Œdocker cli

åŒæ—¶curl ç§ç§ï¼Œå› ä¸ºæ˜¯å®¹å™¨é‡Œçš„ipæ²¡æœ‰æš´éœ²å‡ºæ¥å‘¢ï¼Œæ‰€ä»¥ipsectçœ‹åˆ°ipåå®¿ä¸»æœºä¸Šcurlä¸‹ğŸ‘‡

![image-20240402174041031](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402174041031.png)

è¦æ³¨æ„docker engineä¹Ÿå°±æ˜¯æœåŠ¡ç«¯åœ¨å“ªï¼Œå®¹å™¨å°±è¿è¡Œåœ¨å“ªé‡Œï¼Œå®¢æˆ·éƒ½çš„cliåªæ˜¯ä¸€ä¸ªè¿æ¥è°ƒç”¨å·¥å…·ï¼Œå¾ˆå¥½ç†è§£ï¼Œå¥½æ¯”mysql è¿œç¨‹æ‰§è¡Œå‘½ä»¤ä¸€æ ·ã€‚



å°†æ¥åœ¨K8Sé‡Œçš„è·¨ä¸»æœºçš„è¿œç¨‹dockerè°ƒç”¨å¯èƒ½å°±æ˜¯ç”¨çš„è¿™ä¸ªã€‚ç›®å‰dockerå­¦ä¹ é˜¶æ®µè¿˜ç”¨ä¸åˆ°ã€‚

<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402180552713.png" alt="image-20240402180552713" style="zoom:50%;" />



<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402180924506.png" alt="image-20240402180924506" style="zoom:50%;" />



çœ‹æ¥æ˜¯æŸ¥ä¸åˆ°å°±å¾€ä¸‹ä¸€ä¸ªåœ°å€æŸ¥æ‰¾ã€‚



ç°åœ¨éƒ½æ˜¯systemdäº†ğŸ‘‡<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402181155813.png" alt="image-20240402181155813" style="zoom:55%;" />

ä¸ç”¨æ”¹äº†ï¼Œä»¥å‰æ˜¯è¿™ä¹ˆæ”¹çš„ğŸ‘‡ä¹Ÿæ˜¯daemon.jsoné‡Œ

<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402181223650.png" alt="image-20240402181223650" style="zoom:80%;" />







è¿˜æœ‰è¿™ä¸ªå®¹å™¨å’Œé•œåƒå­˜æ”¾çš„è·¯å¾„

![image-20240402181409786](5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402181409786.png)

é»˜è®¤æ˜¯è¿™é‡ŒğŸ‘†ï¼Œè¿™ä¹ˆæ”¹ğŸ‘‡æ”¹åˆ°å•ç‹¬çš„é«˜æ€§èƒ½ssdä¸Šå»ï¼Œå‰æ–‡è®²è¿‡äº†ï¼Œç›®å½•ä¸è¯¥ç›´æ¥æŒ‚åˆ°æ–°ç£ç›˜ä¸Šå»ï¼Œæˆ–è€…è¯¥ç›®å½•è¿™ä¸ªç›®å½•æŒ‚è¿‡å»ä¹Ÿè¡ŒğŸ‘‡

<img src="5-Dockeré…ç½®ä¼˜åŒ–.assets/image-20240402181801828.png" alt="image-20240402181801828" style="zoom:80%;" />

æ”¹ç›®å½•åï¼Œè€æ•°æ®--å°±æ˜¯å½“å‰å·²ç»äº§ç”Ÿçš„å®¹å™¨å’Œé•œåƒæ–‡ä»¶éƒ½æ˜¯è¿˜åœ¨è€åœ°æ–¹çš„ã€‚



ç°åœ¨ç«‹å³æ”¹ä¼šå‡ºç°çš„é—®é¢˜





