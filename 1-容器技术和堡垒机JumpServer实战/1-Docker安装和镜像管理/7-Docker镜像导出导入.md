# ç¬¬7èŠ‚ Dockeré•œåƒå¯¼å‡ºå¯¼å…¥



## é•œåƒå¯¼å‡ºå’Œå¯¼å…¥-æ¯”å¦‚äº’è”ç½‘ä¸‹è½½åå¯¼å…¥å¼€å‘å†…ç½‘å»-å¯¼å‡ºè¦ç”¨name:tag

![image-20240410181848729](6-Dockeré•œåƒæœç´¢å’Œä¸‹è½½.assets/image-20240410181848729.png)

docker save é»˜è®¤æ˜¯æ ‡å‡†è¾“å‡ºä¹Ÿå°±æ˜¯å±å¹•æ‰“å°äº†ï¼Œæ‰€ä»¥éœ€è¦-o write to a file ,instead of STDOUT

![image-20240410182058372](6-Dockeré•œåƒæœç´¢å’Œä¸‹è½½.assets/image-20240410182058372.png)

ğŸ‘†ä¸Šå›¾æ˜¯å±å¹•æ‹’ç»äº†è¿™ä¸ªè¾“å‡ºï¼Œå…¶å®è¿˜æ˜¯æœ‰STDOUTåŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨ä¸Šå›¾çš„cliåä½¿ç”¨é‡å®šå‘çš„ã€‚

å› ä¸ºsaveå‡ºæ¥æ˜¯taråŒ…æ ¼å¼ï¼Œæ‰€ä»¥è¦åŠ ä¸Š.tar

![image-20240410182145259](6-Dockeré•œåƒæœç´¢å’Œä¸‹è½½.assets/image-20240410182145259.png)

taråŒ…åªæ˜¯æ‰“åŒ…çš„ï¼Œæ²¡æœ‰å‹ç¼©çš„è¿™é‡Œï¼Œæ‰€ä»¥è¿˜éœ€è¦å‹ç¼©ä¸€ä¸‹ï¼Œå‡å°‘ç£ç›˜ç©ºé—´å ç”¨

![image-20240410182332654](6-Dockeré•œåƒæœç´¢å’Œä¸‹è½½.assets/image-20240410182332654.png)



ä¼˜åŒ–å‘½ä»¤ï¼Œå°±æ˜¯å¯¼å‡ºæ¥å°±æ˜¯å‹ç¼©çš„æ•ˆæœ

1ã€é¦–å…ˆä½¿ç”¨é‡å®šå‘

![image-20240410182718741](6-Dockeré•œåƒæœç´¢å’Œä¸‹è½½.assets/image-20240410182718741.png)



2ã€ç„¶å

![image-20240410183641772](6-Dockeré•œåƒæœç´¢å’Œä¸‹è½½.assets/image-20240410183641772.png)

æ€ä¹ˆç›´æ¥æ‰“å‡ºæ¥çš„ï¼Œå¤§å°è¿˜å°‘äº†11KBäº†ğŸ‘†ï¼Œå‘µå‘µï¼Œåº”è¯¥æ•°æ®æ²¡ä¸¢å“¦ï¼Œå“ˆå“ˆå“ˆï¼›å›å¤´å¯¼å…¥çš„æ—¶å€™çœ‹ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚



3ã€å¤åˆ¶åˆ°å…¶ä»–dockeræœºå™¨ä¸Šload

![image-20240411103714519](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411103714519.png)

loadçš„æ—¶å€™ğŸ‘†-iæˆ–<ä½¿ç”¨TDINéƒ½è¡Œï¼Œä¸è¿‡æ­¤æ—¶loadä¼šå¯¼è‡´danglingé•œåƒçš„äº§ç”Ÿï¼›è€Œå¯¼è‡´danlingé•œåƒä¹Ÿå°±æ˜¯\<none\>

çš„åŸå› æ˜¯å½“åˆsaveå¯¼å‡ºé•œåƒçš„æ—¶å€™ç”¨çš„æ˜¯IDè€Œä¸æ˜¯åç§°+TAGï¼Œæ‰€ä»¥æºå¤´å°±é”™äº†



å³ä½¿ä½ æƒ³é€šè¿‡tagå»è¡¥ä¹Ÿæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä½ å‹æ ¹å°±ä¸çŸ¥é“è¿™ä¸ªIDæ˜¯ä»€ä¹ˆé•œåƒinspectä¹Ÿçœ‹ä¸åˆ°äº†

![image-20240411104321475](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411104321475.png)

é™¤éä½ runèµ·æ¥è¿›å»çœ‹çœ‹æ˜¯ä¸ªå•¥å®¹å™¨ï¼Œå†çœ‹çœ‹imageçš„å“ˆå¸Œå€¼ï¼Œç„¶åå»å®˜ç½‘æ¯”å¯¹å“ˆå¸Œå€¼ï¼Œç„¶åæ‰“ä¸Šå¯¹åº”çš„ç‰ˆæœ¬å“ˆå“ˆ

![image-20240411104528999](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411104528999.png)



æé”™äº†ï¼Œå†æ¥ï¼Œå¯¼å‡ºçš„æ—¶å€™ä¸å¸¦tagå°±æ˜¯æ‰€æœ‰tagè¾¾æˆä¸€ä¸ªåŒ…ï¼Œå¸¦tagå°±æ˜¯é‚£ä¸ªtagçš„å¯¼å‡ºå’¯ğŸ‘‡

![image-20240411112234030](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411112234030.png)

![image-20240411112444403](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411112444403.png)



### æŠŠä¸€ä¸ªæœºå™¨çš„æ‰€æœ‰é•œåƒå¯¼å‡ºå¯¼å…¥åˆ°åˆ«çš„æœºå™¨







è¡¥å……ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸‹è½½å“ªä¸ªï¼Œè€Œä¸æ˜¯é€šè¿‡è‡ªåŠ¨åˆ¤æ–­ä½ æ˜¯amd64çš„ï¼Œ

![image-20240411110840564](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411110840564.png)



![image-20240411110801379](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411110801379.png)

å°±æ˜¯æ²¡æœ‰tagäº†ï¼Œè‡ªå·±æ‰“å’¯ç”¨ä¸Šé¢çš„docker tag æ¥æ‰“





### æ‰€æœ‰é•œåƒå¯¼å‡º



1ã€ä¹Ÿç®—æ˜¯ä¸€æ¡å‘½ä»¤æå®šå§

![image-20240411133601695](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411133601695.png)

```shell
docker save `docker images --format "{{.Repository}}" |sort |uniq |xargs` -o  all_images.tar


# æ¨èè¿™ä¸ªå§ğŸ‘‡ï¼Œè™½ç„¶uniqé‚£ç§ä¹Ÿä¸é”™
docker save `docker images --format "{{.Repository}}:{{.Tag}}"` |gzip > all_images.tar.gz


docker save `docker images --format "{{.Repository}}" |sort |uniq |xargs` |gzip > all_images_end.tar.gz
```

å› ä¸ºå‹ç¼©è¦æ—¶é—´çš„ï¼Œæ‰€ä»¥ä½ è‡ªå·±é€‰æ‹©å…·ä½“cliğŸ‘†

![image-20240411135308318](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411135308318.png)

![image-20240411135547479](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411135547479.png)

ç»¼ä¸Šæ‰€è¿°ï¼Œæ¨èçš„cliæ˜¯

```shell
docker save `docker images --format "{{.Repository}}"` |sort |uniq |gzip > all_images.tar.gz          # å’Œä¸Šå›¾çš„åŒºåˆ«å°±æ˜¯çœç•¥æ‰äº†xargsï¼Œä¸ç”¨ä¹Ÿä¸€æ ·çš„æ•ˆæœ

ğŸ‘†ä¸Šé¢çš„cliï¼Œæœ‰é”™è¯¯ï¼Œåå¼•å·å†™é”™äº†ï¼Œå¯¼è‡´sort cpuå ç”¨ç‡100% æ— é™æ°¸ä¹…å¡ä½äº†ï¼Œä¿®æ”¹åğŸ‘‡å°±æ¢å¤äº†

docker save `docker images --format "{{.Repository}}" |sort |uniq` |gzip > all_images_no_xargs.tar.gz       # è¿™ä¸ªå°±è¡Œäº†â˜…
```

sortå¡ä½ä¸åŠ¨çš„CPUğŸ‘‡

![image-20240411140012298](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411140012298.png)

ä¸€ä¸ªsort 100% cpu å•Šï¼Ÿä¸æ­£å¸¸ã€‚æ­£å¸¸ï¼Œç¨å¾®åˆ†æä¸‹å°±çŸ¥é“ç­”æ¡ˆäº†ï¼š

â€‹		å¡çš„åŸå› ä¹Ÿå¥½ç†è§£--å°±æ˜¯docker save xxx å…¶å®å°±æ˜¯imagesçš„å¯¼å‡ºå†…å®¹äº†ï¼Œæ˜¯å†…å®¹å•Šï¼Œæ‰€ä»¥å¾ˆå¤§ï¼Œä¸€ç›´åœ¨sortæ’åºï¼Œæ‰€ä»¥sortå¤„ç†å¤§é‡çš„æ•°æ®äº†å°±ï¼Œä»€ä¹ˆä½ è¡¨ç¤ºæ€€ç–‘ï¼Œå“¦ï¼Œé‚£ä½ ç”¨docker save xxx |cat çœ‹çœ‹å°±çŸ¥é“å•¦

![image-20240411141836886](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411141836886.png)

ä½ è¯´sortå¿™çš„è¿‡æ¥ä¸ï¼Œè¿™è¿˜æ˜¯ä¸€éƒ¨åˆ†ï¼Œä¸‹é¢æ²¡å®Œæ²¡äº†çš„ä¹±ç  äºŒè¿›åˆ¶ æ ¼å¼ğŸ‘‡

![image-20240411142046969](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411142046969.png)

çº æ­£æˆªå›¾ğŸ‘‡

![image-20240411140813895](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411140813895.png)



**åˆ é™¤æ‰€æœ‰é•œåƒ**

```shell
docker rm -f `docker images -aq`
```

ï¼Œå†å¯¼å…¥å°±å…¨éƒ¨å›æ¥äº†ğŸ‘‡

![image-20240411133837034](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411133837034.png)

è¿™æ ·ä¹Ÿè¡Œï¼š

![image-20240411142722570](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411142722570.png)



### è¿˜æœ‰è™½ç„¶æ˜¯taråŒ…ï¼Œä½†æ˜¯è§£å¼€åæ˜¯çœ‹ä¸åˆ°imagesçš„ï¼Œè€Œæ˜¯ä¸€å±‚ä¸€å±‚æ–‡ä»¶ï¼Œè¿˜å¾—æ˜¯loadæ‰è¡Œ

![image-20240411143234917](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411143234917.png)



![image-20240411143311984](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411143311984.png)



### ç„¶åçœ‹çœ‹taråŒ…é‡Œçš„è¿™äº›æ–‡ä»¶å§

![image-20240411143814596](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411143814596.png)

ä¸€ä¸ªè§£åŒ…å¤šå‡ºè¿™ä¹ˆå¤šï¼Œç»§ç»­

![image-20240411143856629](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411143856629.png)

å‘ç°ğŸ‘†layer.tarè§£å¼€é‡Œé¢å°±æ˜¯ä¸€ä¸ªç²¾ç®€çš„ linuxçš„ æ ¹ç›®å½• / 

![image-20240411144041029](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411144041029.png)

å¯¹æ¯”å‘ç°ï¼Œå°‘äº†bootè¿™ä¸ªä¹ˆä¸€ä¸ªé‡è¦çš„æ–‡ä»¶ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œbootfså¯ä¸æ˜¯åœ¨å®¹å™¨é‡Œï¼Œè€Œåœ¨kernelé‡Œæ˜¯å®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨é‡Œåªæœ‰rootfså±‚ä»¥åŠä»¥ä¸Š--è¿™äº›æ˜¯ç”¨æˆ·ç©ºé—´çš„ä¸œè¥¿ã€‚

<img src="7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411144259762.png" alt="image-20240411144259762" style="zoom:33%;" /> <img src="7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411144320260.png" alt="image-20240411144320260" style="zoom:33%;" />



ç„¶åç»§ç»­çœ‹

![image-20240411144844245](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411144844245.png)

è¿™ä¸ªç²¾ç®€é•œåƒé‡Œçš„binä¸‹çš„äºŒè¿›åˆ¶éƒ½æ˜¯busyboxè¿™ä¸ªäºŒè¿›åˆ¶çš„åˆ«åã€‚

æ‰€ä»¥è¿™äº›cat ã€ df ã€grepã€mvã€lså„ç§linuxçš„å‘½ä»¤éƒ½æ˜¯busyboxè¿™ä¸ªäºŒè¿›åˆ¶æ¨¡æ‹Ÿå‡ºæ¥çš„ï¼ŒæœçœŸå¾ˆbusyå•Š~

å°è¯•ä½¿ç”¨è¯¥ç‰›é€¼çš„äºŒè¿›åˆ¶ï¼Œç»“æœå‘ç°ç”¨ä¸äº†ğŸ‘‡

![image-20240411145241074](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411145241074.png)

éš¾é“æœ‰åº“ä¾èµ–ï¼Œè¿˜çœŸæœ‰ğŸ‘‡

![image-20240411145409842](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411145409842.png)



<img src="7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411145620231.png" alt="image-20240411145620231" style="zoom:44%;" />



ç„¶åbusyboxå®¹å™¨é‡Œçš„åˆ†å±‚æ–‡ä»¶é‡Œï¼Œæœç„¶æœ‰è¿™ä¾èµ–åº“çš„ğŸ‘‡

![image-20240411145758413](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411145758413.png)

åªè¦æŠŠè¿™ä¸ªä¾èµ–å¤åˆ¶åˆ°å®¿ä¸»çš„/libä¸‹åº”è¯¥å°±å¯ä»¥äº†ï¼Œå› ä¸ºè¦åœ¨å®¿ä¸»ç”¨ï¼Œå®¿ä¸»æ‰¾çš„è¿™ç§soæ–‡ä»¶è¿˜æ˜¯ä¼šä»/libä¸‹å»æ‰¾å§

![image-20240411150232990](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411150232990.png)

å°†ä¾èµ–å¤åˆ¶åˆ°å®¿ä¸»çš„/lib/æˆ–/lib64/ä¸‹ï¼Œè®°å¾—é€€å‡ºä¸€ä¸‹ï¼Œå¦åˆ™è¿˜æ˜¯è¯†åˆ«ä¸åˆ°

![image-20240411150418943](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411150418943.png)

å¯è§busybox --list å¾—åˆ°å…·ä½“çš„æŒ‡ä»¤

![image-20240411150822717](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411150822717.png)

æˆ‘ç”¨xargs åšäº†æ¨ªå‘æ’åˆ—ï¼Œçœ‹åˆ°äº†ping

äºæ˜¯busyboxç”¨ping

![image-20240411150908557](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411150908557.png)

ä¼˜ç§€ğŸ‘†

![image-20240411153150965](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411153150965.png)

very good

![image-20240411153922548](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411153922548.png)

ğŸ‘†ä¸Šå›¾å¯è§busyçš„å¤§å°æ˜¯æç®€çš„ï¼Œä¸ä»…ä»…cliå°‘ï¼Œè€Œä¸”clié‡Œçš„æŸä¸ªå‘½ä»¤çš„åŠŸèƒ½ä¹Ÿæ˜¯å°‘å¾ˆå¤šã€‚ä½†æ˜¯ä¹Ÿå¤Ÿç”¨äº†ğŸ‘‡

![image-20240411154645001](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411154645001.png)



### è¡¥å……ï¼šæ‰“tagçš„

![image-20240411161318249](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411161318249.png)

ä¸‹è½½çš„æ—¶å€™ä¹Ÿè¦æŒ‡å®šä½¿ç”¨å“ªé‡Œçš„é•œåƒï¼Œå¦åˆ™å°±æ˜¯ä»deamon.jsoné…ç½®çš„ä»“åº“ä¸‹è½½ï¼Œä»€ä¹ˆæ²¡æœ‰jsonæ–‡ä»¶ï¼Œé‚£å°±æ˜¯é»˜è®¤çš„å®˜ç½‘äº†ã€‚

![image-20240415093442286](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240415093442286.png)



ä¸Šå›¾ğŸ‘†æ˜¯tagæ‰“äº†è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ï¼Œæ‰€ä»¥è¦è¿™ä¹ˆæ‰“ï¼Œåˆ°æ—¶å€™ï¼Œpushçš„æ—¶å€™ä¹Ÿå°±æ˜¯æ¨é€åˆ°å¯¹åº”çš„æœåŠ¡å™¨å’Œç›®å½•çš„ã€‚

å¦‚æœæ˜¯æœ¬åœ°ç”¨ï¼Œå°±åªå†™ä¸ªé•œåƒåå’Œtagå°±è¡Œäº†

![image-20240411162141986](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411162141986.png)



æ€»ç»“

1ã€dockerå®‰è£…ï¼Œè¿˜æ˜¯è¦å…ˆæŠŠä»“åº“é…ç½®å¥½çš„ï¼Œå…·ä½“æ“ä½œå¾ˆç®€å•ï¼Œå°±æ˜¯

https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/



2ã€ç¦»çº¿å®‰è£…ï¼Œè§<img src="7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411164931857.png" alt="image-20240411164931857" style="zoom:50%;" />

ç¦»çº¿å®‰è£…ä¹Ÿåˆ†å®˜æ–¹è„šæœ¬å’Œéå®˜æ–¹çš„ï¼Œå“ˆå“ˆ

https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/



3ã€å°ç»“ä¸‹

![image-20240411173615058](7-Dockeré•œåƒå¯¼å‡ºå¯¼å…¥.assets/image-20240411173615058.png)

