# ç¬¬1èŠ‚ Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•



# dockeræ€ä¹ˆç®¡ç†å®¹å™¨çš„



## æ¦‚è¿°





 <img src="1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415101723667.png" alt="image-20240415101723667" style="zoom:50%;" />

![image-20240415103201163](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415103201163.png)









![image-20240415103824654](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415103824654.png)

äº’è”ç½‘ä¸Šçš„é•œåƒï¼Œä¸éœ€è¦ç™»å…¥ï¼Œç›´æ¥ä¸‹è½½ï¼Œä¸€èˆ¬å…¬å¸ç§æœ‰çš„é•œåƒæ‰éœ€è¦loginåå»ä¸‹è½½



## COMMAND

![image-20240415104528966](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415104528966.png)



![image-20240415105021283](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415105021283.png)

â€‹		å¯ä»¥ä¿®æ”¹ä¸ºè‡ªå·±å¸Œæœ›æ‰§è¡Œçš„å‘½ä»¤ï¼Œä»¥åŠåŠ ä¸ŠARGä¹Ÿå°±æ˜¯è·Ÿä¸Šå‚æ•°ï¼Œä½†æ˜¯åŠ çš„çš„cliå¿…é¡»æ˜¯äººå®¶å®¹å™¨é‡Œæœ‰çš„å‘½ä»¤å¦åˆ™æ— æ³•æ‰§è¡Œçš„ã€‚æ¯”å¦‚ä¸Šå›¾hello-worldå®¹å™¨é‡Œåªæœ‰/helloè¿™ä¸ªå‘½ä»¤ï¼Œå…¶ä»–çš„çº¢è‰²æ¡†æ¡†ğŸ‘†é‡Œçš„ciléƒ½æ˜¯æ²¡æœ‰çš„ï¼Œ æ‰€æœ‰éƒ½æ˜¯æŠ¥é”™çš„ã€‚   # æˆ‘å°±æƒ³åˆ°å…¶å®å®¹å™¨é‡Œæ˜¯å¦å¯ä»¥å°è£…ä¸€ä¸ªbusyboxå‘¢ï¼Œå“ˆå“ˆåŸºæœ¬å¾ˆå¤šå¸¸ç”¨cliå°±éƒ½æœ‰äº†ã€‚æˆ‘è§‰å¾—è¿˜ä¸é”™~

â€‹		é•œåƒå°±æ˜¯æ²¡æœ‰boot(å†…æ ¸)çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ+appç¨‹åºæ–‡ä»¶(mysqlã€nginxã€ç­‰å„è‡ªçš„ç¨‹åºåŒ…æ‹¬å„è‡ªä¾èµ–çš„åº“)ã€‚





ä¸‹ä¸ªbusyboxçœ‹çœ‹å¤šå¤§æ˜¯å¦å¯ä»¥åé¢é›†æˆåˆ°æˆ‘å·¥ä½œä¸­çš„imagesé‡Œ

1ã€é¦–å…ˆhub.docker.comæœç´¢latest

![image-20240415113859282](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415113859282.png)

2ã€ç„¶åæ‰¾å“ˆå¸Œå€¼ä¸€æ ·çš„ç‰ˆæœ¬å·ï¼Œ

æœ‰åŒå­¦é—®ï¼Œé‚£ä½ ä¸ºä»€ä¹ˆä¸ç›´æ¥ä¸‹latestï¼Œä½ çŒœæˆ‘ä¸ºå•¥

![image-20240415114000088](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415114000088.png)



![image-20240415114057219](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415114057219.png)

5MBä¸åˆ°ï¼Œå¯ä»¥æ¥å—å§~







### alpineä¸¾ä¾‹ï¼Œè¯´æ˜commondçš„æ˜¯å‰å°cliï¼Œå¦åˆ™å°±æ˜¯è¿è¡Œåå³é€€å‡º

![image-20240415112457390](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415112457390.png)

â€‹		å®¹å™¨è¿è¡Œèµ·æ¥ä¸é€€å‡ºï¼Œè¦æ±‚å®¹å™¨è¿è¡Œæ—¶å¯¹åº”çš„COMMANDçš„æ˜¯å‰å°æ‰§è¡Œï¼Œè€ŒğŸ‘†/bin/shæ˜¯ä¸€ä¸ªåå°æ‰§è¡Œçš„cliï¼Œæ‰€ä»¥è¿è¡Œåå°±æå‡ºäº†ã€‚ç±»ä¼¼docker run nginxæ‰§è¡Œäº†å°±æ˜¯å‰å°å ç”¨ã€‚

â€‹		æ‰€è°“å‰å°æ‰§è¡Œå°±æ˜¯æ‰§è¡Œåå°±éœ¸å äº†å‰å°ï¼Œè€Œä¼ ç»Ÿsystemctl start nginxè¿™ç§å¯åŠ¨æ–¹å¼åœ¨å®¹å™¨é‡Œå°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œå› ä¸ºåå°æ‰§è¡Œï¼Œå®¹å™¨é‡Œæ‰§è¡Œå°±é€€å‡ºäº†ã€‚

![image-20240415112958240](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415112958240.png)



![image-20240415113014809](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415113014809.png)



![image-20240415131028393](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415131028393.png)  

æ€ä¹ˆåœä¸æ‰å•ŠğŸ‘†ï¼Œå…³é—­çª—å£è¿˜æ˜¯upçš„ï¼Œå› ä¸ºæ²¡æœ‰-itäº¤äº’ï¼Œä½ çš„ctrl c å‘ä¸è¿›å»ğŸ‘†

![image-20240415131139775](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415131139775.png)



åŠ ä¸ª-d æ”¾åå°ï¼Œä½†æ˜¯ä¸ä¼šé€€å‡ºï¼Œå› ä¸ºç”¨çš„cli æ˜¯å‰å°å°±è¡Œã€‚

![image-20240415131210932](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415131210932.png)





![image-20240415131722121](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415131722121.png)



![image-20240415131829745](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415131829745.png)



### --nameé€‰é¡¹ï¼ŒæŒ‡å®šå®¹å™¨NAME

æ¯”å¦‚æŒ‡å®šå®¹å™¨çš„NAMEæ–¹ä¾¿åé¢ï¼Œæ¯”å¦‚å®¹å™¨ä¹‹é—´çš„äº’è®¿

![image-20240415133543953](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415133543953.png)

éšæœºçš„åå­—è‚¯å®šå¯è¯»æ€§ä¸å¥½ğŸ‘†

![image-20240415133729937](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415133729937.png)





![image-20240415134402626](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415134402626.png)





### -itäº¤äº’æ¨¡å¼è¿›å…¥å®¹å™¨é‡Œï¼Œçœ‹çœ‹æ–‡ä»¶ï¼Œçœ‹çœ‹çŠ¶æ€ç­‰æ“ä½œ

![image-20240415135101975](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415135101975.png)

-iæ˜¯äº¤äº’ï¼Œè¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦ä¸€ä¸ªttyæ¥å£ï¼Œç±»ä¼¼äº¤æ¢æœºçš„vty

-i -t è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦äº¤äº’çš„shå¦åˆ™ğŸ‘‡

![image-20240415135433555](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415135433555.png)

-it é…åˆä»€ä¹ˆshellï¼Œå°±æ˜¯å°è¯•å°è¯•å°±è¡Œäº†

![image-20240415135719648](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415135719648.png)

ğŸ‘†è¿™å°±è¿›æ¥äº†



ä¸ä»…ä»…æœ‰bashä¹Ÿæœ‰/bin/sh

![image-20240415140235224](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415140235224.png)



### åªæ˜¯ç”¨äº†bashäº¤äº’ï¼Œrunçš„commandè¿˜æ˜¯åŸæ¥çš„é‚£ä¸ªè„šæœ¬

![image-20240415160059055](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415160059055.png)

![image-20240415160130449](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415160130449.png)

è¿›æ¥åï¼Œ

![image-20240415160311606](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415160311606.png)

é€šè¿‡ğŸ‘†booté‡Œæ˜¯ç©ºçš„å°±çŸ¥é“äº†ï¼Œå®¹å™¨ç”¨çš„æ˜¯å®¿ä¸»çš„boot(å†…æ ¸)ï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯ç©ºçš„ã€‚



![image-20240415160438367](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415160438367.png)

è¿™ä¸ªnginxæ˜¯åŸºäºDebianåšå‡ºæ¥çš„ï¼ŒDebianç³»åˆ—çš„å…¸å‹ä»£è¡¨å°±æ˜¯ubuntuäº†ï¼Œaptå°±æ˜¯yumäº†



### å®‰è£…ps

![image-20240415161859681](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415161859681.png)



![image-20240415161921232](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415161921232.png)

pså°±æœ‰äº†ğŸ‘‡

![image-20240415161938718](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415161938718.png)



### å®¹å™¨é‡Œç”¨sedä¿®æ”¹ä¸ºæ¸…åæºï¼Œå®‰è£…æ›´å¿«ï¼Œè°ƒè¯•æ›´æ–¹ä¾¿

å®¹å™¨å®‰è£…ä¸œè¥¿å¤§å¤šæ•°éƒ½æ˜¯è°ƒè¯•ç”¨çš„ã€‚

```shell
sed -i 's|http://deb.debian.org/debian|https://mirrors.tuna.tsinghua.edu.cn/debian|g' /etc/apt/sources.list.d/debian.sources
sed -i 's|http://deb.debian.org/debian-security|https://mirrors.tuna.tsinghua.edu.cn/debian-security|g' /etc/apt/sources.list.d/debian.sources

```



å®¹å™¨exitå°±çœŸçš„å°†å®¹å™¨é€€å‡ºäº†ï¼Œå³ä½¿å®¹å™¨æœ¬æ¥æ—¶runèµ·æ¥å°±å‰å°æ‰§è¡Œçš„é‚£ç§ï¼Œä½ ç”¨-it bashè¿›å»å†exitï¼Œå®¹å™¨å°±ä¸å†æ—¶runningäº†ğŸ‘‡

![image-20240415163327923](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415163327923.png)

å¦‚æœä¸æƒ³exité€€å‡ºçš„æ—¶å€™æŠŠæœ¬æ¥åº”è¯¥å‰å°æ‰§è¡Œçš„å®¹å™¨é€€å‡ºä¹Ÿå¯ä»¥ç”¨ctrl p q ç»„åˆé”®æ¥å®‰å…¨é€€å‡ºï¼Œä¸è¿‡æ­¤æ—¶nginxå°±ä¸å†æ—¶å‰å°äº†ï¼Œè€Œæ˜¯åå°upäº†ï¼Œç±»ä¼¼äºdocker run -d nginxäº†

![image-20240415163851622](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415163851622.png)

ä¸Šå›¾ğŸ‘†ä¸æ˜¯nginxè¿™ç§runèµ·æ¥å°±upçš„ï¼Œä¸€æ ·ä¹Ÿä¼šè¢«ctl p qå˜æˆåå°upğŸ‘‡

![image-20240415164200367](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415164200367.png)

è¿™ä¸‹å€’å­¦åˆ°äº†ä¸€ä¸ªè®©hello-worldåå°UPçš„æ–¹æ³•ï¼Œèµ¶ç´§è¯•è¯•ğŸ‘‡ï¼Œä¸è¡Œäººå®¶å‹æ ¹å°±æ²¡æœ‰shellï¼Œæ‰€ä»¥æ— æ³•è¿›å»ã€‚è€Œæœ‰shellçš„å€’æ˜¯å¯ä»¥ç”¨è¿™ç§æ–¹å¼åå°UPç€ã€‚



### run -itç”¨çš„å°‘ï¼Œå¤§å¤šæ•°éƒ½æ˜¯exec -itæ¥é’ˆå¯¹è¿è¡Œä¸­çš„å®¹å™¨è¿›è¡Œäº¤äº’æ’é”™

æ¯”å¦‚runäº†ä¸€ä¸ªnginx

![image-20240415170121263](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415170121263.png)

å‘ç°æŸä¸ªé—®é¢˜ï¼Œéœ€è¦è¿›å»æ’é”™ï¼Œäºæ˜¯docker exec -itè¿›å»

![image-20240415170306952](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415170306952.png)



![image-20240415170755466](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415170755466.png)



### hostnameåªåœ¨å®¹å™¨å†…éƒ¨ç”Ÿæ•ˆï¼Œä¸å…·å¤‡å®¹å™¨äº’é€šçš„åŠŸæ•ˆï¼Œåªæ˜¯åœ¨å®¹å™¨å†…éƒ¨å¯ä»¥æ‹¿æ¥æœ¬åœ°é€šä¿¡ã€‚

é€šè¿‡è¿™ä¸ªhostnameå’Œæœ¬æœºçš„ç¨‹åºé€šä¿¡

![image-20240415171241453](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415171241453.png)



### å®¹å™¨è¿è¡Œèµ·æ¥åï¼Œé€€å‡ºè‡ªåŠ¨åˆ é™¤ï¼Œä¸´æ—¶æµ‹è¯•å±è‚¡æ“¦çš„æ¯”è¾ƒå¹²å‡€

![image-20240415172738881](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415172738881.png)

åªè¦å®¹å™¨runå®Œé€€å‡ºçš„ï¼Œé‚£ä¹ˆå°±ç»™ä½ åˆ é™¤

![image-20240415173656774](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415173656774.png)





â€‹                                <img src="1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415175042057.png" alt="image-20240415175042057" style="zoom:66%;" /> 

æ‰€ä»¥ï¼Œè¦åšå®ˆæŠ¤å¼å®¹å™¨ï¼Œå°±å¾—è‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹æ˜¯å‰å°æ°¸ä¹…è¿è¡Œçš„ğŸ‘†

å¾ˆå¤šæ·»åŠ å‰å°æ°¸ä¹…è¿è¡Œçš„æ‰‹æ®µï¼š

```shell
docker run alpine:3.19.1 tail -f /dev/null
```

![image-20240415175639814](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415175639814.png)

ğŸ‘†ä¸Šå›¾å°±æ˜¯å‰å°è¿è¡Œä¸ä¼šé€€å‡ºï¼Œé˜²æ­¢è¢«ctrl cé€€å‡ºï¼Œäºæ˜¯åŠ ä¸€ä¸ª-dï¼Œæ˜¯å…ˆä¿è¯ä¸€ä¸ªå‰å°cliå†æ”¾åˆ°åå°ğŸ‘‡

![image-20240415175624436](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415175624436.png)

ç„¶åå‰æ–‡ä¹Ÿè¯´äº†ï¼Œè¿™é‡Œä¹Ÿå¤åˆ¶è¿‡æ¥ä¸€å¹¶çœ‹ä¸‹ğŸ‘‡

![image-20240415131028393](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415131028393.png)  

æ€ä¹ˆåœä¸æ‰å•ŠğŸ‘†ï¼Œå› ä¸ºæ²¡æœ‰-itäº¤äº’ï¼Œä½ çš„ctrl c å‘ä¸è¿›å»ğŸ‘† æ”¾å±-itä¹Ÿä¸è¡Œ

![image-20240415182339492](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415182339492.png)

å…³é—­çª—å£ä¹Ÿæ²¡ç”¨

![image-20240415180943058](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415180943058.png)

åªèƒ½docker rm -fäº† ğŸ‘‡

![image-20240415180617565](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415180617565.png)









### é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ

1ã€docker run alpine tail -f /dev/null       æ— æ³•ctrl c ä¸­æ–­

2ã€docker run nginx        ä¸ºå•¥å¯ä»¥ctrl c ä¸­æ–­

éš¾é“nginxçš„COMMANDé‡Œçš„ä¹Ÿå°±æ˜¯xxx.shé‡Œæ˜¯ç”¨äº†-itçš„ï¼Ÿ

ä¸è¡Œ1ï¼šç”¨sh -c åŒ…è£…ä¹Ÿä¸è¡Œï¼Œå°±æ˜¯ä¸æ¥å—ctrl cï¼Œä¸çŸ¥é“ä¸ºå•¥

![image-20240415182831970](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240415182831970.png)







### docker run -d nginx   -dçš„åå°å’Œnginxçš„å‰å°

1ã€-dçš„åå°æ˜¯docker run è¿™ä¸ªå‘½ä»¤åå°æ‰§è¡Œ

2ã€nginxå®¹å™¨å‰å°æ‰§è¡Œï¼Œæ˜¯nginxå®¹å™¨çš„COMMANDæ˜¯å®¹å™¨é‡Œçš„cliæ˜¯åœ¨å®¹å™¨é‡Œå‰å°

æ‰€ä»¥è¦åŒºåˆ†å¼€æ¥

ä¸€èˆ¬éƒ½æ˜¯-d åœ¨åå°runï¼ŒæœåŠ¡ç±»çš„å®¹å™¨è‚¯å®šè¦å®¹å™¨é‡Œçš„cmdæ˜¯å‰å¤©çš„ã€‚





nginxä¸ºä¾‹ï¼Œå®¹å™¨é‡Œçš„cmdæ˜¯å‰å°æ‰§è¡Œçš„ï¼Œæ—¥å¿—(æ¯”å¦‚è®¿é—®æ—¥å¿—)å°±æ˜¯å±å¹•STDOUTçš„ï¼Œdocker run -d runåœ¨åå¤ªåï¼Œæ—¥å¿—å°±ç”¨cliå»çœ‹

![image-20240416111024282](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416111024282.png)

åå°è¿è¡Œ-d çš„å®¹å™¨logæŸ¥çœ‹ä¹Ÿç®€å•docker logs idxxxå°±è¡ŒğŸ‘‡

![image-20240416111411691](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416111411691.png)

**docker logs -f xxx  å°±å¾ˆnice**

![image-20240416112145563](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416112145563.png)



è¿˜æœ‰ä¼ ç»Ÿè‰ºèƒ½watch -n xxx

![image-20240416112505684](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416112505684.png)

ä¸‹å›¾æ˜¯wathc -n 5 docker logs nginx001çš„æ•ˆæœğŸ‘‡ï¼Œå°±æ˜¯-n 5ç§’åˆ·ä¸€æ¬¡ï¼Œä¹Ÿæ˜¯å®æ—¶çš„ã€‚

![image-20240416112520742](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416112520742.png)





### å®¹å™¨çš„è‡ªå¯åŠ¨ï¼Œä¸æ˜¯è¯´åŸæ¥exitedï¼Œå˜æˆäº†upï¼Œè€Œæ˜¯è¯´upè¿˜æ˜¯up

1ã€ä¹‹å‰å­¦è¿‡ä¸€ä¸ªï¼Œè¿™æ˜¯docker æœåŠ¡é‡å¯ï¼Œå®¹å™¨åŸæœ¬UPçš„è¿˜æ˜¯UPã€‚

![image-20240416113106028](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416113106028.png)

stop è¿‡30s start éƒ½æ˜¯okçš„ï¼Œå°±æ˜¯è¯´å®¹å™¨éšdockeræœåŠ¡ï¼ŒåŸæ¥å¯åŠ¨çš„ï¼Œè¿˜æ˜¯å¯åŠ¨çš„

![image-20240416113451378](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416113451378.png)

å½“ç„¶åŸæ¥æ˜¯åœæ­¢çš„ï¼Œå°±ä¸ä¼šè‡ªå¯åŠ¨äº†ã€‚





2ã€å®¹å™¨æœåŠ¡é‡å¯çš„æ—¶å€™ï¼Œé‡å¯çš„æ—¶å€™å®¹å™¨çš„çŠ¶æ€æ˜¯ä»€ä¹ˆ + policy æ˜¯ä»€ä¹ˆ ==> é‡å¯å¼•æ“å å®¹å™¨çš„çŠ¶æ€ä¼šæ˜¯ä»€ä¹ˆ

![image-20240416113650207](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416113650207.png)

no	ï¼š  é€€å‡ºäº†ä¸é‡æ–°UPï¼Œ	è¿™æ˜¯é»˜è®¤å€¼ï¼Œ# é‡å¯çš„æ—¶å€™å®¹å™¨æ˜¯é€€å‡ºçš„ï¼ˆä¸ç®¡æ˜¯å¼‚å¸¸è¿˜æ˜¯æ­£å¸¸ï¼‰ï¼Œé‚£ä¹ˆé‡å¯æœåŠ¡åï¼Œå®¹å™¨è¿˜æ˜¯é€€å‡ºï¼Œè¿™å°±æ˜¯noã€‚



on-failure[:max-retries]	 :   å¼‚å¸¸é€€å‡ºå°±é‡æ–°UPï¼Œå°è¯•Næ¬¡ã€‚   non-zero exit statusï¼Œè¿™æ˜¯$? â‰ 0 çš„æ„æ€ï¼Œå°±æ˜¯å¼‚å¸¸é€€å‡ºï¼ŒçŠ¶æ€ç ä¸ç­‰äº0ã€‚  # é‡å¯å‰å®¹å™¨æ˜¯å¼‚å¸¸é€€å‡ºçš„ï¼Œé‡å¯æœåŠ¡åï¼Œå®¹å™¨å°±ä¼šå°è¯•èµ·æ¥ã€‚



always    ï¼š  æ— è®ºé€€å‡ºç æ˜¯ä»€ä¹ˆ--ä¹Ÿå°±æ˜¯ä¸ç®¡æ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å¼‚å¸¸é€€å‡º--ä¹Ÿå°±æ˜¯ä¸ç®¡è®¤ä¸ºé€€å‡º($?=0)è¿˜æ˜¯å¼‚å¸¸é€€å‡º($?â‰ 0)éƒ½éšå®¿ä¸»æœºå™¨èµ·æ¥è€Œèµ·æ¥ï¼›  #   é‡å¯æœåŠ¡(å•¥é‡å¯æœºå™¨ï¼Œé‡å¯æœºå™¨ä¹Ÿæ˜¯å¯¹åº”åˆ°é‡å¯docker å¼•æ“ï¼Œæææ¸…æ¥šï¼Œè®²çš„ä»€ä¹ˆä¸œè¥¿ï¼Œå½“ç„¶æ•´ä½“è¿˜æ˜¯ä¸é”™ï¼Œè¿™é‡Œè®²çš„å¾ˆï¼Œä¸å¥½è¯´ä»€ä¹ˆäº†)çš„æ—¶å€™å®¹å™¨ä¸ç®¡æ˜¯æ€ä¹ˆé€€å‡ºçš„ï¼Œæ˜¯ä½ é‡å¯å¯¼è‡´é€€å‡ºè¿˜æ˜¯æœ¬æ¥å°±æ˜¯è®¤ä¸ºé€€å‡ºçš„ï¼Œé‡å¯åéƒ½ç»™ä½ èµ·æ¥ã€‚ ä¸noç›¸å¯¹ã€‚



unless-stopped	ï¼š  é‡å¯æœºå™¨(æœåŠ¡)çš„æ—¶å€™å®¹å™¨å¦‚æœæ˜¯äººä¸ºé€€å‡ºçš„ï¼Œé‚£ä¹ˆå¯åŠ¨äº†å°±ä¸ä¼šç»™ä½ UPå®¹å™¨ï¼Œå¦‚æœå®¹å™¨æ˜¯å¼‚å¸¸é€€å‡ºçš„ï¼Œæ¯”å¦‚é‡å¯çš„æ—¶å€™å®¹å™¨è¿˜æ˜¯UP( é‚£ä¹ˆé‡å¯çš„æ—¶å€™å®¹å™¨å°±ä¼šæ˜¯å¼‚å¸¸é€€å‡º )ï¼Œé‡å¯åå®¹å™¨å°±ç»™ä½ UPèµ·æ¥







![image-20240416142113963](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416142113963.png)





![image-20240416142548690](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416142548690.png)



![image-20240416142725440](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416142725440.png)

ç„¶åé‡å¯æœºå™¨ï¼Œæ­¤æ—¶web003å°±ä¸ä¼šèµ·æ¥äº†ï¼Œå› ä¸ºdocker run çš„æ˜¯åé»˜è®¤æ˜¯---restart noçš„ï¼Œå°±æ˜¯è¯´é‡å¯ç­‰åŠ¨ä½œåæ­£å¯¼è‡´ä½ é€€å‡ºçš„ï¼Œdockerå¼•æ“èµ·æ¥ä½ å®¹å™¨ä¹Ÿä¸ä¼šupçš„ã€‚



é€šè¿‡ä¸Šé¢çš„æˆªå›¾å¯çŸ¥web01æ˜¯--restart always æ–¹å¼å¯åŠ¨çš„å®¹å™¨

![image-20240416143008774](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416143008774.png)

å¯åŠ¨åå°±æ˜¯ğŸ‘‡

![image-20240416143124882](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416143124882.png)



æ‰€ä»¥é‡å¯å®¿ä¸»è¦ç”¨--restart always è¿™ç§æˆ–è€…è‡³å°‘--restart unless-stopedï¼Œè€Œé‡å¯docker æœåŠ¡ï¼ŒåŸæ¥æ˜¯upçš„å¸Œæœ›å®ƒç»§ç»­åœ¨é‡å¯æœåŠ¡åç»§ç»­upå°±å¯ä»¥ç”¨live-restoreé…ç½®é€‰é¡¹ï¼Œä½†è¯¥é€‰é¡¹ä¹Ÿåšä¸åˆ°åŸæ¥é€€å‡ºé‡å¯æœåŠ¡åç»™ä½ èµ·æ¥çš„ï¼Œè€Œ--restart alwayså°±å¯ä»¥ğŸ‘‡

![image-20240416143448657](1-Dockerè¿è¡Œå®¹å™¨çš„å¸¸è§ç”¨æ³•.assets/image-20240416143448657.png)





