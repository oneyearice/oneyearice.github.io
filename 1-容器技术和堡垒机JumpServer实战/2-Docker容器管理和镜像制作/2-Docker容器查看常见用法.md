# ç¬¬2èŠ‚ Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•





# å®¹å™¨é‡Œçš„root

docker è¿è¡Œçš„æ—¶å€™ï¼Œåœ¨å®¹å™¨é‡Œé¢ï¼Œé€šå¸¸æ˜¯ä»¥rootè¿è¡Œçš„ã€‚

![image-20240416144445946](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416144445946.png)



![image-20240416145359646](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416145359646.png)

å®¹å™¨æœ¬èº«çš„æ–‡ä»¶è¿˜æ˜¯åˆ†å±‚è½åœ¨å®¿ä¸»æœºä¸Šçš„overlay2ç›®å½•é‡Œçš„ğŸ‘‡ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯2ä¸ªm53.txtè¿™ä¸ªåé¢å†è¯´ï¼Œæ¶‰åŠåˆ†å±‚ç»“æ„çš„æ¢³ç†ã€‚

![image-20240416145535817](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416145535817.png)

è¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…ä¹Ÿæ˜¯root

![image-20240416145656551](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416145656551.png)

å°±æ˜¯å®¹å™¨é‡Œçš„m53.txtæ‰€æœ‰è€…æ˜¯rootï¼Œå®¹å™¨å¤–é¢å®¿ä¸»æœºä¸Šçœ‹åˆ°çš„m53.txtæ‰€æœ‰è€…ä¹Ÿæ˜¯rootã€‚

æ˜¯ä¸€ä¸ªrootå˜›ï¼Ÿå®¹å™¨é‡Œçš„rootæ˜¯ç”¨çš„å®¿ä¸»æœºä¸Šçš„rootå˜›ï¼Ÿå¹¶ä¸æ˜¯ï¼Œå®¹å™¨é‡Œçš„rootæ˜¯ä¸€ä¸ªå‡rootå°±æ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·ã€‚è¯æ˜ğŸ‘‡ã€‚

![image-20240416152328302](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416152328302.png)

è€Œå®¿ä¸»æœºæ˜¯å¯ä»¥çš„ğŸ‘‡ï¼Œæ‰€ä»¥è¯æ˜äº†å®¹å™¨é‡Œçš„rootå¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„rootè¶…çº§ç”¨æˆ·ã€‚

![image-20240416152425027](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416152425027.png)

dfçœ‹ä¸åˆ°æŒ‚è½½è¦†ç›–çš„æ•ˆæœï¼Œlsblkå¯ä»¥

![image-20240416155821756](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416155821756.png)

é¡ºä¾¿çŸ¥é“ä¸‹dm0 dm1è¿™äº›

![image-20240416160008963](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416160008963.png)

æ‰€ä»¥dm-0  dm-1  è¿™ç§å°±æ˜¯lvmäº†ï¼Œé€»è¾‘å—ã€‚



## privileged--å®¹å™¨é‡Œä½¿ç”¨å®¿ä¸»æœºçš„rootï¼Œé™¤éç‰¹åœ°è¿™ä¹ˆè¦æ±‚ï¼Œå¦åˆ™åˆ«åŠ è¯¥é€‰é¡¹ã€‚

![image-20240416154939569](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416154939569.png)

ç´¢ç„¶/dev/mapperä¸‹é¢æ²¡æœ‰lvmçš„é€»è¾‘å—ï¼Œä½†æ˜¯è¦çŸ¥é“è¿™ä¸ªç›®å½•ä¸‹é¢å…¶å®å°±æ˜¯è½¯è¿æ¥

çœŸæ­£çš„rl-rootå…¶å®æ˜¯è¿æ¥åˆ°dm-0å»çš„

è¿™ä¸€ç‚¹ï¼Œåœ¨å®¿ä¸»æœºä¸Šå¯ä»¥çœ‹åˆ°ğŸ‘‡

![image-20240416160438846](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416160438846.png)

æ‰€ä»¥å®¹å™¨é‡Œç›´æ¥mount /dev/dm-0å°±è¡Œäº†

![image-20240416160522694](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416160522694.png)



![image-20240416160638530](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416160638530.png)



ç„¶å

![image-20240416160804794](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416160804794.png)

æ­¤æ—¶å†åˆ°å®¿ä¸»ä¸Šç›´æ¥å°±çœ‹åˆ°äº†

![image-20240416160818508](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416160818508.png)



**è¿™æ ·å®¹å™¨é‡Œçš„æŸäº›æ“ä½œå°±å±é™©äº†ï¼Œæ¯”å¦‚**

![image-20240416161903877](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416161903877.png)

æ­¤æ—¶å®¿ä¸»ä¸Šçš„echoå°±æ²¡äº†

![image-20240416162022527](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416162022527.png)

ä½†æ˜¯å‘ç°echoè¿˜èƒ½ç”¨ï¼Œ

![image-20240416162240919](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416162240919.png)

å¿½ç„¶ååº”è¿‡æ¥ï¼Œtype ä¸€ä¸‹çœ‹åˆ°äº†builtinï¼Œè¯´æ˜ä»€ä¹ˆï¼Œè¯´æ˜echoæ˜¯buildinåœ¨/bin/bashé‡Œçš„ï¼Œæ˜¯å†…éƒ¨å‘½ä»¤ã€‚

**å¥½ï¼Œmv echoçœ‹ä¸åˆ°æ•ˆæœï¼Œmv /bin/bashå§å“ˆå“ˆ**

![image-20240416162524895](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416162524895.png)

ç›´æ¥GGğŸ‘‡

![image-20240416162513703](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416162513703.png)

æ‰€ä»¥é™¤éç”Ÿäº§ä¸­æœ‰æ˜ç¡®è¦æ±‚å®¹å™¨é‡Œå¯ä»¥æ“ä½œå®¿ä¸»æœºçš„æƒé™ï¼Œå¦åˆ™åˆ«åŠ è¯¥--priviliegedé€‰é¡¹ã€‚



### é‚£ä¹ˆå¦‚ä½•çŸ¥é“runçš„æ—¶å€™åŠ äº†é‚£äº›é€‰é¡¹ï¼Œæ¯”å¦‚æ˜¯å¦åŠ äº†å±é™©çš„provilieged

![image-20240416163844094](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416163844094.png)

çœ‹å…¨éƒ¨çš„runçš„æ—¶å€™åŠ çš„é€‰é¡¹

![image-20240416164100328](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416164100328.png)

ä¸è¿‡è¿˜ä¸æ˜¯å¤ªæ˜æ˜¾ï¼Œä¸æ˜¯tmdä¸€ç›®äº†ç„¶ï¼Œä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹å·¥å…·runlikeæ¥ä¸€ç›®äº†ç„¶ã€‚

![image-20240416170139668](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416170139668.png)



![image-20240416170554324](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416170554324.png)



![image-20240416172309411](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416172309411.png)



-på°±æ˜¯--pretty æ›´æ¸…æ™°ç‚¹æ’ç‰ˆ

![image-20240416172340168](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416172340168.png)





# æŸ¥çœ‹å®¹å™¨ä¿¡æ¯



å‰é¢ä¸€ç›´åœ¨ç”¨ps imagesè¿™äº›ï¼Œ

è¿™é‡Œå†è¡¥å……ä¸‹-fé€‰é¡¹çš„è¿‡æ»¤



https://docs.docker.com/reference/cli/docker/container/ls/

ä¸‹å›¾é“¾æ¥æœ‰é—®é¢˜ï¼Œçº æ­£ä¸ºğŸ‘†

ç„¶åæ”¯æŒ--filteré€‰é¡¹çš„åˆæœ‰å¾ˆå¤šdockers cli  ï¼š  https://docs.docker.com/config/filter/



![image-20240416173604368](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416173604368.png)



![image-20240416181800216](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416181800216.png)

-fç­‰ä»·äº--filterï¼Œå°±æ˜¯çŸ­é€‰é¡¹å’Œé•¿é€‰é¡¹çš„æ„æ€ï¼Œå¥½æ¯”-h ï¼ --help

ç„¶å--formatå°±æ˜¯ä¸æƒ³å…¶ä»–çš„ï¼Œå®ƒåªæœ‰çŸ­é€‰é¡¹ã€‚

![image-20240416182514073](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416182514073.png)



### æ¨èçš„cli



**åˆ é™¤æ‰€æœ‰é€€å‡ºçš„å®¹å™¨**

```shell
docker ps -f 'status=exited' -q  # é€€å‡ºå®¹å™¨çš„ç¼–å·ï¼Œåˆ é™¤ğŸ‘‡èµ·æ¥æ–¹ä¾¿
docker rm $(docker ps -f 'status=exited' -q)
```



**æŸ¥çœ‹å®¹å™¨ç©ºé—´å ç”¨**

å®¹å™¨åˆ†å±‚ï¼Œimageå…±ç”¨ï¼Œæ‰€ä»¥æ‹¬å·é‡Œçš„æ˜¯imageå¤§å°ï¼Œå®¹å™¨è‡ªèº«çš„å¯å†™å±‚ï¼Œä¸€èˆ¬æ˜¯ä¸€äº›logï¼Œå ç”¨501B

![image-20240416183600605](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416183600605.png)

![image-20240416184059894](2-Dockerå®¹å™¨æŸ¥çœ‹å¸¸è§ç”¨æ³•.assets/image-20240416184059894.png)



