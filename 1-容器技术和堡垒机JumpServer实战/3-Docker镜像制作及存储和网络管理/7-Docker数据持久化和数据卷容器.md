# ç¬¬7èŠ‚ Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨



# ç”¨æŒä¹…åŒ–åšä¸€ä¸‹wordpress



```shell
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=wordpress -e MYSQL_USER=wordpress -e MYSQL_PASSWORD=123456 --name mysql -d --restart=always -v /data/mysql:/var/lib/mysql mariadb:11.3.2
```

```shell
docker run -d -p 8080:80 --name wordpress -v /data/wordpress:/var/www/html --restart=always wordpress:php8.2-apache
```

 ![image-20240527102135939](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527102135939.png)





![image-20240527103206863](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527103206863.png)

ä¹Ÿå°±æ˜¯ç”Ÿæˆwp-config.phpæ–‡ä»¶





![image-20240527103517230](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527103517230.png)



![image-20240527103841887](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527103841887.png)

ğŸ‘†ä¸Šå›¾localhostæ˜¯é”™è¯¯çš„ï¼Œå‰æ–‡å°±è¯´è¿‡äº†ï¼Œè¦å†™å®¿ä¸»æœºçš„IPã€‚

![image-20240527104145638](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527104145638.png)

æ€»ä¹‹ï¼Œwordpresså®¹å™¨åŒ–å°±æ˜¯

â‘ wordpressæœåŠ¡æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œä½ è¿™ä¸ªé…ç½®ç•Œé¢æ˜¯wordpressè¿æ¥mysqlçš„é…ç½®ç•Œé¢ï¼Œå…¶å®æ˜¯wordpressé‡Œé¢é…ç½®çš„localhostï¼Œæ‰€ä»¥æ˜¯å®¹å™¨é‡Œçš„ï¼Œè€Œä¸æ˜¯å®¿ä¸»çš„ã€‚è¦æ³¨æ„çš„ã€‚

â‘¡mysqlï¼Œåˆæ˜¯å¦ä¸€ä¸ªå®¹å™¨äº†



ä¸Šé¢çš„æ•°æ®é…ç½®æäº¤åï¼Œå®é™…ä¸Šå°±æ˜¯ç”Ÿæˆäº†wp_config.phpæ–‡ä»¶

![image-20240527105104643](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527105104643.png)

![image-20240527105126401](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527105126401.png)





![image-20240527104356749](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527104356749.png)





![image-20240527105242416](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527105242416.png)

è¿™ä¸ªé…ç½®å®Œåï¼Œmysqé‡Œçš„ç›¸å…³è¡¨ä¿¡æ¯å°±æ¥äº†

![image-20240527105437541](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527105437541.png)





ç„¶åç™»å…¥è¿›å»åï¼Œæ–°å»ºæ–‡ç« ï¼Œä¸Šä¼ å›¾ç‰‡

![image-20240527110334634](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527110334634.png)

å°±ä¼šåœ¨wordpressçš„ç›®å½•ä¸‹çœ‹åˆ°

![image-20240527110456245](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527110456245.png)

ä¸€å¼ å›¾ç‰‡ä¼š æ ¹æ®  æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘ï¼Œåˆ†è¾¨ç‡ï¼Œæ¥ç”Ÿæˆå¤šå¼ ï¼Œå°†æ¥å¥½åŒ¹é…ä¸åŒå±å¹•ã€‚

ç„¶åå‘å¸ƒæ–‡ç« 

![image-20240527110820511](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527110820511.png)









**ç„¶ååˆ é™¤ä¸Šé¢çš„ä¸¤ä¸ªå®¹å™¨ï¼Œç”±äºåšäº†æ•°æ®æŒä¹…åŒ–ï¼Œæ‰€ä»¥æ–‡ç« å¾—ä»¥ä¿å­˜**

åˆ é™¤å®¹å™¨docker rm -f xxxxï¼Œ å¦‚æœä½ ç”¨docker -rm -v -f xxxï¼Œå°±è¦å°å¿ƒäº†ï¼Œä¼šä¸ä¼š-vä¸€ä¸‹å­ä¹Ÿå°±æŠŠæŒä¹…åŒ–çš„æ•°æ®ä¹Ÿç»™åˆ äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„è¿™ä¸ªå®éªŒä¸ä¼šï¼Œå› ä¸ºï¼Œ-våªèƒ½åˆ é™¤åŒ¿åå·ã€‚

![image-20240527111135956](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527111135956.png)

æ‰€ä»¥èƒ†å­ä¸å¦¨å¤§ä¸€ç‚¹~ï¼Œè¿½å¥³å­©å­çš„æ—¶å€™è„¸çš®ä¸å¦¨åšä¸€ç‚¹~ï¼Œå•¥~ è·‘é¢˜äº†~~~



![image-20240527112606677](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527112606677.png)



åˆ é™¤åï¼Œç”±äºæŒä¹…åŒ–çš„æ•°æ®è¿˜åœ¨ï¼Œæ‰€ä»¥docker runèµ·æ¥å°±è¿˜èƒ½çœ‹å¾—è§

ç„¶åé‡æ–°runä¸€ä¸‹å°±æ¢å¤

![image-20240527114250818](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527114250818.png)



æ£€æŸ¥é¡µé¢å·²ç»æ¢å¤ä¸‹

![image-20240527114218911](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527114218911.png)









# æ•°æ®å·å®¹å™¨

å°±æ˜¯ç”¨å®¹å™¨æ¥å®ç°æ•°æ®æŒä¹…åŒ–





å†è·‘ä¸€ä¸ªwordpress2



![image-20240527133003310](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527133003310.png)





![image-20240527132913556](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527132913556.png)



å‘ç°ä¼šè‡ªåŠ¨å°†9090è·³è½¬åˆ°8080å»

![image-20240527132945868](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527132945868.png)

å› ä¸ºæ•°æ®åº“æ²¡æœ‰å‘å¼€



åˆ†å¼€æ¥ä¸€é

![image-20240527133853314](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527133853314.png)

![image-20240527134044754](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527134044754.png)

è¿™é‡Œåˆä¼šæ¶‰åŠåˆå§‹åŒ–mysqlçš„é…ç½®

![image-20240527134143417](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527134143417.png)

é»˜è®¤å°±æ˜¯3306ï¼Œä¹Ÿä¸çŸ¥é“æˆ‘å¼ºè¡Œå†™æˆ3406è¡Œä¸è¡Œ

![image-20240527134215988](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527134215988.png)

### å¯ä»¥ï¼wordpressåˆå§‹åŒ–mysqlå¯ä»¥å¸¦ç«¯å£ğŸ‘†

![image-20240527134223603](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527134223603.png)

ä½ çœ‹è¿™å°±ä¸€ä¸ªå®¿ä¸»ä¸¤ä¸ªwordpressäº†

![image-20240527134312933](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527134312933.png)

è¿™æ˜¯è‹±æ–‡çš„è¿˜æ˜¯ğŸ‘†



è¿™æ˜¯ğŸ‘‡ä¹‹å‰ä¸­æ–‡çš„

![image-20240527134349911](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527134349911.png)



## å†æ¥ä¸€ä¸ªä¾‹å­ï¼Œä¸¤ä¸ªå®¹å™¨å…±äº«æ•°æ®çš„æ•ˆæœ

ç”¨ä¹‹å‰çš„è‡ªå®šä¹‰çš„imageæ¥å¼„

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¿‡äº†è¿™ä¹ˆä¹…ï¼Œæˆ‘åº”è¯¥ç”¨å“ªä¸ªimageså»runå‘¢ï¼Œæˆ–è€…è¯´æˆ‘çš„è¿™ä¸ªimageæ˜¯æ€ä¹ˆbuildå‡ºæ¥çš„ï¼Œç”¨çš„å“ªä¸ªDockerfileå‘¢ï¼Œå¯¹å§ï¼Œç®€å•ï¼Œä¸Šæ¬¡çš„ç ”ç©¶å°±æ²¡æœ‰ç™½è´¹ï¼ŒğŸ‘‡

### å¯»æ‰¾ç†Ÿæ‚‰çš„é•œåƒçš„å‡†å¤‡

â‘ inspectçœ‹çœ‹Fromçš„è°

![image-20240527140412203](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527140412203.png)

â‘¡hisotryçœ‹çœ‹buildçš„è¿‡ç¨‹

![image-20240527140816757](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527140816757.png)



### å¼€å§‹å¯»æ‰¾

![image-20240527140936919](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527140936919.png)

å¯è§è¿™å‡ ä¸ªé•œåƒåˆ276MBçš„è¿˜æœ‰48.3MBï¼Œçœ‹çœ‹ä¸ºå•¥å¤§å°å·®è¿™ä¹ˆå¤šï¼Œ

![image-20240527141419914](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527141419914.png)



å†çœ‹çœ‹

![image-20240527142017938](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142017938.png)

å°±è¿™çœ‹åˆ°äº†ä¸ºä»€ä¹ˆ0.1ç‰ˆå¤§åœ¨å“ªé‡ŒğŸ‘†ç„¶åç”¨--no-trucå±•å¼€çœ‹è¯¦ç»†CLI

![image-20240527142205440](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142205440.png)

ç„¶åæ‰¾æ‰¾å“ªä¸€ä¸ªDockerfileé‡Œåˆè¿™ä¸ªå‘½ä»¤çš„ğŸ‘†

![image-20240527142511933](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142511933.png)

å‘ç°ä¸å†è¿™ä¸ªå±‚çº§ç›®å½•ä¸‹

é€šè¿‡å½“å‰çš„Dockerfileçš„å°±ä¼šçœ‹åˆ°FROM alpine_3.19_self:v1.0

![image-20240527142725284](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142725284.png)



![image-20240527142805939](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142805939.png)



è¿™å°±æ‰¾åˆ°äº†ğŸ‘‡

![image-20240527142852070](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142852070.png)

é‚£ä¹ˆ276MBçš„åŸå› æ‰¾åˆ°äº†ï¼Œ48.3MBä¸ºä»€ä¹ˆè¿™ä¹ˆå°å‘¢

<img src="7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527142914095.png" alt="image-20240527142914095" style="zoom:40%;" />





æ‰¾åˆ°äº†

![image-20240527145123902](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527145123902.png)

æœ€åå®éªŒçš„æ—¶å€™ï¼ŒFROMçš„é•œåƒæ”¹ç”¨äº†å®˜æ–¹é•œåƒäº†

ä¹Ÿè®¸å¯ä»¥è¿™ä¹ˆéªŒè¯ï¼ŒéªŒè¯ä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯

![image-20240527151009602](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527151009602.png)

è¿™ä¸ªFROMï¼Œbuildå‡ºæ¥äº†web001_entrypoint0.3

è€Œweb001_entrypoint:0.1æ˜¯è‡ªå®šä¹‰çš„ï¼Œ

run è¿›å»çœ‹apk list å°±çŸ¥é“äº†ï¼Œæ¯”å¦‚å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ï¼Œé‚£ä¹ˆapk listé‡Œæ˜¯ç”±iotopè¿™ä¸ªåŒ…çš„





![image-20240527151332727](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527151332727.png)

å¥½äº†ï¼Œç›®å‰å°±æ‰¾åˆ°è¿™ä¹ˆä¸ªæ–¹æ³•æ¥å®šä½è‡ªå·±å¤§é‡çš„imageä¸çŸ¥é“ä»å“ªä¸ªDockerfileæ¥çš„ï¼Œ

æ€è·¯å°±æ˜¯ï¼šæ‰¾åˆ°Dockerfileé‡Œçš„ç‰¹ç‚¹ï¼Œç„¶ååŸºäºè¿™ä¸ªç‰¹ç‚¹ï¼Œæ¯”å¦‚è¿™ä¸ªDockerfileé‡Œå®‰è£…äº†æŸä¸ªä¸ä¼—ä¸åŒçš„è½¯ä»¶ï¼Œå°±å°†å¯¹æ¯”çš„imagesåˆ†åˆ«runèµ·æ¥å»çœ‹æœ‰æ²¡æœ‰ï¼Œæœ‰å°±æ˜¯FROMçš„è¿™ä¸ªï¼Œæ²¡æœ‰å°±æ˜¯åˆ«çš„æˆ–è€…ç›´æ¥æ˜¯å®˜æ–¹çš„ã€‚



æ‰€ä»¥è¿˜æ˜¯docker-composeå¥½å•Šï¼Œå“ï¼Œèµ¶ç´§å­¦åˆ°é‚£é‡Œå»çœ‹çœ‹æœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ~~





ä¸‹é¢ç»§ç»­å®éªŒï¼ŒåŸºäºå®šä½å‡ºæ¥çš„è¿™ä¸ªé•œåƒ

![image-20240527152513433](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527152513433.png)



ç„¶åè¿™ä¸ªé•œåƒçš„Dockerfileå’Œentrypointçœ‹çœ‹

![image-20240527152722637](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527152722637.png)

ä¸Šå›¾ï¼Œä½†å…¶å®ä½ ä¼šå‘ç°ï¼ŒTMDï¼Œè¿™ä¸ªå…¶å®web001_entrypoint:0.3å½“åˆbuildé‚£ä¼šå„¿ï¼Œentrypointè„šæœ¬é‡Œçš„

```shell
echo "$HOST" > ${DOC_ROOT}index.html  è¿™ä¸€è¡Œæ˜¯æ‰“å¼€çš„ï¼Œæ²¡æœ‰è¢«æ³¨é‡Šæ‰çš„
```



å®éªŒæ€è·¯ï¼š
ä¸¤ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªæŒä¹…åŒ–

æœ‰ä¸€ä¸ªé—®é¢˜

![image-20240527154611201](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527154611201.png)

å‘½åå·å’ŒåŒ¿åå·ï¼Œéƒ½æ˜¯å¯ä»¥docker volume lsæŸ¥åˆ°çš„ï¼Œæ­¤æ—¶å°½ç®¡docker ps -aä¹Ÿæ²¡äº†ï¼Œç›®å½•ä¹Ÿåˆ æ‰äº†ï¼Œä½†æ˜¯docker volume lså¯è§ï¼Œå°±ä¼šå¯¼è‡´runçš„æ—¶å€™-v æŒ‡å®šå‘½åå·å°±ä¼šæŠ¥é”™

![image-20240527154759759](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527154759759.png)

æ‰€ä»¥è¦ç”¨docker volume rmæ¸…ç†

![image-20240527154938420](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527154938420.png)

ç»“æœä¸æ¶ˆæ¯æ¸…æ‰äº†åŒ¿åå·ï¼Œå“ˆå“ˆå“ˆ

é‡å¯ä¸€ä¸‹å°±å¥½äº†

![image-20240527155039912](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527155039912.png)

ä¸‹æ¬¡è®°å¾—åˆ é™¤volumeä¸è¦ç”¨rmï¼Œè¦ç”¨docker volume rm



ç„¶åå®¿ä¸»æœºçš„è·¯å¾„ï¼Œå°±æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ç›®å½•ï¼Œä¸ç®—é€»è¾‘å·,ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼Œdocker volume lsæ˜¯çœ‹ä¸åˆ°çš„

![image-20240527160104706](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527160104706.png)

åªè¦docker volume ls çœ‹ä¸åˆ°ï¼Œå°±å¯ä»¥è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶runçš„æ—¶å€™æŒ‚è½½è¿‡å»

åªè¦docker volume ls çœ‹åˆ° ä¸” æ–‡ä»¶ç¡®å®å­˜åœ¨ï¼Œå°±å¯ä»¥é‡å¤run çš„æ—¶å€™æŒ‚è½½è¿‡å»äº†



ç»§ç»­åš2ä¸ªå®¹å™¨æŒ‚è½½ä¸€ä¸ªç›®å½•å§



ç¬¬ä¸€ä¸ªå®¹å™¨ok

![image-20240527160818772](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527160818772.png)

ç¬¬äºŒä¸ª

![image-20240527160858234](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527160858234.png)

ä¹ŸOKï¼Œè€Œä¸”æ˜¯å…±ç”¨çš„ä¸€ä¸ªå‘½åå·mydata



### æ•°æ®å·å®¹å™¨çš„äº§ç”ŸèƒŒæ™¯

é—®é¢˜æ¥äº†

å¦‚æœ10ä¸ªå®¹å™¨éƒ½æŒ‚åŒæ ·çš„ç›®å½•ï¼Œæ¯”å¦‚ğŸ‘‡

```shell
docker1 -v mydata1 -v mydata2 -v mydata3
docker2 -v mydata1 -v mydata2 -v mydata3
ã€‚ã€‚ã€‚ ã€‚ã€‚ã€‚ 
docker10 -v mydata1 -v mydata2 -v mydata3
```

å°±è¦å†™10é -v mydata1 -v mydata2 -v mydata3ï¼Œé…ç½®å¤ªç¹çï¼Œäºæ˜¯å°±æœ‰äº†ä¸€ä¸‹çš„è§£å†³æ–¹æ¡ˆ**æ•°æ®å·å®¹å™¨**



<img src="7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527161947694.png" alt="image-20240527161947694" style="zoom:44%;" />



å®¹å™¨0æ­£å¸¸ä½¿ç”¨-v -v -vå»æŒ‚è½½ï¼Œå…¶ä»–å®¹å™¨1 2 3 4 .. å‚è€ƒå®¹å™¨0ç›´æ¥æŒ‚è¿‡å»--å°±æ˜¯è¯´ä½ å®¹å™¨0çš„æŒä¹…åŒ–æ–¹æ¡ˆå°±æ˜¯æˆ‘ä»¬å…¶ä»–å®¹å™¨çš„æŒä¹…åŒ–æ–¹æ¡ˆ

è¿™é‡Œæ‰€è°“çš„å®¹å™¨0å°±æ˜¯å›¾ä¸­çš„Data containerã€‚

1ã€å…ˆåˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å®¹å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨å®¹å™¨å°±æ­£å¸¸-v -v -v æŒ‚è½½å¥½ç›®å½•ï¼Œä¸ç®¡æ˜¯é€»è¾‘å·(â‘ åŒ¿åå·â‘¡å‘½åå·)ï¼Œè¿˜æ˜¯ç›´æ¥ä½¿ç”¨å®¿ä¸»çš„æ–‡ä»¶å¤¹ã€‚

2ã€å…¶ä»–å®¹å™¨å°±å¥½æ¯”clientç«¯ï¼Œéƒ½æ˜¯æœåŠ¡å™¨å®¹å™¨çš„æŒ‚è½½æ–¹æ¡ˆè¿›è¡Œå¤åˆ¶æŒ‚è½½å°±è¡Œäº†ã€‚

<img src="7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527162737908.png" alt="image-20240527162737908" style="zoom:50%;" />

ä¸Šé¢ä¸¤ä¸ªå›¾å…¶å®æœ‰ä¸€ä¸ªç†è§£è¯¯åŒºï¼Œå…¶å®å°±æ˜¯ç”»å›¾çš„ä¸ä¸“ä¸šï¼Œæ˜¯ä»€ä¹ˆå‘¢ï¼Œå°±æ˜¯ç®­å¤´ä¸æ˜¯æ•°æ®å·æŒ‚è½½çš„åŠ¨ä½œæµï¼Œè€Œæ˜¯-vå¤åˆ¶å‚è€ƒçš„åŠ¨ä½œæµï¼Œä½ è¿™ä¸ªå›¾æçš„å¥½åƒæˆ‘åˆ æ‰å®¹å™¨Aæˆ–è€…å‰ä¸€å¼ å›¾çš„Data Containerå°±ä¼šå¯¼è‡´å®¹å™¨B C ï¼›Container 1 2 3éƒ½æ–­å¼€è¿æ¥äº†ä¸€æ ·ï¼Œå…¶å®ä¸å­˜åœ¨è¿æ¥ï¼Œä¸å­˜åœ¨ç»•è¡Œï¼Œè¿™ä¸ªå®¹å™¨B C ç»•è¡Œå®¹å™¨Açš„ç®­å¤´åªæ˜¯å¤åˆ¶äº†-v xx -v xxx -v xxxçš„é…ç½®è€Œå·²ï¼Œä¸€æ—¦å¤åˆ¶è¿‡äº†ï¼Œé‚£ä¹ˆå®¹å™¨B Céƒ½æ˜¯ç›´æ¥æŒ‚è½½è®¿é—®åˆ°å®¿ä¸»æœºçš„ã€‚ä¸‹é¢æœ‰æˆªå›¾å®éªŒè¯çš„ã€‚



**å®é™…é…ç½®å¾ˆç®€å•**

```shell
docker run --volumes-from <æ•°æ®å·å®¹å™¨>   Mount volumes from the specified container(s)
```



### å®é™…é…ç½®å¼€å§‹-å¤šä¸ªå®¹å™¨å…±äº«æŸéƒ¨åˆ†æ•°æ®çš„æ–¹æ¡ˆ

1ã€é…ç½®æ•°æ®å·å®¹å™¨ï¼Œserverå•¦ï¼Œå› ä¸ºåªæ˜¯æä¾›åˆ«çš„å®¹å™¨ï¼Œæ¥å¤åˆ¶æŒ‚è½½ç›®å½•çš„ã€‚æ‰€ä»¥å°±åªéœ€è¦å†™å¥½-vå°±ä¿¡äº†

```SHELL
docker run -d -v mydata:/data/website --name volume-server -e HOST='www.dalao.tk' web001_entrypoint:0.3
```

è¿™é‡Œç•™äº†ä¸€ä¸ª-e HOST=xxxæ¥æµ‹è¯•æ˜¯å¦å¯ä»¥å¤åˆ¶ï¼Œå’Œ-vä¸€æ ·è¢«å…¶ä»–å®¹å™¨å¤åˆ¶ã€‚



2ã€é…ç½®ä½¿ç”¨"æ•°æ®å·å®¹å™¨"çš„å®¹å™¨ï¼Œclientså•¦

```shell
docker run -d --volumes-from volume-server -p 81:80 --name web01 web001_entrypoint:0.3

docker run -d --volumes-from volume-server -p 82:80 --name web02 -e HOST="web02" web001_entrypoint:0.3

docker run -d --volumes-from volume-server -p 83:80 --name web03 -e HOST="web03" web001_entrypoint:0.3

```

çœ‹æ•ˆæœğŸ‘‡

![image-20240527164855137](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527164855137.png)

ä½†æ˜¯è¦æ³¨æ„åˆ°ä¸Šå›¾çš„æœ€åä¸¤è¡Œcurlç»“æœæ˜¯ä¸€æ ·çš„ï¼Œåˆ«æ²¡æœ‰æƒ³å½“ç„¶çš„å‡ºç°web02ã€‚ç†ç”±å¾ˆç®€å•ï¼Œå°±æ˜¯å½“ä½ ä¸Šé¢æ•²äº†æœ€åä¸€è¡Œdocker runçš„æ—¶å€™ï¼Œæ­¤æ—¶å°±å·²ç»ä¼ å‚-e HOST=web03è¿›å»äº†ï¼Œè€Œentrypointå°±æ˜¯docker runçš„æ—¶å€™æ‰§è¡Œçš„ã€‚åŠ ä¸Šé€»è¾‘å·åˆæ˜¯æŒ‚è½½åŒæ ·çš„ä¸€ä¸ªï¼Œæ‰€ä»¥æœ€åä¸€è¡Œçš„runå°±æŠŠå¤–é¢é€»è¾‘å·é‡Œçš„Index.htmlçš„å†…å®¹æ”¹æˆäº†web03ã€‚

æ‰€ä»¥æ­¤æ—¶ä¸‹å›¾è¿™ä¸ªçš„index.htmå…¶å®å°±æ˜¯web03

![image-20240527165505732](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527165505732.png)

ç„¶åserverå—é‡Œçš„ä¸œè¥¿ä¾ç„¶è¿˜æ˜¯web02çš„ï¼Œæ‰€ä»¥æ‰å¯ä»¥host:web01è¿›è¡Œè½¬å‘

![image-20240527165621057](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527165621057.png)

ä»¥ä¸Šå°±é…ç½®éªŒè¯ç†è§£okäº†

![image-20240527170348031](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527170348031.png)



![image-20240527170755896](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527170755896.png)

**ç„¶åæ³¨æ„æ˜¯å¤åˆ¶çš„æ•°æ®å·å®¹å™¨çš„-vï¼Œè€Œä¸è¦å‚»å‚»ç†è§£ä¸ºæŒ‚åˆ°æŸä¸ªå®¹å™¨é‡Œå“¦**ï¼Œæ‰€ä»¥â˜…å³ä½¿ä½ æŠŠvolume-serverè¿™ä¸ªå‚è€ƒå®¹å™¨ç»™åˆ äº†ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–å®¹å™¨ï¼Œå› ä¸º<font color=red>åªæ˜¯æŠ„äº†å®ƒçš„é…ç½®è€Œå·²</font>ã€‚

![image-20240527170814772](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527170814772.png)



![image-20240527171313928](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527171313928.png)

ä»»ä½•ä¸€ä¸ªæœ‰æŒ‚è½½è¥¿ä¿¡æ¯éƒ½å¯ä»¥ä½œä¸ºåˆ«äººçš„å‚è€ƒä¹Ÿå°±æ˜¯æ•°æ®å·å®¹å™¨--volumes-from xxx

![image-20240527171602491](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527171602491.png)





è¡¥å……ï¼šè¿™äº›runçš„æ—¶å€™ä½¿ç”¨çš„é•œåƒå¯ä»¥ä¸åŒï¼Œåªæ˜¯--volumes-fromä¸€æ ·ä½¿ç”¨ä¸€æ ·çš„æ•°æ®å·å®¹å™¨çš„-væŒ‚è½½æƒ…å†µ

![image-20240527170443710](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527170443710.png)







å¤šä¸ªå®¹å™¨å…±äº«æŸéƒ¨åˆ†æ•°æ®çš„æ–¹æ¡ˆçš„å…¸å‹åº”ç”¨åœºæ™¯

nginx + php ä»¥å‰æ˜¯è·‘åœ¨ä¸€ä¸ªå®¿ä¸»ä¸Šçš„ï¼Œç°åœ¨å®¹å™¨åŒ–ï¼Œå°±æ˜¯ä¸¤ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥å¯ä»¥è¿™ä¸¤ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªæŒä¹…åŒ–ç›®å½•ã€‚

nginxå’Œphpçš„ç¨‹åº åº”è¯¥æ˜¯å…±äº«ä¸€ä¸ªç›®å½•ï¼Œè¦åœ¨ä¸€èµ·çš„ï¼Œï¼Œæˆ‘å»å¤ä¹ ä¹‹å‰çš„åŠ¨é™åˆ†ç¦»çš„æ–‡ç« 

![image-20240527182137278](7-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·å®¹å™¨.assets/image-20240527182137278.png)









