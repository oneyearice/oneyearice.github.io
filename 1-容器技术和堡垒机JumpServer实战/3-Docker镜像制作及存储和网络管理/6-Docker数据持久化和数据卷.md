# ç¬¬6èŠ‚ Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·





ä¹‹å‰VOLUMEä¹Ÿå¯ä»¥å®ç°æ•°æ®æŒä¹…åŒ–ï¼Œå°±æ˜¯å®¹å™¨åˆ æ‰ï¼Œæ•°æ®è¿˜åœ¨å®¿ä¸»ä¸Šæ”¾ç€ï¼Œå°±æ˜¯æœ‰ç‚¹ç¼ºç‚¹ï¼Œå¤ªä¹±äº†ï¼Œå­˜æ”¾æ²¡æ³•è‡ªå®šä¹‰ï¼Œæˆ–è€…è¦-v å‘½ä»¤è¡Œé€‰é¡¹çš„æ–¹å¼æ¥æŒ‡å®šã€‚



å†æ¥çœ‹ä¸‹é•œåƒå’Œå®¹å™¨çš„åˆ†å±‚æ•°æ®å­˜æ”¾

**imageçš„**

![image-20240521111902324](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521111902324.png)

![image-20240521112036391](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521112036391.png)



**å®¹å™¨çš„**

é¦–å…ˆå®¹å™¨runèµ·æ¥å°±æ˜¯å¤åˆ¶ä¸€ä»½image

![image-20240521112142037](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521112142037.png)



![image-20240521112300490](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521112300490.png)

å› ä¸ºè¿™ä¸ªå®¹å™¨åœæ‰äº†ï¼Œæ‰€ä»¥æ•°æ®é‡Šæ”¾æ‰äº†ï¼Œrunningèµ·æ¥ï¼Œæ‰æœ‰mergeæ‰æœ‰å¤åˆ¶imageçš„é‚£ä¸€ä»½ã€‚

æŒ‚ä¸€ä¸ªå‰å°è®©ä»–running

![image-20240521112729148](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521112729148.png)

å†çœ‹åˆ†å±‚æ•°æ®

![image-20240521112808821](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521112808821.png)

è¿™æ¬¡å°±çœ‹åˆ°mergedäº†ğŸ‘†



ç„¶åæˆ‘å°†imageå’Œrunèµ·æ¥çš„å®¹å™¨çš„åˆ†å±‚ç›®å½• æ”¾ä¸€èµ·çœ‹çœ‹

![image-20240521113630281](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521113630281.png)

ä¸Šå›¾æ˜¯å®¹å™¨é‡Œçš„megerå¤åˆ¶äº†ä¸€ä»½imageé‡Œçš„diffï¼Œå…¶å®inspectå®¹å™¨å¯è§LowerDiråˆ†å±‚é‡Œç›´æ¥å†™äº†imageçš„diffåˆ†å±‚ï¼Œ

![image-20240521141920449](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521141920449.png)







å®¹å™¨ç”Ÿæˆçš„æ•°æ®æ˜¯æ”¾åœ¨diffä¸‹ï¼Œæ¯”å¦‚æ—¥å¿—ã€ä»¥åŠå…¶ä»–å®¹å™¨ä¸­ç”Ÿæˆçš„æ–°çš„æ•°æ®ï¼Œè¿™ä¸ªdiffå°±æ˜¯å¯è¯»å¯å†™å±‚ã€‚

![image-20240521141632632](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521141632632.png)





çœ‹ä¸‹æ—¥å¿—ï¼Œåº”è¯¥å°±åœ¨UpperDirä¹Ÿå°±æ˜¯diffé‡Œã€‚ä¸è¿‡æˆ‘ä¸Šé¢æ˜¯tail -f /dev/nullï¼Œæ²¡æœ‰æ—¥å¿—è¾“å‡ºï¼Œæ‰€ä»¥é‡æ–°runä¸€ä¸ªæœ‰stdçš„

![image-20240521144031109](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521144031109.png)

ç„¶åå»åˆ†å±‚diffé‡Œçœ‹

ä½†æ˜¯æ˜¾ç„¶æ˜¯æ²¡æœ‰çš„ï¼Œå› ä¸ºï¼Œæ²¡æœ‰è½æ–‡ä»¶

![image-20240521144259910](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521144259910.png)

è½ä¸€ä¸ªæ–‡ä»¶

![image-20240521150807933](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521150807933.png)



ç°åœ¨diffé‡Œæ˜¯ç©ºçš„

![image-20240521151133637](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521151133637.png)



ç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶

![image-20240521151152765](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521151152765.png)

ç„¶åUpperDiré‡Œå°±æœ‰äº†ï¼Œäºæ­¤åŒæ—¶mergeä½œä¸ºåˆå¹¶å±‚ä¹Ÿå°±çœ‹å¾—åˆ°äº†

![image-20240521151334814](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521151334814.png)



è¿™æ˜¯å®¹å™¨èµ·æ¥åç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯å®¹å™¨buildçš„æ—¶å€™ç”Ÿæˆæ–‡ä»¶ä¼šå‡ºç°åœ¨å“ªä¸ªç›®å½•é‡Œå‘¢?

è¿™é‡Œåšäº†æ—¥å¿—æ–‡ä»¶å’Œç”Ÿæˆäº†testæ–‡ä»¶ï¼Œä¸è¿‡æ˜¯buildçš„æ—¶å€™å°±å·²ç»ç”Ÿæˆtestäº†ï¼Œçœ‹çœ‹

![image-20240521151743546](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521151743546.png)

å¯è§buildé˜¶æ®µçš„æ–‡ä»¶æ˜¯ä¸ä¼šå‡ºç°åœ¨UpperDiré‡Œçš„ã€‚è€Œæ˜¯å‡ºç°åœ¨LowerDiré‡Œçš„diffé‡Œçš„

![image-20240521151857652](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521151857652.png)

### åˆ†å±‚ç›®å½•ç†è§£ï¼šç»“è®ºæ¥äº†

1ã€diffå°±æ˜¯å®¹å™¨å’Œé•œåƒç›¸æ¯” diffå‡ºæ¥çš„ï¼Œå°±æ˜¯å¤šå‡ºæ¥çš„

2ã€è€ŒUpperDirçš„diffå°±æ˜¯å®¹å™¨çš„å¯å†™å±‚

3ã€è€ŒLowerDIrçš„diffå°±æ˜¯åŸºäºæŸä¸ªFROMåŸºç¡€é•œåƒåˆ›å»ºæ–°çš„é•œåƒçš„æ—¶å€™çš„åº•å±‚ã€‚~~æ˜¯å¯å†™çš„ï¼Œå› ä¸ºä¸ç®¡æ˜¯testè¿˜æ˜¯access.logéƒ½æ˜¯å¯ä»¥å†™çš„ã€‚~~  å…¶å®æ˜¯ä¸å¯å†™çš„ï¼Œå°±æ˜¯buildçš„æ—¶å€™æ‰“è¿›å»çš„ï¼Œåé¢å¯å†™éƒ½æ˜¯UpperDiré‡Œçš„diffæ‰æ˜¯ï¼ŒLowerDirrçš„diffåªæ˜¯ åŒºåˆ«äº FROMåŸºç¡€é•œåƒçš„diffï¼ŒåŒæ ·ä¹Ÿæ˜¯åªè¯»å±‚ã€‚

![image-20240521152934039](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521152934039.png)

3ã€LowerDiré‡Œçš„æ¯ä¸ªè·¯å¾„ä¹‹é—´ç”¨å†’å·åˆ†éš”ï¼Œä»£è¡¨ä¸€å±‚å±‚buildçš„æ—¶å€™çš„å°è£…ã€‚

4ã€mergedå°±æ˜¯è”åˆæ–‡ä»¶æ•´ä½“çš„å‘ˆç°ã€‚



# ä¸‹é¢å¼€å§‹å­¦ä¹ æŒä¹…åŒ–ä¿å­˜



![image-20240521160637520](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521160637520.png)



1ã€sessionè¿™äº›å°±æ˜¯æœ‰çŠ¶æ€çš„ä¸œè¥¿ï¼Œæ²¡å¿…è¦æŒä¹…åŒ–ã€‚

2ã€mysqlæ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œéœ€è¦æŒä¹…åŒ–ã€‚



**æŒä¹…åŒ–çš„çš„æ–¹æ³•å°±æ˜¯ï¼š**

1ã€å®¹å™¨åˆ é™¤ï¼Œ/var/lib/doker/overlay2/xxxxxxxxx..xxxè¿™ä¸ªå¯¹åº”çš„æ–‡ä»¶å¤¹å°±è‡ªåŠ¨æ²¡äº†

2ã€å¯¹äºé‡è¦çš„æ•°æ®ï¼Œå•ç‹¬å­˜æ”¾åˆ°å®¿ä¸»çš„å…¶ä»–è·¯å¾„å°±è¡Œäº†ã€‚



**å…·ä½“çš„æŠ€æœ¯ï¼š**

1ã€æ•°æ®å·

2ã€æ•°æ®é›†å®¹å™¨å°±æ˜¯æ•°æ®å·çš„å˜ç§ï¼Œä¸å¸¸ç”¨



### ä½¿ç”¨æ–¹æ³•



docker run å‘½ä»¤çš„ä»¥ä¸‹æ ¼å¼å¯ä»¥å®ç°æ•°æ®å·

```shell
-v, --volume=[host-src:]container-dest[:<options>]

<options>
ro ä»å®¹å™¨å†…å¯¹æ­¤æ•°æ®å·æ˜¯åªè¯»ï¼Œä¸å†™æ­¤é¡¹é»˜è®¤ä¸ºå¯è¯»å¯å†™
rw ä»å®¹å™¨å†…å¯¹æ­¤æ•°æ®å·å¯è¯»å¯å†™ï¼Œæ­¤ä¸ºé»˜è®¤å€¼
host-src å®¿ä¸»æœºç›®å½•å¦‚æœä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º
```

ä¸ç®¡ä»€ä¹ˆæ–¹æ³•ï¼Œè‚¯å®šéƒ½ä¸åœ¨/var/lib/docker/overlay2/ä¸‹äº†ï¼Œä¸ä¼šéšå®¹å™¨åˆ é™¤è€Œåˆ é™¤



<span id=1>æ–¹æ³•1ï¼šæ‰‹åŠ¨æŒ‡å®šå®¿ä¸»ç›®å½•</span>

```shell
#æŒ‡å®šå®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶æ ¼å¼ï¼š
â€”v <å®¿ä¸»æœºç»å¯¹è·¯å¾„çš„ç›®å½•æˆ–æ–‡ä»¶>:<å®¹å™¨ç›®å½•æˆ–æ–‡ä»¶>[:ro]  # å°†å®¿ä¸»æœºç›®å½•æŒ‚è½½å®¹å™¨ç›®å½•ï¼Œä¸¤ä¸ªç›®å½•éƒ½å¯ä»¥è‡ªåŠ¨åˆ›å»º
```



<span id=2>æ–¹æ³•2ï¼šå·ID</span>

```shell
# åŒ¿åå·ï¼ŒåªæŒ‡å®šå®¹å™¨å†…è·¯å¾„ï¼Œæ²¡æœ‰æŒ‡å®šå®¿ä¸»æœºè·¯å¾„ä¿¡æ¯ï¼Œå®¿ä¸»æœºè‡ªåŠ¨ç”Ÿæˆ/var/lib/docker/volumes/<å·ID>/_dataç›®å½•ï¼Œå¹¶æŒ‚è½½è‡³å®¹å™¨æŒ‡å®šè·¯å¾„
-v <å®¹å™¨å†…è·¯å¾„>

# ç¤ºä¾‹ï¼š
docker run --name nginx -v /etc/nginx nginx
```



<span id=3>æ–¹æ³•3ï¼šå·åæ¯”å·IDè¯†åˆ«åº¦å¥½ï¼Œæœ€é€šç”¨çš„æ–¹å¼ã€‚</span>

```shell
#å‘½åå·å°†å›ºå®šçš„å­˜æ”¾åœ¨/var/lib/docker/volumes/<å·å>/_data
-v <å·å>:<å®¹å™¨ç›®å½•è·¯å¾„>
# å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœæ²¡æœ‰äº‹å…ˆåˆ›å»ºå·åï¼Œdocker runæ—¶ä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºã€‚
# é‡Œé¢å¤–é¢éƒ½èƒ½è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯æ–‡ä»¶ä¸è¡Œï¼

#ç¤ºä¾‹ï¼š
docker volume create vol1  # ä¹Ÿå¯ä»¥äº‹å…ˆä¸åˆ›å»ºï¼Œå°±æ˜¯è¿™å¥å¯ä»¥ä¸å†™çš„ã€‚
docker run -d -p 80:80 --name -v vol1:/usr/share/nginx/html nginx
```

docker rm çš„-vé€‰é¡¹å¯ä»¥åˆ é™¤å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶åˆ é™¤ç›¸å…³è”çš„åŒ¿åå·

```shell
-v,--volumes  Remove the volumes associated with the container
```





è¿™æ˜¯ä¹‹å‰Dockerfileé‡Œçš„VOLUMEä¹Ÿæœ‰ç±»ä¼¼çš„æ•ˆæœï¼Œå¥½åƒå°±æ˜¯æ–¹æ³•2çš„æ•ˆæœä¸€æ ·ã€‚

![image-20240521165754387](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521165754387.png)





![image-20240521170455848](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521170455848.png)

![image-20240521170517938](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521170517938.png)

è¿™ç§å°±æ˜¯éšæœºå­—ç¬¦ä¸²çš„ç›®å½•åï¼Œæ²¡æœ‰å¯è¯»æ€§å¥½çš„åå­—ï¼Œæ‰€ä»¥ä¸€èˆ¬å°±ç§°ä¹‹ä¸ºåŒ¿åå·ã€‚æ²¡æœ‰åå­—



### å®éªŒ

![image-20240521171752876](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521171752876.png)

æŠŠä¹‹å‰nginxçš„å®¹å™¨çš„Dockerfileæ¥åšæŒ‚è½½VOLUMEå®éªŒ

![image-20240521172201546](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521172201546.png)

Dockerfile.sonæœ¬æ¬¡å®éªŒä¸è¦å¤ªå…³æ³¨ï¼Œå°±æ˜¯æµ‹è¯•ONBUILD æŒ‡ä»¤çš„ã€‚



[**æ–¹æ³•2**](#2)

**å…ˆè·‘ä¸€ä¸ªä¸ç”¨æ–¹æ³•3çš„ï¼Œå› ä¸ºDockerfileç†ç”±æŒ‡å®šVOLUMEæ‰€ä»¥ä¹Ÿå°±æ˜¯æ–¹æ³•2çš„æ•ˆæœ**

å…ˆæ¸…ä¸€ä¸‹noneçš„é•œåƒdocker images -f "Dangling=true"

![image-20240521172858615](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521172858615.png)

![image-20240521172922048](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521172922048.png)

ä¸runä¸€ä¸‹æ˜¯æ²¡æœ‰VOLUMEå·çš„æ˜¯å§...åº”è¯¥æ˜¯çš„

![image-20240521173340806](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521173340806.png)



runèµ·æ¥çœ‹çœ‹

![image-20240521181240376](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521181240376.png)

![image-20240521181623398](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521181623398.png)

**ç„¶åé‡ç‚¹å…³æ³¨VOLUME**

![image-20240521182715677](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521182715677.png)

å› ä¸ºHOSTå˜é‡æ²¡æœ‰å€¼ï¼Œæ‰€ä»¥æ–‡ä»¶ä¹Ÿæ˜¯ç©ºçš„ğŸ‘‡

![image-20240522092534945](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522092534945.png)

ç„¶ååœ¨å®¿ä¸»æœºä¸Šå¾€é‡Œé¢å†™ç‚¹ä¸œè¥¿ç©ç©å“ˆå“ˆ

![image-20240522092814312](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522092814312.png)

è¿™ä¸å°±æœ‰äº†å—ï¼Œå“ˆå“ˆï¼Œå…¶å®åº”è¯¥å»entrypoint.shè„šæœ¬é‡Œï¼Œç»™HOSTèµ‹å€¼æ‰å¯¹å“¦~~



é¡ºä¾¿ä¹ŸçŸä¸€çœ¼å¥åº·æ£€æŸ¥çš„log

![image-20240521182916372](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240521182916372.png)







[**æ–¹æ³•1**](#1)

â€‹		å…ˆçœ‹ä¸‹æ–¹æ³•2çš„åŒ¿åå·(ä¹Ÿå°±æ˜¯VOLUMEåç§°æ˜¯éšæœºä¸€é•¿ä¸²å­—ç¬¦ä¸²)çš„æ•ˆæœ

æˆ‘æƒ³é€šè¿‡runlikeçœ‹åˆ°VOLUMEçš„å€¼ï¼Œçœ‹æ¥buildé˜¶æ®µçš„VOLUMEï¼Œruné˜¶æ®µæ˜¯çœ‹ä¸åˆ°çš„ï¼Œrunlikeå°±æ˜¯çœ‹docker runçš„é€‰é¡¹çš„ã€‚

â€‹		åªèƒ½é€šè¿‡inspectå»çœ‹å’¯

![image-20240522094828062](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522094828062.png)

å¯è§è¿™ä¸ªVOLUMEåç§°æ˜¯ä¸å‹å¥½çš„ï¼Œæ”¹ä¹‹ï¼Œ

```shell
docker run -d --name web2-run -P -v /dirtest/html:/dirtest/html -e DO       C_ROOT=/dirtest/html/ -e HOST=ttttttt web1
```

ğŸ‘‡å›¾ä¸­-e DOC_ROOT å’Œ-e HOSTæ˜¯ä¼ å‚ï¼Œè·³è½¬é¡µé¢è½¬å‘è·¯å¾„ï¼Œä»¥åŠHOSTè¿™é‡Œèµ‹å€¼ä¿®å¤è„šæœ¬é‡Œæ²¡ç»™HOSTèµ‹å€¼çš„æƒ…å†µã€‚

![image-20240522095340613](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522095340613.png)

ä¸Šå›¾ğŸ‘†curlçš„æ—¶å€™HOSTè¦æ³¨æ„ï¼Œå·²ç»è¢«ä½ æ”¹æˆttttttäº†ã€‚

![image-20240522095905010](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522095905010.png)

å®¹å™¨é‡Œé¢ä¹Ÿæ˜¯è‡ªåŠ¨åˆ›å»ºäº†è¿™ä¸ªç›®å½•

![image-20240522095434354](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522095434354.png)



å¥½äº†ç„¶åè¿™ä¸ªVOLUMEä¹Ÿæ˜¯è‡ªå®šä¹‰çš„å°±æ¯”è¾ƒå¥½ç»´æŠ¤äº†

![image-20240522100405083](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522100405083.png)



[**æ–¹æ³•3**](#3)æ‰æ˜¯æœ€æ£’çš„

```shell
docker run -d --name web3-run -P -v vol1:/dirtest/html -e DOC_ROOT=/dirtest/html/ -e HOST=www.test.tk web1
```

ä¸è¦è‡ªå·±å®šä¹‰å®¿ä¸»çš„æŒ‚è½½ç›®å½•ï¼Œå°±ç”¨ç»Ÿä¸€çš„/var/lib/docker/volumes/èµ·ä¸ªåå­—/_data/å°±è¡Œã€‚

![image-20240522101412278](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522101412278.png)



ç„¶åè¦æ³¨æ„å°±æ˜¯Dockerfileé‡Œçš„VOLUMEä½ ä¹Ÿæ²¡åˆ ï¼Œdocker run çš„æ—¶å€™åˆ-v vol1:/dirtest/html

![image-20240522102500419](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522102500419.png)

æ‰€ä»¥å°±æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªæŒ‚è½½å·äº†ğŸ‘†ã€‚



#### æ’æ’­dockerèµ·ä¸æ¥æ’é”™æ€è·¯

docker build okï¼Œrunçš„æ—¶å€™æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ’é”™

1ã€æ­£å‘æ£€æŸ¥ï¼ŒDockerfileæ˜¯å¦ok

2ã€docker ps -açœ‹çœ‹é‡Œé¢çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯CMDï¼Œä¸è¿‡çœ‹ä¸å…¨ï¼Œæ²¡äº‹ç”¨

```shell
docker inspect web3-run -f '{{.Args}}' 
```

çœ‹çš„å…¨

3ã€docker runå»æ‰-dï¼Œä¸æŒ‚åå°ï¼Œrunç€çœ‹çœ‹

4ã€docker logsçœ‹çœ‹ç°è±¡

5ã€docker exec è¿›å»æ‰‹åŠ¨å…¶æœåŠ¡æˆ–åˆ™CMDçš„å‘½ä»¤ï¼Œèµ·ä¸æ¥æ— éæ˜¯CMDé‚£æ¡é—®é¢˜ï¼Œèµ·æ¥è¿˜æœ‰åˆ«çš„é—®é¢˜æ‰æ˜¯è¿›ä¸€æ­¥çš„é…ç½®è®¾ç½®ä¹‹ç±»çš„ï¼Œç”¨ENTRYPOINTå’ŒCMDçš„ç»„åˆæ¥è§£é‡Šï¼Œé€šå¸¸æ˜¯åˆå§‹åŒ–è„šæœ¬æ²¡åˆå§‹åŒ–å¥½ç­‰ç­‰ã€‚æˆ–è€…RUNé‡Œçš„çš„apk addæ¼å®‰è£…åŒ…å•¦ä¹‹ç±»çš„ã€‚

![image-20240522104202770](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522104202770.png)

ä¸‹å›¾è¯´æ˜å¦‚æœæŒ‚è½½çš„å®¿ä¸»å·é‡Œæœ‰æ–‡ä»¶ï¼Œç„¶åDockerfileé‡Œæœ‰COPYäº†åŒåè¿™ä¸ªæ–‡ä»¶è¿›å»ï¼Œå“ªä¸€ä¸ªä¼˜å…ˆï¼Œå®¿ä¸»çš„ä¼˜å…ˆä¼šè¦†ç›–æ‰çš„ï¼Œå¦‚æœvol1é‡Œæ˜¯ç©ºçš„ï¼Œå°±ä¸ä¼šè¦†ç›–åŒåçš„æ–‡ä»¶äº†ğŸ‘‡

![image-20240522112001436](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522112001436.png)









# å·¥ä½œæ¡ˆä¾‹åˆ†äº«



linuxå¦‚ä½•æ‹¨v2ray

## 1ã€æ­å»ºæ¡¥æ¥clientï¼Œserveråˆ©æ—§

1ã€å®‰è£…docker

https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/

2ã€pullé•œåƒ

https://hub.docker.com/r/v2fly/v2fly-core/tags

3ã€runå®¹å™¨

https://github.com/v2fly/docker



![image-20240522164614007](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522164614007.png)

ä¿®æ”¹é…ç½®æ–‡ä»¶

![image-20240522164836662](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522164836662.png)

ä¸è¡Œï¼Œè¿›å»çœ‹ï¼Œ   #  **å…¶å®å°±æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶åæ²¡æœ‰é‡å¯å®¹å™¨**

![image-20240522164914462](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522164914462.png)

æ¢ä¸‹å›½å†…æº

https://mirrors.tuna.tsinghua.edu.cn/help/alpine/

å®‰è£…curlæµ‹è¯•ï¼Œåœ¨å®¹å™¨é‡Œ

![image-20240522165008327](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522165008327.png)



ç„¶åæ­£å¼å®æ–½çš„æ—¶å€™åŠ ä¸Š--restart alwayså’Œå®‰è£…runlike

```shell
docker run -d --name v2ray  --restart always -v vol1:/etc/v2ray -p 10086:1080 v2fly/v2fly-core run -c /etc/v2ray/config.json
 
yum -y install python3-pip
pip install runlike
```

![image-20240522171423795](6-Dockeræ•°æ®æŒä¹…åŒ–å’Œæ•°æ®å·.assets/image-20240522171423795.png)



## 2ã€æ­å»ºnginxåä»£

å°†socktåæŒ‡åˆ°æœ¬åœ°ç›‘å¬ç«¯å£

åˆ«æ­äº†äº†ï¼Œéœ€æ±‚æé”™äº†ï¼Œç›®å‰æ­£ç¡®çš„éœ€æ±‚æ˜¯å°†æ‰€æœ‰æµå…¥è¿›æ¥çš„æµé‡ï¼Œè½¬å‘åˆ°æœ¬åœ°çš„socks5:10086ä¸Šå»ã€‚

è€Œä¸æ˜¯å†é…ç½®ä¸€ä¸ªnginxå»æš´éœ²ä¸€ä¸ªç«¯å£



## 2ã€æ„å»ºæœ¬åœ°æµé‡è½¬å‘

1ã€ä½¿ç”¨sshè¯•è¯•

ä¸è¡Œï¼Œsshä¹Ÿæ˜¯è¦æŒ‡å®šç«¯å£çš„

2ã€iptables å¯è¡Œ

3ã€redsocks å¯è¡Œ

æ˜å¤©ç»§ç»­

https://tttang.com/archive/1878/



https://www.cnblogs.com/zhenyuyaodidiao/p/5494569.html

