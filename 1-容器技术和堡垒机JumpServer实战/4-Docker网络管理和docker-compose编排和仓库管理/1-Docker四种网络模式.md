# ç¬¬1èŠ‚ Dockerå››ç§ç½‘ç»œæ¨¡å¼



dockerçš„5ç§ç½‘ç»œæ¨¡å¼

1ã€noneï¼šæ²¡æœ‰ç½‘ç»œ

2ã€bridgeï¼šæ¡¥æ¥

3ã€containerï¼šå®¹å™¨

4ã€hostï¼šä¸»æœº

5ã€network-nameï¼Œè¿™ä¸€ç§ä¾èµ–äºå‰ç§



# 1ã€Bridgeæ¡¥æ¥æ¨¡å¼

ä¹Ÿæ˜¯é»˜è®¤æ¨¡å¼ï¼Œç±»ä¼¼Vmwareçš„NATæ¨¡å¼

![image-20240603164915618](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603164915618.png)



dockerå®‰è£…äº†é»˜è®¤ç»™ä½ ä¼˜åŒ–äº†ip-forward=1ï¼Œå¦‚æœæ˜¯k8sçš„containerdä¹Ÿè®¸æ—©æœŸæ˜¯æ²¡æœ‰çš„ï¼Œå¯èƒ½å°±éœ€è¦æ‰‹åŠ¨è°ƒæ•´è¿™äº›å†…æ ¸å‚æ•°ã€‚

```shell
docker network ls

docker inspect bridge  # å¯ä»¥æŸ¥çœ‹ç½‘å…³

iptables -vnL -t nat   # é…åˆdocker port xxx å¯è§PREROUTINGé‡Œçš„ç«¯å£æš´éœ²
```

![image-20240603170724285](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603170724285.png)



ä¸€äº›ç½‘æ®µé…ç½®ğŸ‘‡

```shell
vim /etc/docker/daemon.json
{
    "registry-mirrors":[
       "https://docker-hub.iwgame.com",
       "https://ustc-edu-cn.mirror.aliyuncs.com"
    ],
    "hosts":["tcp://0.0.0.0:2375","fd://"],  # /lib/systemd/system/docker.serviceé‡Œéœ€è¦åˆ æ‰å’Œè¿™é‡Œçš„é‡å¤é…ç½®
        "bip":"192.168.100.1/24",
        "fixed-cidr":"192.168.100.128/30",
        "fixed-cidr-v6":"2001:db8::/64",
        "mtu": 1500,
        "default-gateway":"192.168.100.2",
        "default-gateway-v6":"2001:db8:abcd::89",
        "dns":["1.1.1.1","8.8.8.8"]
}

```



![image-20240603180004573](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603180004573.png)



![image-20240603180024224](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603180024224.png)

å¼€å§‹åˆ›å»ºå®¹å™¨ï¼Œé¡¶å¤š4ä¸ªå’¯ï¼Œå› ä¸º/30å˜›



![image-20240603180052237](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603180052237.png)

ç¬¬äº”ä¸ªæœç„¶æŠ¥é”™äº†



![image-20240603180111246](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603180111246.png)



ç†è§£ä¸‹ä¸¤ä¸ªGW

![image-20240603180235716](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603180235716.png)

ä¸‹é¢ä¸€ä¸ªæ˜¯è¾…åŠ©ç½‘å…³ï¼Œå…·ä½“ç”¨æ³•ä¸æ¸…æ¥š~



# Hostæ¨¡å¼

ç±»ä¼¼äºVmwareçš„æ¡¥æ¥æ¨¡å¼

<img src="1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603181903947.png" alt="image-20240603181903947" style="zoom:50%;" />



å®¹å™¨é‡Œçš„ç½‘å¡å°±æ˜¯å®¿ä¸»æœºçš„ç½‘å¡äº†ï¼Œå¤šä¸ªå®¹å™¨ä¹‹é—´éœ€è¦åŒºåˆ†ç«¯å£äº†ã€‚

ä¹Ÿä¸å­˜åœ¨ç«¯å£æš´éœ²ä¸€è¯´ï¼Œå› ä¸ºç›´æ¥å°±æ˜¯å®¿ä¸»IPçš„ç«¯å£äº†ã€‚



![image-20240603182728351](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603182728351.png)



çœ‹çœ‹è¿™ä¸ªï¼Œå®Œå…¨å°±æ˜¯å®¿ä¸»ä¸Šæ‰€æœ‰ç½‘å¡éƒ½çœ‹çš„åˆ°äº†

![image-20240603182917476](1-Dockerå››ç§ç½‘ç»œæ¨¡å¼.assets/image-20240603182917476.png)





