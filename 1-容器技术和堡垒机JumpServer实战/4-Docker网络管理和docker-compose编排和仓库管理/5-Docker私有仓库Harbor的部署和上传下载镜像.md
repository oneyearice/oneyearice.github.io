# ç¬¬5èŠ‚ Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ



# ç®€è¿°

å®˜æ–¹çš„hub.docker.comçš„ä¸Šä¼ ![image-20240619094400007](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619094400007.png)

æ¯”å¦‚è‡ªå·±çš„ä¸€ä¸ªimageæ¨ä¸Šå»

```shell
docker tag openvpn:v001 oneyearice/openvpn:v001  # æ‰“æ ‡ç­¾å°±æ˜¯hub.docker.comçš„è´¦å·/é•œåƒ+tag

```



1ã€æ³¨å†Œè´¦å·





2ã€æ‰“æ ‡ç­¾ï¼Œæ‰“çš„æ˜¯ä»“åº“çš„IDå’Œé•œåƒä¿¡æ¯ï¼Œå¾…ä¼šç™»å…¥å“ªä¸ªä»“åº“å°±ç”¨å“ªä¸ªä»“åº“çš„IDã€‚

![image-20240619094933932](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619094933932.png)



3ã€ç™»å…¥æŒ‡å®šä»“åº“ï¼Œä¸æŒ‡å®šå°±æ˜¯å®˜æ–¹hub.docker.com

![image-20240619094921187](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619094921187.png)



![image-20240619095814308](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619095814308.png)

å¯†ç æœ¬åœ°æ˜¯å­˜èµ·æ¥äº†

![image-20240619100222914](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619100222914.png)





4ã€push

![image-20240619101717317](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619101717317.png)

æŠ¥é”™äº†ï¼Œå¥½åƒæ˜¯ä¸¤ä¸ªè´¦å·å†²çªäº†ï¼Œå°±æ˜¯ï¼Œoneyearice/è¿™ä¸ªè·¯å¾„ï¼Œçš„ç”¨oneyeariceè¿™ä¸ªè´¦å·æ¥ç™»å…¥ï¼Œç»“æœä¸Šé¢ç”¨çš„æ˜¯oneyearice@gmail.comç™»å…¥çš„ï¼Œè¿™ä¸ªè´¦å·çš„ä¸»ç›®å½•æ˜¯oneyeariceXXXæ˜¯ä»Šå¤©åˆšåˆšæ³¨å†Œçš„ï¼Œdeactiveè¿™ä¸ªè´¦å·å°±è¡Œäº†ã€‚

![image-20240619102741838](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619102741838.png)





å…¶å®å¯ä»¥ä¸å¿…ç”¨hub.docker.comçš„è´¦å·å¯†ç ï¼Œå¯ä»¥ç”¨ä¸“é—¨çš„access token



![image-20240619103035882](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619103035882.png)



![image-20240619103019513](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619103019513.png)







# Harbor

Vmwareå…¬å¸åšçš„

https://goharbor.io/

https://goharbor.io/docs/2.11.0/

https://github.com/vmware/

https://github.com/vmware/harbor



ç»„æˆï¼š

![image-20240619143936396](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619143936396.png)



![img](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/2238907-20211029101805703-890031358.png)



![image-20240619143953244](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619143953244.png)







harboræ˜¯åå‡ ä¸ªå®¹å™¨ç»„æˆçš„ï¼š

1ã€nginxï¼šnginxåšåä»£ï¼Œè¿™æ˜¯ä¸€ä¸ªå®¹å™¨ï¼›ç»™åç«¯å„ç§æœåŠ¡æä¾›åä»£

2ã€AdminServerï¼šå¯¹åº”å¯åŠ¨ç»„ä»¶harbor-admin serverï¼Œæ˜¯ç³»ç»Ÿçš„é…ç½®ç®¡ç†ä¸­å¿ƒé™„å¸¦æ£€æŸ¥å­˜å‚¨ç”¨é‡ï¼Œuiå’Œjobserverå¯åŠ¨æ—¶éœ€è¦åŠ è½½adminserveré…ç½®ã€‚

3ã€UIï¼šä»¥UIä¸ºå‰ç«¯çš„core serviceï¼šæ¶‰åŠUIã€APIã€Authï¼Œè€ŒAuth

4ã€APIï¼š

5ã€Authï¼šå¯¹æ¥AD/LDAP

6ã€AD/LDAP

7ã€LogCollector

8ã€DB

9ã€ReplicationService

10ã€Basic Registry



å®˜æ–¹æä¾›äº†è¿™äº›å®¹å™¨ç»„ä»¶å¯åŠ¨çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯docker-compolseçš„ymlæ–‡ä»¶ã€‚

# å®‰è£…Harbor

1ã€å®‰è£…docker

2ã€å®‰è£…docker-comose

ç„¶ådocker-composeåˆæ˜¯ä¾èµ–dockeræœåŠ¡çš„ï¼Œæ‰€ä»¥harborçš„å¯åŠ¨å°±éœ€è¦docker+docker-compose

3ã€ä¸‹è½½harborç¦»çº¿åŒ…

![image-20240619144515411](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619144515411.png)



![image-20240619144531125](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619144531125.png)



4ã€è§£å‹

![image-20240619145318811](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619145318811.png)

harborå†…éƒ¨æ‰€æœ‰åŠŸèƒ½ç»„ä»¶éƒ½æ˜¯ç”¨å®¹å™¨æä¾›çš„ï¼Œè€Œå®¹å™¨çš„é•œåƒéƒ½åœ¨harbor.v2.11.0.tar.gzè¿™ä¸ªåŒ…é‡Œäº†ï¼Œè¿™å°±æ˜¯æ‰€æœ‰imagesçš„æ‰“åŒ…æ–‡ä»¶ã€‚ç›¸å½“äºdocker save

![image-20240619145600057](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619145600057.png)

tar tvfé¢„è§ˆä¸€ä¸‹ï¼Œå¯è§éƒ½æ˜¯åˆ†å±‚é•œåƒæ–‡ä»¶ğŸ‘‡

![image-20240619145837255](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619145837255.png)

ç„¶åç†è®ºä¸Šå°±æ˜¯docker loadå¯¼å‡ºimagesï¼Œä½†æ˜¯äººå®¶æä¾›äº†è„šæœ¬ç»™ä½ äº†ğŸ‘‡ï¼Œè„šæœ¬é‡Œé¢å°±æœ‰docker load å‘½ä»¤

![image-20240619150258943](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619150258943.png)

è¿™ä¸ªè¿˜ä¸æ˜¯docker-compose.ymlæ–‡ä»¶å“¦ï¼Œåç¼€åä¹Ÿè¦æ”¹æˆymlğŸ‘‡ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯åˆå§‹åŒ–æ–‡ä»¶ï¼Œå°†æ¥è·‘å®Œinstall.shåï¼Œä¼šç”Ÿæˆdocker-comose.ymlæ–‡ä»¶çš„ã€‚

![image-20240619154621215](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619154621215.png)



5ã€ä¿®æ”¹ymlæ–‡ä»¶

![image-20240619155236366](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619155236366.png)

ä¿®æ”¹éƒ¨åˆ†å†…å®¹ğŸ‘‡

â‘ harborçš„è®¿é—®åŸŸåæˆ–è€…IP

![image-20240619155342824](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619155342824.png)

â‘¡sslè¯ä¹¦å¯ä»¥å…³æ‰ï¼Œå®éªŒç”¨æ— æ‰€è°“

![image-20240619155530333](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619155530333.png)

â‘¢é»˜è®¤çš„adminè´¦å·å¯†ç 

![image-20240619155656533](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619155656533.png)

å…¶ä»–ä¸ç”¨ä¿®æ”¹

metricæ˜¯Prometheusç›‘æ§ç”¨ğŸ‘‡

![image-20240619155908185](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619155908185.png)





6ã€è¿è¡Œinstall.shè¿›è¡Œå®‰è£…

æ—©æœŸéœ€è¦å®‰è£…pythonç¯å¢ƒï¼Œç°åœ¨pythonéƒ½æ˜¯è‡ªå¸¦äº†ï¼Œç‰ˆæœ¬ä¹Ÿä¸ä½ã€‚

![image-20240619170113744](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619170113744.png)

åŠ è½½é•œåƒğŸ‘‡

![image-20240619171427185](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619171427185.png)

å…¶åå°±ä¼šåˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œç„¶åå°±ä¼šä½¿ç”¨docker-compose up -då•¦ğŸ‘‡

![image-20240619183405420](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619183405420.png)

å¯è§proxyå°±æ˜¯nginxå•¦ï¼Œç„¶åè®¿é—®ä¸€ä¸‹å°±OKäº†

![image-20240619183910224](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619183910224.png)



![image-20240619183926266](5-Dockerç§æœ‰ä»“åº“Harborçš„éƒ¨ç½²å’Œä¸Šä¼ ä¸‹è½½é•œåƒ.assets/image-20240619183926266.png)

































